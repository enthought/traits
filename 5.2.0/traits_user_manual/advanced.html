<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8">
    
    <title>Advanced Topics &mdash; Traits 5 User Manual</title>
    
    <link rel="stylesheet" type="text/css" href="../_static/css/spc-bootstrap.css">
    <link rel="stylesheet" type="text/css" href="../_static/css/spc-extend.css">
    <link rel="stylesheet" href="../_static/enthought.css" type="text/css" >
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" >
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '5.2.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <script type="text/javascript" src="../_static/js/copybutton.js"></script>
    <script type="text/javascript" src="../_static/js/wrap_on_dot.js"></script>
    <link rel="shortcut icon" href="../_static/img/favicon.ico">
    <link rel="search" title="Search" href="../search.html" >
    <link rel="top" title="Traits 5 User Manual" href="../index.html" >
    <link rel="up" title="Traits 5 User Manual" href="index.html" >
    <link rel="next" title="Testing" href="testing.html" >
    <link rel="prev" title="Custom Traits" href="custom.html" > 
  </head>
  <body>
  <div class="container">
    <div class="header">
    </div>
  </div>

    <div class="container">
      <div class="main">
        
	<div class="row-fluid">
	  <div class="span12">
	    <div class="spc-navbar">
              
    <ul class="nav nav-pills pull-left">
	
        <li class="active"><a href="../index.html">Traits 5 User Manual</a></li>
	
          <li class="active"><a href="index.html" accesskey="U">Traits 5 User Manual</a></li> 
    </ul>
              
              
    <ul class="nav nav-pills pull-right">
      <li class="active">
        <a href="../py-modindex.html" title="Python Module Index"
           >modules</a>
      </li>
      <li class="active">
        <a href="testing.html" title="Testing"
           accesskey="N">next</a>
      </li>
      <li class="active">
        <a href="custom.html" title="Custom Traits"
           accesskey="P">previous</a>
      </li>
    </ul>
              
	    </div>
	  </div>
	</div>
        

	<div class="row-fluid">
          <div class="span9">
            
        <div class="bodywrapper">
          <div class="body" id="spc-section-body">
            
  <div class="section" id="advanced-topics">
<span id="id1"></span><h1>Advanced Topics<a class="headerlink" href="#advanced-topics" title="Permalink to this headline">¶</a></h1>
<p>The preceding sections provide enough information for you to use traits for
manifestly-typed attributes, with initialization and validation. This section
describes the advanced features of the Traits package</p>
<div class="section" id="initialization-and-validation-revisited">
<span id="id2"></span><h2>Initialization and Validation Revisited<a class="headerlink" href="#initialization-and-validation-revisited" title="Permalink to this headline">¶</a></h2>
<p>The following sections present advanced topics related to the initialization and
validation features of the Traits package.</p>
<ul class="simple">
<li>Dynamic initialization</li>
<li>Overriding default values</li>
<li>Reusing trait definitions</li>
<li>Trait attribute definition strategies</li>
</ul>
<div class="section" id="dynamic-initialization">
<span id="index-0"></span><span id="id3"></span><h3>Dynamic Initialization<a class="headerlink" href="#dynamic-initialization" title="Permalink to this headline">¶</a></h3>
<p>When you define trait attributes using predefined traits, the Trait() factory
function or trait handlers, you typically specify their default values
statically. You can also define a method that dynamically initializes a trait
attribute the first time that the attribute value is accessed. To do this, you
define a method on the same class as the trait attribute, with a name based on
the name of the trait attribute:</p>
<span class="target" id="index-1"></span><dl class="method">
<dt id="_name_default">
<code class="descname">_name_default</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#_name_default" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>This method initializes the <em>name</em> trait attribute, returning its initial value.
The method overrides any default value specified in the trait definition.</p>
<p id="index-2">It is also possible to define a dynamic method for the default value in a trait
type subclass (get_default_value()). However, using a
_<em>name</em>_default()  method avoids the overhead of subclassing a trait.</p>
<span class="target" id="index-3"></span></div>
<div class="section" id="overriding-default-values-in-a-subclass">
<span id="index-4"></span><span id="id4"></span><h3>Overriding Default Values in a Subclass<a class="headerlink" href="#overriding-default-values-in-a-subclass" title="Permalink to this headline">¶</a></h3>
<p>Often, a subclass must override a trait attribute in a parent class by providing
a different default value. You can specify a new default value without
completely re-specifying the trait definition for the attribute. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># override_default.py -- Example of overriding a default value for</span>
<span class="c1">#                        a trait attribute in a subclass</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">Range</span><span class="p">,</span> <span class="n">Str</span>

<span class="k">class</span> <span class="nc">Employee</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Str</span>
    <span class="n">salary_grade</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="n">value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Manager</span><span class="p">(</span><span class="n">Employee</span><span class="p">):</span>
    <span class="n">salary_grade</span> <span class="o">=</span> <span class="mi">5</span>
</pre></div>
</div>
<p>In this example, the <strong>salary_grade</strong> of the Employee class is a range from 1 to
10, with a default value of 1. In the Manager subclass, the default value of
<strong>salary_grade</strong> is 5, but it is still a range as defined in the Employee class.</p>
</div>
<div class="section" id="reusing-trait-definitions">
<span id="index-5"></span><span id="id5"></span><h3>Reusing Trait Definitions<a class="headerlink" href="#reusing-trait-definitions" title="Permalink to this headline">¶</a></h3>
<p>As mentioned in <a class="reference internal" href="defining.html#defining-traits-initialization-and-validation"><span class="std std-ref">Defining Traits: Initialization and Validation</span></a>, in most
cases, traits are defined in-line in attribute definitions, but they can also be
defined independently. A trait definition only describes the characteristics of
a trait, and not the current value of a trait attribute, so it can be used in
the definition of any number of attributes. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># trait_reuse.py --- Example of reusing trait definitions</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">Range</span>

<span class="n">coefficient</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">quadratic</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="n">coefficient</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="n">coefficient</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="n">coefficient</span>
    <span class="n">x</span>  <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="o">-</span><span class="mf">100.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
</pre></div>
</div>
<p>In this example, a trait named <strong>coefficient</strong> is defined externally to the
class <strong>quadratic</strong>, which references <strong>coefficient</strong> in the definitions of its
trait attributes <strong>c2</strong>, <strong>c1</strong>, and <strong>c0</strong>. Each of these attributes has a
unique value, but they all use the same trait definition to determine whether a
value assigned to them is valid.</p>
</div>
<div class="section" id="trait-attribute-definition-strategies">
<span id="index-6"></span><span id="id6"></span><h3>Trait Attribute Definition Strategies<a class="headerlink" href="#trait-attribute-definition-strategies" title="Permalink to this headline">¶</a></h3>
<p>In the preceding examples in this guide, all trait attribute definitions have
bound a single object attribute to a specified trait definition. This is known
as “explicit” trait attribute definition. The Traits package supports other
strategies for defining trait attributes. You can associate a category of
attributes with a particular trait definition, using the trait attribute name
wildcard. You can also dynamically create trait attributes that are specific to
an instance, using the add_trait() method, rather than defined on a class. These
strategies are described in the following sections.</p>
<div class="section" id="trait-attribute-name-wildcard">
<span id="index-7"></span><span id="id7"></span><h4>Trait Attribute Name Wildcard<a class="headerlink" href="#trait-attribute-name-wildcard" title="Permalink to this headline">¶</a></h4>
<p>The Traits package enables you to define a category of trait attributes
associated with a particular trait definition, by including an underscore (‘_’)
as a wildcard at the end of a trait attribute name. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># temp_wildcard.py --- Example of using a wildcard with a Trait</span>
<span class="c1">#                      attribute name</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">HasTraits</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="n">temp_</span> <span class="o">=</span> <span class="n">Any</span>
</pre></div>
</div>
<p>This example defines a class Person, with a category of attributes that have
names beginning with <code class="docutils literal notranslate"><span class="pre">temp</span></code>, and that are defined by the Any trait. Thus, any
part of the program that uses a Person instance can reference attributes such as
<strong>tempCount</strong>, <strong>temp_name</strong>, or <strong>temp_whatever</strong>, without having to explicitly
declare these trait attributes. Each such attribute has None as the initial
value and allows assignment of any value (because it is based on the Any trait).</p>
<p>You can even give all object attributes a default trait definition, by
specifying only the wildcard character for the attribute name:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># all_wildcard.py --- Example of trait attribute wildcard rules</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span> <span class="n">Str</span>

<span class="k">class</span> <span class="nc">Person</span> <span class="p">(</span> <span class="n">HasTraits</span> <span class="p">):</span>

    <span class="c1"># Normal, explicitly defined trait:</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">Str</span>

    <span class="c1"># By default, let all traits have any value:</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">Any</span>

    <span class="c1"># Except for this one, which must be an Int:</span>
    <span class="n">age</span> <span class="o">=</span> <span class="n">Int</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">&gt;&gt;&gt; bill = Person()</span>
<span class="sd">&gt;&gt;&gt; # These assignments should all work:</span>
<span class="sd">&gt;&gt;&gt; bill.name      = &#39;William&#39;</span>
<span class="sd">&gt;&gt;&gt; bill.address  = &#39;121 Drury Lane&#39;</span>
<span class="sd">&gt;&gt;&gt; bill.zip_code = 55212</span>
<span class="sd">&gt;&gt;&gt; bill.age      = 49</span>
<span class="sd">&gt;&gt;&gt; # This should generate an error (must be an Int):</span>
<span class="sd">&gt;&gt;&gt; bill.age = &#39;middle age&#39;</span>
<span class="sd">Traceback (most recent call last):</span>
<span class="sd">  File &quot;all_wildcard.py&quot;, line 33, in &lt;module&gt;</span>
<span class="sd">    bill.age = &#39;middle age&#39;</span>
<span class="sd">  File &quot;c:\wrk\src\lib\enthought\traits\\trait_handlers.py&quot;, line 163, in error</span>
<span class="sd">    raise TraitError( object, name, self.info(), value )</span>
<span class="sd">TraitError: The &#39;age&#39; trait of a Person instance must be an integer, but a value</span>
<span class="sd"> of &#39;middle age&#39; &lt;type &#39;str&#39;&gt; was specified.</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>
</div>
<p>In this case, all Person instance attributes can be created on the fly and are
defined by the Any trait.</p>
<div class="section" id="wildcard-rules">
<span id="index-8"></span><span id="id8"></span><h5>Wildcard Rules<a class="headerlink" href="#wildcard-rules" title="Permalink to this headline">¶</a></h5>
<p>When using wildcard characters in trait attribute names, the following rules are
used to determine what trait definition governs an attribute:</p>
<ol class="arabic simple">
<li>If an attribute name exactly matches a name without a wildcard character,
that definition applies.</li>
<li>Otherwise, if an attribute name matches one or more names with wildcard
characters, the definition with the longest name applies.</li>
</ol>
<p>Note that all possible attribute names are covered by one of these two rules.
The base HasTraits class implicitly contains the attribute definition
<code class="docutils literal notranslate"><span class="pre">_</span> <span class="pre">=</span> <span class="pre">Python</span></code>. This rule guarantees that, by default, all attributes have
standard Python language semantics.</p>
<p>These rules are demonstrated by the following example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># wildcard_rules.py -- Example of trait attribute wildcard rules</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span> <span class="n">Python</span>

<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="n">temp_count</span> <span class="o">=</span> <span class="n">Int</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp_</span>      <span class="o">=</span> <span class="n">Any</span>
    <span class="n">_</span>          <span class="o">=</span> <span class="n">Python</span>
</pre></div>
</div>
<p>In this example, the Person class has a <strong>temp_count</strong> attribute, which must be
an integer and which has an initial value of -1. Any other attribute with a name
starting with <code class="docutils literal notranslate"><span class="pre">temp</span></code> has an initial value of None and allows any value to be
assigned. All other object attributes behave like normal Python attributes
(i.e., they allow any value to be assigned, but they must have a value assigned
to them before their first reference).</p>
</div>
<div class="section" id="disallow-object">
<span id="index-9"></span><span id="id9"></span><h5>Disallow Object<a class="headerlink" href="#disallow-object" title="Permalink to this headline">¶</a></h5>
<p>The singleton object Disallow can be used with wildcards to disallow all
attributes that are not explicitly defined. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># disallow.py --- Example of using Disallow with wildcards</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> \
    <span class="n">Disallow</span><span class="p">,</span> <span class="n">Float</span><span class="p">,</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span> <span class="n">Str</span>

<span class="k">class</span> <span class="nc">Person</span> <span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="n">name</span>   <span class="o">=</span> <span class="n">Str</span>
    <span class="n">age</span>    <span class="o">=</span> <span class="n">Int</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">Float</span>
    <span class="n">_</span>      <span class="o">=</span> <span class="n">Disallow</span>
</pre></div>
</div>
<p>In this example, a Person instance has three trait attributes:</p>
<ul class="simple">
<li><strong>name</strong>: Must be a string; its initial value is ‘’.</li>
<li><strong>age</strong>: Must be an integer; its initial value is 0.</li>
<li><strong>weight</strong>: Must be a float; its initial value is 0.0.</li>
</ul>
<p>All other object attributes are explicitly disallowed. That is, any attempt to
read or set any object attribute other than <strong>name</strong>, <strong>age</strong>, or <strong>weight</strong>
causes an exception.</p>
</div>
<div class="section" id="hastraits-subclasses">
<span id="index-10"></span><span id="id10"></span><h5>HasTraits Subclasses<a class="headerlink" href="#hastraits-subclasses" title="Permalink to this headline">¶</a></h5>
<p>Because the HasTraits class implicitly contains the attribute definition
<code class="docutils literal notranslate"><span class="pre">_</span> <span class="pre">=</span> <span class="pre">Python</span></code>, subclasses of HasTraits by default have very standard Python
attribute behavior for any attribute not explicitly defined as a trait
attribute. However, the wildcard trait attribute definition rules make it easy
to create subclasses of HasTraits with very non-standard attribute behavior. Two
such subclasses are predefined in the Traits package: HasStrictTraits and
HasPrivateTraits.</p>
</div>
<div class="section" id="hasstricttraits">
<span id="index-11"></span><span id="id11"></span><h5>HasStrictTraits<a class="headerlink" href="#hasstricttraits" title="Permalink to this headline">¶</a></h5>
<p>This class guarantees that accessing any object attribute that does not have an
explicit or wildcard trait definition results in an exception. This can be
useful in cases where a more rigorous software engineering approach is employed
than is typical for Python programs. It also helps prevent typos and spelling
mistakes in attribute names from going unnoticed; a misspelled attribute name
typically causes an exception. The definition of HasStrictTraits is the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HasStrictTraits</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
      <span class="n">_</span> <span class="o">=</span> <span class="n">Disallow</span>
</pre></div>
</div>
<p>HasStrictTraits can be used to create type-checked data structures, as in the
following example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">TreeNode</span><span class="p">(</span><span class="n">HasStrictTraits</span><span class="p">):</span>
    <span class="n">left</span> <span class="o">=</span> <span class="n">This</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">This</span>
    <span class="n">value</span> <span class="o">=</span> <span class="n">Str</span>
</pre></div>
</div>
<p>This example defines a TreeNode class that has three attributes: <strong>left</strong>,
<strong>right</strong>, and <strong>value</strong>. The <strong>left</strong> and <strong>right</strong> attributes can only be
references to other instances of TreeNode (or subclasses), while the <strong>value</strong>
attribute must be a string. Attempting to set other types of values generates an
exception, as does attempting to set an attribute that is not one of the three
defined attributes. In essence, TreeNode behaves like a type-checked data
structure.</p>
</div>
<div class="section" id="hasrequiredtraits">
<span id="index-12"></span><span id="id12"></span><h5>HasRequiredTraits<a class="headerlink" href="#hasrequiredtraits" title="Permalink to this headline">¶</a></h5>
<p>This subclass of <a class="reference internal" href="#hasstricttraits"><span class="std std-ref">HasStrictTraits</span></a> ensures that any object attribute with
<code class="docutils literal notranslate"><span class="pre">required=True</span></code> in its metadata must be passed as an argument on object
initialization.</p>
<p>An example of a class with required traits:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">RequiredTest</span><span class="p">(</span><span class="n">HasRequiredTraits</span><span class="p">):</span>
    <span class="n">required_trait</span> <span class="o">=</span> <span class="n">Any</span><span class="p">(</span><span class="n">required</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">non_required_trait</span> <span class="o">=</span> <span class="n">Any</span><span class="p">()</span>
</pre></div>
</div>
<p>All required traits have to be provided as arguments on creating a new
instance:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_instance</span> <span class="o">=</span> <span class="n">RequiredTest</span><span class="p">(</span><span class="n">required_trait</span><span class="o">=</span><span class="mf">13.0</span><span class="p">)</span>
</pre></div>
</div>
<p>Non-required traits can also still be provided as usual:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_instance</span> <span class="o">=</span> <span class="n">RequiredTest</span><span class="p">(</span><span class="n">required_trait</span><span class="o">=</span><span class="mf">13.0</span><span class="p">,</span> <span class="n">non_required_trait</span><span class="o">=</span><span class="mf">14.0</span><span class="p">)</span>
</pre></div>
</div>
<p>However, omitting a required trait will raise a TraitError:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">new_instance</span> <span class="o">=</span> <span class="n">RequiredTest</span><span class="p">(</span><span class="n">non_required_trait</span><span class="o">=</span><span class="mf">14.0</span><span class="p">)</span>
<span class="go">traits.trait_errors.TraitError: The following required traits were not</span>
<span class="go">provided: required_trait.</span>
</pre></div>
</div>
</div>
<div class="section" id="hasprivatetraits">
<span id="index-13"></span><span id="id13"></span><h5>HasPrivateTraits<a class="headerlink" href="#hasprivatetraits" title="Permalink to this headline">¶</a></h5>
<p>This class is similar to HasStrictTraits, but allows attributes beginning with
‘_’ to have an initial value of None, and to not be type-checked. This is useful
in cases where a class needs private attributes, which are not part of the
class’s public API, to keep track of internal object state. Such attributes do
not need to be type-checked because they are only manipulated by the (presumably
correct) methods of the class itself. The definition of HasPrivateTraits is the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">HasPrivateTraits</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
      <span class="n">__</span> <span class="o">=</span> <span class="n">Any</span>
      <span class="n">_</span>  <span class="o">=</span> <span class="n">Disallow</span>
</pre></div>
</div>
<p>These subclasses of HasTraits are provided as a convenience, and their use is
completely optional. However, they do illustrate how easy it is to create
subclasses with customized default attribute behavior if desired.</p>
</div>
<div class="section" id="per-object-trait-attributes">
<span id="index-14"></span><span id="id14"></span><h5>Per-Object Trait Attributes<a class="headerlink" href="#per-object-trait-attributes" title="Permalink to this headline">¶</a></h5>
<p>The Traits package allows you to define dynamic trait attributes that are
object-, rather than class-, specific. This is accomplished using the
add_trait() method of the HasTraits class:</p>
<dl class="method">
<dt id="add_trait">
<code class="descname">add_trait</code><span class="sig-paren">(</span><em>name</em>, <em>trait</em><span class="sig-paren">)</span><a class="headerlink" href="#add_trait" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p id="index-15">For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># object_trait_attrs.py --- Example of per-object trait attributes</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">Range</span>

<span class="k">class</span> <span class="nc">GUISlider</span> <span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">eval</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span>
                 <span class="n">trait</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="nb">min</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="nb">max</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">initial</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">traits</span><span class="p">):</span>
        <span class="n">HasTraits</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">traits</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">min</span> <span class="o">&gt;</span> <span class="nb">max</span><span class="p">:</span>
                <span class="nb">min</span><span class="p">,</span> <span class="nb">max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">,</span> <span class="nb">min</span>
            <span class="k">if</span> <span class="n">initial</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">initial</span> <span class="o">=</span> <span class="nb">min</span>
            <span class="k">elif</span> <span class="ow">not</span> <span class="p">(</span><span class="nb">min</span> <span class="o">&lt;=</span> <span class="n">initial</span> <span class="o">&lt;=</span> <span class="nb">max</span><span class="p">):</span>
                <span class="n">initial</span> <span class="o">=</span> <span class="p">[</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">][</span>
                            <span class="nb">abs</span><span class="p">(</span><span class="n">initial</span> <span class="o">-</span> <span class="nb">min</span><span class="p">)</span> <span class="o">&gt;</span>
                            <span class="nb">abs</span><span class="p">(</span><span class="n">initial</span> <span class="o">-</span> <span class="nb">max</span><span class="p">)]</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="n">Range</span><span class="p">(</span><span class="nb">min</span><span class="p">,</span> <span class="nb">max</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">initial</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">trait</span><span class="p">)</span>
</pre></div>
</div>
<p>This example creates a GUISlider class, whose __init__() method can accept a
string label and either a trait definition or minimum, maximum, and initial
values. If no trait definition is specified, one is constructed based on the
<strong>max</strong> and <strong>min</strong> values. A trait attribute whose name is the value of label
is added to the object, using the trait definition (whether specified or
constructed). Thus, the label trait attribute on the GUISlider object is
determined by the calling code, and added in the __init__() method using
add_trait().</p>
<p>You can require that add_trait() must be used in order to add attributes to a
class, by deriving the class from HasStrictTraits (see <a class="reference internal" href="#hasstricttraits"><span class="std std-ref">HasStrictTraits</span></a>).
When a class inherits from HasStrictTraits, the program cannot create a new
attribute (either a trait attribute or a regular attribute) simply by assigning
to it, as is normally the case in Python. In this case, add_trait() is the only
way to create a new attribute for the class outside of the class definition.</p>
</div>
</div>
</div>
</div>
<div class="section" id="interfaces">
<span id="index-16"></span><span id="id15"></span><h2>Interfaces<a class="headerlink" href="#interfaces" title="Permalink to this headline">¶</a></h2>
<p>The Traits package supports declaring and implementing
<em>interfaces</em>. An interface is an abstract data type that defines a set of
attributes and methods that an object must have to work in a given situation.
The interface says nothing about what the attributes or methods do, or how they
do it; it just says that they have to be there. Interfaces in Traits are similar
to those in Java. They can be used to declare a relationship among classes which
have similar behavior but do not have an inheritance relationship. Like Traits
in general, Traits interfaces don’t make anything possible that is not already
possible in Python, but they can make relationships more explicit and enforced.
Python programmers routinely use implicit, informal interfaces (what’s known as
“duck typing”). Traits allows programmers to define explicit and formal
interfaces, so that programmers reading the code can more easily understand what
kinds of objects are actually <em>intended</em> to be used in a given situation.</p>
<div class="section" id="defining-an-interface">
<span id="index-17"></span><span id="id16"></span><h3>Defining an Interface<a class="headerlink" href="#defining-an-interface" title="Permalink to this headline">¶</a></h3>
<p>To define an interface, create a subclass of Interface:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">Interface</span>

<span class="k">class</span> <span class="nc">IName</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>

    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a string which is the name of an object. &quot;&quot;&quot;</span>
</pre></div>
</div>
<p>Interface classes serve primarily as documentation of the methods and
attributes that the interface defines. In this case, a class that implements the
<code class="docutils literal notranslate"><span class="pre">IName</span></code> interface must have a method named <code class="docutils literal notranslate"><span class="pre">get_name()</span></code>, which takes no arguments
and returns a string. Do not include any implementation code in an interface
declaration. However, the Traits package does not actually check to ensure that
interfaces do not contain implementations.</p>
<p>By convention, interface names have a capital ‘I’ at the beginning of the name.</p>
</div>
<div class="section" id="implementing-an-interface">
<span id="index-18"></span><span id="id17"></span><h3>Implementing an Interface<a class="headerlink" href="#implementing-an-interface" title="Permalink to this headline">¶</a></h3>
<p>A class declares that it implements one or more interfaces using the
<code class="xref py py-func docutils literal notranslate"><span class="pre">provides()</span></code> class decorator, which has the signature:</p>
<dl class="function">
<dt>
<code class="descclassname">traits.has_traits.</code><code class="descname">provides</code><span class="sig-paren">(</span><em>interface</em><span class="optional">[</span>, <em>interface2</em>, <em>...</em>, <em>interfaceN</em><span class="optional">]</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/traits/has_traits.html#provides"><span class="viewcode-link">[source]</span></a></dt>
<dd></dd></dl>

<p id="index-19">Interface names beyond the first one are optional. As for all class
decorators, the call to provides must occur just before the class
definition. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">Interface</span><span class="p">,</span> <span class="n">provides</span><span class="p">,</span> <span class="n">Str</span>

<span class="k">class</span> <span class="nc">IName</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_name</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a string which is the name of an object. &quot;&quot;&quot;</span>

<span class="nd">@provides</span><span class="p">(</span><span class="n">IName</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">Person</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>

    <span class="n">first_name</span> <span class="o">=</span> <span class="n">Str</span><span class="p">(</span> <span class="s1">&#39;John&#39;</span> <span class="p">)</span>
    <span class="n">last_name</span>  <span class="o">=</span> <span class="n">Str</span><span class="p">(</span> <span class="s1">&#39;Doe&#39;</span> <span class="p">)</span>

    <span class="c1"># Implementation of the &#39;IName&#39; interface:</span>
    <span class="k">def</span> <span class="nf">get_name</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&#39;&#39;&#39; Returns the name of an object. &#39;&#39;&#39;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{first}</span><span class="s1"> </span><span class="si">{last}</span><span class="s1">&#39;</span>
        <span class="k">return</span> <span class="n">name</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">last_name</span><span class="p">)</span>
</pre></div>
</div>
<p>You can specify whether the provides() decorator verifies that
the class calling it actually implements the interface that it says it does.
This is determined by the CHECK_INTERFACES variable, which can take one of three
values:</p>
<ul class="simple">
<li>0 (default): Does not check whether classes implement their declared interfaces.</li>
<li>1: Verifies that classes implement the interfaces they say they do, and logs
a warning if they don’t.</li>
<li>2: Verifies that classes implement the interfaces they say they do, and raises
an InterfaceError if they don’t.</li>
</ul>
<p>The CHECK_INTERFACES variable must be imported directly from the
traits.has_traits module:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">traits.has_traits</span>
<span class="n">traits</span><span class="o">.</span><span class="n">has_traits</span><span class="o">.</span><span class="n">CHECK_INTERFACES</span> <span class="o">=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="section" id="using-interfaces">
<span id="index-20"></span><span id="id18"></span><h3>Using Interfaces<a class="headerlink" href="#using-interfaces" title="Permalink to this headline">¶</a></h3>
<p>You can use an interface at any place where you would normally use a class name.
The most common way to use interfaces is with the
<a class="reference internal" href="../traits_api_reference/trait_types.html#traits.trait_types.Instance" title="traits.trait_types.Instance"><code class="xref py py-class docutils literal notranslate"><span class="pre">Instance</span></code></a> or
<a class="reference internal" href="../traits_api_reference/trait_types.html#traits.trait_types.Supports" title="traits.trait_types.Supports"><code class="xref py py-class docutils literal notranslate"><span class="pre">Supports</span></code></a> traits:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">Instance</span>
<span class="gp">&gt;&gt;&gt; </span><span class="k">class</span> <span class="nc">Apartment</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
<span class="gp">... </span>    <span class="n">renter</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">IName</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">william</span> <span class="o">=</span> <span class="n">Person</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s1">&#39;William&#39;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s1">&#39;Adams&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">apt1</span> <span class="o">=</span> <span class="n">Apartment</span><span class="p">(</span> <span class="n">renter</span><span class="o">=</span><span class="n">william</span> <span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span> <span class="s1">&#39;Renter is: &#39;</span><span class="p">,</span> <span class="n">apt1</span><span class="o">.</span><span class="n">renter</span><span class="o">.</span><span class="n">get_name</span><span class="p">()</span>
<span class="go">Renter is: William Adams</span>
</pre></div>
</div>
<p>Using an interface class with an <code class="docutils literal notranslate"><span class="pre">Instance</span></code> trait definition declares that the
trait accepts only values that implement the specified interface. Using the
<code class="docutils literal notranslate"><span class="pre">Supports</span></code> traits, if the assigned object does not implement the interface,
the Traits package may automatically substitute an adapter object that
implements the specified interface. See <a class="reference internal" href="#adaptation"><span class="std std-ref">Adaptation</span></a> for more
information.</p>
</div>
</div>
<div class="section" id="adaptation">
<span id="index-21"></span><span id="id19"></span><h2>Adaptation<a class="headerlink" href="#adaptation" title="Permalink to this headline">¶</a></h2>
<p><em>The adaptation features of Traits have been rewritten in v. 4.4.0 . See
the</em> <a class="reference internal" href="#migration"><span class="std std-ref">migration guide</span></a> <em>below for details regarding changes
in API.</em></p>
<p>Adaptation is the process of transforming an object that does not implement a
specific interface needed by a client into an object that does. In the adapter
pattern, an object is wrapped in a second object, the <em>adapter</em>,
that implements the target interface.</p>
<p>Adaptation enables a programming style in which each component or service in an
application defines an interface through which it would like to receive
information. Objects that need to communicate with the component declare
an adapter for that interface, as illustrated in the figure below.</p>
<img alt="../_images/adaptation.png" src="../_images/adaptation.png" />
<p>Adaptation allows decoupling the data model from the application components and
services: introducing a new component in the application should not require
modifying the data objects!</p>
<p>Traits provides a package to make this pattern easy and automatic:
In the <a class="reference internal" href="../traits_api_reference/traits.adaptation.html#module-traits.adaptation" title="traits.adaptation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">traits.adaptation</span></code></a> package, adapters from a protocol
(type or interface) to another can be registered with a manager object.
HasTraits classes can either explicitly request to adapt an object to a
protocol, or they can define special traits that automatically invoke
the adaptation manager whenever it is necessary.</p>
<p>For example, if a <a class="reference internal" href="../traits_api_reference/trait_types.html#traits.trait_types.Supports" title="traits.trait_types.Supports"><code class="xref py py-class docutils literal notranslate"><span class="pre">Supports</span></code></a> trait requires
its values to implement
interface <code class="docutils literal notranslate"><span class="pre">IPrintable</span></code>, and an object is assigned to it which is of
class <code class="docutils literal notranslate"><span class="pre">Image</span></code>, which does not implement <code class="docutils literal notranslate"><span class="pre">IPrintable</span></code>, then Traits looks for
an adapter from <code class="docutils literal notranslate"><span class="pre">Image</span></code> to <code class="docutils literal notranslate"><span class="pre">IPrintable</span></code>, and if one exists the adapter object
is assigned to the trait. If necessary, a “chain” of adapter objects might be
created, in order to perform the required adaptation.</p>
<div class="section" id="main-features">
<h3>Main features<a class="headerlink" href="#main-features" title="Permalink to this headline">¶</a></h3>
<p>The main features of the <a class="reference internal" href="../traits_api_reference/traits.adaptation.html#module-traits.adaptation" title="traits.adaptation"><code class="xref py py-mod docutils literal notranslate"><span class="pre">traits.adaptation</span></code></a> package are:</p>
<ul>
<li><p class="first">Support for Python classes, ABCs, and traits <a class="reference internal" href="../traits_api_reference/has_traits.html#traits.has_traits.Interface" title="traits.has_traits.Interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">Interface</span></code></a> s</p>
<blockquote>
<div><p>Protocols can be specified using any of those.</p>
</div></blockquote>
</li>
<li><p class="first">Chaining of adapters</p>
<blockquote>
<div><p>Adapters can be chained, i.e., an object can be adapted
to a target protocol as long as there is a sequence of adapters
that can be used to transform it.</p>
</div></blockquote>
</li>
<li><p class="first">Conditional adaptation</p>
<blockquote>
<div><p>Adaptation of an object to a protocol can be conditional, i.e. it may
succeed or fail depending on the state of the object.</p>
</div></blockquote>
</li>
<li><p class="first">Lazy loading</p>
<blockquote>
<div><p>The classes for the adapter, the origin, and the target protocols can
be specified as strings, and are only loaded if they are required.</p>
</div></blockquote>
</li>
</ul>
</div>
<div class="section" id="note-on-terminology">
<h3>Note on terminology<a class="headerlink" href="#note-on-terminology" title="Permalink to this headline">¶</a></h3>
<p>To avoid confusion, let’s define two terms that we will use all the time:</p>
<ul class="simple">
<li>We say that a class <em>provides</em> a protocol if it is a subclass of the
protocol, or if it implements the protocol (if it is an interface)</li>
<li>We say that a class <em>supports</em> a protocol if it provides the protocol
or an adapter object can be built that provides the protocol</li>
</ul>
</div>
<div class="section" id="defining-adapters">
<span id="index-22"></span><span id="id20"></span><h3>Defining Adapters<a class="headerlink" href="#defining-adapters" title="Permalink to this headline">¶</a></h3>
<div class="section" id="the-adapter-class">
<span id="subclassing-adapter"></span><span id="index-23"></span><h4>The <code class="xref py py-class docutils literal notranslate"><span class="pre">Adapter</span></code> class<a class="headerlink" href="#the-adapter-class" title="Permalink to this headline">¶</a></h4>
<p>The Traits package provides two classes for defining adapters,
one for Traits adapters, <a class="reference internal" href="../traits_api_reference/traits.adaptation.html#traits.adaptation.adapter.Adapter" title="traits.adaptation.adapter.Adapter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Adapter</span></code></a>,
and one for for pure-Python adapters,
<a class="reference internal" href="../traits_api_reference/traits.adaptation.html#traits.adaptation.adapter.PurePythonAdapter" title="traits.adaptation.adapter.PurePythonAdapter"><code class="xref py py-class docutils literal notranslate"><span class="pre">PurePythonAdapter</span></code></a>. These classes
streamline the process of creating a new adapter class. They have a standard
constructor that does not normally need to be overridden by subclasses. This
constructor accepts one parameter, which is the object to be adapted, and
assigns that object to an <code class="xref py py-attr docutils literal notranslate"><span class="pre">adaptee</span></code> attribute (a trait in the case
of <a class="reference internal" href="../traits_api_reference/traits.adaptation.html#traits.adaptation.adapter.Adapter" title="traits.adaptation.adapter.Adapter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Adapter</span></code></a>).</p>
<p>As an adapter writer, you need to take care of the following:</p>
<ul class="simple">
<li>Declare which interfaces the adapter class implements on behalf of the
object it is adapting. For example, if we are working with Traits
<a class="reference internal" href="../traits_api_reference/has_traits.html#traits.has_traits.Interface" title="traits.has_traits.Interface"><code class="xref py py-class docutils literal notranslate"><span class="pre">Interface</span></code></a> s, the adapter would be decorated with the
<a class="reference internal" href="../traits_api_reference/has_traits.html#traits.has_traits.provides" title="traits.has_traits.provides"><code class="xref py py-func docutils literal notranslate"><span class="pre">provides()</span></code></a> decorator. In the case of Python ABCs,
the class would be a subclass of the abstract base class, or be
<a class="reference external" href="http://docs.python.org/2/library/abc.html#abc.ABCMeta.register">registered with it</a>.</li>
<li>Implement the methods defined in the interfaces declared in the previous
step. Usually, these methods are implemented using appropriate members
on the adaptee object.</li>
</ul>
<ul class="simple" id="index-24">
<li>For Traits adapters, define a trait attribute named <strong>adaptee</strong> that
declares what type of object it is an adapter for. Usually, this is an
<a class="reference internal" href="../traits_api_reference/trait_types.html#traits.trait_types.Instance" title="traits.trait_types.Instance"><code class="xref py py-class docutils literal notranslate"><span class="pre">Instance</span></code></a> trait.</li>
</ul>
<p id="index-25">The following code example shows a definition of a simple adapter class:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">Adapter</span><span class="p">,</span> <span class="n">Instance</span><span class="p">,</span> <span class="n">provides</span>

<span class="c1"># Declare what interfaces this adapter implements for its client</span>
<span class="nd">@provides</span><span class="p">(</span><span class="n">IName</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">PersonToIName</span><span class="p">(</span><span class="n">Adapter</span><span class="p">):</span>

    <span class="c1"># Declare the type of client it supports:</span>
    <span class="n">adaptee</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span>

    <span class="c1"># Implement the &#39;IName&#39; interface on behalf of its client:</span>
    <span class="k">def</span> <span class="nf">get_name</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{first}</span><span class="s1"> </span><span class="si">{last}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">first</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">adaptee</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span>
                                       <span class="n">last</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">adaptee</span><span class="o">.</span><span class="n">last_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">name</span>
</pre></div>
</div>
</div>
<div class="section" id="registering-adapters">
<span id="index-26"></span><span id="id21"></span><h4>Registering adapters<a class="headerlink" href="#registering-adapters" title="Permalink to this headline">¶</a></h4>
<p>Once an adapter class has been defined, it has to be registered with the
adaptation manager using the <code class="xref py py-func docutils literal notranslate"><span class="pre">register_factory()</span></code>
function.</p>
<p>The signature of <code class="xref py py-func docutils literal notranslate"><span class="pre">register_factory()</span></code> is:</p>
<dl class="function">
<dt>
<code class="descclassname">traits.adaptation.api.</code><code class="descname">register_factory</code><span class="sig-paren">(</span><em>adapter_class</em>, <em>from_protocol</em>, <em>to_protocol</em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/traits/adaptation/adaptation_manager.html#register_factory"><span class="viewcode-link">[source]</span></a></dt>
<dd></dd></dl>

<p>The <a class="reference internal" href="../traits_api_reference/traits.adaptation.html#traits.adaptation.adaptation_manager.register_factory" title="traits.adaptation.adaptation_manager.register_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_factory()</span></code></a> function
takes as first argument
the adapter class (or an <a class="reference internal" href="#adapter-factories"><span class="std std-ref">adapter factory</span></a>), followed
by the protocol to be adapted (the one provided by the adaptee,
<code class="xref py py-attr docutils literal notranslate"><span class="pre">from_protocol</span></code>), and the protocol that it provides
(<code class="xref py py-attr docutils literal notranslate"><span class="pre">to_protocol</span></code>).</p>
<p id="index-27">This is the example from the previous section, were the adapter is registered:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">traits.adaptation.api</span> <span class="k">import</span> <span class="n">Adapter</span><span class="p">,</span> <span class="n">Instance</span><span class="p">,</span> <span class="n">provides</span>

<span class="c1"># Declare what interfaces this adapter implements for its client</span>
<span class="nd">@provides</span><span class="p">(</span><span class="n">IName</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">PersonToIName</span><span class="p">(</span><span class="n">Adapter</span><span class="p">):</span>

    <span class="c1"># Declare the type of client it supports:</span>
    <span class="n">adaptee</span> <span class="o">=</span> <span class="n">Instance</span><span class="p">(</span><span class="n">Person</span><span class="p">)</span>

    <span class="c1"># Implement the &#39;IName&#39; interface on behalf of its client:</span>
    <span class="k">def</span> <span class="nf">get_name</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="si">{first}</span><span class="s1"> </span><span class="si">{last}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">first</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">adaptee</span><span class="o">.</span><span class="n">first_name</span><span class="p">,</span>
                                       <span class="n">last</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">adaptee</span><span class="o">.</span><span class="n">last_name</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">name</span>

<span class="c1"># ... somewhere else at application startup.</span>
<span class="n">register_factory</span><span class="p">(</span><span class="n">PersonToIName</span><span class="p">,</span> <span class="n">Person</span><span class="p">,</span> <span class="n">IName</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="adapter-factories-and-conditional-adaptation">
<span id="adapter-factories"></span><span id="index-28"></span><h3>Adapter factories, and conditional adaptation<a class="headerlink" href="#adapter-factories-and-conditional-adaptation" title="Permalink to this headline">¶</a></h3>
<p>The first argument to the <code class="xref py py-func docutils literal notranslate"><span class="pre">register_factory()</span></code>
function needs not be an adapter <em>class</em>, it can be, more generally, an
adapter <em>factory</em>.</p>
<p>An adapter factory can be any callable that accepts one positional argument,
the adaptee object, and returns an adapter or None if the adaptation was
not possible. Adapter factories allow flexibility in the adaptation process,
as the result of adaptation may vary depending on the state of the
adaptee object.</p>
<div class="section" id="conditional-adaptation">
<span id="id22"></span><h4>Conditional adaptation<a class="headerlink" href="#conditional-adaptation" title="Permalink to this headline">¶</a></h4>
<p>A common use of adapter factories is to allow adaptation only if the
state of the adaptee object allows it. The factory returns an adapter object
if adaptation is possible, or None if it is not.</p>
<p>In the following example, a <code class="docutils literal notranslate"><span class="pre">numpy.ndarray</span></code> object can be adapted to provide
an <code class="docutils literal notranslate"><span class="pre">IImage</span></code> protocol only if the number of dimensions is 2. (For
illustration, this example uses Python ABCs rather than Traits Interfaces.)</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">abc</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">Array</span><span class="p">,</span> <span class="n">HasTraits</span>
<span class="kn">from</span> <span class="nn">traits.adaptation.api</span> <span class="k">import</span> <span class="n">adapt</span><span class="p">,</span> <span class="n">Adapter</span><span class="p">,</span> <span class="n">register_factory</span>

<span class="k">class</span> <span class="nc">ImageABC</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span>

<span class="k">class</span> <span class="nc">NDArrayToImage</span><span class="p">(</span><span class="n">Adapter</span><span class="p">):</span>
    <span class="n">adaptee</span> <span class="o">=</span> <span class="n">Array</span>

<span class="c1"># Declare that NDArrayToImage implements ImageABC.</span>
<span class="n">ImageABC</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="n">NDArrayToImage</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">ndarray_to_image_abc</span><span class="p">(</span><span class="n">adaptee</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; An adapter factory from numpy arrays to the ImageABC protocol.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">adaptee</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">NDArrayToImage</span><span class="p">(</span><span class="n">adaptee</span><span class="o">=</span><span class="n">adaptee</span><span class="p">)</span>
    <span class="k">return</span> <span class="kc">None</span>

<span class="c1"># ... somewhere else at application startup</span>
<span class="n">register_factory</span><span class="p">(</span><span class="n">ndarray_to_image_abc</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">ImageABC</span><span class="p">)</span>

<span class="c1"># Try to adapt numpy arrays to images. The `adapt` function is</span>
<span class="c1"># introduced later in the docs, but you can probably guess what it does ;-)</span>

<span class="c1"># This adaptation fails, as the array is 1D</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">adapt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="n">ImageABC</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="k">assert</span> <span class="n">image</span> <span class="o">==</span> <span class="kc">None</span>

<span class="c1"># This succeeds.</span>
<span class="n">image</span> <span class="o">=</span> <span class="n">adapt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]]),</span> <span class="n">ImageABC</span><span class="p">)</span>
<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">NDArrayToImage</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="requesting-an-adapter">
<span id="using-adapters"></span><span id="index-29"></span><h3>Requesting an adapter<a class="headerlink" href="#requesting-an-adapter" title="Permalink to this headline">¶</a></h3>
<div class="section" id="the-adapt-function">
<h4>The <code class="docutils literal notranslate"><span class="pre">adapt</span></code> function<a class="headerlink" href="#the-adapt-function" title="Permalink to this headline">¶</a></h4>
<p>Adapter classes are defined as described in the preceding sections, but you do
not explicitly create instances of these classes.</p>
<p>Instead, the function <a class="reference internal" href="../traits_api_reference/traits.adaptation.html#traits.adaptation.adaptation_manager.adapt" title="traits.adaptation.adaptation_manager.adapt"><code class="xref py py-func docutils literal notranslate"><span class="pre">adapt()</span></code></a> is
used, giving the object that needs to be adapted and the target protocol.</p>
<p>For instance, in the example in the <a class="reference internal" href="#conditional-adaptation"><span class="std std-ref">Conditional adaptation</span></a> section,
a 2D numpy array is adapted to an ImageABC protocol with</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">image</span> <span class="o">=</span> <span class="n">adapt</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],[</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">]]),</span> <span class="n">ImageABC</span><span class="p">)</span>
</pre></div>
</div>
<p>In some cases, no single adapter class is registered that adapts the object
to the required interface, but a series of adapter classes exist that,
together, perform the required adaptation. In such cases, the necessary set
of adapter objects are created, and the “last” link in the chain, the one
that actually implements the required interface, is returned.</p>
<p>When a situation like this arises, the adapted object assigned to the trait
always contains the smallest set of adapter objects needed to adapt the
original object. Also, more specific adapters are preferred over less specific
ones. For example, let’s suppose we have a class <code class="docutils literal notranslate"><span class="pre">Document</span></code> and a subclass
<code class="docutils literal notranslate"><span class="pre">HTMLDocument</span></code>. We register two adapters to an interface <code class="docutils literal notranslate"><span class="pre">IPrintable</span></code>,
<code class="docutils literal notranslate"><span class="pre">DocumentToIPrintable</span></code> and <code class="docutils literal notranslate"><span class="pre">HTMLDocumentToIPrintable</span></code>. The call</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">html_doc</span> <span class="o">=</span> <span class="n">HTMLDocument</span><span class="p">()</span>
<span class="n">printable</span> <span class="o">=</span> <span class="n">adapt</span><span class="p">(</span><span class="n">html_doc</span><span class="p">,</span> <span class="n">IPrintable</span><span class="p">)</span>
</pre></div>
</div>
<p>will return an instance of the <code class="docutils literal notranslate"><span class="pre">HTMLDocumentToIPrintable</span></code> adapter, as it
is more specific than <code class="docutils literal notranslate"><span class="pre">DocumentToIPrintable</span></code>.</p>
<p>If no single adapter and no adapter chain can be constructed for the requested
adaptation, an <a class="reference internal" href="../traits_api_reference/traits.adaptation.html#traits.adaptation.adaptation_error.AdaptationError" title="traits.adaptation.adaptation_error.AdaptationError"><code class="xref py py-class docutils literal notranslate"><span class="pre">AdaptationError</span></code></a>
is raised. Alternatively, one can specify a default value to be returned
in this case:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">printable</span> <span class="o">=</span> <span class="n">adapt</span><span class="p">(</span><span class="n">unprintable_doc</span><span class="p">,</span> <span class="n">IPrintable</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="n">EmptyPrintableDoc</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="section" id="using-traits-interfaces">
<h4>Using Traits interfaces<a class="headerlink" href="#using-traits-interfaces" title="Permalink to this headline">¶</a></h4>
<p>An alternative syntax to create adapters when using Traits Interfaces is
to use the interface class as an adapter factory, for example</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">printable</span> <span class="o">=</span> <span class="n">IPrintable</span><span class="p">(</span><span class="n">html_doc</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>is equivalent to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">printable</span> <span class="o">=</span> <span class="n">adapt</span><span class="p">(</span><span class="n">html_doc</span><span class="p">,</span> <span class="n">IPrintable</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</pre></div>
</div>
<p>(the default argument, None, is optional).</p>
</div>
<div class="section" id="using-the-supports-and-adaptsto-traits">
<h4>Using the <code class="docutils literal notranslate"><span class="pre">Supports</span></code> and <code class="docutils literal notranslate"><span class="pre">AdaptsTo</span></code> traits<a class="headerlink" href="#using-the-supports-and-adaptsto-traits" title="Permalink to this headline">¶</a></h4>
<p>Using the terminology introduced in this section, we can say that the
<a class="reference internal" href="../traits_api_reference/trait_types.html#traits.trait_types.Instance" title="traits.trait_types.Instance"><code class="xref py py-class docutils literal notranslate"><span class="pre">Instance</span></code></a> trait accepts values that <em>provide</em> the specified protocol.</p>
<p>Traits defines two additional traits that accept values that <em>support</em> a
given protocol (they provide it or can be adapted to it) instead:</p>
<ul class="simple">
<li>The <a class="reference internal" href="../traits_api_reference/trait_types.html#traits.trait_types.Supports" title="traits.trait_types.Supports"><code class="xref py py-class docutils literal notranslate"><span class="pre">Supports</span></code></a> trait accepts values that support the specified
protocol. The value of the trait after assignment is the possibly adapted
value (i.e., it is the original assigned value if that provides the protocol,
or is an adapter otherwise).</li>
<li>The <a class="reference internal" href="../traits_api_reference/trait_types.html#traits.trait_types.AdaptsTo" title="traits.trait_types.AdaptsTo"><code class="xref py py-class docutils literal notranslate"><span class="pre">AdaptsTo</span></code></a> trait also accepts values that support the specified
protocol. Unlike <code class="docutils literal notranslate"><span class="pre">Supports</span></code>, <code class="docutils literal notranslate"><span class="pre">AdaptsTo</span></code> stores the original, unadapted
value.</li>
</ul>
<p>If your application works with adaptation, it is natural to use the
<code class="docutils literal notranslate"><span class="pre">Supports</span></code> trait in place of the <code class="docutils literal notranslate"><span class="pre">Instance</span></code> one in most cases. This
will allow that application to be extended by adaptation in the future
without changing the existing code, without having to invoke adaptation
explicitly in your code.</p>
<p>For example, a Traits object can be written against the <code class="docutils literal notranslate"><span class="pre">IPrintable</span></code>
interface and be open to extensions by adaptation as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="p">(</span><span class="n">Adapter</span><span class="p">,</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">Interface</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">provides</span><span class="p">,</span>
                        <span class="n">register_factory</span><span class="p">,</span> <span class="n">Str</span><span class="p">,</span> <span class="n">Supports</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">IPrintable</span><span class="p">(</span><span class="n">Interface</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">get_formatted_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return text formatted with the given number of columns. &quot;&quot;&quot;</span>

<span class="k">class</span> <span class="nc">PrintQueue</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="c1"># This is the key part of the example: we declare a list of</span>
    <span class="c1"># items that provide or can be adapted to IPrintable</span>
    <span class="n">queue</span> <span class="o">=</span> <span class="n">List</span><span class="p">(</span><span class="n">Supports</span><span class="p">(</span><span class="n">IPrintable</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">is_empty</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span>

    <span class="k">def</span> <span class="nf">push</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">printable</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">printable</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">print_next</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">printable</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

        <span class="c1"># The elements from the list are guaranteed to provide</span>
        <span class="c1"># IPrintable, so we can call the interface without worrying</span>
        <span class="c1"># about adaptation.</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">printable</span><span class="o">.</span><span class="n">get_formatted_text</span><span class="p">(</span><span class="n">n_cols</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-- Start document --&#39;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lines</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;-- End of document -</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">TextDocument</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A text document. &quot;&quot;&quot;</span>
    <span class="n">text</span> <span class="o">=</span> <span class="n">Str</span>

<span class="nd">@provides</span><span class="p">(</span><span class="n">IPrintable</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">TextDocumentToIPrintable</span><span class="p">(</span><span class="n">Adapter</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adapt TextDocument and provide IPrintable. &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">get_formatted_text</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">):</span>
        <span class="kn">import</span> <span class="nn">textwrap</span>
        <span class="k">return</span> <span class="n">textwrap</span><span class="o">.</span><span class="n">wrap</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">adaptee</span><span class="o">.</span><span class="n">text</span><span class="p">,</span> <span class="n">n_cols</span><span class="p">)</span>


<span class="c1"># ---- Application starts here.</span>

<span class="c1"># Register the adapter.</span>
<span class="n">register_factory</span><span class="p">(</span><span class="n">TextDocumentToIPrintable</span><span class="p">,</span> <span class="n">TextDocument</span><span class="p">,</span> <span class="n">IPrintable</span><span class="p">)</span>

<span class="c1"># Create two text documents.</span>
<span class="n">doc1</span> <span class="o">=</span> <span class="n">TextDocument</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;very very long text the will bore you for sure&#39;</span><span class="p">)</span>
<span class="n">doc2</span> <span class="o">=</span> <span class="n">TextDocument</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;once upon a time in a far away galaxy&#39;</span><span class="p">)</span>

<span class="c1"># The text documents can be pushed on the print queue; in the process,</span>
<span class="c1"># they are automatically adapted by Traits.</span>
<span class="n">print_queue</span> <span class="o">=</span> <span class="n">PrintQueue</span><span class="p">()</span>
<span class="n">print_queue</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">doc1</span><span class="p">)</span>
<span class="n">print_queue</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="n">doc2</span><span class="p">)</span>

<span class="k">while</span> <span class="ow">not</span> <span class="n">print_queue</span><span class="o">.</span><span class="n">is_empty</span><span class="p">():</span>
    <span class="n">print_queue</span><span class="o">.</span><span class="n">print_next</span><span class="p">()</span>
</pre></div>
</div>
<p>This scripts produces this output:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">--</span> <span class="n">Start</span> <span class="n">document</span> <span class="o">--</span>
<span class="n">very</span> <span class="n">very</span> <span class="n">long</span> <span class="n">text</span>
<span class="n">the</span> <span class="n">will</span> <span class="n">bore</span> <span class="n">you</span>
<span class="k">for</span> <span class="n">sure</span>
<span class="o">--</span> <span class="n">End</span> <span class="n">of</span> <span class="n">document</span> <span class="o">-</span>

<span class="o">--</span> <span class="n">Start</span> <span class="n">document</span> <span class="o">--</span>
<span class="n">once</span> <span class="n">upon</span> <span class="n">a</span> <span class="n">time</span> <span class="ow">in</span>
<span class="n">a</span> <span class="n">far</span> <span class="n">away</span> <span class="n">galaxy</span>
<span class="o">--</span> <span class="n">End</span> <span class="n">of</span> <span class="n">document</span> <span class="o">-</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="implementation-details">
<h3>Implementation details<a class="headerlink" href="#implementation-details" title="Permalink to this headline">¶</a></h3>
<p>The algorithm for finding a sequence of adapters adapting an object <code class="docutils literal notranslate"><span class="pre">adaptee</span></code>
to a protocol <code class="docutils literal notranslate"><span class="pre">to_protocol</span></code> is based on a weighted graph.</p>
<p>Nodes on the graphs are protocols (types or interfaces).
Edges are adaptation offers that connect a <code class="docutils literal notranslate"><span class="pre">offer.from_protocol</span></code> to a
<code class="docutils literal notranslate"><span class="pre">offer.to_protocol</span></code>.</p>
<p>Edges connect protocol <code class="docutils literal notranslate"><span class="pre">A</span></code> to protocol <code class="docutils literal notranslate"><span class="pre">B</span></code> and are weighted by two
numbers in this priority:</p>
<ol class="arabic simple">
<li>a unit weight (1) representing the fact that we use 1 adaptation
offer to go from <code class="docutils literal notranslate"><span class="pre">A</span></code> to <code class="docutils literal notranslate"><span class="pre">B</span></code></li>
<li>the number of steps up the type hierarchy that we need to take
to go from <code class="docutils literal notranslate"><span class="pre">A</span></code> to <code class="docutils literal notranslate"><span class="pre">offer.from_protocol</span></code>, so that more specific
adapters are always preferred</li>
</ol>
<p>The algorithm finds the shortest weighted path between <code class="docutils literal notranslate"><span class="pre">adaptee</span></code>
and <code class="docutils literal notranslate"><span class="pre">to_protocol</span></code>. Once a candidate path is found, it tries to
create the chain of adapters using the factories in the adaptation offers
that compose the path. If this fails because of conditional
adaptation (i.e., an adapter factory returns None), the path
is discarded and the algorithm looks for the next shortest path.</p>
<p>Cycles in adaptation are avoided by only considering path were
every adaptation offer is used at most once.</p>
</div>
<div class="section" id="migration-guide">
<span id="migration"></span><h3>Migration guide<a class="headerlink" href="#migration-guide" title="Permalink to this headline">¶</a></h3>
<p>The implementation of the adaptation mechanism changed in Traits 4.4.0 from
one based on PyProtocols to a new, smaller, and more robust implementation.</p>
<p>Code written against <code class="docutils literal notranslate"><span class="pre">traits.protocols</span></code> will not work any longer as the
<code class="docutils literal notranslate"><span class="pre">traits.protocols</span></code> API has been removed in Traits 5.0.0 .</p>
<p>This is a list of replacements for the old API:</p>
<ul>
<li><p class="first"><code class="xref py py-class docutils literal notranslate"><span class="pre">traits.protocols.api.AdaptationFailure</span></code></p>
<p>Use <code class="xref py py-class docutils literal notranslate"><span class="pre">traits.api.AdaptationError</span></code> instead.</p>
</li>
<li><p class="first"><code class="xref py py-func docutils literal notranslate"><span class="pre">traits.api.adapts()</span></code></p>
<p>Use the <code class="xref py py-func docutils literal notranslate"><span class="pre">traits.api.register_factory()</span></code> function.</p>
</li>
<li><p class="first"><code class="xref py py-func docutils literal notranslate"><span class="pre">implements()</span></code></p>
<p>Use the <code class="xref py py-func docutils literal notranslate"><span class="pre">traits.api.provides()</span></code> decorator instead.</p>
</li>
<li><p class="first"><code class="xref py py-func docutils literal notranslate"><span class="pre">traits.protocols.api.declareAdapter()</span></code></p>
<p>Use the function <code class="xref py py-func docutils literal notranslate"><span class="pre">traits.api.register_factory()</span></code>, or the function
<code class="xref py py-func docutils literal notranslate"><span class="pre">traits.adaptation.api.register_offer()</span></code> instead. It is no longer
necessary to distinguish between “types”, “protocols”, and “objects”.</p>
</li>
<li><p class="first"><code class="xref py py-func docutils literal notranslate"><span class="pre">traits.protocols.api.declareImplementation()</span></code></p>
<p>This function
was used occasionally to declare that an arbitrary type (e.g., <code class="docutils literal notranslate"><span class="pre">dict</span></code>)
implements an interface. Users that use Python ABCs can use the <code class="docutils literal notranslate"><span class="pre">register</span></code>
method for achieving the same result. Otherwise, use the function
<code class="xref py py-func docutils literal notranslate"><span class="pre">traits.adaptation.api.register_provides()</span></code> that declares a “null”
adapter to adapt the type to the interface.</p>
</li>
<li><p class="first">Testing if a class is an Interface</p>
<p><code class="docutils literal notranslate"><span class="pre">issubclass(klass,</span> <span class="pre">Interface)</span></code> is not reliable, use
<code class="xref py py-func docutils literal notranslate"><span class="pre">traits.api.isinterface()</span></code> instead</p>
</li>
</ul>
</div>
<div class="section" id="gotchas">
<h3>Gotchas<a class="headerlink" href="#gotchas" title="Permalink to this headline">¶</a></h3>
<ol class="arabic simple">
<li>The adaptation mechanism does not explicitly support old-style classes.
Adaptation might work in particular cases but is not guaranteed to work
correctly in situations involving old-style classes. When used with Traits,
the classes involved in adaptation are typically subclasses of
<a class="reference internal" href="../traits_api_reference/has_traits.html#traits.has_traits.HasTraits" title="traits.has_traits.HasTraits"><code class="xref py py-class docutils literal notranslate"><span class="pre">HasTraits</span></code></a>, in which case this is not an issue.</li>
<li>The methods <a class="reference internal" href="../traits_api_reference/traits.adaptation.html#traits.adaptation.adaptation_manager.register_factory" title="traits.adaptation.adaptation_manager.register_factory"><code class="xref py py-func docutils literal notranslate"><span class="pre">register_factory()</span></code></a>,
<a class="reference internal" href="../traits_api_reference/traits.adaptation.html#traits.adaptation.adaptation_manager.adapt" title="traits.adaptation.adaptation_manager.adapt"><code class="xref py py-func docutils literal notranslate"><span class="pre">adapt()</span></code></a>,
etc. use a global adaptation manager, which is accessible through the
function
<a class="reference internal" href="../traits_api_reference/traits.adaptation.html#traits.adaptation.adaptation_manager.get_global_adaptation_manager" title="traits.adaptation.adaptation_manager.get_global_adaptation_manager"><code class="xref py py-func docutils literal notranslate"><span class="pre">get_global_adaptation_manager()</span></code></a>.
The traits automatic adaptation features also use the global manager.
Having a global adaptation manager can get you into trouble, for the usual
reasons related to having a global state. If you want to have more control
over adaptation, we recommend creating a new
<a class="reference internal" href="../traits_api_reference/traits.adaptation.html#traits.adaptation.adaptation_manager.AdaptationManager" title="traits.adaptation.adaptation_manager.AdaptationManager"><code class="xref py py-class docutils literal notranslate"><span class="pre">AdaptationManager</span></code></a>
instance, use it directly in your application, and set it as the global
manager using
<a class="reference internal" href="../traits_api_reference/traits.adaptation.html#traits.adaptation.adaptation_manager.set_global_adaptation_manager" title="traits.adaptation.adaptation_manager.set_global_adaptation_manager"><code class="xref py py-func docutils literal notranslate"><span class="pre">set_global_adaptation_manager()</span></code></a>.
A common issue with the global manager arises in unittesting, where adapters
registered in one test influence the outcome of other tests downstream.
Tests relying on adaptation should make sure to reset the state of the
global adapter using
<a class="reference internal" href="../traits_api_reference/traits.adaptation.html#traits.adaptation.adaptation_manager.reset_global_adaptation_manager" title="traits.adaptation.adaptation_manager.reset_global_adaptation_manager"><code class="xref py py-func docutils literal notranslate"><span class="pre">reset_global_adaptation_manager()</span></code></a>.</li>
</ol>
</div>
<div class="section" id="recommended-readings-about-adaptation">
<h3>Recommended readings about adaptation<a class="headerlink" href="#recommended-readings-about-adaptation" title="Permalink to this headline">¶</a></h3>
<p>This is a list of interesting readings about adaptation and the adapter
pattern outside of Traits:</p>
<ul class="simple">
<li><a class="reference external" href="http://peak.telecommunity.com/protocol_ref/module-protocols.html">PyProtocols</a>,
a precursor of <code class="docutils literal notranslate"><span class="pre">traits.adaptation</span></code></li>
<li><a class="reference external" href="http://www.python.org/dev/peps/pep-0246/">PEP 246</a> on object adaptation</li>
<li><a class="reference external" href="http://www.eclipse.org/articles/article.php?file=Article-Adapters/index.html">Article about adapters in Eclipse plugins</a></li>
</ul>
</div>
</div>
<div class="section" id="property-traits">
<span id="index-30"></span><span id="id23"></span><h2>Property Traits<a class="headerlink" href="#property-traits" title="Permalink to this headline">¶</a></h2>
<p>The predefined Property() trait factory function defines a Traits-based version
of a Python property, with “getter” and “setter” methods. This type of trait
provides a powerful technique for defining trait attributes whose values depend
on the state of other object attributes. In particular, this can be very useful
for creating synthetic trait attributes which are editable or displayable in a
TraitUI view.</p>
<div class="section" id="property-factory-function">
<span id="id24"></span><h3>Property Factory Function<a class="headerlink" href="#property-factory-function" title="Permalink to this headline">¶</a></h3>
<p>The Property() function has the following signature:</p>
<dl class="function">
<dt id="traits.adaptation.api.Property">
<code class="descclassname">traits.adaptation.api.</code><code class="descname">Property</code><span class="sig-paren">(</span><span class="optional">[</span><em>fget=None</em>, <em>fset=None</em>, <em>fvalidate=None</em>, <em>force=False</em>, <em>handler=None</em>, <em>trait=None</em>, <em>**metadata</em><span class="optional">]</span><span class="sig-paren">)</span><a class="headerlink" href="#traits.adaptation.api.Property" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<p>All parameters are optional, including the <em>fget</em> “getter”, <em>fvalidate</em>
“validator”  and <em>fset</em> “setter” methods. If no parameters are specified, then
the trait looks for and uses methods on the same class as the attribute that
the trait is assigned to, with names of the form _get_<em>name</em>(),
_validate_<em>name</em>() and _set_<em>name</em>(), where <em>name</em> is the name of the
trait attribute.</p>
<p>If you specify a trait as either the <em>fget</em> parameter or the <em>trait</em> parameter,
that trait’s handler supersedes the <em>handler</em> argument, if any. Because the
<em>fget</em> parameter accepts either a method or a trait, you can define a Property
trait by simply passing another trait. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">source</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span> <span class="n">Code</span> <span class="p">)</span>
</pre></div>
</div>
<p>This line defines a trait whose value is validated by the Code trait, and whose
getter and setter methods are defined elsewhere on the same class.</p>
<p>If a Property trait has only a getter function, it acts as read-only; if it has
only a setter function, it acts as write-only. It can lack a function due to two
situations:</p>
<ul class="simple">
<li>A function with the appropriate name is not defined on the class.</li>
<li>The <em>force</em> option is True, (which requires the Property() factory function
to ignore functions on the class) and one of the access functions was not
specified in the arguments.</li>
</ul>
</div>
<div class="section" id="caching-a-property-value">
<span id="index-31"></span><span id="id25"></span><h3>Caching a Property Value<a class="headerlink" href="#caching-a-property-value" title="Permalink to this headline">¶</a></h3>
<p>In some cases, the cost of computing the value of a property trait attribute may
be very high. In such cases, it is a good idea to cache the most recently
computed value, and to return it as the property value without recomputing it.
When a change occurs in one of the attributes on which the cached value depends,
the cache should be cleared, and the property value should be recomputed the
next time its value is requested.</p>
<p id="index-32">One strategy to accomplish caching would be to use a private attribute for the
cached value, and notification listener methods on the attributes that are
depended on. However, to simplify the situation, Property traits support a
&#64;cached_property decorator and <strong>depends_on</strong> metadata. Use &#64;cached_property to
indicate that a getter method’s return value should be cached. Use
<strong>depends_on</strong> to indicate the other attributes that the property depends on.</p>
<p id="index-33">For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># cached_prop.py -- Example of @cached_property decorator</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">HasPrivateTraits</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Int</span><span class="p">,</span>\
                                 <span class="n">Property</span><span class="p">,</span> <span class="n">cached_property</span>

<span class="k">class</span> <span class="nc">TestScores</span> <span class="p">(</span> <span class="n">HasPrivateTraits</span> <span class="p">):</span>

    <span class="n">scores</span>  <span class="o">=</span> <span class="n">List</span><span class="p">(</span> <span class="n">Int</span> <span class="p">)</span>
    <span class="n">average</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span> <span class="n">depends_on</span> <span class="o">=</span> <span class="s1">&#39;scores&#39;</span> <span class="p">)</span>

    <span class="nd">@cached_property</span>
    <span class="k">def</span> <span class="nf">_get_average</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">scores</span>
        <span class="k">return</span> <span class="p">(</span><span class="nb">float</span><span class="p">(</span> <span class="n">reduce</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">n1</span><span class="p">,</span> <span class="n">n2</span><span class="p">:</span> <span class="n">n1</span> <span class="o">+</span> <span class="n">n2</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span> <span class="p">)</span>
                 <span class="o">/</span> <span class="nb">len</span><span class="p">(</span> <span class="n">s</span> <span class="p">))</span>
</pre></div>
</div>
<p>The &#64;cached_property decorator takes no arguments. Place it on the line
preceding the property’s getter method.</p>
<p>The <strong>depends_on</strong> metadata attribute accepts extended trait references, using
the same syntax as the on_trait_change() method’s name parameter, described in
<a class="reference internal" href="notification.html#the-name-parameter"><span class="std std-ref">The name Parameter</span></a>. As a result, it can take values that specify
attributes on referenced objects, multiple attributes, or attributes that are
selected based on their metadata attributes.</p>
</div>
</div>
<div class="section" id="persistence">
<span id="index-34"></span><span id="id26"></span><h2>Persistence<a class="headerlink" href="#persistence" title="Permalink to this headline">¶</a></h2>
<p>In version 3.0, the Traits package provides __getstate__() and __setstate__()
methods on HasTraits, to implement traits-aware policies for serialization and
deserialization (i.e., pickling and unpickling).</p>
<div class="section" id="pickling-hastraits-objects">
<span id="index-35"></span><span id="id27"></span><h3>Pickling HasTraits Objects<a class="headerlink" href="#pickling-hastraits-objects" title="Permalink to this headline">¶</a></h3>
<p>Often, you may wish to control for a HasTraits subclass which parts of an
instance’s state are saved, and which are discarded. A typical approach is to
define a __getstate__() method that copies the object’s __dict__ attribute, and
deletes those items that should not be saved. This approach works, but can have
drawbacks, especially related to inheritance.</p>
<p id="index-36">The HasTraits __getstate__() method uses a more generic approach, which
developers can customize through the use of traits metadata attributes, often
without needing to override or define a __getstate__() method in their
application classes. In particular, the HasTraits __getstate__() method discards
the values of all trait attributes that have the <strong>transient</strong> metadata
attribute set to True, and saves all other trait attributes. So, to mark which
trait values should not be saved, you set <strong>transient</strong> to True in the metadata
for those trait attributes. The benefits of this approach are that you do not
need to override __getstate__(), and that the metadata helps document the
pickling behavior of the class.</p>
<p id="index-37">For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># transient_metadata.py -- Example of using &#39;transient&#39; metadata</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">File</span><span class="p">,</span> <span class="n">Any</span>

<span class="k">class</span> <span class="nc">DataBase</span> <span class="p">(</span> <span class="n">HasTraits</span> <span class="p">):</span>
    <span class="c1"># The name of the data base file:</span>
    <span class="n">file_name</span> <span class="o">=</span> <span class="n">File</span>

    <span class="c1"># The open file handle used to access the data base:</span>
    <span class="n">file</span> <span class="o">=</span> <span class="n">Any</span><span class="p">(</span> <span class="n">transient</span> <span class="o">=</span> <span class="kc">True</span> <span class="p">)</span>
</pre></div>
</div>
<p>In this example, the DataBase class’s file trait is marked as transient because
it normally contains an open file handle used to access a data base. Since file
handles typically cannot be pickled and restored, the file handle should not be
saved as part of the object’s persistent state. Normally, the file handle would
be re-opened by application code after the object has been restored from its
persisted state.</p>
</div>
<div class="section" id="predefined-transient-traits">
<span id="index-38"></span><span id="id28"></span><h3>Predefined Transient Traits<a class="headerlink" href="#predefined-transient-traits" title="Permalink to this headline">¶</a></h3>
<p>A number of the predefined traits in the Traits package are defined with
<strong>transient</strong> set to True, so you do not need to explicitly mark them. The
automatically transient traits are:</p>
<ul class="simple">
<li>Constant</li>
<li>Event</li>
<li>Read-only and write-only Property traits (See <a class="reference internal" href="#property-factory-function"><span class="std std-ref">Property Factory Function</span></a>)</li>
<li>Shadow attributes for mapped traits (See <a class="reference internal" href="custom.html#mapped-traits"><span class="std std-ref">Mapped Traits</span></a>)</li>
<li>Private attributes of HasPrivateTraits subclasses (See <a class="reference internal" href="#hasprivatetraits"><span class="std std-ref">HasPrivateTraits</span></a>)</li>
<li>Delegate traits that do not have a local value overriding the delegation.
Delegate traits with a local value are non-transient, i.e., they are
serialized. (See <a class="reference internal" href="deferring.html#delegatesto"><span class="std std-ref">DelegatesTo</span></a>) You can mark a Delegate trait as
transient if you do not want its value to ever be serialized.</li>
</ul>
</div>
<div class="section" id="overriding-getstate">
<span id="index-39"></span><span id="id29"></span><h3>Overriding __getstate__()<a class="headerlink" href="#overriding-getstate" title="Permalink to this headline">¶</a></h3>
<p>In general, try to avoid overriding __getstate__() in subclasses of HasTraits.
Instead, mark traits that should not be pickled with <code class="docutils literal notranslate"><span class="pre">transient</span> <span class="pre">=</span> <span class="pre">True</span></code>
metadata.</p>
<p>However, in cases where this strategy is insufficient, use the following pattern
to override __getstate__() to remove items that should not be persisted:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">__getstate__</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
    <span class="n">state</span> <span class="o">=</span> <span class="nb">super</span><span class="p">(</span> <span class="n">XXX</span><span class="p">,</span> <span class="bp">self</span> <span class="p">)</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">[</span> <span class="s1">&#39;foo&#39;</span><span class="p">,</span> <span class="s1">&#39;bar&#39;</span> <span class="p">]:</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">state</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">state</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span>

    <span class="k">return</span> <span class="n">state</span>
</pre></div>
</div>
</div>
<div class="section" id="unpickling-hastraits-objects">
<span id="unpicking-hastraits-objects"></span><span id="index-40"></span><h3>Unpickling HasTraits Objects<a class="headerlink" href="#unpickling-hastraits-objects" title="Permalink to this headline">¶</a></h3>
<p>The __setstate__() method of HasTraits differs from the default Python behavior
in one important respect: it explicitly sets the value of each attribute using
the values from the state dictionary, rather than simply storing or copying the
entire state dictionary to its <strong>__dict__</strong> attribute. While slower, this
strategy has the advantage of generating trait change notifications for each
attribute. These notifications are important for classes that rely on them to
ensure that their internal object state remains consistent and up to date.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If you’re manually creating state dictionaries for consumption by
__setstate__(), you should be aware of an additional implementation detail:
when pickling, the HasTraits __getstate__() method returns a dictionary with
an extra <code class="docutils literal notranslate"><span class="pre">'__traits_version__'</span></code> key giving the version of Traits used at
pickling time.  If this key is not present when unpickling, the HasTraits
__setstate__() method falls back to a compatibility mode and may not restore
the state correctly.  For the same reason, if you’re overriding
__getstate__(), you should be careful to make the appropriate <code class="docutils literal notranslate"><span class="pre">super(...,</span>
<span class="pre">self).__getstate__()</span></code> call.</p>
</div>
</div>
<div class="section" id="overriding-setstate">
<span id="index-41"></span><span id="id30"></span><h3>Overriding __setstate__()<a class="headerlink" href="#overriding-setstate" title="Permalink to this headline">¶</a></h3>
<p>You may wish to override the HasTraits __setstate__() method, for example for
classes that do not need to receive trait change notifications, and where the
overhead of explicitly setting each attribute is undesirable. You can
override __setstate__() to update the object’s __dict__ directly. However, in
such cases, it is important ensure that trait notifications are properly set
up so that later change notifications are handled. You can do this in two ways:</p>
<ul class="simple">
<li>Call the __setstate__() super method (for example, with an empty state
dictionary).</li>
<li>Call the HasTraits class’s private _init_trait_listeners() method; this
method has no parameters and does not return a result.</li>
</ul>
</div>
</div>
<div class="section" id="useful-methods-on-hastraits">
<span id="index-42"></span><span id="id31"></span><h2>Useful Methods on HasTraits<a class="headerlink" href="#useful-methods-on-hastraits" title="Permalink to this headline">¶</a></h2>
<p>The HasTraits class defines a number of methods, which are available to any
class derived from it, i.e., any class that uses trait attributes. This section
provides examples of a sampling of these methods. Refer to the <em>Traits API
Reference</em> for a complete list of HasTraits methods.</p>
<div class="section" id="add-trait">
<span id="index-43"></span><span id="id32"></span><h3>add_trait()<a class="headerlink" href="#add-trait" title="Permalink to this headline">¶</a></h3>
<p>This method adds a trait attribute to an object dynamically, after the object
has been created. For more information, see <a class="reference internal" href="#per-object-trait-attributes"><span class="std std-ref">Per-Object Trait Attributes</span></a>.</p>
</div>
<div class="section" id="clone-traits">
<span id="index-44"></span><span id="id33"></span><h3>clone_traits()<a class="headerlink" href="#clone-traits" title="Permalink to this headline">¶</a></h3>
<p>This method copies trait attributes from one object to another. It can copy
specified attributes, all explicitly defined trait attributes, or all explicitly
and implicitly defined trait attributes on the source object.</p>
<p>This method is useful if you want to allow a user to edit a clone of an object,
so that changes are made permanent only when the user commits them. In such a
case, you might clone an object and its trait attributes; allow the user to
modify the clone; and then re-clone only the trait attributes back to the
original object when the user commits changes.</p>
</div>
<div class="section" id="set">
<span id="index-45"></span><span id="id34"></span><h3>set()<a class="headerlink" href="#set" title="Permalink to this headline">¶</a></h3>
<p>This method takes a list of keyword-value pairs, and sets the trait attribute
corresponding to each keyword to the matching value. This shorthand is useful
when a number of trait attributes need to be set on an object, or a trait
attribute value needs to be set in a lambda function. For example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">person</span><span class="o">.</span><span class="n">trait_set</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s1">&#39;Bill&#39;</span><span class="p">,</span> <span class="n">age</span><span class="o">=</span><span class="mi">27</span><span class="p">)</span>
</pre></div>
</div>
<p>The statement above is equivalent to the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">person</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Bill&#39;</span>
<span class="n">person</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="mi">27</span>
</pre></div>
</div>
</div>
<div class="section" id="add-class-trait">
<span id="index-46"></span><span id="id35"></span><h3>add_class_trait()<a class="headerlink" href="#add-class-trait" title="Permalink to this headline">¶</a></h3>
<p>The add_class_trait() method is a class method, while the preceding HasTraits
methods are instance methods. This method is very similar to the add_trait()
instance method. The difference is that adding a trait attribute by using
add_class_trait() is the same as having declared the trait as part of the class
definition. That is, any trait attribute added using add_class_trait() is
defined in every subsequently-created instance of the class, and in any
subsequently-defined subclasses of the class. In contrast, the add_trait()
method adds the specified trait attribute only to the object instance it is
applied to.</p>
<p>In addition, if the name of the trait attribute ends with a ‘_’, then a new (or
replacement) prefix rule is added to the class definition, just as if the prefix
rule had been specified statically in the class definition. It is not possible
to define new prefix rules using the add_trait() method.</p>
<p>One of the main uses of the add_class_trait() method is to add trait attribute
definitions that could not be defined statically as part of the body of the
class definition. This occurs, for example, when two classes with trait
attributes are being defined and each class has a trait attribute that should
contain a reference to the other. For the class that occurs first in lexical
order, it is not possible to define the trait attribute that references the
other class, since the class it needs to refer to has not yet been defined.</p>
<p id="index-47">This is illustrated in the following example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># circular_definition.py --- Non-working example of mutually-</span>
<span class="c1">#                            referring classes</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">Trait</span>

<span class="k">class</span> <span class="nc">Chicken</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="n">hatched_from</span> <span class="o">=</span> <span class="n">Trait</span><span class="p">(</span><span class="n">Egg</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Egg</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="n">created_by</span> <span class="o">=</span> <span class="n">Trait</span><span class="p">(</span><span class="n">Chicken</span><span class="p">)</span>
</pre></div>
</div>
<p>As it stands, this example will not run because the <strong>hatched_from</strong> attribute
references the Egg class, which has not yet been defined. Reversing the
definition order of the classes does not fix the problem, because then the
<strong>created_by</strong> trait references the Chicken class, which has not yet been defined.</p>
<p>The problem can be solved using the add_class_trait() method, as shown in the
following code:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># add_class_trait.py --- Example of mutually-referring classes</span>
<span class="c1">#                        using add_class_trait()</span>
<span class="kn">from</span> <span class="nn">traits.api</span> <span class="k">import</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">Trait</span>

<span class="k">class</span> <span class="nc">Chicken</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">class</span> <span class="nc">Egg</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
    <span class="n">created_by</span> <span class="o">=</span> <span class="n">Trait</span><span class="p">(</span><span class="n">Chicken</span><span class="p">)</span>

<span class="n">Chicken</span><span class="o">.</span><span class="n">add_class_trait</span><span class="p">(</span><span class="s1">&#39;hatched_from&#39;</span><span class="p">,</span> <span class="n">Egg</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="performance-considerations-of-traits">
<span id="index-48"></span><span id="id36"></span><h2>Performance Considerations of Traits<a class="headerlink" href="#performance-considerations-of-traits" title="Permalink to this headline">¶</a></h2>
<p>Using traits can potentially impose a performance penalty on attribute access
over and above that of normal Python attributes. For the most part, this
penalty, if any, is small, because the core of the Traits package is written in
C, just like the Python interpreter. In fact, for some common cases, subclasses
of HasTraits can actually have the same or better performance than old or new
style Python classes.</p>
<p>However, there are a couple of performance-related factors to keep in mind when
defining classes and attributes using traits:</p>
<ul class="simple">
<li>Whether a trait attribute defers its value through delegation or prototyping</li>
<li>The complexity of a trait definition</li>
</ul>
<p>If a trait attribute does not defer its value, the performance penalty can be
characterized as follows:</p>
<ul class="simple">
<li>Getting a value: No penalty (i.e., standard Python attribute access speed or
faster)</li>
<li>Setting a value: Depends upon the complexity of the validation tests
performed by the trait definition. Many of the predefined trait handlers
defined in the Traits package support fast C-level validation. For most of
these, the cost of validation is usually negligible. For other trait
handlers, with Python-level validation methods, the cost can be quite a bit
higher.</li>
</ul>
<p>If a trait attribute does defer its value, the cases to be considered are:</p>
<ul class="simple">
<li>Getting the default value: Cost of following the deferral chain. The chain
is resolved at the C level, and is quite fast, but its cost is linear with
the number of deferral links that must be followed to find the default value
for the trait.</li>
<li>Getting an explicitly assigned value for a prototype: No penalty (i.e.,
standard Python attribute access speed or faster)</li>
<li>Getting an explicitly assigned value for a delegate: Cost of following the
deferral chain.</li>
<li>Setting: Cost of following the deferral chain plus the cost of performing
the validation of the new value. The preceding discussions about deferral
chain following and fast versus slow validation apply here as well.</li>
</ul>
<p>In a typical application scenario, where attributes are read more often than
they are written, and deferral is not used, the impact of using traits is often
minimal, because the only cost occurs when attributes are assigned and
validated.</p>
<p>The worst case scenario occurs when deferral is used heavily, either for
delegation, or for prototyping to provide attributes with default values that
are seldom changed. In this case, the cost of frequently following deferral
chains may impose a measurable performance detriment on the application. Of
course, this is offset by the convenience and flexibility provided by the
deferral model. As with any powerful tool, it is best to understand its
strengths and weaknesses and apply that understanding in determining when use of
the tool is justified and appropriate.</p>
</div>
</div>


          </div>
        </div>
          </div>
      <div class="spc-rightsidebar span3">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../index.html">
              <img class="logo" src="../_static/img/e-logo.png" alt="Logo">
            </a></p>
  <h3><a href="../index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Advanced Topics</a><ul>
<li><a class="reference internal" href="#initialization-and-validation-revisited">Initialization and Validation Revisited</a><ul>
<li><a class="reference internal" href="#dynamic-initialization">Dynamic Initialization</a></li>
<li><a class="reference internal" href="#overriding-default-values-in-a-subclass">Overriding Default Values in a Subclass</a></li>
<li><a class="reference internal" href="#reusing-trait-definitions">Reusing Trait Definitions</a></li>
<li><a class="reference internal" href="#trait-attribute-definition-strategies">Trait Attribute Definition Strategies</a><ul>
<li><a class="reference internal" href="#trait-attribute-name-wildcard">Trait Attribute Name Wildcard</a><ul>
<li><a class="reference internal" href="#wildcard-rules">Wildcard Rules</a></li>
<li><a class="reference internal" href="#disallow-object">Disallow Object</a></li>
<li><a class="reference internal" href="#hastraits-subclasses">HasTraits Subclasses</a></li>
<li><a class="reference internal" href="#hasstricttraits">HasStrictTraits</a></li>
<li><a class="reference internal" href="#hasrequiredtraits">HasRequiredTraits</a></li>
<li><a class="reference internal" href="#hasprivatetraits">HasPrivateTraits</a></li>
<li><a class="reference internal" href="#per-object-trait-attributes">Per-Object Trait Attributes</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#interfaces">Interfaces</a><ul>
<li><a class="reference internal" href="#defining-an-interface">Defining an Interface</a></li>
<li><a class="reference internal" href="#implementing-an-interface">Implementing an Interface</a></li>
<li><a class="reference internal" href="#using-interfaces">Using Interfaces</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adaptation">Adaptation</a><ul>
<li><a class="reference internal" href="#main-features">Main features</a></li>
<li><a class="reference internal" href="#note-on-terminology">Note on terminology</a></li>
<li><a class="reference internal" href="#defining-adapters">Defining Adapters</a><ul>
<li><a class="reference internal" href="#the-adapter-class">The <code class="docutils literal notranslate"><span class="pre">Adapter</span></code> class</a></li>
<li><a class="reference internal" href="#registering-adapters">Registering adapters</a></li>
</ul>
</li>
<li><a class="reference internal" href="#adapter-factories-and-conditional-adaptation">Adapter factories, and conditional adaptation</a><ul>
<li><a class="reference internal" href="#conditional-adaptation">Conditional adaptation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#requesting-an-adapter">Requesting an adapter</a><ul>
<li><a class="reference internal" href="#the-adapt-function">The <code class="docutils literal notranslate"><span class="pre">adapt</span></code> function</a></li>
<li><a class="reference internal" href="#using-traits-interfaces">Using Traits interfaces</a></li>
<li><a class="reference internal" href="#using-the-supports-and-adaptsto-traits">Using the <code class="docutils literal notranslate"><span class="pre">Supports</span></code> and <code class="docutils literal notranslate"><span class="pre">AdaptsTo</span></code> traits</a></li>
</ul>
</li>
<li><a class="reference internal" href="#implementation-details">Implementation details</a></li>
<li><a class="reference internal" href="#migration-guide">Migration guide</a></li>
<li><a class="reference internal" href="#gotchas">Gotchas</a></li>
<li><a class="reference internal" href="#recommended-readings-about-adaptation">Recommended readings about adaptation</a></li>
</ul>
</li>
<li><a class="reference internal" href="#property-traits">Property Traits</a><ul>
<li><a class="reference internal" href="#property-factory-function">Property Factory Function</a></li>
<li><a class="reference internal" href="#caching-a-property-value">Caching a Property Value</a></li>
</ul>
</li>
<li><a class="reference internal" href="#persistence">Persistence</a><ul>
<li><a class="reference internal" href="#pickling-hastraits-objects">Pickling HasTraits Objects</a></li>
<li><a class="reference internal" href="#predefined-transient-traits">Predefined Transient Traits</a></li>
<li><a class="reference internal" href="#overriding-getstate">Overriding __getstate__()</a></li>
<li><a class="reference internal" href="#unpickling-hastraits-objects">Unpickling HasTraits Objects</a></li>
<li><a class="reference internal" href="#overriding-setstate">Overriding __setstate__()</a></li>
</ul>
</li>
<li><a class="reference internal" href="#useful-methods-on-hastraits">Useful Methods on HasTraits</a><ul>
<li><a class="reference internal" href="#add-trait">add_trait()</a></li>
<li><a class="reference internal" href="#clone-traits">clone_traits()</a></li>
<li><a class="reference internal" href="#set">set()</a></li>
<li><a class="reference internal" href="#add-class-trait">add_class_trait()</a></li>
</ul>
</li>
<li><a class="reference internal" href="#performance-considerations-of-traits">Performance Considerations of Traits</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="custom.html"
                        title="previous chapter">Custom Traits</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="testing.html"
                        title="next chapter">Testing</a></p>
  <h3>This Page</h3>
  <div>
    <a href="../_sources/traits_user_manual/advanced.rst.txt"
       rel="nofollow">Show Source</a>
  </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
        </div>
      </div>
    </div>

    <div class="container container-navbar-bottom">
      <div class="spc-navbar">
        
      </div>
    </div>
    <div class="container">
    <div class="footer">
    <div class="row-fluid">
    <ul class="inline pull-left">
      <li>
        &copy; Copyright 2008-2019, Enthought Inc
      </li>
      <li>
      Last updated on Nov 18, 2019.
      </li>
      <li>
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.8.5.
      </li>
    </ul>
    </div>
    </div>
    </div>
  </body>
</html>