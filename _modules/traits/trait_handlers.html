


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>traits.trait_handlers &mdash; Traits 4 User Manual</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '4.5.0-rc.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/et.ico"/>
    <link rel="top" title="Traits 4 User Manual" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../index.html">Traits 4 User Manual</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li>
  
    <li><a href="#">traits.trait_handlers</a></li>
  

      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for traits.trait_handlers</h1><div class="highlight"><pre>
<span class="c">#------------------------------------------------------------------------------</span>
<span class="c">#</span>
<span class="c">#  Copyright (c) 2005, Enthought, Inc.</span>
<span class="c">#  All rights reserved.</span>
<span class="c">#</span>
<span class="c">#  This software is provided without warranty under the terms of the BSD</span>
<span class="c">#  license included in enthought/LICENSE.txt and may be redistributed only</span>
<span class="c">#  under the conditions described in the aforementioned license.  The license</span>
<span class="c">#  is also available online at http://www.enthought.com/licenses/BSD.txt</span>
<span class="c">#</span>
<span class="c">#  Thanks for using Enthought open source!</span>
<span class="c">#</span>
<span class="c">#  Author: David C. Morrill</span>
<span class="c">#  Date:   06/21/2002</span>
<span class="c">#</span>
<span class="c">#  Refactored into a separate module: 07/04/2003</span>
<span class="c">#</span>
<span class="c">#------------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Defines the BaseTraitHandler class and a standard set of BaseTraitHandler</span>
<span class="sd">subclasses for use with the Traits package.</span>

<span class="sd">A trait handler mediates the assignment of values to object traits. It</span>
<span class="sd">verifies (via its validate() method) that a specified value is consistent</span>
<span class="sd">with the object trait, and generates a TraitError exception if it is not</span>
<span class="sd">consistent.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Imports:</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">copy_reg</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">FunctionType</span><span class="p">,</span> <span class="n">MethodType</span>
<span class="n">TypeType</span> <span class="o">=</span> <span class="nb">type</span>

<span class="kn">from</span> <span class="nn">weakref</span> <span class="kn">import</span> <span class="n">ref</span>

<span class="kn">from</span> <span class="nn">.trait_base</span> <span class="kn">import</span> <span class="p">(</span><span class="n">strx</span><span class="p">,</span> <span class="n">SequenceTypes</span><span class="p">,</span> <span class="n">Undefined</span><span class="p">,</span> <span class="n">TypeTypes</span><span class="p">,</span> <span class="n">ClassTypes</span><span class="p">,</span>
    <span class="n">CoercableTypes</span><span class="p">,</span> <span class="n">TraitsCache</span><span class="p">,</span> <span class="n">class_of</span><span class="p">,</span> <span class="n">Missing</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">.trait_errors</span> <span class="kn">import</span> <span class="n">TraitError</span><span class="p">,</span> <span class="n">repr_type</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">_py2to3</span>

<span class="c"># Patched by &#39;traits.py&#39; once class is defined!</span>
<span class="n">Trait</span> <span class="o">=</span> <span class="n">Event</span> <span class="o">=</span> <span class="bp">None</span>

<span class="c"># Set up a logger:</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span> <span class="n">__name__</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Constants:</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<span class="c"># Trait &#39;comparison_mode&#39; enum values:</span>
<span class="n">NO_COMPARE</span>              <span class="o">=</span> <span class="mi">0</span>
<span class="n">OBJECT_IDENTITY_COMPARE</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">RICH_COMPARE</span>            <span class="o">=</span> <span class="mi">2</span>

<span class="n">RangeTypes</span>    <span class="o">=</span> <span class="p">(</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">long</span><span class="p">,</span> <span class="nb">float</span> <span class="p">)</span>

<span class="n">CallableTypes</span> <span class="o">=</span> <span class="p">(</span> <span class="n">FunctionType</span><span class="p">,</span> <span class="n">MethodType</span> <span class="p">)</span>

<span class="c"># Mapping from trait metadata &#39;type&#39; to CTrait &#39;type&#39;:</span>
<span class="n">trait_types</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s">&#39;python&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
    <span class="s">&#39;event&#39;</span><span class="p">:</span>  <span class="mi">2</span>
<span class="p">}</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Forward references:</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<span class="n">trait_from</span> <span class="o">=</span> <span class="bp">None</span>  <span class="c"># Patched by &#39;traits.py&#39; when real &#39;trait_from&#39; is defined</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Returns the correct argument count for a specified function or method:</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="_arg_count"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers._arg_count">[docs]</a><span class="k">def</span> <span class="nf">_arg_count</span> <span class="p">(</span> <span class="n">func</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the correct argument count for a specified function or method.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span> <span class="n">func</span> <span class="p">)</span> <span class="ow">is</span> <span class="n">MethodType</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">func</span><span class="o">.</span><span class="n">im_self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">func_code</span><span class="o">.</span><span class="n">co_argcount</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">func</span><span class="o">.</span><span class="n">func_code</span><span class="o">.</span><span class="n">co_argcount</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Property error handling functions:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="_write_only"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers._write_only">[docs]</a><span class="k">def</span> <span class="nf">_write_only</span> <span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
    <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="s">&quot;The &#39;</span><span class="si">%s</span><span class="s">&#39; trait of </span><span class="si">%s</span><span class="s"> instance is &#39;write only&#39;.&quot;</span> <span class="o">%</span> <span class="p">(</span>
                      <span class="n">name</span><span class="p">,</span> <span class="n">class_of</span><span class="p">(</span> <span class="nb">object</span> <span class="p">)</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="_read_only"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers._read_only">[docs]</a><span class="k">def</span> <span class="nf">_read_only</span> <span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
    <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="s">&quot;The &#39;</span><span class="si">%s</span><span class="s">&#39; trait of </span><span class="si">%s</span><span class="s"> instance is &#39;read only&#39;.&quot;</span> <span class="o">%</span> <span class="p">(</span>
                      <span class="n">name</span><span class="p">,</span> <span class="n">class_of</span><span class="p">(</span> <span class="nb">object</span> <span class="p">)</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="_undefined_get"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers._undefined_get">[docs]</a><span class="k">def</span> <span class="nf">_undefined_get</span> <span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
    <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;The &#39;</span><span class="si">%s</span><span class="s">&#39; trait of </span><span class="si">%s</span><span class="s"> instance is a property that has &quot;</span>
                       <span class="s">&quot;no &#39;get&#39; or &#39;set&#39; method&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                       <span class="n">name</span><span class="p">,</span> <span class="n">class_of</span><span class="p">(</span> <span class="nb">object</span> <span class="p">)</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="_undefined_set"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers._undefined_set">[docs]</a><span class="k">def</span> <span class="nf">_undefined_set</span> <span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
    <span class="n">_undefined_get</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;BaseTraitHandler&#39; class (base class for all user defined traits and trait</span>
<span class="c">#  handlers):</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="BaseTraitHandler"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.BaseTraitHandler">[docs]</a><span class="k">class</span> <span class="nc">BaseTraitHandler</span> <span class="p">(</span> <span class="nb">object</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The task of this class and its subclasses is to verify the correctness</span>
<span class="sd">    of values assigned to object trait attributes.</span>

<span class="sd">    This class is an alternative to trait validator functions. A trait handler</span>
<span class="sd">    has several advantages over a trait validator function, due to being an</span>
<span class="sd">    object:</span>

<span class="sd">        * Trait handlers have constructors and state. Therefore, you can use</span>
<span class="sd">          them to create *parametrized types*.</span>
<span class="sd">        * Trait handlers can have multiple methods, whereas validator functions</span>
<span class="sd">          can have only one callable interface. This feature allows more</span>
<span class="sd">          flexibility in their implementation, and allows them to handle a</span>
<span class="sd">          wider range of cases, such as interactions with other components.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_value_type</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">has_items</span>          <span class="o">=</span> <span class="bp">False</span>
    <span class="n">is_mapped</span>          <span class="o">=</span> <span class="bp">False</span>
    <span class="n">editor</span>             <span class="o">=</span> <span class="bp">None</span>
    <span class="n">info_text</span>          <span class="o">=</span> <span class="s">&#39;a legal value&#39;</span>

    <span class="k">def</span> <span class="nf">is_valid</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
                <span class="k">return</span> <span class="bp">True</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">False</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">True</span>

<div class="viewcode-block" id="BaseTraitHandler.error"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.BaseTraitHandler.error">[docs]</a>    <span class="k">def</span> <span class="nf">error</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Raises a TraitError exception.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        object : object</span>
<span class="sd">            The object whose attribute is being assigned.</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the attribute being assigned.</span>
<span class="sd">        value : object</span>
<span class="sd">            The proposed new value for the attribute.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        This method is called by the validate() method when an assigned value</span>
<span class="sd">        is not valid. Raising a TraitError exception either notifies the user of</span>
<span class="sd">        the problem, or, in the case of compound traits, provides a chance for</span>
<span class="sd">        another trait handler to handle to validate the value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">full_info</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">),</span>
                          <span class="n">value</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseTraitHandler.full_info"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.BaseTraitHandler.full_info">[docs]</a>    <span class="k">def</span> <span class="nf">full_info</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a string describing the type of value accepted by the</span>
<span class="sd">        trait handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        object : object</span>
<span class="sd">            The object whose attribute is being assigned.</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the attribute being assigned.</span>
<span class="sd">        value :</span>
<span class="sd">            The proposed new value for the attribute.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        The string should be a phrase describing the type defined by the</span>
<span class="sd">        TraitHandler subclass, rather than a complete sentence. For example, use</span>
<span class="sd">        the phrase, &quot;a square sprocket&quot; instead of the sentence, &quot;The value must</span>
<span class="sd">        be a square sprocket.&quot; The value returned by full_info() is combined</span>
<span class="sd">        with other information whenever an error occurs and therefore makes more</span>
<span class="sd">        sense to the user if the result is a phrase. The full_info() method is</span>
<span class="sd">        similar in purpose and use to the **info** attribute of a validator</span>
<span class="sd">        function.</span>

<span class="sd">        Note that the result can include information specific to the particular</span>
<span class="sd">        trait handler instance. For example, TraitRange instances return a</span>
<span class="sd">        string indicating the range of values acceptable to the handler (e.g.,</span>
<span class="sd">        &quot;an integer in the range from 1 to 9&quot;). If the full_info() method is not</span>
<span class="sd">        overridden, the default method returns the value of calling the info()</span>
<span class="sd">        method.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="BaseTraitHandler.info"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.BaseTraitHandler.info">[docs]</a>    <span class="k">def</span> <span class="nf">info</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Must return a string describing the type of value accepted by the</span>
<span class="sd">        trait handler.</span>

<span class="sd">        The string should be a phrase describing the type defined by the</span>
<span class="sd">        TraitHandler subclass, rather than a complete sentence. For example, use</span>
<span class="sd">        the phrase, &quot;a square sprocket&quot; instead of the sentence, &quot;The value must</span>
<span class="sd">        be a square sprocket.&quot; The value returned by info() is combined with</span>
<span class="sd">        other information whenever an error occurs and therefore makes more</span>
<span class="sd">        sense to the user if the result is a phrase. The info() method is</span>
<span class="sd">        similar in purpose and use to the **info** attribute of a validator</span>
<span class="sd">        function.</span>

<span class="sd">        Note that the result can include information specific to the particular</span>
<span class="sd">        trait handler instance. For example, TraitRange instances return a</span>
<span class="sd">        string indicating the range of values acceptable to the handler (e.g.,</span>
<span class="sd">        &quot;an integer in the range from 1 to 9&quot;). If the info() method is not</span>
<span class="sd">        overridden, the default method returns the value of the &#39;info_text&#39;</span>
<span class="sd">        attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_text</span>
</div>
<div class="viewcode-block" id="BaseTraitHandler.repr"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.BaseTraitHandler.repr">[docs]</a>    <span class="k">def</span> <span class="nf">repr</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a printable representation of a value along with its type.</span>

<span class="sd">        .. deprecated :: 3.0.3</span>
<span class="sd">            This functionality was only used to provide readable error</span>
<span class="sd">            messages. This functionality has been incorporated into</span>
<span class="sd">            TraitError itself.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : object</span>
<span class="sd">            The value to be printed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">warnings</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s">&quot;this functionality has been merged into TraitError; &quot;</span>
            <span class="s">&quot;just pass the raw value&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">repr_type</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="BaseTraitHandler.get_editor"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.BaseTraitHandler.get_editor">[docs]</a>    <span class="k">def</span> <span class="nf">get_editor</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a trait editor that allows the user to modify the *trait*</span>
<span class="sd">        trait.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trait : Trait</span>
<span class="sd">            The trait to be edited.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        This method only needs to be specified if traits defined using this</span>
<span class="sd">        trait handler require a non-default trait editor in trait user</span>
<span class="sd">        interfaces. The default implementation of this method returns a trait</span>
<span class="sd">        editor that allows the user to type an arbitrary string as the value.</span>

<span class="sd">        For more information on trait user interfaces, refer to the *Traits UI</span>
<span class="sd">        User Guide*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_editor</span><span class="p">()</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span>
</div>
<div class="viewcode-block" id="BaseTraitHandler.create_editor"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.BaseTraitHandler.create_editor">[docs]</a>    <span class="k">def</span> <span class="nf">create_editor</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the default traits UI editor to use for a trait.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">TextEditor</span>

        <span class="k">return</span> <span class="n">TextEditor</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="BaseTraitHandler.inner_traits"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.BaseTraitHandler.inner_traits">[docs]</a>    <span class="k">def</span> <span class="nf">inner_traits</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a tuple containing the *inner traits* for this trait. Most</span>
<span class="sd">            trait handlers do not have any inner traits, and so will return an</span>
<span class="sd">            empty tuple. The exceptions are **List** and **Dict** trait types,</span>
<span class="sd">            which have inner traits used to validate the values assigned to the</span>
<span class="sd">            trait. For example, in *List( Int )*, the *inner traits* for</span>
<span class="sd">            **List** are ( **Int**, ).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">()</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitType&#39; (base class for class-based trait definitions:</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<span class="c"># Create a singleton object for use in the TraitType constructor:</span></div></div>
<div class="viewcode-block" id="NoDefaultSpecified"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.NoDefaultSpecified">[docs]</a><span class="k">class</span> <span class="nc">NoDefaultSpecified</span> <span class="p">(</span> <span class="nb">object</span> <span class="p">):</span> <span class="k">pass</span></div>
<span class="n">NoDefaultSpecified</span> <span class="o">=</span> <span class="n">NoDefaultSpecified</span><span class="p">()</span>

<div class="viewcode-block" id="TraitType"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitType">[docs]</a><span class="k">class</span> <span class="nc">TraitType</span> <span class="p">(</span> <span class="n">BaseTraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Base class for new trait types.</span>

<span class="sd">        This class enables you to define new traits using a class-based</span>
<span class="sd">        approach, instead of by calling the Trait() factory function with an</span>
<span class="sd">        instance of a TraitHandler derived object.</span>

<span class="sd">        When subclassing this class, you can implement one or more of the</span>
<span class="sd">        method signatures below. Note that these methods are defined only as</span>
<span class="sd">        comments, because the absence of method definitions in the subclass</span>
<span class="sd">        definition implicitly provides information about how the trait should</span>
<span class="sd">        operate.</span>

<span class="sd">        The optional methods are as follows:</span>

<span class="sd">        * **get ( self, object, name ):**</span>

<span class="sd">          This is the getter method of a trait that behaves like a property.</span>

<span class="sd">          :Parameters:</span>
<span class="sd">            **object** (*object*) -- The object that the property applies to.</span>

<span class="sd">            **name** (str) -- The name of the property on *object* property.</span>

<span class="sd">          *Description*</span>

<span class="sd">          If neither this method nor the set() method is defined, the value</span>
<span class="sd">          of the trait is handled like a normal object attribute. If this</span>
<span class="sd">          method is not defined, but the set() method is defined, the trait</span>
<span class="sd">          behaves like a write-only property. This method should return the</span>
<span class="sd">          value of the *name* property for the *object* object.</span>

<span class="sd">        * **set ( self, object, name, value )**</span>

<span class="sd">          This is the setter method of a trait that behaves like a property.</span>

<span class="sd">          :Parameters:</span>
<span class="sd">            **object** (*object*) -- The object that the property applies to.</span>

<span class="sd">            **name** (str) -- The name of the property on *object*.</span>

<span class="sd">            **value** -- The value being assigned as the value of the property.</span>

<span class="sd">          *Description*</span>

<span class="sd">          If neither this method nor the get() method is implemented, the</span>
<span class="sd">          trait behaves like a normal trait attribute. If this method is not</span>
<span class="sd">          defined, but the get() method is defined, the trait behaves like a</span>
<span class="sd">          read-only property. This method does not need to return a value,</span>
<span class="sd">          but it should raise a TraitError exception if the specified *value*</span>
<span class="sd">          is not valid and cannot be coerced or adapted to a valid value.</span>

<span class="sd">        * **validate ( self, object, name, value )**</span>

<span class="sd">          This method validates, coerces, or adapts the specified *value* as</span>
<span class="sd">          the value of the *name* trait of the *object* object. This method</span>
<span class="sd">          is called when a value is assigned to an object trait that is</span>
<span class="sd">          based on this subclass of *TraitType* and the class does not</span>
<span class="sd">          contain a definition for either the get() or set() methods. This</span>
<span class="sd">          method must return the original *value* or any suitably coerced or</span>
<span class="sd">          adapted value that is a legal value for the trait. If *value* is</span>
<span class="sd">          not a legal value for the trait, and cannot be coerced or adapted</span>
<span class="sd">          to a legal value, the method should either raise a **TraitError** or</span>
<span class="sd">          call the **error** method to raise the **TraitError** on its behalf.</span>

<span class="sd">        * **is_valid_for ( self, value )**</span>

<span class="sd">          As an alternative to implementing the **validate** method, you can</span>
<span class="sd">          instead implement the **is_valid_for** method, which receives only</span>
<span class="sd">          the *value* being assigned. It should return **True** if the value is</span>
<span class="sd">          valid, and **False** otherwise.</span>

<span class="sd">        * **value_for ( self, value )**</span>

<span class="sd">          As another alternative to implementing the **validate** method, you</span>
<span class="sd">          can instead implement the **value_for** method, which receives only</span>
<span class="sd">          the *value* being assigned. It should return the validated form of</span>
<span class="sd">          *value* if it is valid, or raise a **TraitError** if the value is not</span>
<span class="sd">          valid.</span>

<span class="sd">        * **post_setattr ( self, object, name, value )**</span>

<span class="sd">          This method allows the trait to do additional processing after</span>
<span class="sd">          *value* has been successfully assigned to the *name* trait of the</span>
<span class="sd">          *object* object. For most traits there is no additional processing</span>
<span class="sd">          that needs to be done, and this method need not be defined. It is</span>
<span class="sd">          normally used for creating &quot;shadow&quot; (i.e., &quot;mapped&quot; traits), but</span>
<span class="sd">          other uses may arise as well. This method does not need to return</span>
<span class="sd">          a value, and should normally not raise any exceptions.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_value</span> <span class="o">=</span> <span class="n">Undefined</span>
    <span class="n">metadata</span>      <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">default_value</span> <span class="o">=</span> <span class="n">NoDefaultSpecified</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This constructor method is the only method normally called</span>
<span class="sd">            directly by client code. It defines the trait. The</span>
<span class="sd">            default implementation accepts an optional, untype-checked default</span>
<span class="sd">            value, and caller-supplied trait metadata. Override this method</span>
<span class="sd">            whenever a different method signature or a type-checked</span>
<span class="sd">            default value is needed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">NoDefaultSpecified</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">default_value</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">metadata</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">metadata</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">metadata</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">init</span><span class="p">()</span>

<div class="viewcode-block" id="TraitType.init"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitType.init">[docs]</a>    <span class="k">def</span> <span class="nf">init</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Allows the trait to perform any additional initialization needed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
</div>
<div class="viewcode-block" id="TraitType.get_default_value"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitType.get_default_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_default_value</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a tuple of the form: (*default_value_type*, *default_value*)</span>
<span class="sd">            which describes the default value for this trait. The default</span>
<span class="sd">            implementation analyzes the value of the trait&#39;s **default_value**</span>
<span class="sd">            attribute and determines an appropriate *default_value_type* for</span>
<span class="sd">            *default_value*. If you need to override this method to provide a</span>
<span class="sd">            different result tuple, the following values are valid values for</span>
<span class="sd">            *default_value_type*:</span>

<span class="sd">                - 0, 1: The *default_value* item of the tuple is the default</span>
<span class="sd">                  value.</span>
<span class="sd">                - 2: The object containing the trait is the default value.</span>
<span class="sd">                - 3: A new copy of the list specified by *default_value* is</span>
<span class="sd">                  the default value.</span>
<span class="sd">                - 4: A new copy of the dictionary specified by *default_value*</span>
<span class="sd">                  is the default value.</span>
<span class="sd">                - 5: A new instance of TraitListObject constructed using the</span>
<span class="sd">                  *default_value* list is the default value.</span>
<span class="sd">                - 6: A new instance of TraitDictObject constructed using the</span>
<span class="sd">                  *default_value* dictionary is the default value.</span>
<span class="sd">                - 7: *default_value* is a tuple of the form: (*callable*, *args*,</span>
<span class="sd">                  *kw*), where *callable* is a callable, *args* is a tuple, and</span>
<span class="sd">                  *kw* is either a dictionary or None. The default value is the</span>
<span class="sd">                  result obtained by invoking callable(\*args, \*\*kw).</span>
<span class="sd">                - 8: *default_value* is a callable. The default value is the</span>
<span class="sd">                  result obtained by invoking *default_value*(*object*), where</span>
<span class="sd">                  *object* is the object containing the trait. If the trait has</span>
<span class="sd">                  a validate() method, the validate() method is also called to</span>
<span class="sd">                  validate the result.</span>
<span class="sd">                - 9: A new instance of TraitSetObject constructed using the</span>
<span class="sd">                  *default_value* set is the default value.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dv</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_value</span>
        <span class="n">dvt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_value_type</span>
        <span class="k">if</span> <span class="n">dvt</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">dvt</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">dv</span><span class="p">,</span> <span class="n">TraitListObject</span> <span class="p">):</span>
                <span class="n">dvt</span> <span class="o">=</span> <span class="mi">5</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">dv</span><span class="p">,</span> <span class="nb">list</span> <span class="p">):</span>
                <span class="n">dvt</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">dv</span><span class="p">,</span> <span class="n">TraitDictObject</span> <span class="p">):</span>
                <span class="n">dvt</span> <span class="o">=</span> <span class="mi">6</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">dv</span><span class="p">,</span> <span class="nb">dict</span> <span class="p">):</span>
                <span class="n">dvt</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">dv</span><span class="p">,</span> <span class="n">TraitSetObject</span> <span class="p">):</span>
                <span class="n">dvt</span> <span class="o">=</span> <span class="mi">9</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">default_value_type</span> <span class="o">=</span> <span class="n">dvt</span>

        <span class="k">return</span> <span class="p">(</span> <span class="n">dvt</span><span class="p">,</span> <span class="n">dv</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="TraitType.clone"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitType.clone">[docs]</a>    <span class="k">def</span> <span class="nf">clone</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">default_value</span> <span class="o">=</span> <span class="n">Missing</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Clones the contents of this object into a new instance of the same</span>
<span class="sd">            class, and then modifies the cloned copy using the specified</span>
<span class="sd">            *default_value* and *metadata*. Returns the cloned object as the</span>
<span class="sd">            result.</span>

<span class="sd">            Note that subclasses can change the signature of this method if</span>
<span class="sd">            needed, but should always call the &#39;super&#39; method if possible.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s">&#39;parent&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">metadata</span><span class="p">:</span>
            <span class="n">metadata</span><span class="p">[</span> <span class="s">&#39;parent&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">new</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="p">)</span>
        <span class="n">new_dict</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">__dict__</span>
        <span class="n">new_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span> <span class="p">)</span>

        <span class="k">if</span> <span class="s">&#39;editor&#39;</span> <span class="ow">in</span> <span class="n">new_dict</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">new_dict</span><span class="p">[</span> <span class="s">&#39;editor&#39;</span> <span class="p">]</span>

        <span class="k">if</span> <span class="s">&#39;_metadata&#39;</span> <span class="ow">in</span> <span class="n">new_dict</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="n">new</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">_metadata</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">new</span><span class="o">.</span><span class="n">_metadata</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">metadata</span> <span class="p">)</span>

        <span class="k">if</span> <span class="n">default_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Missing</span><span class="p">:</span>
            <span class="n">new</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="n">default_value</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">new</span><span class="o">.</span><span class="n">default_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span>
                                                       <span class="n">default_value</span> <span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">return</span> <span class="n">new</span>
</div>
<div class="viewcode-block" id="TraitType.get_value"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitType.get_value">[docs]</a>    <span class="k">def</span> <span class="nf">get_value</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the current value of a property-based trait.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cname</span> <span class="o">=</span> <span class="n">TraitsCache</span> <span class="o">+</span> <span class="n">name</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">cname</span><span class="p">,</span> <span class="n">Undefined</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">trait</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>

            <span class="nb">object</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span> <span class="n">cname</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">=</span> \
                <span class="n">trait</span><span class="o">.</span><span class="n">default_value_for</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span>
</div>
<div class="viewcode-block" id="TraitType.set_value"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitType.set_value">[docs]</a>    <span class="k">def</span> <span class="nf">set_value</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets the cached value of a property-based trait and fires the</span>
<span class="sd">            appropriate trait change event.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cname</span> <span class="o">=</span> <span class="n">TraitsCache</span> <span class="o">+</span> <span class="n">name</span>
        <span class="n">old</span>   <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">cname</span><span class="p">,</span> <span class="n">Undefined</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="o">!=</span> <span class="n">old</span><span class="p">:</span>
            <span class="nb">object</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span> <span class="n">cname</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="nb">object</span><span class="o">.</span><span class="n">trait_property_changed</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="c">#-- Private Methods --------------------------------------------------------</span>
</div>
    <span class="k">def</span> <span class="nf">__call__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Allows a derivative trait to be defined from this one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span> <span class="p">)</span><span class="o">.</span><span class="n">as_ctrait</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_is_valid_for</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Handles a simplified validator that only returns whether or not the</span>
<span class="sd">            original value is valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid_for</span><span class="p">(</span> <span class="n">value</span> <span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_value_for</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Handles a simplified validator that only receives the value</span>
<span class="sd">            argument.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_for</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
        <span class="k">except</span> <span class="n">TraitError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

<div class="viewcode-block" id="TraitType.as_ctrait"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitType.as_ctrait">[docs]</a>    <span class="k">def</span> <span class="nf">as_ctrait</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a CTrait corresponding to the trait defined by this class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">.traits</span> <span class="kn">import</span> <span class="n">CTrait</span>

        <span class="n">metadata</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_metadata&#39;</span><span class="p">,</span> <span class="p">{}</span> <span class="p">)</span>
        <span class="n">getter</span>   <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;get&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="n">setter</span>   <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;set&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">getter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">setter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">getter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">getter</span> <span class="o">=</span> <span class="n">_write_only</span>
                <span class="n">metadata</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="s">&#39;transient&#39;</span><span class="p">,</span> <span class="bp">True</span> <span class="p">)</span>
            <span class="k">elif</span> <span class="n">setter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">setter</span> <span class="o">=</span> <span class="n">_read_only</span>
                <span class="n">metadata</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="s">&#39;transient&#39;</span><span class="p">,</span> <span class="bp">True</span> <span class="p">)</span>
            <span class="n">trait</span>    <span class="o">=</span> <span class="n">CTrait</span><span class="p">(</span> <span class="mi">4</span> <span class="p">)</span>
            <span class="n">n</span>        <span class="o">=</span> <span class="mi">0</span>
            <span class="n">validate</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;validate&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">n</span> <span class="o">=</span> <span class="n">_arg_count</span><span class="p">(</span> <span class="n">validate</span> <span class="p">)</span>
            <span class="n">trait</span><span class="o">.</span><span class="n">property</span><span class="p">(</span> <span class="n">getter</span><span class="p">,</span>   <span class="n">_arg_count</span><span class="p">(</span> <span class="n">getter</span> <span class="p">),</span>
                            <span class="n">setter</span><span class="p">,</span>   <span class="n">_arg_count</span><span class="p">(</span> <span class="n">setter</span> <span class="p">),</span>
                            <span class="n">validate</span><span class="p">,</span> <span class="n">n</span> <span class="p">)</span>
            <span class="n">metadata</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="s">&#39;property&#39;</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">type</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;ctrait_type&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="nb">type</span> <span class="o">=</span> <span class="n">trait_types</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s">&#39;type&#39;</span> <span class="p">),</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="n">CTrait</span><span class="p">(</span> <span class="nb">type</span> <span class="p">)</span>

            <span class="n">validate</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;fast_validate&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">validate</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;validate&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">validate</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;is_valid_for&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
                    <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_is_valid_for</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">validate</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;value_for&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
                        <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_value_for</span>

            <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">trait</span><span class="o">.</span><span class="n">set_validate</span><span class="p">(</span> <span class="n">validate</span> <span class="p">)</span>

            <span class="n">post_setattr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;post_setattr&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">post_setattr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">trait</span><span class="o">.</span><span class="n">post_setattr</span> <span class="o">=</span> <span class="n">post_setattr</span>
                <span class="n">trait</span><span class="o">.</span><span class="n">is_mapped</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mapped</span> <span class="p">)</span>

            <span class="c"># Note: The use of &#39;rich_compare&#39; metadata is deprecated; use</span>
            <span class="c"># &#39;comparison_mode&#39; metadata instead:</span>
            <span class="n">rich_compare</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s">&#39;rich_compare&#39;</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">rich_compare</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">trait</span><span class="o">.</span><span class="n">rich_comparison</span><span class="p">(</span> <span class="n">rich_compare</span> <span class="ow">is</span> <span class="bp">True</span> <span class="p">)</span>

            <span class="n">comparison_mode</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s">&#39;comparison_mode&#39;</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">comparison_mode</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">trait</span><span class="o">.</span><span class="n">comparison_mode</span><span class="p">(</span> <span class="n">comparison_mode</span> <span class="p">)</span>

            <span class="n">metadata</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="s">&#39;type&#39;</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span> <span class="p">)</span>

        <span class="n">trait</span><span class="o">.</span><span class="n">default_value</span><span class="p">(</span> <span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">get_default_value</span><span class="p">()</span> <span class="p">)</span>

        <span class="n">trait</span><span class="o">.</span><span class="n">value_allowed</span><span class="p">(</span> <span class="n">metadata</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s">&#39;trait_value&#39;</span><span class="p">,</span> <span class="bp">False</span> <span class="p">)</span> <span class="ow">is</span> <span class="bp">True</span> <span class="p">)</span>

        <span class="n">trait</span><span class="o">.</span><span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">trait</span><span class="o">.</span><span class="n">__dict__</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">trait</span>
</div>
    <span class="k">def</span> <span class="nf">__getattr__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;__&#39;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">(</span> <span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; object has no attribute &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span> <span class="p">)</span>

        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_metadata&#39;</span><span class="p">,</span> <span class="p">{}</span> <span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitHandler&#39; class (base class for all trait handlers):</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitHandler"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitHandler">[docs]</a><span class="k">class</span> <span class="nc">TraitHandler</span> <span class="p">(</span> <span class="n">BaseTraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The task of this class and its subclasses is to verify the correctness</span>
<span class="sd">    of values assigned to object trait attributes.</span>

<span class="sd">    This class is an alternative to trait validator functions. A trait handler</span>
<span class="sd">    has several advantages over a trait validator function, due to being an</span>
<span class="sd">    object:</span>

<span class="sd">        * Trait handlers have constructors and state. Therefore, you can use</span>
<span class="sd">          them to create *parametrized types*.</span>
<span class="sd">        * Trait handlers can have multiple methods, whereas validator functions</span>
<span class="sd">          can have only one callable interface. This feature allows more</span>
<span class="sd">          flexibility in their implementation, and allows them to handle a</span>
<span class="sd">          wider range of cases, such as interactions with other components.</span>

<span class="sd">    The only method of TraitHandler that *must* be implemented by subclasses</span>
<span class="sd">    is validate().</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="TraitHandler.validate"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitHandler.validate">[docs]</a>    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Verifies whether a new value assigned to a trait attribute is valid.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        object : object</span>
<span class="sd">            The object whose attribute is being assigned.</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the attribute being assigned.</span>
<span class="sd">        value :</span>
<span class="sd">            The proposed new value for the attribute.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        If the new value is valid, this method must return either the original</span>
<span class="sd">        value passed to it, or an alternate value to be assigned in place of the</span>
<span class="sd">        original value. Whatever value this method returns is the actual value</span>
<span class="sd">        assigned to *object.name*.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        This method *must* be implemented by subclasses of TraitHandler. It is</span>
<span class="sd">        called whenever a new value is assigned to a trait attribute defined</span>
<span class="sd">        using this trait handler.</span>

<span class="sd">        If the value received by validate() is not valid for the trait</span>
<span class="sd">        attribute, the method must called the predefined error() method to</span>
<span class="sd">        raise a TraitError exception</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="p">(</span>
              <span class="s">&quot;The &#39;</span><span class="si">%s</span><span class="s">&#39; trait of </span><span class="si">%s</span><span class="s"> instance has an unknown type. &quot;</span>
              <span class="s">&quot;Contact the developer to correct the problem.&quot;</span> <span class="o">%</span> <span class="p">(</span>
              <span class="n">name</span><span class="p">,</span> <span class="n">class_of</span><span class="p">(</span> <span class="nb">object</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitRange&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div></div>
<div class="viewcode-block" id="TraitRange"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitRange">[docs]</a><span class="k">class</span> <span class="nc">TraitRange</span> <span class="p">(</span> <span class="n">TraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensures that a trait attribute lies within a specified numeric range.</span>

<span class="sd">    TraitRange is the underlying handler for the predefined Range() trait</span>
<span class="sd">    factory.</span>

<span class="sd">    Any value assigned to a trait containing a TraitRange handler must be of the</span>
<span class="sd">    correct type and in the numeric range defined by the TraitRange instance.</span>
<span class="sd">    No automatic coercion takes place. For example::</span>

<span class="sd">        class Person(HasTraits):</span>
<span class="sd">            age = Trait(0, TraitRange(0, 150))</span>
<span class="sd">            weight = Trait(0.0, TraitRange(0.0, None))</span>

<span class="sd">    This example defines a Person class, which has an **age** trait</span>
<span class="sd">    attribute, which must be an integer/long in the range from 0 to 150, and a</span>
<span class="sd">    **weight** trait attribute, which must be a non-negative float value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">low</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                         <span class="n">exclude_low</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">exclude_high</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a TraitRange handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        low : number</span>
<span class="sd">            The minimum value that the trait can accept.</span>
<span class="sd">        high : number</span>
<span class="sd">            The maximum value that the trait can accept.</span>
<span class="sd">        exclude_low : bool</span>
<span class="sd">            Should the *low* value be exclusive (or inclusive).</span>
<span class="sd">        exclude_high : bool</span>
<span class="sd">            Should the *high* value be exclusive (or inclusive).</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        The *low* and *high* values must be of the same Python numeric type,</span>
<span class="sd">        either ``int``, ``long`` or ``float``. Alternatively, one of the values</span>
<span class="sd">        may be None, to indicate that that portion of the range is</span>
<span class="sd">        unbounded. The *exclude_low* and *exclude_high* values can be used to</span>
<span class="sd">        specify whether the *low* and *high* values should be exclusive (or</span>
<span class="sd">        inclusive).</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">vtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span> <span class="n">high</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">low</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">vtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">float</span><span class="p">):</span>
            <span class="n">vtype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span> <span class="n">low</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">vtype</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">RangeTypes</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;TraitRange can only be use for int, long or &quot;</span>
                               <span class="s">&quot;float values, but a value of type </span><span class="si">%s</span><span class="s"> was &quot;</span>
                               <span class="s">&quot;specified.&quot;</span> <span class="o">%</span> <span class="n">vtype</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">vtype</span> <span class="ow">is</span> <span class="nb">float</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">float_validate</span>
            <span class="n">kind</span>            <span class="o">=</span> <span class="mi">4</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_type_desc</span> <span class="o">=</span> <span class="s">&#39;a floating point number&#39;</span>
            <span class="k">if</span> <span class="n">low</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">low</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="n">low</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">high</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">high</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span> <span class="n">high</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="n">vtype</span> <span class="ow">is</span> <span class="nb">long</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">long_validate</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_type_desc</span> <span class="o">=</span> <span class="s">&#39;a long integer&#39;</span>
            <span class="k">if</span> <span class="n">low</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">low</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span> <span class="n">low</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">high</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">high</span> <span class="o">=</span> <span class="nb">long</span><span class="p">(</span> <span class="n">high</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">int_validate</span>
            <span class="n">kind</span> <span class="o">=</span> <span class="mi">3</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_type_desc</span> <span class="o">=</span> <span class="s">&#39;an integer&#39;</span>
            <span class="k">if</span> <span class="n">low</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">low</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">low</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">high</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">high</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span> <span class="n">high</span> <span class="p">)</span>
        <span class="n">exclude_mask</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">exclude_low</span><span class="p">:</span>
            <span class="n">exclude_mask</span> <span class="o">|=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="n">exclude_high</span><span class="p">:</span>
            <span class="n">exclude_mask</span> <span class="o">|=</span> <span class="mi">2</span>
        <span class="k">if</span> <span class="n">vtype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">long</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span> <span class="o">=</span> <span class="p">(</span> <span class="n">kind</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">exclude_mask</span> <span class="p">)</span>

        <span class="c"># Assign type-corrected arguments to handler attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_low</span>          <span class="o">=</span> <span class="n">low</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_high</span>         <span class="o">=</span> <span class="n">high</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exclude_low</span>  <span class="o">=</span> <span class="n">exclude_low</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_exclude_high</span> <span class="o">=</span> <span class="n">exclude_high</span>


    <span class="k">def</span> <span class="nf">float_validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="n">RangeTypes</span> <span class="p">)</span> <span class="ow">and</span>
                <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_low</span>  <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span>
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exclude_low</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_low</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">))</span> <span class="ow">or</span>
                 <span class="p">((</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exclude_low</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_low</span> <span class="o">&lt;=</span> <span class="n">value</span><span class="p">)))</span> <span class="ow">and</span>
                <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_high</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span>
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exclude_high</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_high</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">))</span> <span class="ow">or</span>
                 <span class="p">((</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exclude_high</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_high</span> <span class="o">&gt;=</span> <span class="n">value</span><span class="p">)))):</span>
               <span class="k">return</span> <span class="nb">float</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">int_validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="nb">int</span> <span class="p">)</span> <span class="ow">and</span>
                <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_low</span>  <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span>
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exclude_low</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_low</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">))</span> <span class="ow">or</span>
                 <span class="p">((</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exclude_low</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_low</span> <span class="o">&lt;=</span> <span class="n">value</span><span class="p">)))</span> <span class="ow">and</span>
                <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_high</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span>
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exclude_high</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_high</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">))</span> <span class="ow">or</span>
                 <span class="p">((</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exclude_high</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_high</span> <span class="o">&gt;=</span> <span class="n">value</span><span class="p">)))):</span>
               <span class="k">return</span> <span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">long_validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="nb">long</span> <span class="p">)</span> <span class="ow">and</span>
                <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_low</span>  <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span>
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exclude_low</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_low</span> <span class="o">&lt;</span> <span class="n">value</span><span class="p">))</span> <span class="ow">or</span>
                 <span class="p">((</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exclude_low</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_low</span> <span class="o">&lt;=</span> <span class="n">value</span><span class="p">)))</span> <span class="ow">and</span>
                <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_high</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span>
                 <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_exclude_high</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_high</span> <span class="o">&gt;</span> <span class="n">value</span><span class="p">))</span> <span class="ow">or</span>
                 <span class="p">((</span><span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exclude_high</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_high</span> <span class="o">&gt;=</span> <span class="n">value</span><span class="p">)))):</span>
               <span class="k">return</span> <span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_low</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_high</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type_desc</span>
            <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> &lt;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                   <span class="bp">self</span><span class="o">.</span><span class="n">_type_desc</span><span class="p">,</span> <span class="s">&#39;=&#39;</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exclude_high</span><span class="p">:</span> <span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_high</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">_high</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span>  <span class="s">&#39;</span><span class="si">%s</span><span class="s"> &gt;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_type_desc</span><span class="p">,</span> <span class="s">&#39;=&#39;</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exclude_low</span><span class="p">:</span> <span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_low</span> <span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> &lt;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s"> &lt;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">_low</span><span class="p">,</span> <span class="s">&#39;=&#39;</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exclude_low</span><span class="p">:</span> <span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_type_desc</span><span class="p">,</span>
               <span class="s">&#39;=&#39;</span><span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">_exclude_high</span><span class="p">:</span> <span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_high</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_editor</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait</span> <span class="p">):</span>
        <span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">RangeEditor</span>

        <span class="n">auto_set</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">auto_set</span>
        <span class="k">if</span> <span class="n">auto_set</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">auto_set</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="n">RangeEditor</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span>
                            <span class="n">mode</span>       <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">mode</span> <span class="ow">or</span> <span class="s">&#39;auto&#39;</span><span class="p">,</span>
                            <span class="n">cols</span>       <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">cols</span> <span class="ow">or</span> <span class="mi">3</span><span class="p">,</span>
                            <span class="n">auto_set</span>   <span class="o">=</span> <span class="n">auto_set</span><span class="p">,</span>
                            <span class="n">enter_set</span>  <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">enter_set</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">,</span>
                            <span class="n">low_label</span>  <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">low</span>  <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                            <span class="n">high_label</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">high</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitString&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitString"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitString">[docs]</a><span class="k">class</span> <span class="nc">TraitString</span> <span class="p">(</span> <span class="n">TraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Ensures that a trait attribute value is a string that satisfied some</span>
<span class="sd">    additional, optional constraints.</span>

<span class="sd">    The optional constraints include minimum and maximum lengths, and a regular</span>
<span class="sd">    expression that the string must match.</span>

<span class="sd">    If the value assigned to the trait attribute is a Python numeric type, the</span>
<span class="sd">    TraitString handler first coerces the value to a string. Values of other</span>
<span class="sd">    non-string types result in a TraitError being raised. The handler then</span>
<span class="sd">    makes sure that the resulting string is within the specified length range</span>
<span class="sd">    and that it matches the regular expression.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>

<span class="sd">    class Person(HasTraits):</span>
<span class="sd">        name = Trait(&#39;&#39;, TraitString(maxlen=50, regex=r&#39;^[A-Za-z]*$&#39;))</span>


<span class="sd">    This example defines a **Person** class with a **name** attribute, which</span>
<span class="sd">    must be a string of between 0 and 50 characters that consist of only</span>
<span class="sd">    upper and lower case letters.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">minlen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">maxlen</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">,</span> <span class="n">regex</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a TraitString handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        minlen : int</span>
<span class="sd">            The minimum length allowed for the string.</span>
<span class="sd">        maxlen : int</span>
<span class="sd">            The maximum length allowed for the string.</span>
<span class="sd">        regex : str</span>
<span class="sd">            A Python regular expression that the string must match.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">minlen</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">minlen</span><span class="p">,</span> <span class="n">maxlen</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">regex</span>  <span class="o">=</span> <span class="n">regex</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">_init</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regex</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">match</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">regex</span> <span class="p">)</span><span class="o">.</span><span class="n">match</span>
            <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minlen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span> <span class="o">==</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_regex</span>
        <span class="k">elif</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minlen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span> <span class="o">==</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_str</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_len</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">strx</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
            <span class="k">if</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">minlen</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)):</span>
                <span class="k">return</span> <span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_str</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">strx</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_len</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">strx</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minlen</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_regex</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">strx</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">match</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minlen</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">):</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39; between </span><span class="si">%d</span><span class="s"> and </span><span class="si">%d</span><span class="s"> characters long&#39;</span> <span class="o">%</span> <span class="p">(</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">minlen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span> <span class="o">!=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39; &lt;= </span><span class="si">%d</span><span class="s"> characters long&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">minlen</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="s">&#39; &gt;= </span><span class="si">%d</span><span class="s"> characters long&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">minlen</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">regex</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">msg</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39; and&#39;</span>
            <span class="n">msg</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&quot; matching the pattern &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">regex</span><span class="p">)</span>
        <span class="k">return</span> <span class="s">&#39;a string&#39;</span> <span class="o">+</span> <span class="n">msg</span>

    <span class="k">def</span> <span class="nf">__getstate__</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span> <span class="s">&#39;validate&#39;</span><span class="p">,</span> <span class="s">&#39;match&#39;</span> <span class="p">]:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">result</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__setstate__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">state</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">state</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_init</span><span class="p">()</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitCoerceType&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitCoerceType"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitCoerceType">[docs]</a><span class="k">class</span> <span class="nc">TraitCoerceType</span> <span class="p">(</span> <span class="n">TraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensures that a value assigned to a trait attribute is of a specified</span>
<span class="sd">    Python type, or can be coerced to the specified type.</span>

<span class="sd">    TraitCoerceType is the underlying handler for the predefined traits and</span>
<span class="sd">    factories for Python simple types. The TraitCoerceType class is also an</span>
<span class="sd">    example of a parametrized type, because the single TraitCoerceType class</span>
<span class="sd">    allows creating instances that check for totally different sets of values.</span>
<span class="sd">    For example::</span>

<span class="sd">        class Person(HasTraits):</span>
<span class="sd">            name = Trait(&#39;&#39;, TraitCoerceType(&#39;&#39;))</span>
<span class="sd">            weight = Trait(0.0, TraitCoerceType(float))</span>

<span class="sd">    In this example, the **name** attribute must be of type ``str`` (string),</span>
<span class="sd">    while the **weight** attribute must be of type ``float``, although both are</span>
<span class="sd">    based on instances of the TraitCoerceType class. Note that this example is</span>
<span class="sd">    essentially the same as writing::</span>

<span class="sd">        class Person(HasTraits):</span>
<span class="sd">            name = Trait(&#39;&#39;)</span>
<span class="sd">            weight = Trait(0.0)</span>

<span class="sd">    This simpler form is automatically changed by the Trait() function into</span>
<span class="sd">    the first form, based on TraitCoerceType instances, when the trait</span>
<span class="sd">    attributes are defined.</span>

<span class="sd">    For attributes based on TraitCoerceType instances, if a value that is</span>
<span class="sd">    assigned is not of the type defined for the trait, a TraitError exception</span>
<span class="sd">    is raised. However, in certain cases, if the value can be coerced to the</span>
<span class="sd">    required type, then the coerced value is assigned to the attribute. Only</span>
<span class="sd">    *widening* coercions are allowed, to avoid any possible loss of precision.</span>
<span class="sd">    The following table lists the allowed coercions.</span>

<span class="sd">    ============ =================</span>
<span class="sd">     Trait Type   Coercible Types</span>
<span class="sd">    ============ =================</span>
<span class="sd">    complex      float, int</span>
<span class="sd">    float        int</span>
<span class="sd">    long         int</span>
<span class="sd">    unicode      str</span>
<span class="sd">    ============ =================</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">aType</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a TraitCoerceType handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        aType : type</span>
<span class="sd">            Either a Python type (e.g., ``str`` or types.StringType) or a</span>
<span class="sd">            Python value (e.g., &#39;cat&#39;).</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        If *aType* is a value, it is mapped to its corresponding type. For</span>
<span class="sd">        example, the string &#39;cat&#39; is automatically mapped to ``str`` (i.e.,</span>
<span class="sd">        types.StringType).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">aType</span><span class="p">,</span> <span class="n">TypeType</span> <span class="p">):</span>
            <span class="n">aType</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span> <span class="n">aType</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aType</span> <span class="o">=</span> <span class="n">aType</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span> <span class="o">=</span> <span class="n">CoercableTypes</span><span class="p">[</span> <span class="n">aType</span> <span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">11</span><span class="p">,</span> <span class="n">aType</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="n">fv</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span>
        <span class="n">tv</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>

        <span class="c"># If the value is already the desired type, then return it:</span>
        <span class="k">if</span> <span class="n">tv</span> <span class="ow">is</span> <span class="n">fv</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="c"># Else see if it is one of the coercable types:</span>
        <span class="k">for</span> <span class="n">typei</span> <span class="ow">in</span> <span class="n">fv</span><span class="p">[</span><span class="mi">2</span><span class="p">:]:</span>
            <span class="k">if</span> <span class="n">tv</span> <span class="ow">is</span> <span class="n">typei</span><span class="p">:</span>
                <span class="c"># Return the coerced value:</span>
                <span class="k">return</span> <span class="n">fv</span><span class="p">[</span><span class="mi">1</span><span class="p">](</span> <span class="n">value</span> <span class="p">)</span>

        <span class="c"># Otherwise, raise an exception:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;a value of </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">str</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">aType</span> <span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="k">def</span> <span class="nf">get_editor</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait</span> <span class="p">):</span>

        <span class="c"># Make the special case of a &#39;bool&#39; type use the boolean editor:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aType</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">BooleanEditor</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="n">BooleanEditor</span><span class="p">()</span>

            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span>

        <span class="c"># Otherwise, map all other types to a text editor:</span>
        <span class="n">auto_set</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">auto_set</span>
        <span class="k">if</span> <span class="n">auto_set</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">auto_set</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">TextEditor</span>

        <span class="k">return</span> <span class="n">TextEditor</span><span class="p">(</span> <span class="n">auto_set</span>  <span class="o">=</span> <span class="n">auto_set</span><span class="p">,</span>
                           <span class="n">enter_set</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">enter_set</span> <span class="ow">or</span> <span class="bp">False</span><span class="p">,</span>
                           <span class="n">evaluate</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitCastType&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitCastType"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitCastType">[docs]</a><span class="k">class</span> <span class="nc">TraitCastType</span> <span class="p">(</span> <span class="n">TraitCoerceType</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensures that a value assigned to a trait attribute is of a specified</span>
<span class="sd">    Python type, or can be cast to the specified type.</span>

<span class="sd">    This class is similar to TraitCoerceType, but uses casting rather than</span>
<span class="sd">    coercion. Values are cast by calling the type with the value to be assigned</span>
<span class="sd">    as an argument. When casting is performed, the result of the cast is the</span>
<span class="sd">    value assigned to the trait attribute.</span>

<span class="sd">    Any trait that uses a TraitCastType instance in its definition ensures that</span>
<span class="sd">    its value is of the type associated with the TraitCastType instance. For</span>
<span class="sd">    example::</span>

<span class="sd">        class Person(HasTraits):</span>
<span class="sd">            name = Trait(&#39;&#39;, TraitCastType(&#39;&#39;))</span>
<span class="sd">            weight = Trait(0.0, TraitCastType(float))</span>

<span class="sd">    In this example, the **name** trait must be of type ``str`` (string), while</span>
<span class="sd">    the **weight** trait must be of type ``float``. Note that this example is</span>
<span class="sd">    essentially the same as writing::</span>

<span class="sd">        class Person(HasTraits):</span>
<span class="sd">            name = CStr</span>
<span class="sd">            weight = CFloat</span>

<span class="sd">    To understand the difference between TraitCoerceType and TraitCastType (and</span>
<span class="sd">    also between Float and CFloat), consider the following example::</span>

<span class="sd">        &gt;&gt;&gt;class Person(HasTraits):</span>
<span class="sd">        ...    weight = Float</span>
<span class="sd">        ...    cweight = CFloat</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt;bill = Person()</span>
<span class="sd">        &gt;&gt;&gt;bill.weight = 180    # OK, coerced to 180.0</span>
<span class="sd">        &gt;&gt;&gt;bill.cweight = 180   # OK, cast to 180.0</span>
<span class="sd">        &gt;&gt;&gt;bill.weight = &#39;180&#39;  # Error, invalid coercion</span>
<span class="sd">        &gt;&gt;&gt;bill.cweight = &#39;180&#39; # OK, cast to float(&#39;180&#39;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">aType</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a TraitCastType handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        aType : type</span>
<span class="sd">            Either a Python type (e.g., ``str`` or types.StringType) or a</span>
<span class="sd">            Python value (e.g., ``&#39;cat``).</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        If *aType* is a Python value, it is automatically mapped to its</span>
<span class="sd">        corresponding Python type. For example, the string &#39;cat&#39; is</span>
<span class="sd">        automatically mapped to ``str`` (i.e., types.StringType).</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">aType</span><span class="p">,</span> <span class="n">TypeType</span> <span class="p">):</span>
            <span class="n">aType</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span> <span class="n">aType</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aType</span> <span class="o">=</span> <span class="n">aType</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">12</span><span class="p">,</span> <span class="n">aType</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>

        <span class="c"># If the value is already the desired type, then return it:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span> <span class="ow">is</span> <span class="bp">self</span><span class="o">.</span><span class="n">aType</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="c"># Else try to cast it to the specified type:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aType</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;ThisClass&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="ThisClass"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.ThisClass">[docs]</a><span class="k">class</span> <span class="nc">ThisClass</span> <span class="p">(</span> <span class="n">TraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensures that the trait attribute values belong to the same class (or</span>
<span class="sd">       a subclass) as the object containing the trait attribute.</span>

<span class="sd">       ThisClass is the underlying handler for the predefined traits **This**</span>
<span class="sd">       and **self**, and the elements of ListThis.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">allow_none</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a ThisClass handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        allow_none : bool</span>
<span class="sd">            Flag indicating whether None is accepted as a valid value</span>
<span class="sd">            (True or non-zero) or not (False or 0).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">allow_none</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_none</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">info</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">info_none</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">2</span><span class="p">,</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="nb">object</span><span class="o">.</span><span class="n">__class__</span> <span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate_failed</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate_none</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="nb">object</span><span class="o">.</span><span class="n">__class__</span> <span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate_failed</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;an instance of the same type as the receiver&#39;</span>

    <span class="k">def</span> <span class="nf">info_none</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;an instance of the same type as the receiver or None&#39;</span>

    <span class="k">def</span> <span class="nf">validate_failed</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_editor</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait</span> <span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">InstanceEditor</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="n">InstanceEditor</span><span class="p">(</span> <span class="n">label</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">label</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                                          <span class="n">view</span>  <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">view</span>  <span class="ow">or</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                                          <span class="n">kind</span>  <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">kind</span>  <span class="ow">or</span> <span class="s">&#39;live&#39;</span> <span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitInstance&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<span class="c"># Mapping from &#39;adapt&#39; parameter values to &#39;fast validate&#39; values</span></div>
<span class="n">AdaptMap</span> <span class="o">=</span> <span class="p">{</span>
   <span class="s">&#39;no&#39;</span><span class="p">:</span>     <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
   <span class="s">&#39;yes&#39;</span><span class="p">:</span>     <span class="mi">0</span><span class="p">,</span>
   <span class="s">&#39;default&#39;</span><span class="p">:</span> <span class="mi">1</span>
<span class="p">}</span>

<div class="viewcode-block" id="TraitInstance"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitInstance">[docs]</a><span class="k">class</span> <span class="nc">TraitInstance</span> <span class="p">(</span> <span class="n">ThisClass</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensures that trait attribute values belong to a specified Python class</span>
<span class="sd">    or type.</span>

<span class="sd">    TraitInstance is the underlying handler for the predefined trait</span>
<span class="sd">    **Instance** and the elements of List( Instance ).</span>

<span class="sd">    Any trait that uses a TraitInstance handler ensures that its values belong</span>
<span class="sd">    to the specified type or class (or one of its subclasses). For example::</span>

<span class="sd">        class Employee(HasTraits):</span>
<span class="sd">            manager = Trait(None, TraitInstance(Employee, True))</span>

<span class="sd">    This example defines a class Employee, which has a **manager** trait</span>
<span class="sd">    attribute, which accepts either None or an instance of Employee</span>
<span class="sd">    as its value.</span>

<span class="sd">    TraitInstance ensures that assigned values are exactly of the type specified</span>
<span class="sd">    (i.e., no coercion is performed).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">aClass</span><span class="p">,</span> <span class="n">allow_none</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">adapt</span> <span class="o">=</span> <span class="s">&#39;no&#39;</span><span class="p">,</span>
                   <span class="n">module</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a TraitInstance handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        aClass : class or type</span>
<span class="sd">            A Python class, an instance of a Python class, or a Python type.</span>
<span class="sd">        allow_none : bool</span>
<span class="sd">            Flag indicating whether None is accepted as a valid value.</span>
<span class="sd">            (True or non-zero) or not (False or 0)</span>
<span class="sd">        adapt : str</span>
<span class="sd">            Value indicating how adaptation should be handled:</span>

<span class="sd">            - &#39;no&#39; (-1): Adaptation is not allowed.</span>
<span class="sd">            - &#39;yes&#39; (0): Adaptation is allowed and should raise an exception if</span>
<span class="sd">              adaptation fails.</span>
<span class="sd">            - &#39;default&#39; (1): Adaption is allowed and should return the default</span>
<span class="sd">              value if adaptation fails.</span>
<span class="sd">        module : module</span>
<span class="sd">            The module that the class belongs to.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        If *aClass* is an instance, it is mapped to the class it is an instance</span>
<span class="sd">        of.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_allow_none</span> <span class="o">=</span> <span class="n">allow_none</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">adapt</span>       <span class="o">=</span> <span class="n">AdaptMap</span><span class="p">[</span> <span class="n">adapt</span> <span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">module</span>      <span class="o">=</span> <span class="n">module</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">aClass</span><span class="p">,</span> <span class="nb">basestring</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span> <span class="o">=</span> <span class="n">aClass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">aClass</span><span class="p">,</span> <span class="n">ClassTypes</span> <span class="p">):</span>
                <span class="n">aClass</span> <span class="o">=</span> <span class="n">aClass</span><span class="o">.</span><span class="n">__class__</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span> <span class="o">=</span> <span class="n">aClass</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_fast_validate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">allow_none</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_allow_none</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;fast_validate&#39;</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">set_fast_validate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_fast_validate</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapt</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fast_validate</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span> <span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_none</span><span class="p">:</span>
                <span class="n">fast_validate</span> <span class="o">=</span> <span class="p">[</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span> <span class="p">]</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span> <span class="ow">in</span> <span class="n">TypeTypes</span><span class="p">:</span>
                <span class="n">fast_validate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span> <span class="n">fast_validate</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">19</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapt</span><span class="p">,</span>
                                   <span class="bp">self</span><span class="o">.</span><span class="n">_allow_none</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>

        <span class="kn">from</span> <span class="nn">traits.adaptation.api</span> <span class="kn">import</span> <span class="n">adapt</span>

        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_none</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">validate_failed</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span><span class="p">,</span> <span class="nb">basestring</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">resolve_class</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapt</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span> <span class="p">):</span>
                <span class="k">return</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapt</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">adapt</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span> <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># fixme: The &#39;None&#39; value is not really correct. It should return</span>
            <span class="c"># the default value for the trait, but the handler does not have</span>
            <span class="c"># any way to know this currently. Since the &#39;fast validate&#39; code</span>
            <span class="c"># does the correct thing, this should not normally be a problem.</span>
            <span class="k">return</span> <span class="n">adapt</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validate_failed</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">aClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span> <span class="n">aClass</span> <span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="nb">str</span><span class="p">:</span>
            <span class="n">aClass</span> <span class="o">=</span> <span class="n">aClass</span><span class="o">.</span><span class="n">__name__</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">adapt</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">class_of</span><span class="p">(</span> <span class="n">aClass</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;an implementor of, or can be adapted to implement, </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                      <span class="n">aClass</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_allow_none</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">result</span> <span class="o">+</span> <span class="s">&#39; or None&#39;</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">resolve_class</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="n">aClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_class</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_class</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">aClass</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_failed</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span> <span class="o">=</span> <span class="n">aClass</span>

        <span class="c"># fixme: The following is quite ugly, because it wants to try and fix</span>
        <span class="c"># the trait referencing this handler to use the &#39;fast path&#39; now that the</span>
        <span class="c"># actual class has been resolved. The problem is finding the trait,</span>
        <span class="c"># especially in the case of List(Instance(&#39;foo&#39;)), where the</span>
        <span class="c"># object.base_trait(...) value is the List trait, not the Instance</span>
        <span class="c"># trait, so we need to check for this and pull out the List</span>
        <span class="c"># &#39;item_trait&#39;. Obviously this does not extend well to other traits</span>
        <span class="c"># containing nested trait references (Dict?)...</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_fast_validate</span><span class="p">()</span>
        <span class="n">trait</span>   <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="n">base_trait</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">handler</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">self</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span> <span class="n">handler</span><span class="p">,</span> <span class="s">&#39;item_trait&#39;</span> <span class="p">):</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">item_trait</span>
        <span class="n">trait</span><span class="o">.</span><span class="n">set_validate</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">find_class</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">aClass</span> <span class="p">):</span>
        <span class="n">module</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">module</span>
        <span class="n">col</span>    <span class="o">=</span> <span class="n">aClass</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span> <span class="s">&#39;.&#39;</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">col</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">module</span> <span class="o">=</span> <span class="n">aClass</span><span class="p">[</span> <span class="p">:</span> <span class="n">col</span> <span class="p">]</span>
            <span class="n">aClass</span> <span class="o">=</span> <span class="n">aClass</span><span class="p">[</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span> <span class="p">]</span>

        <span class="n">theClass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">module</span> <span class="p">),</span> <span class="n">aClass</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">theClass</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">col</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">mod</span> <span class="o">=</span> <span class="nb">__import__</span><span class="p">(</span> <span class="n">module</span> <span class="p">,</span> <span class="nb">globals</span><span class="o">=</span><span class="nb">globals</span><span class="p">(),</span> <span class="n">level</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">component</span> <span class="ow">in</span> <span class="n">module</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s">&#39;.&#39;</span> <span class="p">)[</span><span class="mi">1</span><span class="p">:]:</span>
                    <span class="n">mod</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">mod</span><span class="p">,</span> <span class="n">component</span> <span class="p">)</span>
                <span class="n">theClass</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">mod</span><span class="p">,</span> <span class="n">aClass</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">return</span> <span class="n">theClass</span>

    <span class="k">def</span> <span class="nf">validate_class</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">aClass</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">aClass</span>

    <span class="k">def</span> <span class="nf">create_default_value</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span> <span class="p">):</span>
        <span class="n">aClass</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">aClass</span><span class="p">,</span> <span class="nb">basestring</span> <span class="p">):</span>
            <span class="n">aClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate_class</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_class</span><span class="p">(</span> <span class="n">aClass</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">aClass</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="s">&#39;Unable to locate class: &#39;</span> <span class="o">+</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

        <span class="k">return</span> <span class="n">aClass</span><span class="p">(</span> <span class="o">*</span><span class="n">args</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="o">**</span><span class="n">kw</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitWeakRef&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitWeakRef"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitWeakRef">[docs]</a><span class="k">class</span> <span class="nc">TraitWeakRef</span> <span class="p">(</span> <span class="n">TraitInstance</span> <span class="p">):</span>

    <span class="k">def</span> <span class="nf">_get</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span><span class="o">.</span><span class="n">value</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">_set</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">HandleWeakRef</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
        <span class="nb">object</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">resolve_class</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="c"># fixme: We have to override this method to prevent the &#39;fast validate&#39;</span>
        <span class="c"># from being set up, since the trait using this is a &#39;property&#39; style</span>
        <span class="c"># trait which is not currently compatible with the &#39;fast_validate&#39;</span>
        <span class="c"># style (causes internal Python SystemError messages).</span>
        <span class="n">aClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">find_class</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">aClass</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">validate_failed</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span> <span class="o">=</span> <span class="n">aClass</span>



<span class="c">#-- Private Class --------------------------------------------------------------</span>
</div>
<span class="k">def</span> <span class="nf">_make_value_freed_callback</span> <span class="p">(</span> <span class="n">object_ref</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
    <span class="k">def</span> <span class="nf">_value_freed</span> <span class="p">(</span> <span class="n">value_ref</span> <span class="p">):</span>
        <span class="nb">object</span> <span class="o">=</span> <span class="n">object_ref</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">object</span><span class="o">.</span><span class="n">trait_property_changed</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">Undefined</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
    <span class="k">return</span> <span class="n">_value_freed</span>


<div class="viewcode-block" id="HandleWeakRef"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.HandleWeakRef">[docs]</a><span class="k">class</span> <span class="nc">HandleWeakRef</span> <span class="p">(</span> <span class="nb">object</span> <span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="n">object_ref</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span> <span class="nb">object</span> <span class="p">)</span>
        <span class="n">_value_freed</span> <span class="o">=</span> <span class="n">_make_value_freed_callback</span><span class="p">(</span> <span class="n">object_ref</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">object_ref</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="n">_value_freed</span> <span class="p">)</span>


<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitClass&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitClass"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitClass">[docs]</a><span class="k">class</span> <span class="nc">TraitClass</span> <span class="p">(</span> <span class="n">TraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensures that trait attribute values are subclasses of a specified class</span>
<span class="sd">    (or the class itself).</span>

<span class="sd">    A value is valid if it is a subclass of the specified class (including the</span>
<span class="sd">    class itself), or it is a string that is equivalent to the name of a valid</span>
<span class="sd">    class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">aClass</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a TraitClass handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        aClass : class</span>
<span class="sd">            A Python class.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        If *aClass* is an instance, it is mapped to the class it is an instance</span>
<span class="sd">        of.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">_py2to3</span><span class="o">.</span><span class="n">is_old_style_instance</span><span class="p">(</span><span class="n">aClass</span><span class="p">):</span>
            <span class="n">aClass</span> <span class="o">=</span> <span class="n">aClass</span><span class="o">.</span><span class="n">__class__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span> <span class="o">=</span> <span class="n">aClass</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="nb">basestring</span> <span class="p">):</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">col</span>   <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">rfind</span><span class="p">(</span> <span class="s">&#39;.&#39;</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">col</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">module_name</span> <span class="o">=</span> <span class="n">value</span><span class="p">[:</span><span class="n">col</span><span class="p">]</span>
                    <span class="n">class_name</span>  <span class="o">=</span> <span class="n">value</span><span class="p">[</span><span class="n">col</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
                    <span class="n">module</span>      <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">module_name</span> <span class="p">)</span>
                    <span class="k">if</span> <span class="n">module</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="k">exec</span><span class="p">(</span> <span class="s">&#39;import &#39;</span> <span class="o">+</span> <span class="n">module_name</span> <span class="p">)</span>
                        <span class="n">module</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span> <span class="n">module_name</span> <span class="p">]</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">module</span><span class="p">,</span> <span class="n">class_name</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>

            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span> <span class="p">):</span>
                <span class="k">return</span> <span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;a subclass of &#39;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">aClass</span><span class="o">.</span><span class="n">__name__</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitFunction&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitFunction"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitFunction">[docs]</a><span class="k">class</span> <span class="nc">TraitFunction</span> <span class="p">(</span> <span class="n">TraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensures that assigned trait attribute values are acceptable to a</span>
<span class="sd">    specified validator function.</span>

<span class="sd">    TraitFunction is the underlying handler for the predefined trait</span>
<span class="sd">    **Function**, and for the use of function references as arguments to the</span>
<span class="sd">    Trait() function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">aFunc</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a TraitFunction handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        aFunc : function</span>
<span class="sd">            A function to validate trait attribute values.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        The signature of the function passed as an argument must be of the</span>
<span class="sd">        form *function* ( *object*, *name*, *value* ). The function must</span>
<span class="sd">        verify that *value* is a legal value for the *name* trait attribute</span>
<span class="sd">        of *object*. If it is, the value returned by the function is the</span>
<span class="sd">        actual value assigned to the trait attribute. If it is not, the</span>
<span class="sd">        function must raise a TraitError exception.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">aFunc</span><span class="p">,</span> <span class="n">CallableTypes</span> <span class="p">):</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="s">&quot;Argument must be callable.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">aFunc</span> <span class="o">=</span> <span class="n">aFunc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">13</span><span class="p">,</span> <span class="n">aFunc</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aFunc</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
        <span class="k">except</span> <span class="n">TraitError</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aFunc</span><span class="o">.</span><span class="n">info</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">aFunc</span><span class="o">.</span><span class="n">__doc__</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">aFunc</span><span class="o">.</span><span class="n">__doc__</span>
            <span class="k">return</span> <span class="s">&#39;a legal value&#39;</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitEnum&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitEnum"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitEnum">[docs]</a><span class="k">class</span> <span class="nc">TraitEnum</span> <span class="p">(</span> <span class="n">TraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Ensures that a value assigned to a trait attribute is a member of a</span>
<span class="sd">    specified list of values.</span>

<span class="sd">    TraitEnum is the underlying handler for the forms of the Trait() function</span>
<span class="sd">    that take a list of possible values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a TraitEnum handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        values : list or tuple</span>
<span class="sd">            Enumeration of all legal values for a trait.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        The list of legal values can be provided as a list of values. That is,</span>
<span class="sd">        ``TraitEnum([1, 2, 3])`` and ``TraitEnum(1, 2, 3)`` are equivalent. For</span>
<span class="sd">        example::</span>

<span class="sd">            class Flower(HasTraits):</span>
<span class="sd">                color = Trait(&#39;white&#39;, TraitEnum([&#39;white&#39;, &#39;yellow&#39;, &#39;red&#39;]))</span>
<span class="sd">                kind  = Trait(&#39;annual&#39;, TraitEnum(&#39;annual&#39;, &#39;perennial&#39;))</span>

<span class="sd">        This example defines a Flower class, which has a **color** trait</span>
<span class="sd">        attribute, which can have as its value, one of the three strings,</span>
<span class="sd">        &#39;white&#39;, &#39;yellow&#39;, or &#39;red&#39;, and a **kind** trait attribute, which can</span>
<span class="sd">        have as its value, either of the strings &#39;annual&#39; or &#39;perennial&#39;. This</span>
<span class="sd">        is equivalent to the following class definition::</span>

<span class="sd">            class Flower(HasTraits):</span>
<span class="sd">                color = Trait([&#39;white&#39;, &#39;yellow&#39;, &#39;red&#39;])</span>
<span class="sd">                kind  = Trait(&#39;annual&#39;, &#39;perennial&#39;)</span>

<span class="sd">        The Trait() function automatically maps traits of the form shown in</span>
<span class="sd">        this example to the form shown in the preceding example whenever it</span>
<span class="sd">        encounters them in a trait definition.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">values</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="ow">in</span> <span class="n">SequenceTypes</span><span class="p">):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span>        <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span> <span class="n">values</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">5</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39; or &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span> <span class="nb">repr</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="p">]</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_editor</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait</span> <span class="p">):</span>
        <span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">EnumEditor</span>

        <span class="k">return</span> <span class="n">EnumEditor</span><span class="p">(</span> <span class="n">values</span>   <span class="o">=</span> <span class="bp">self</span><span class="p">,</span>
                           <span class="n">cols</span>     <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">cols</span> <span class="ow">or</span> <span class="mi">3</span><span class="p">,</span>
                           <span class="n">evaluate</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">evaluate</span><span class="p">,</span>
                           <span class="n">mode</span>     <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">mode</span> <span class="ow">or</span> <span class="s">&#39;radio&#39;</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitPrefixList&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitPrefixList"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitPrefixList">[docs]</a><span class="k">class</span> <span class="nc">TraitPrefixList</span> <span class="p">(</span> <span class="n">TraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensures that a value assigned to a trait attribute is a member of a list</span>
<span class="sd">    of specified string values, or is a unique prefix of one of those values.</span>

<span class="sd">    TraitPrefixList is a variation on TraitEnum. The values that can be</span>
<span class="sd">    assigned to a trait attribute defined using a TraitPrefixList handler is the</span>
<span class="sd">    set of all strings supplied to the TraitPrefixList constructor, as well as</span>
<span class="sd">    any unique prefix of those strings. That is, if the set of strings supplied</span>
<span class="sd">    to the constructor is described by [*s*\ :sub:`1`\ , *s*\ :sub:`2`\ , ...,</span>
<span class="sd">    *s*\ :sub:`n`\ ], then the string *v* is a valid value for the trait if</span>
<span class="sd">    *v* == *s*\ :sub:`i[:j]` for one and only one pair of values (i, j). If *v*</span>
<span class="sd">    is a valid value, then the actual value assigned to the trait attribute is</span>
<span class="sd">    the corresponding *s*\ :sub:`i` value that *v* matched.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>

<span class="sd">    class Person(HasTraits):</span>
<span class="sd">        married = Trait(&#39;no&#39;, TraitPrefixList(&#39;yes&#39;, &#39;no&#39;)</span>

<span class="sd">    The Person class has a **married** trait that accepts any of the</span>
<span class="sd">    strings &#39;y&#39;, &#39;ye&#39;, &#39;yes&#39;, &#39;n&#39;, or &#39;no&#39; as valid values. However, the actual</span>
<span class="sd">    values assigned as the value of the trait attribute are limited to either</span>
<span class="sd">    &#39;yes&#39; or &#39;no&#39;. That is, if the value &#39;y&#39; is assigned to the **married**</span>
<span class="sd">    attribute, the actual value assigned will be &#39;yes&#39;.</span>

<span class="sd">    Note that the algorithm used by TraitPrefixList in determining whether a</span>
<span class="sd">    string is a valid value is fairly efficient in terms of both time and space,</span>
<span class="sd">    and is not based on a brute force set of comparisons.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">values</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a TraitPrefixList handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        values : list or tuple of strings</span>
<span class="sd">            Enumeration of all legal values for a trait.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        As with TraitEnum, the list of legal values can be provided as a list</span>
<span class="sd">        of values.  That is, ``TraitPrefixList([&#39;one&#39;, &#39;two&#39;, &#39;three&#39;])`` and</span>
<span class="sd">        ``TraitPrefixList(&#39;one&#39;, &#39;two&#39;, &#39;three&#39;)`` are equivalent.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">values</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="ow">in</span> <span class="n">SequenceTypes</span><span class="p">):</span>
            <span class="n">values</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values</span>  <span class="o">=</span> <span class="n">values</span><span class="p">[:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">values_</span> <span class="o">=</span> <span class="n">values_</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="n">values_</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">10</span><span class="p">,</span> <span class="n">values_</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">n</span>     <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">key</span><span class="p">[:</span><span class="n">n</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                           <span class="n">match</span> <span class="o">=</span> <span class="bp">None</span>
                           <span class="k">break</span>
                        <span class="n">match</span> <span class="o">=</span> <span class="n">key</span>
                <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">values_</span><span class="p">[</span> <span class="n">value</span> <span class="p">]</span> <span class="o">=</span> <span class="n">match</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">values_</span><span class="p">[</span> <span class="n">value</span> <span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span><span class="s">&#39; or &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span> <span class="nb">repr</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">values</span> <span class="p">]</span> <span class="p">)</span> <span class="o">+</span>
                <span class="s">&#39; (or any unique prefix)&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_editor</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait</span> <span class="p">):</span>
        <span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">EnumEditor</span>

        <span class="k">return</span> <span class="n">EnumEditor</span><span class="p">(</span> <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span>
                           <span class="n">cols</span>   <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">cols</span> <span class="ow">or</span> <span class="mi">3</span>  <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getstate__</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">if</span> <span class="s">&#39;fast_validate&#39;</span> <span class="ow">in</span> <span class="n">result</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">result</span><span class="p">[</span> <span class="s">&#39;fast_validate&#39;</span> <span class="p">]</span>

        <span class="k">return</span> <span class="n">result</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitMap&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitMap"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitMap">[docs]</a><span class="k">class</span> <span class="nc">TraitMap</span> <span class="p">(</span> <span class="n">TraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Checks that the value assigned to a trait attribute is a key of a</span>
<span class="sd">    specified dictionary, and also assigns the dictionary value corresponding</span>
<span class="sd">    to that key to a *shadow* attribute.</span>

<span class="sd">    A trait attribute that uses a TraitMap handler is called *mapped* trait</span>
<span class="sd">    attribute. In practice, this means that the resulting object actually</span>
<span class="sd">    contains two attributes: one whose value is a key of the TraitMap</span>
<span class="sd">    dictionary, and the other whose value is the corresponding value of the</span>
<span class="sd">    TraitMap dictionary. The name of the shadow attribute is simply the base</span>
<span class="sd">    attribute name with an underscore (&#39;_&#39;) appended. Mapped trait attributes</span>
<span class="sd">    can be used to allow a variety of user-friendly input values to be mapped to</span>
<span class="sd">    a set of internal, program-friendly values.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>

<span class="sd">        &gt;&gt;&gt;class Person(HasTraits):</span>
<span class="sd">        ...    married = Trait(&#39;yes&#39;, TraitMap({&#39;yes&#39;: 1, &#39;no&#39;: 0 })</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt;bob = Person()</span>
<span class="sd">        &gt;&gt;&gt;print bob.married</span>
<span class="sd">        yes</span>
<span class="sd">        &gt;&gt;&gt;print bob.married_</span>
<span class="sd">        1</span>

<span class="sd">    In this example, the default value of the **married** attribute of the</span>
<span class="sd">    Person class is &#39;yes&#39;. Because this attribute is defined using</span>
<span class="sd">    TraitPrefixList, instances of Person have another attribute,</span>
<span class="sd">    **married_**, whose default value is 1, the dictionary value corresponding</span>
<span class="sd">    to the key &#39;yes&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">is_mapped</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">map</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a TraitMap handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        map : dict</span>
<span class="sd">            A dictionary whose keys are valid values for the trait attribute,</span>
<span class="sd">            and whose corresponding values are the values for the shadow</span>
<span class="sd">            trait attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map</span> <span class="o">=</span> <span class="nb">map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">6</span><span class="p">,</span> <span class="nb">map</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">mapped_value</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="p">[</span> <span class="n">value</span> <span class="p">]</span>

    <span class="k">def</span> <span class="nf">post_setattr</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">setattr</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapped_value</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c"># We don&#39;t need a fancy error message, because this exception</span>
            <span class="c"># should always be caught by a TraitCompound handler:</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="s">&#39;Unmappable&#39;</span>

    <span class="k">def</span> <span class="nf">info</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[</span> <span class="nb">repr</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="p">]</span>
        <span class="n">keys</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">return</span> <span class="s">&#39; or &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">keys</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_editor</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait</span> <span class="p">):</span>
        <span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">EnumEditor</span>

        <span class="k">return</span> <span class="n">EnumEditor</span><span class="p">(</span> <span class="n">values</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span>
                           <span class="n">cols</span>   <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">cols</span> <span class="ow">or</span> <span class="mi">3</span>  <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitPrefixMap&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitPrefixMap"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitPrefixMap">[docs]</a><span class="k">class</span> <span class="nc">TraitPrefixMap</span> <span class="p">(</span> <span class="n">TraitMap</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;A cross between the TraitPrefixList and TraitMap classes.</span>

<span class="sd">    Like TraitMap, TraitPrefixMap is created using a dictionary, but in this</span>
<span class="sd">    case, the keys of the dictionary must be strings. Like TraitPrefixList,</span>
<span class="sd">    a string *v* is a valid value for the trait attribute if it is a prefix of</span>
<span class="sd">    one and only one key *k* in the dictionary. The actual values assigned to</span>
<span class="sd">    the trait attribute is *k*, and its corresponding mapped attribute is</span>
<span class="sd">    *map*[*k*].</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>

<span class="sd">        mapping = {&#39;true&#39;: 1, &#39;yes&#39;: 1, &#39;false&#39;: 0, &#39;no&#39;: 0 }</span>
<span class="sd">        boolean_map = Trait(&#39;true&#39;, TraitPrefixMap(mapping))</span>

<span class="sd">    This example defines a Boolean trait that accepts any prefix of &#39;true&#39;,</span>
<span class="sd">    &#39;yes&#39;, &#39;false&#39;, or &#39;no&#39;, and maps them to 1 or 0.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">map</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Creates a TraitPrefixMap handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        map : dict</span>
<span class="sd">            A dictionary whose keys are strings that are valid values for the</span>
<span class="sd">            trait attribute, and whose corresponding values are the values for</span>
<span class="sd">            the shadow trait attribute.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">map</span>  <span class="o">=</span> <span class="nb">map</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_map</span> <span class="o">=</span> <span class="n">_map</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="nb">map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">_map</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">10</span><span class="p">,</span> <span class="n">_map</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">validate</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map</span><span class="p">:</span>
                <span class="n">match</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="n">n</span>     <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
                <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">map</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">value</span> <span class="o">==</span> <span class="n">key</span><span class="p">[:</span><span class="n">n</span><span class="p">]:</span>
                        <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                           <span class="n">match</span> <span class="o">=</span> <span class="bp">None</span>
                           <span class="k">break</span>
                        <span class="n">match</span> <span class="o">=</span> <span class="n">key</span>
                <span class="k">if</span> <span class="n">match</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_map</span><span class="p">[</span> <span class="n">value</span> <span class="p">]</span> <span class="o">=</span> <span class="n">match</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_map</span><span class="p">[</span> <span class="n">value</span> <span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">(</span> <span class="n">TraitPrefixMap</span><span class="p">,</span> <span class="bp">self</span> <span class="p">)</span><span class="o">.</span><span class="n">info</span><span class="p">()</span> <span class="o">+</span> <span class="s">&#39; (or any unique prefix)&#39;</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitExpression&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitExpression"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitExpression">[docs]</a><span class="k">class</span> <span class="nc">TraitExpression</span> <span class="p">(</span> <span class="n">TraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Ensures that a value assigned to a trait attribute is a valid Python</span>
<span class="sd">        expression. The compiled form of a valid expression is stored as the</span>
<span class="sd">        mapped value of the trait.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">is_mapped</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">compile</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="s">&#39;&lt;string&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;eval&#39;</span> <span class="p">)</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">post_setattr</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="nb">object</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapped_value</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;a valid Python expression&#39;</span>

    <span class="k">def</span> <span class="nf">mapped_value</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">return</span> <span class="nb">compile</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="s">&#39;&lt;string&gt;&#39;</span><span class="p">,</span> <span class="s">&#39;eval&#39;</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitCompound&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitCompound"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitCompound">[docs]</a><span class="k">class</span> <span class="nc">TraitCompound</span> <span class="p">(</span> <span class="n">TraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Provides a logical-OR combination of other trait handlers.</span>

<span class="sd">    This class provides a means of creating complex trait definitions by</span>
<span class="sd">    combining several simpler trait definitions. TraitCompound is the underlying</span>
<span class="sd">    handler for the general forms of the Trait() function.</span>

<span class="sd">    A value is a valid value for a trait attribute based on a TraitCompound</span>
<span class="sd">    instance if the value is valid for at least one of the TraitHandler or</span>
<span class="sd">    trait objects supplied to the constructor. In addition, if at least one of</span>
<span class="sd">    the TraitHandler or trait objects is mapped (e.g., based on a TraitMap or</span>
<span class="sd">    TraitPrefixMap instance), then the TraitCompound is also mapped. In this</span>
<span class="sd">    case, any non-mapped traits or trait handlers use identity mapping.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">handlers</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a TraitCompound handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *handlers :</span>
<span class="sd">            list or tuple of TraitHandler or trait objects to be combined.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">handlers</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span> <span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="ow">in</span> <span class="n">SequenceTypes</span><span class="p">):</span>
            <span class="n">handlers</span> <span class="o">=</span> <span class="n">handlers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">handlers</span> <span class="o">=</span> <span class="n">handlers</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_validate</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">set_validate</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">is_mapped</span>  <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_items</span>  <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">reversable</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">post_setattrs</span>   <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mapped_handlers</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">validates</span>       <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fast_validates</span>  <span class="o">=</span> <span class="p">[]</span>
        <span class="n">slow_validates</span>  <span class="o">=</span> <span class="p">[]</span>

        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handlers</span><span class="p">:</span>
            <span class="n">fv</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">handler</span><span class="p">,</span> <span class="s">&#39;fast_validate&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">fv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">validates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">handler</span><span class="o">.</span><span class="n">validate</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">fv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
                    <span class="c"># If this is a nested complex fast validator, expand its</span>
                    <span class="c"># contents and adds its list to our list:</span>
                    <span class="n">fast_validates</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="n">fv</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Else just add the entire validator to the list:</span>
                    <span class="n">fast_validates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">fv</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">slow_validates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">handler</span><span class="o">.</span><span class="n">validate</span> <span class="p">)</span>

            <span class="n">post_setattr</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">handler</span><span class="p">,</span> <span class="s">&#39;post_setattr&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">post_setattr</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">post_setattrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">post_setattr</span> <span class="p">)</span>

            <span class="k">if</span> <span class="n">handler</span><span class="o">.</span><span class="n">is_mapped</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">is_mapped</span> <span class="o">=</span> <span class="bp">True</span>
                <span class="n">mapped_handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">handler</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">reversable</span> <span class="o">=</span> <span class="bp">False</span>

            <span class="k">if</span> <span class="n">handler</span><span class="o">.</span><span class="n">has_items</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">has_items</span> <span class="o">=</span> <span class="bp">True</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">validates</span>      <span class="o">=</span> <span class="n">validates</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">slow_validates</span> <span class="o">=</span> <span class="n">slow_validates</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_mapped</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mapped_handlers</span> <span class="o">=</span> <span class="n">mapped_handlers</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;mapped_handlers&#39;</span> <span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapped_handlers</span>

        <span class="c"># If there are any fast validators, then we create a &#39;complex&#39; fast</span>
        <span class="c"># validator that composites them:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">fast_validates</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># If there are any &#39;slow&#39; validators, add a special handler at</span>
            <span class="c"># the end of the fast validator list to handle them:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">slow_validates</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">fast_validates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">)</span>
            <span class="c"># Create the &#39;complex&#39; fast validator:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">7</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span> <span class="n">fast_validates</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;fast_validate&#39;</span> <span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">post_setattrs</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">post_setattrs</span> <span class="o">=</span> <span class="n">post_setattrs</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">post_setattr</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_post_setattr</span>
        <span class="k">elif</span> <span class="nb">hasattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;post_setattr&#39;</span> <span class="p">):</span>
            <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_setattr</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">for</span> <span class="n">validate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">validates</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
               <span class="k">return</span> <span class="n">validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
            <span class="k">except</span> <span class="n">TraitError</span><span class="p">:</span>
               <span class="k">pass</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">slow_validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">slow_validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">for</span> <span class="n">validate</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">slow_validates</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
               <span class="k">return</span> <span class="n">validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
            <span class="k">except</span> <span class="n">TraitError</span><span class="p">:</span>
               <span class="k">pass</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">full_info</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39; or &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span> <span class="n">x</span><span class="o">.</span><span class="n">full_info</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
                              <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handlers</span> <span class="p">]</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39; or &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span> <span class="n">x</span><span class="o">.</span><span class="n">info</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handlers</span> <span class="p">]</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">mapped_value</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">mapped_handlers</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">handler</span><span class="o">.</span><span class="n">mapped_value</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">_post_setattr</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">for</span> <span class="n">post_setattr</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">post_setattrs</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">post_setattr</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
                <span class="k">return</span>
            <span class="k">except</span> <span class="n">TraitError</span><span class="p">:</span>
               <span class="k">pass</span>
        <span class="nb">setattr</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_editor</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait</span> <span class="p">):</span>
        <span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">TextEditor</span><span class="p">,</span> <span class="n">CompoundEditor</span>

        <span class="n">the_editors</span> <span class="o">=</span> <span class="p">[</span> <span class="n">x</span><span class="o">.</span><span class="n">get_editor</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">handlers</span> <span class="p">]</span>
        <span class="n">text_editor</span> <span class="o">=</span> <span class="n">TextEditor</span><span class="p">()</span>
        <span class="n">count</span>       <span class="o">=</span> <span class="mi">0</span>
        <span class="n">editors</span>     <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">editor</span> <span class="ow">in</span> <span class="n">the_editors</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">text_editor</span><span class="p">,</span> <span class="n">editor</span><span class="o">.</span><span class="n">__class__</span> <span class="p">):</span>
                <span class="n">count</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">count</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="n">editors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">editor</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">CompoundEditor</span><span class="p">(</span> <span class="n">editors</span> <span class="o">=</span> <span class="n">editors</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">items_event</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">items_event</span><span class="p">()</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitTuple&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitTuple"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitTuple">[docs]</a><span class="k">class</span> <span class="nc">TraitTuple</span> <span class="p">(</span> <span class="n">TraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Ensures that values assigned to a trait attribute are tuples of a</span>
<span class="sd">    specified length, with elements that are of specified types.</span>

<span class="sd">    TraitTuple is the underlying handler for the predefined trait **Tuple**,</span>
<span class="sd">    and the trait factory Tuple().</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>

<span class="sd">        rank = Range(1, 13)</span>
<span class="sd">        suit = Trait(&#39;Hearts&#39;, &#39;Diamonds&#39;, &#39;Spades&#39;, &#39;Clubs&#39;)</span>
<span class="sd">        class Card(HasTraits):</span>
<span class="sd">            value = Trait(TraitTuple(rank, suit))</span>

<span class="sd">    This example defines a Card class, which has a **value** trait attribute,</span>
<span class="sd">    which must be a tuple of two elments. The first element must be an integer</span>
<span class="sd">    in the range from 1 to 13, and the second element must be one of the four</span>
<span class="sd">    strings, &#39;Hearts&#39;, &#39;Diamonds&#39;, &#39;Spades&#39;, or &#39;Clubs&#39;.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a TraitTuple handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        *args :</span>
<span class="sd">            A list of traits, each *trait*\ :sub:`i` specifies the type that</span>
<span class="sd">            the *i*\ th element of a tuple must be.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        Each *trait*\ :sub:`i` must be either a trait, or a value that can be</span>
<span class="sd">        converted to a trait using the Trait() function. The resulting</span>
<span class="sd">        trait handler accepts values that are tuples of the same length as</span>
<span class="sd">        *args*, and whose *i*\ th element is of the type specified by</span>
<span class="sd">        *trait*\ :sub:`i`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">types</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span> <span class="p">[</span> <span class="n">trait_from</span><span class="p">(</span> <span class="n">arg</span> <span class="p">)</span> <span class="k">for</span> <span class="n">arg</span> <span class="ow">in</span> <span class="n">args</span> <span class="p">]</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fast_validate</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">9</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="nb">tuple</span> <span class="p">):</span>
                <span class="n">types</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span> <span class="n">types</span> <span class="p">):</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="nb">type</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">types</span> <span class="p">):</span>
                        <span class="n">values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="nb">type</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span>
                                                              <span class="n">value</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span> <span class="n">values</span> <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">full_info</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;a tuple of the form: (</span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
               <span class="p">[</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait_info</span><span class="p">(</span> <span class="nb">type</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
                 <span class="k">for</span> <span class="nb">type</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span> <span class="p">]</span> <span class="p">))</span>

    <span class="k">def</span> <span class="nf">_trait_info</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">type</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="n">handler</span>
        <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="s">&#39;any value&#39;</span>

        <span class="k">return</span> <span class="n">handler</span><span class="o">.</span><span class="n">full_info</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_editor</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait</span> <span class="p">):</span>
        <span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">TupleEditor</span>

        <span class="k">return</span> <span class="n">TupleEditor</span><span class="p">(</span> <span class="n">types</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">types</span><span class="p">,</span>
                            <span class="n">labels</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">labels</span> <span class="ow">or</span> <span class="p">[],</span>
                            <span class="n">cols</span>   <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">cols</span>   <span class="ow">or</span> <span class="mi">1</span>  <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitCallable&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitCallable"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitCallable">[docs]</a><span class="k">class</span> <span class="nc">TraitCallable</span> <span class="p">(</span> <span class="n">TraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Ensures that the value of a trait attribute is a callable Python object</span>
<span class="sd">    (usually a function or method).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">callable</span><span class="p">(</span> <span class="n">value</span> <span class="p">):</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">info</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="s">&#39;a callable value&#39;</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitListEvent&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitListEvent"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitListEvent">[docs]</a><span class="k">class</span> <span class="nc">TraitListEvent</span> <span class="p">(</span> <span class="nb">object</span> <span class="p">):</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Initialize the object:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">removed</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">added</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>

        <span class="k">if</span> <span class="n">removed</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">removed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removed</span> <span class="o">=</span> <span class="n">removed</span>

        <span class="k">if</span> <span class="n">added</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">added</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">added</span> <span class="o">=</span> <span class="n">added</span>


<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitList&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitList"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitList">[docs]</a><span class="k">class</span> <span class="nc">TraitList</span> <span class="p">(</span> <span class="n">TraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Ensures that a value assigned to a trait attribute is a list containing</span>
<span class="sd">    elements of a specified type, and that the length of the list is also</span>
<span class="sd">    within a specified range.</span>

<span class="sd">    TraitList also makes sure that any changes made to the list after it is</span>
<span class="sd">    assigned to the trait attribute do not violate the list&#39;s type and length</span>
<span class="sd">    constraints. TraitList is the underlying handler for the predefined</span>
<span class="sd">    list-based traits.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>

<span class="sd">    class Card(HasTraits):</span>
<span class="sd">        pass</span>
<span class="sd">    class Hand(HasTraits):</span>
<span class="sd">        cards = Trait([], TraitList(Trait(Card), maxlen=52))</span>


<span class="sd">    This example defines a Hand class, which has a **cards** trait attribute,</span>
<span class="sd">    which is a list of Card objects and can have from 0 to 52 items in the</span>
<span class="sd">    list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">info_trait</span>         <span class="o">=</span> <span class="bp">None</span>
    <span class="n">default_value_type</span> <span class="o">=</span> <span class="mi">5</span>
    <span class="n">_items_event</span>       <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">minlen</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">maxlen</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">,</span>
                         <span class="n">has_items</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a TraitList handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trait : Trait</span>
<span class="sd">            The type of items the list can contain.</span>
<span class="sd">        minlen : int</span>
<span class="sd">            The minimum length of the list.</span>
<span class="sd">        maxlen : int</span>
<span class="sd">            The maximum length of the list.</span>
<span class="sd">        has_items : bool</span>
<span class="sd">            Flag indicating whether the list contains elements.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        If *trait* is None or omitted, then no type checking is performed</span>
<span class="sd">        on any items in the list; otherwise, *trait* must be either a trait, or</span>
<span class="sd">        a value that can be converted to a trait using the Trait() function.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">item_trait</span> <span class="o">=</span> <span class="n">trait_from</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minlen</span>     <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">minlen</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span>     <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="n">minlen</span><span class="p">,</span> <span class="n">maxlen</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_items</span>  <span class="o">=</span> <span class="n">has_items</span>

    <span class="k">def</span> <span class="nf">clone</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">TraitList</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_trait</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minlen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span><span class="p">,</span>
                          <span class="bp">self</span><span class="o">.</span><span class="n">has_items</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="nb">list</span> <span class="p">)</span> <span class="ow">and</span>
           <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">minlen</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">TraitListObject</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">full_info</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">minlen</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span> <span class="o">==</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="s">&#39;items&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="s">&#39;at most </span><span class="si">%d</span><span class="s"> items&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span> <span class="o">==</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxint</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="s">&#39;at least </span><span class="si">%d</span><span class="s"> items&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">minlen</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">size</span> <span class="o">=</span> <span class="s">&#39;from </span><span class="si">%s</span><span class="s"> to </span><span class="si">%s</span><span class="s"> items&#39;</span> <span class="o">%</span> <span class="p">(</span>
                       <span class="bp">self</span><span class="o">.</span><span class="n">minlen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlen</span> <span class="p">)</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_trait</span><span class="o">.</span><span class="n">handler</span>
        <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="s">&#39; which are </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">handler</span><span class="o">.</span><span class="n">full_info</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

        <span class="k">return</span> <span class="s">&#39;a list of </span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">size</span><span class="p">,</span> <span class="n">info</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_editor</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait</span> <span class="p">):</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">item_trait</span><span class="o">.</span><span class="n">handler</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">handler</span><span class="p">,</span> <span class="n">TraitInstance</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">trait</span><span class="o">.</span><span class="n">mode</span> <span class="o">!=</span> <span class="s">&#39;list&#39;</span><span class="p">):</span>
            <span class="kn">from</span> <span class="nn">.api</span> <span class="kn">import</span> <span class="n">HasTraits</span>

            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span> <span class="n">handler</span><span class="o">.</span><span class="n">aClass</span><span class="p">,</span> <span class="n">HasTraits</span> <span class="p">):</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">object</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">aClass</span><span class="p">()</span>
                    <span class="kn">from</span> <span class="nn">traitsui.table_column</span> <span class="kn">import</span> <span class="n">ObjectColumn</span>
                    <span class="kn">from</span> <span class="nn">traitsui.table_filter</span> <span class="kn">import</span> <span class="p">(</span><span class="n">EvalFilterTemplate</span><span class="p">,</span>
                        <span class="n">RuleFilterTemplate</span><span class="p">,</span> <span class="n">MenuFilterTemplate</span><span class="p">,</span> <span class="n">EvalTableFilter</span><span class="p">)</span>
                    <span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">TableEditor</span>

                    <span class="k">return</span> <span class="n">TableEditor</span><span class="p">(</span>
                            <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span> <span class="n">ObjectColumn</span><span class="p">(</span> <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="p">)</span>
                                        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">object</span><span class="o">.</span><span class="n">editable_traits</span><span class="p">()</span> <span class="p">],</span>
                            <span class="n">filters</span>     <span class="o">=</span> <span class="p">[</span> <span class="n">RuleFilterTemplate</span><span class="p">,</span>
                                            <span class="n">MenuFilterTemplate</span><span class="p">,</span>
                                            <span class="n">EvalFilterTemplate</span> <span class="p">],</span>
                            <span class="n">edit_view</span>   <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                            <span class="n">orientation</span> <span class="o">=</span> <span class="s">&#39;vertical&#39;</span><span class="p">,</span>
                            <span class="n">search</span>      <span class="o">=</span> <span class="n">EvalTableFilter</span><span class="p">(),</span>
                            <span class="n">deletable</span>   <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                            <span class="n">row_factory</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">aClass</span> <span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">ListEditor</span>

        <span class="k">return</span> <span class="n">ListEditor</span><span class="p">(</span> <span class="n">trait_handler</span> <span class="o">=</span> <span class="bp">self</span><span class="p">,</span>
                           <span class="n">rows</span>          <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">rows</span> <span class="ow">or</span> <span class="mi">5</span><span class="p">,</span>
                           <span class="n">use_notebook</span>  <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">use_notebook</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">,</span>
                           <span class="n">page_name</span>     <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">page_name</span> <span class="ow">or</span> <span class="s">&#39;&#39;</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">items_event</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">items_event</span><span class="p">()</span>
</div>
<span class="k">def</span> <span class="nf">items_event</span> <span class="p">(</span> <span class="p">):</span>
    <span class="k">if</span> <span class="n">TraitList</span><span class="o">.</span><span class="n">_items_event</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">TraitList</span><span class="o">.</span><span class="n">_items_event</span> <span class="o">=</span> \
            <span class="n">Event</span><span class="p">(</span> <span class="n">TraitListEvent</span><span class="p">,</span> <span class="n">is_base</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">)</span><span class="o">.</span><span class="n">as_ctrait</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">TraitList</span><span class="o">.</span><span class="n">_items_event</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitListObject&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="TraitListObject"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitListObject">[docs]</a><span class="k">class</span> <span class="nc">TraitListObject</span> <span class="p">(</span> <span class="nb">list</span> <span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trait</span>      <span class="o">=</span> <span class="n">trait</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span>     <span class="o">=</span> <span class="n">ref</span><span class="p">(</span> <span class="nb">object</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>       <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">has_items</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_items&#39;</span>

        <span class="c"># Do the validated &#39;setslice&#39; assignment without raising an</span>
        <span class="c"># &#39;items_changed&#39; event:</span>
        <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">minlen</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span> <span class="o">&lt;=</span> <span class="n">trait</span><span class="o">.</span><span class="n">maxlen</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">validate</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">item_trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">validate</span>
                <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="p">[</span> <span class="n">validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span> <span class="p">]</span>

                <span class="nb">list</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">value</span> <span class="p">)</span>

                <span class="k">return</span>

            <span class="k">except</span> <span class="n">TraitError</span><span class="p">,</span> <span class="n">excp</span><span class="p">:</span>
                <span class="n">excp</span><span class="o">.</span><span class="n">set_prefix</span><span class="p">(</span> <span class="s">&#39;Each element of the&#39;</span> <span class="p">)</span>
                <span class="k">raise</span> <span class="n">excp</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">len_error</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_send_trait_items_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">items_event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Send a TraitListEvent to the owning object if there is one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">items_event</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span><span class="p">):</span>
                <span class="n">items_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="o">.</span><span class="n">items_event</span><span class="p">()</span>
            <span class="nb">object</span><span class="o">.</span><span class="n">trait_items_event</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">items_event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">memo</span> <span class="p">):</span>
        <span class="n">id_self</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">id_self</span> <span class="ow">in</span> <span class="n">memo</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">memo</span><span class="p">[</span> <span class="n">id_self</span> <span class="p">]</span>

        <span class="n">memo</span><span class="p">[</span> <span class="n">id_self</span> <span class="p">]</span> <span class="o">=</span> <span class="n">result</span> <span class="o">=</span> <span class="n">TraitListObject</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">[</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">memo</span> <span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span> <span class="p">]</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__setitem__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="n">self_trait</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">self_trait</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">removed</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">removed</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="nb">object</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span>
            <span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="o">.</span><span class="n">item_trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">validate</span>
            <span class="n">name</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>

            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="nb">slice</span><span class="p">):</span>
                <span class="n">values</span> <span class="o">=</span> <span class="n">value</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">key</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">key</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)))</span>
                <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">TypeError</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s">&#39;must assign sequence (not &quot;</span><span class="si">%s</span><span class="s">&quot;) to slice&#39;</span> <span class="o">%</span> <span class="p">(</span>
                                    <span class="n">values</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="p">))</span>
                <span class="n">slice_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="n">key</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">//</span> <span class="n">key</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">values</span> <span class="p">)</span> <span class="o">-</span> <span class="n">slice_len</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">step</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">and</span> <span class="n">delta</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                        <span class="s">&#39;attempt to assign sequence of size </span><span class="si">%d</span><span class="s"> to extended slice of size </span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
                        <span class="nb">len</span><span class="p">(</span> <span class="n">values</span> <span class="p">),</span> <span class="n">slice_len</span>
                    <span class="p">))</span>
                <span class="n">newlen</span> <span class="o">=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">+</span> <span class="n">delta</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">self_trait</span><span class="o">.</span><span class="n">minlen</span> <span class="o">&lt;=</span> <span class="n">newlen</span> <span class="o">&lt;=</span> <span class="n">self_trait</span><span class="o">.</span><span class="n">maxlen</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">len_error</span><span class="p">(</span> <span class="n">newlen</span> <span class="p">)</span>
                    <span class="k">return</span>

                <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span> <span class="n">validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
                               <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span> <span class="p">]</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">values</span>
                <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">step</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                    <span class="c"># FIXME: Bug-for-bug compatibility with old __setslice__ code.</span>
                    <span class="c"># In this case, we return a TraitListEvent with an</span>
                    <span class="c"># index=key.start and the removed and added lists as they</span>
                    <span class="c"># are.</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">start</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Otherwise, we have an extended slice which was handled,</span>
                    <span class="c"># badly, by __setitem__ before. In this case, we return the</span>
                    <span class="c"># removed and added lists wrapped in another list.</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">key</span>
                    <span class="n">values</span> <span class="o">=</span> <span class="p">[</span><span class="n">values</span><span class="p">]</span>
                    <span class="n">removed</span> <span class="o">=</span> <span class="p">[</span><span class="n">removed</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

                <span class="n">values</span> <span class="o">=</span> <span class="p">[</span> <span class="n">value</span> <span class="p">]</span>
                <span class="n">removed</span> <span class="o">=</span> <span class="p">[</span> <span class="n">removed</span> <span class="p">]</span>
                <span class="n">delta</span> <span class="o">=</span> <span class="mi">0</span>

                <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">+</span> <span class="n">key</span> <span class="k">if</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">key</span>

            <span class="nb">list</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">delta</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">removed</span> <span class="o">==</span> <span class="n">values</span><span class="p">:</span>
                            <span class="k">return</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="c"># Treat incomparable values as equal:</span>
                        <span class="k">pass</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                    <span class="n">TraitListEvent</span><span class="p">(</span> <span class="n">index</span><span class="p">,</span> <span class="n">removed</span><span class="p">,</span> <span class="n">values</span> <span class="p">)</span> <span class="p">)</span>

        <span class="k">except</span> <span class="n">TraitError</span><span class="p">,</span> <span class="n">excp</span><span class="p">:</span>
            <span class="n">excp</span><span class="o">.</span><span class="n">set_prefix</span><span class="p">(</span> <span class="s">&#39;Each element of the&#39;</span> <span class="p">)</span>
            <span class="k">raise</span> <span class="n">excp</span>

    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">__setslice__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">values</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">),</span> <span class="n">values</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__delitem__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span> <span class="p">):</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="o">.</span><span class="n">__delitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">removed</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">removed</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">key</span><span class="p">,</span><span class="nb">slice</span><span class="p">):</span>
            <span class="n">key</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="o">*</span><span class="n">key</span><span class="o">.</span><span class="n">indices</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)))</span>
            <span class="n">slice_len</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="n">key</span><span class="o">.</span><span class="n">stop</span> <span class="o">-</span> <span class="n">key</span><span class="o">.</span><span class="n">start</span><span class="p">)</span> <span class="o">//</span> <span class="n">key</span><span class="o">.</span><span class="n">step</span><span class="p">)</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="n">slice_len</span>
            <span class="k">if</span> <span class="n">key</span><span class="o">.</span><span class="n">step</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="c"># FIXME: See corresponding comment in __setitem__() for</span>
                <span class="c"># explanation.</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">start</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">key</span>
                <span class="n">removed</span> <span class="o">=</span> <span class="p">[</span><span class="n">removed</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">+</span> <span class="n">key</span> <span class="o">+</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">key</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">key</span>
            <span class="n">removed</span> <span class="o">=</span> <span class="p">[</span> <span class="n">removed</span> <span class="p">]</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">trait</span><span class="o">.</span><span class="n">minlen</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">-</span> <span class="n">delta</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">len_error</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">-</span> <span class="n">delta</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="nb">list</span><span class="o">.</span><span class="n">__delitem__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span> <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                <span class="n">TraitListEvent</span><span class="p">(</span> <span class="n">index</span><span class="p">,</span> <span class="n">removed</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version_info</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">def</span> <span class="nf">__delslice__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__delitem__</span><span class="p">(</span><span class="nb">slice</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">append</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">minlen</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">trait</span><span class="o">.</span><span class="n">maxlen</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">validate</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">item_trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">validate</span>
                <span class="nb">object</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
                <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                        <span class="n">TraitListEvent</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[</span> <span class="n">value</span> <span class="p">]</span> <span class="p">),</span>
                        <span class="n">trait</span><span class="o">.</span><span class="n">items_event</span><span class="p">()</span> <span class="p">)</span>
                <span class="k">return</span>

            <span class="k">except</span> <span class="n">TraitError</span><span class="p">,</span> <span class="n">excp</span><span class="p">:</span>
                <span class="n">excp</span><span class="o">.</span><span class="n">set_prefix</span><span class="p">(</span> <span class="s">&#39;Each element of the&#39;</span> <span class="p">)</span>
                <span class="k">raise</span> <span class="n">excp</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">len_error</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">insert</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">minlen</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">trait</span><span class="o">.</span><span class="n">maxlen</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">validate</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">item_trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">validate</span>
                <span class="nb">object</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

                <span class="nb">list</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">+</span> <span class="n">index</span> <span class="o">-</span> <span class="mi">1</span>

                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                        <span class="n">TraitListEvent</span><span class="p">(</span> <span class="n">index</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="p">[</span> <span class="n">value</span> <span class="p">]</span> <span class="p">),</span>
                        <span class="n">trait</span><span class="o">.</span><span class="n">items_event</span><span class="p">()</span> <span class="p">)</span>

                <span class="k">return</span>

            <span class="k">except</span> <span class="n">TraitError</span><span class="p">,</span> <span class="n">excp</span><span class="p">:</span>
                <span class="n">excp</span><span class="o">.</span><span class="n">set_prefix</span><span class="p">(</span> <span class="s">&#39;Each element of the&#39;</span> <span class="p">)</span>
                <span class="k">raise</span> <span class="n">excp</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">len_error</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">extend</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">xlist</span> <span class="p">):</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">xlist</span> <span class="p">)</span>

            <span class="k">return</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">len_xlist</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">xlist</span> <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="s">&quot;list.extend() argument must be iterable&quot;</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">trait</span><span class="o">.</span><span class="n">minlen</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">+</span> <span class="n">len_xlist</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">trait</span><span class="o">.</span><span class="n">maxlen</span><span class="p">):</span>
            <span class="nb">object</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span>
            <span class="n">name</span>     <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
            <span class="n">validate</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">item_trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">validate</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">xlist</span> <span class="o">=</span> <span class="p">[</span> <span class="n">validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
                              <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">xlist</span> <span class="p">]</span>

                <span class="nb">list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">xlist</span> <span class="p">)</span>

                <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">xlist</span> <span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                        <span class="n">TraitListEvent</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span> <span class="n">xlist</span> <span class="p">),</span> <span class="bp">None</span><span class="p">,</span>
                                        <span class="n">xlist</span> <span class="p">),</span> <span class="n">trait</span><span class="o">.</span><span class="n">items_event</span><span class="p">()</span> <span class="p">)</span>

                <span class="k">return</span>

            <span class="k">except</span> <span class="n">TraitError</span><span class="p">,</span> <span class="n">excp</span><span class="p">:</span>
                <span class="n">excp</span><span class="o">.</span><span class="n">set_prefix</span><span class="p">(</span> <span class="s">&#39;The elements of the&#39;</span> <span class="p">)</span>
                <span class="k">raise</span> <span class="n">excp</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">len_error</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span> <span class="n">xlist</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">minlen</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">index</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
                <span class="n">removed</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="p">[</span> <span class="n">index</span> <span class="p">]</span> <span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="nb">list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                    <span class="n">TraitListEvent</span><span class="p">(</span> <span class="n">index</span><span class="p">,</span> <span class="n">removed</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c"># Let whatever system error (ValueError) should be raised be raised.</span>
            <span class="nb">list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">len_error</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">sort</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">cmp</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">reverse</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">):</span>
        <span class="n">removed</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[:]</span>
        <span class="nb">list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">cmp</span> <span class="o">=</span> <span class="nb">cmp</span><span class="p">,</span> <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="p">,</span> <span class="n">reverse</span> <span class="o">=</span> <span class="n">reverse</span> <span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;name_items&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="ow">and</span>
            <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                <span class="n">TraitListEvent</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">removed</span><span class="p">,</span> <span class="bp">self</span><span class="p">[:]</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">reverse</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">removed</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[:]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="nb">list</span><span class="o">.</span><span class="n">reverse</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                    <span class="n">TraitListEvent</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">removed</span><span class="p">,</span> <span class="bp">self</span><span class="p">[:]</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">pop</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="o">.</span><span class="n">minlen</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">args</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">index</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">removed</span> <span class="o">=</span> <span class="p">[</span> <span class="bp">self</span><span class="p">[</span> <span class="n">index</span> <span class="p">]</span> <span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="n">result</span> <span class="o">=</span> <span class="nb">list</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">+</span> <span class="n">index</span> <span class="o">+</span> <span class="mi">1</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                    <span class="n">TraitListEvent</span><span class="p">(</span> <span class="n">index</span><span class="p">,</span> <span class="n">removed</span> <span class="p">)</span> <span class="p">)</span>

            <span class="k">return</span> <span class="n">result</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">len_error</span><span class="p">(</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">-</span> <span class="mi">1</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">rename</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span><span class="o">.</span><span class="n">_trait</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span>  <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trait</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">handler</span>

    <span class="k">def</span> <span class="nf">len_error</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">len</span> <span class="p">):</span>
        <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span> <span class="s">&quot;The &#39;</span><span class="si">%s</span><span class="s">&#39; trait of </span><span class="si">%s</span><span class="s"> instance must be </span><span class="si">%s</span><span class="s">, &quot;</span>
                  <span class="s">&quot;but you attempted to change its length to </span><span class="si">%d</span><span class="s"> element</span><span class="si">%s</span><span class="s">.&quot;</span> <span class="o">%</span> <span class="p">(</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">class_of</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span> <span class="p">),</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="o">.</span><span class="n">full_info</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">(),</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">Undefined</span> <span class="p">),</span>
                  <span class="nb">len</span><span class="p">,</span> <span class="s">&#39;s&#39;</span><span class="p">[</span> <span class="nb">len</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getstate__</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;object&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;trait&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__setstate__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">state</span> <span class="p">):</span>
        <span class="n">name</span>   <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">object</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span> <span class="s">&#39;object&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="k">if</span> <span class="nb">object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span> <span class="nb">object</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">state</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitSetEvent&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitSetEvent"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitSetEvent">[docs]</a><span class="k">class</span> <span class="nc">TraitSetEvent</span> <span class="p">(</span> <span class="nb">object</span> <span class="p">):</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Initialize the object:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">removed</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">added</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">):</span>
        <span class="k">if</span> <span class="n">removed</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">removed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removed</span> <span class="o">=</span> <span class="n">removed</span>

        <span class="k">if</span> <span class="n">added</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">added</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">added</span> <span class="o">=</span> <span class="n">added</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitSetObject&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitSetObject"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitSetObject">[docs]</a><span class="k">class</span> <span class="nc">TraitSetObject</span> <span class="p">(</span> <span class="nb">set</span> <span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trait</span>      <span class="o">=</span> <span class="n">trait</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span>     <span class="o">=</span> <span class="n">ref</span><span class="p">(</span> <span class="nb">object</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>       <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">has_items</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_items&#39;</span>

        <span class="c"># Validate and assign the initial set value:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">validate</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">item_trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">validate</span>
            <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="p">[</span> <span class="n">validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">val</span> <span class="p">)</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">value</span> <span class="p">]</span>

            <span class="nb">super</span><span class="p">(</span> <span class="n">TraitSetObject</span><span class="p">,</span> <span class="bp">self</span> <span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>

            <span class="k">return</span>

        <span class="k">except</span> <span class="n">TraitError</span><span class="p">,</span> <span class="n">excp</span><span class="p">:</span>
            <span class="n">excp</span><span class="o">.</span><span class="n">set_prefix</span><span class="p">(</span> <span class="s">&#39;Each element of the&#39;</span> <span class="p">)</span>
            <span class="k">raise</span> <span class="n">excp</span>

    <span class="k">def</span> <span class="nf">_send_trait_items_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">items_event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Send a TraitDictEvent to the owning object if there is one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">items_event</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span><span class="p">):</span>
                <span class="n">items_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="o">.</span><span class="n">items_event</span><span class="p">()</span>
            <span class="nb">object</span><span class="o">.</span><span class="n">trait_items_event</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">items_event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">memo</span> <span class="p">):</span>
        <span class="n">id_self</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">id_self</span> <span class="ow">in</span> <span class="n">memo</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">memo</span><span class="p">[</span> <span class="n">id_self</span> <span class="p">]</span>

        <span class="n">memo</span><span class="p">[</span> <span class="n">id_self</span> <span class="p">]</span> <span class="o">=</span> <span class="n">result</span> <span class="o">=</span> <span class="n">TraitSetObject</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="p">[</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">memo</span> <span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span> <span class="p">]</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">update</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">set</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">added</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">added</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">object</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span>
                <span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="o">.</span><span class="n">item_trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">validate</span>
                <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">name</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">added</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="p">[</span> <span class="n">validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="p">)</span>
                                   <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">added</span> <span class="p">]</span> <span class="p">)</span>

                <span class="nb">set</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">added</span> <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                        <span class="n">TraitSetEvent</span><span class="p">(</span> <span class="bp">None</span><span class="p">,</span> <span class="n">added</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">except</span> <span class="n">TraitError</span><span class="p">,</span> <span class="n">excp</span><span class="p">:</span>
            <span class="n">excp</span><span class="o">.</span><span class="n">set_prefix</span><span class="p">(</span> <span class="s">&#39;Each element of the&#39;</span> <span class="p">)</span>
            <span class="k">raise</span> <span class="n">excp</span>

    <span class="k">def</span> <span class="nf">intersection_update</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="n">removed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">removed</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">set</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">removed</span> <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                    <span class="n">TraitSetEvent</span><span class="p">(</span> <span class="n">removed</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">difference_update</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="n">removed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">removed</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">set</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">removed</span> <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                    <span class="n">TraitSetEvent</span><span class="p">(</span> <span class="n">removed</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">symmetric_difference_update</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">set</span><span class="o">.</span><span class="n">symmetric_difference_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="n">removed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">intersection</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
        <span class="n">added</span>   <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">removed</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">added</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="nb">object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span>
            <span class="nb">set</span><span class="o">.</span><span class="n">difference_update</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">removed</span> <span class="p">)</span>

            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">added</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="o">.</span><span class="n">item_trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">validate</span>
                <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">name</span>  <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
                    <span class="n">added</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="p">[</span> <span class="n">validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="p">)</span>
                                   <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">added</span> <span class="p">]</span> <span class="p">)</span>

                <span class="nb">set</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">added</span> <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                    <span class="n">TraitSetEvent</span><span class="p">(</span> <span class="n">removed</span><span class="p">,</span> <span class="n">added</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">add</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span><span class="p">):</span>
            <span class="k">return</span> <span class="nb">set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">object</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span>
                <span class="n">validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="o">.</span><span class="n">item_trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">validate</span>
                <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

                <span class="nb">set</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                        <span class="n">TraitSetEvent</span><span class="p">(</span> <span class="bp">None</span><span class="p">,</span> <span class="nb">set</span><span class="p">(</span> <span class="p">[</span> <span class="n">value</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">except</span> <span class="n">TraitError</span><span class="p">,</span> <span class="n">excp</span><span class="p">:</span>
                <span class="n">excp</span><span class="o">.</span><span class="n">set_prefix</span><span class="p">(</span> <span class="s">&#39;Each element of the&#39;</span> <span class="p">)</span>
                <span class="k">raise</span> <span class="n">excp</span>

    <span class="k">def</span> <span class="nf">remove</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="nb">set</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                <span class="n">TraitSetEvent</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="p">[</span> <span class="n">value</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">discard</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">pop</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">value</span> <span class="o">=</span> <span class="nb">set</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                <span class="n">TraitSetEvent</span><span class="p">(</span> <span class="nb">set</span><span class="p">(</span> <span class="p">[</span> <span class="n">value</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">clear</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">removed</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="nb">set</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                <span class="n">TraitSetEvent</span><span class="p">(</span> <span class="n">removed</span> <span class="p">)</span> <span class="p">)</span>

<div class="viewcode-block" id="TraitSetObject.copy"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitSetObject.copy">[docs]</a>    <span class="k">def</span> <span class="nf">copy</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Return a true ``set`` object with a copy of the data.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">set</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">__reduce_ex__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">protocol</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Overridden to make sure we call our custom __getstate__.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="n">copy_reg</span><span class="o">.</span><span class="n">_reconstructor</span><span class="p">,</span>
                <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="nb">set</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="p">)),</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">())</span>

    <span class="k">def</span> <span class="nf">__getstate__</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;object&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;trait&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__setstate__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">state</span> <span class="p">):</span>
        <span class="n">name</span>   <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">object</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span> <span class="s">&#39;object&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="k">if</span> <span class="nb">object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span> <span class="nb">object</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">state</span> <span class="p">)</span>


<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitDictEvent&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitDictEvent"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitDictEvent">[docs]</a><span class="k">class</span> <span class="nc">TraitDictEvent</span> <span class="p">(</span> <span class="nb">object</span> <span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">added</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">changed</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">removed</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        added : dict</span>
<span class="sd">            New keys and values.</span>
<span class="sd">        changed : dict</span>
<span class="sd">            Updated keys and their previous values.</span>
<span class="sd">        removed : dict</span>
<span class="sd">            Old keys and values that were just removed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Construct new empty dicts every time instead of using a default value</span>
        <span class="c"># in the method argument, just in case someone gets the bright idea of</span>
        <span class="c"># modifying the dict they get in-place.</span>
        <span class="k">if</span> <span class="n">added</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">added</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">added</span> <span class="o">=</span> <span class="n">added</span>

        <span class="k">if</span> <span class="n">changed</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">changed</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">changed</span> <span class="o">=</span> <span class="n">changed</span>

        <span class="k">if</span> <span class="n">removed</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">removed</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">removed</span> <span class="o">=</span> <span class="n">removed</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitDict&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitDict"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitDict">[docs]</a><span class="k">class</span> <span class="nc">TraitDict</span> <span class="p">(</span> <span class="n">TraitHandler</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Ensures that values assigned to a trait attribute are dictionaries whose</span>
<span class="sd">    keys and values are of specified types.</span>

<span class="sd">    TraitDict also makes sure that any changes to keys or values made that are</span>
<span class="sd">    made after the dictionary is assigned to the trait attribute satisfy the</span>
<span class="sd">    type constraints. TraitDict is the underlying handler for the</span>
<span class="sd">    dictionary-based predefined traits, and the Dict() trait factory.</span>

<span class="sd">    Example</span>
<span class="sd">    -------</span>

<span class="sd">    class WorkoutClass(HasTraits):</span>
<span class="sd">        member_weights = Trait({}, TraitDict(str, float))</span>


<span class="sd">    This example defines a WorkoutClass class containing a *member_weights*</span>
<span class="sd">    trait attribute whose value must be a dictionary containing keys that</span>
<span class="sd">    are strings (i.e., the members&#39; names) and whose associated values must</span>
<span class="sd">    be floats (i.e., their most recently recorded weight).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">info_trait</span>         <span class="o">=</span> <span class="bp">None</span>
    <span class="n">default_value_type</span> <span class="o">=</span> <span class="mi">6</span>
    <span class="n">_items_event</span>       <span class="o">=</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key_trait</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">value_trait</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                         <span class="n">has_items</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a TraitDict handler.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        key_trait : trait</span>
<span class="sd">            The type for the dictionary keys.</span>
<span class="sd">        value_trait : trait</span>
<span class="sd">            The type for the dictionary values.</span>
<span class="sd">        has_items : bool</span>
<span class="sd">            Flag indicating whether the dictionary contains entries.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        If *key_trait* is None or omitted, the keys in the dictionary can</span>
<span class="sd">        be of any type. Otherwise, *key_trait* must be either a trait, or a</span>
<span class="sd">        value that can be converted to a trait using the Trait() function. In</span>
<span class="sd">        this case, all dictionary keys are checked to ensure that they are of</span>
<span class="sd">        the type specified by *key_trait*.</span>

<span class="sd">        If *value_trait* is None or omitted, the values in the dictionary</span>
<span class="sd">        can be of any type. Otherwise, *value_trait* must be either a trait, or</span>
<span class="sd">        a value that can be converted to a trait using the Trait() function.</span>
<span class="sd">        In this case, all dictionary values are checked to ensure that they are</span>
<span class="sd">        of the type specified by *value_trait*.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">key_trait</span>   <span class="o">=</span> <span class="n">trait_from</span><span class="p">(</span> <span class="n">key_trait</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_trait</span> <span class="o">=</span> <span class="n">trait_from</span><span class="p">(</span> <span class="n">value_trait</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">has_items</span>   <span class="o">=</span> <span class="n">has_items</span>
        <span class="n">handler</span>          <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_trait</span><span class="o">.</span><span class="n">handler</span>
        <span class="k">if</span> <span class="n">handler</span><span class="o">.</span><span class="n">has_items</span><span class="p">:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="n">handler</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
            <span class="n">handler</span><span class="o">.</span><span class="n">has_items</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_handler</span> <span class="o">=</span> <span class="n">handler</span>

    <span class="k">def</span> <span class="nf">clone</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">TraitDict</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_trait</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_trait</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_items</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">validate</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="nb">dict</span> <span class="p">):</span>
            <span class="k">return</span> <span class="n">TraitDictObject</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">full_info</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="n">extra</span>   <span class="o">=</span> <span class="s">&#39;&#39;</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">key_trait</span><span class="o">.</span><span class="n">handler</span>
        <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">extra</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39; with keys which are </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                     <span class="n">handler</span><span class="o">.</span><span class="n">full_info</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value_handler</span>
        <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">extra</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="n">extra</span> <span class="o">=</span> <span class="s">&#39; with&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">extra</span> <span class="o">+=</span> <span class="s">&#39; and&#39;</span>
            <span class="n">extra</span> <span class="o">+=</span> <span class="p">(</span><span class="s">&#39; values which are </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
                      <span class="n">handler</span><span class="o">.</span><span class="n">full_info</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">))</span>
        <span class="k">return</span> <span class="s">&#39;a dictionary</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">extra</span>

    <span class="k">def</span> <span class="nf">get_editor</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait</span> <span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">TextEditor</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">editor</span> <span class="o">=</span> <span class="n">TextEditor</span><span class="p">(</span> <span class="n">evaluate</span> <span class="o">=</span> <span class="nb">eval</span> <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">editor</span>

    <span class="k">def</span> <span class="nf">items_event</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">if</span> <span class="n">TraitDict</span><span class="o">.</span><span class="n">_items_event</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">TraitDict</span><span class="o">.</span><span class="n">_items_event</span> <span class="o">=</span> \
                <span class="n">Event</span><span class="p">(</span> <span class="n">TraitDictEvent</span><span class="p">,</span> <span class="n">is_base</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">)</span><span class="o">.</span><span class="n">as_ctrait</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">TraitDict</span><span class="o">.</span><span class="n">_items_event</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;TraitDictObject&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="TraitDictObject"><a class="viewcode-back" href="../../traits_api_reference/trait_handlers.html#traits.trait_handlers.TraitDictObject">[docs]</a><span class="k">class</span> <span class="nc">TraitDictObject</span> <span class="p">(</span> <span class="nb">dict</span> <span class="p">):</span>

    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trait</span>      <span class="o">=</span> <span class="n">trait</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object</span>     <span class="o">=</span> <span class="n">ref</span><span class="p">(</span> <span class="nb">object</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span>       <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">has_items</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="o">=</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_items&#39;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dic</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_send_trait_items_event</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">items_event</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Send a TraitDictEvent to the owning object if there is one.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">items_event</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span><span class="p">):</span>
                <span class="n">items_event</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="o">.</span><span class="n">items_event</span><span class="p">()</span>
            <span class="nb">object</span><span class="o">.</span><span class="n">trait_items_event</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">items_event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">__deepcopy__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">memo</span> <span class="p">):</span>
        <span class="n">id_self</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">id_self</span> <span class="ow">in</span> <span class="n">memo</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">memo</span><span class="p">[</span> <span class="n">id_self</span> <span class="p">]</span>

        <span class="n">memo</span><span class="p">[</span> <span class="n">id_self</span> <span class="p">]</span> <span class="o">=</span> <span class="n">result</span> <span class="o">=</span> <span class="n">TraitDictObject</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="p">,</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span><span class="p">,</span>
                         <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="nb">dict</span><span class="p">([</span> <span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span> <span class="n">x</span><span class="p">,</span> <span class="n">memo</span> <span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">iteritems</span><span class="p">()</span> <span class="p">])</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__setitem__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">dict</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
            <span class="k">return</span>

        <span class="nb">object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">validate</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">key_trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">validate</span>
            <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">key</span> <span class="p">)</span>

        <span class="k">except</span> <span class="n">TraitError</span><span class="p">,</span> <span class="n">excp</span><span class="p">:</span>
            <span class="n">excp</span><span class="o">.</span><span class="n">set_prefix</span><span class="p">(</span> <span class="s">&#39;Each key of the&#39;</span> <span class="p">)</span>
            <span class="k">raise</span> <span class="n">excp</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">validate</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">value_handler</span><span class="o">.</span><span class="n">validate</span>
            <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                    <span class="n">added</span>   <span class="o">=</span> <span class="bp">None</span>
                    <span class="n">old</span>     <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span>
                    <span class="n">changed</span> <span class="o">=</span> <span class="p">{</span> <span class="n">key</span><span class="p">:</span> <span class="n">old</span> <span class="p">}</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">added</span>   <span class="o">=</span> <span class="p">{</span> <span class="n">key</span><span class="p">:</span> <span class="n">value</span> <span class="p">}</span>
                    <span class="n">changed</span> <span class="o">=</span> <span class="bp">None</span>

            <span class="nb">dict</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">added</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">try</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">old</span> <span class="o">==</span> <span class="n">value</span><span class="p">:</span>
                            <span class="k">return</span>
                    <span class="k">except</span><span class="p">:</span>
                        <span class="c"># Treat incomparable objects as unequal:</span>
                        <span class="k">pass</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                    <span class="n">TraitDictEvent</span><span class="p">(</span> <span class="n">added</span><span class="p">,</span> <span class="n">changed</span> <span class="p">),</span> <span class="n">trait</span><span class="o">.</span><span class="n">items_event</span><span class="p">()</span> <span class="p">)</span>

        <span class="k">except</span> <span class="n">TraitError</span><span class="p">,</span> <span class="n">excp</span><span class="p">:</span>
            <span class="n">excp</span><span class="o">.</span><span class="n">set_prefix</span><span class="p">(</span> <span class="s">&#39;Each value of the&#39;</span> <span class="p">)</span>
            <span class="k">raise</span> <span class="n">excp</span>

    <span class="k">def</span> <span class="nf">__delitem__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span> <span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">removed</span> <span class="o">=</span> <span class="p">{</span> <span class="n">key</span><span class="p">:</span> <span class="bp">self</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span> <span class="p">}</span>

        <span class="nb">dict</span><span class="o">.</span><span class="n">__delitem__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span> <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                <span class="n">TraitDictEvent</span><span class="p">(</span> <span class="n">removed</span> <span class="o">=</span> <span class="n">removed</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">clear</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">removed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

            <span class="nb">dict</span><span class="o">.</span><span class="n">clear</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                    <span class="n">TraitDictEvent</span><span class="p">(</span> <span class="n">removed</span> <span class="o">=</span> <span class="n">removed</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">update</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dic</span> <span class="p">):</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;trait&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nb">dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dic</span> <span class="p">)</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">dic</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">new_dic</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_validate_dic</span><span class="p">(</span> <span class="n">dic</span> <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">added</span>   <span class="o">=</span> <span class="p">{}</span>
                <span class="n">changed</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">new_dic</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
                        <span class="n">changed</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">added</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                <span class="nb">dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">new_dic</span> <span class="p">)</span>

                <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                    <span class="n">TraitDictEvent</span><span class="p">(</span> <span class="n">added</span> <span class="o">=</span> <span class="n">added</span><span class="p">,</span> <span class="n">changed</span> <span class="o">=</span> <span class="n">changed</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="nb">dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">new_dic</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">setdefault</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">):</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span>

        <span class="bp">self</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="n">result</span>      <span class="o">=</span> <span class="bp">self</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                <span class="n">TraitDictEvent</span><span class="p">(</span> <span class="n">added</span> <span class="o">=</span> <span class="p">{</span> <span class="n">key</span><span class="p">:</span> <span class="n">result</span> <span class="p">}</span> <span class="p">)</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">pop</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="o">=</span> <span class="n">Undefined</span> <span class="p">):</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">value</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">)</span> <span class="ow">or</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">key</span> <span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                    <span class="n">TraitDictEvent</span><span class="p">(</span> <span class="n">removed</span> <span class="o">=</span> <span class="p">{</span> <span class="n">key</span><span class="p">:</span> <span class="n">result</span> <span class="p">}</span> <span class="p">)</span> <span class="p">)</span>

            <span class="k">return</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">popitem</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">popitem</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_send_trait_items_event</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">name_items</span><span class="p">,</span>
                <span class="n">TraitDictEvent</span><span class="p">(</span> <span class="n">removed</span> <span class="o">=</span> <span class="p">{</span> <span class="n">result</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="n">result</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="p">}</span> <span class="p">)</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">rename</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span><span class="o">.</span><span class="n">_trait</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">name</span>  <span class="o">=</span> <span class="n">name</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trait</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">handler</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span> <span class="s">&quot;rename: No &#39;trait&#39; in </span><span class="si">%s</span><span class="s"> for &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span>
                          <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">(),</span> <span class="n">name</span> <span class="p">)</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">__getstate__</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">result</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;object&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="n">result</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="s">&#39;trait&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__setstate__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">state</span> <span class="p">):</span>
        <span class="n">name</span>   <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;name&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span>
        <span class="nb">object</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span> <span class="s">&#39;object&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="k">if</span> <span class="nb">object</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="n">ref</span><span class="p">(</span> <span class="nb">object</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">object</span> <span class="o">=</span> <span class="k">lambda</span><span class="p">:</span> <span class="bp">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">state</span> <span class="p">)</span>

<span class="c">#-- Private Methods ------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_validate_dic</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">dic</span> <span class="p">):</span>
        <span class="n">name</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span>
        <span class="n">new_dic</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="n">key_validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="o">.</span><span class="n">key_trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">validate</span>
        <span class="k">if</span> <span class="n">key_validate</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">key_validate</span> <span class="o">=</span> <span class="k">lambda</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="n">key</span>

        <span class="n">value_validate</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="o">.</span><span class="n">value_trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">validate</span>
        <span class="k">if</span> <span class="n">value_validate</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">value_validate</span> <span class="o">=</span> <span class="k">lambda</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">value</span>

        <span class="nb">object</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">object</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">iteritems</span><span class="p">():</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">key_validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">key</span> <span class="p">)</span>
            <span class="k">except</span> <span class="n">TraitError</span><span class="p">,</span> <span class="n">excp</span><span class="p">:</span>
                <span class="n">excp</span><span class="o">.</span><span class="n">set_prefix</span><span class="p">(</span> <span class="s">&#39;Each key of the&#39;</span> <span class="p">)</span>
                <span class="k">raise</span> <span class="n">excp</span>

            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="n">value_validate</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
            <span class="k">except</span> <span class="n">TraitError</span><span class="p">,</span> <span class="n">excp</span><span class="p">:</span>
                <span class="n">excp</span><span class="o">.</span><span class="n">set_prefix</span><span class="p">(</span> <span class="s">&#39;Each value of the&#39;</span> <span class="p">)</span>
                <span class="k">raise</span> <span class="n">excp</span>

            <span class="n">new_dic</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">new_dic</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Tell the C-based traits module about &#39;TraitListObject&#39;, &#39;TraitSetObject and</span>
<span class="c">#  &#39;TraitDictObject&#39;, and the PyProtocols &#39;adapt&#39; function:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">ctraits</span>
<span class="n">ctraits</span><span class="o">.</span><span class="n">_list_classes</span><span class="p">(</span> <span class="n">TraitListObject</span><span class="p">,</span> <span class="n">TraitSetObject</span><span class="p">,</span> <span class="n">TraitDictObject</span> <span class="p">)</span>

<span class="k">def</span> <span class="nf">_adapt_wrapper</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="c"># We need this wrapper to defer the import of &#39;adapt&#39; and avoid a circular</span>
    <span class="c"># import. The ctraits &#39;adapt&#39; callback needs to be set as soon as possible,</span>
    <span class="c"># but the adaptation mechanism relies on traits.</span>

    <span class="c"># This wrapper is called once, after which we set the ctraits callback</span>
    <span class="c"># to point directly to &#39;adapt&#39;.</span>

    <span class="kn">from</span> <span class="nn">traits.adaptation.api</span> <span class="kn">import</span> <span class="n">adapt</span>

    <span class="n">ctraits</span><span class="o">.</span><span class="n">_adapt</span><span class="p">(</span><span class="n">adapt</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">adapt</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>

<span class="n">ctraits</span><span class="o">.</span><span class="n">_adapt</span><span class="p">(</span> <span class="n">_adapt_wrapper</span> <span class="p">)</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/e-logo-rev.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../index.html">Traits 4 User Manual</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
  
    <li><a href="#">traits.trait_handlers</a></li>
  

      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2008-2011, Enthought.
      Last updated on Apr 01, 2014.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>