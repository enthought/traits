


<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>traits.has_traits &mdash; Traits 4 User Manual</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '4.2.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../../_static/et.ico"/>
    <link rel="top" title="Traits 4 User Manual" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li><a href="../../index.html">Traits 4 User Manual</a> &raquo;</li>
          <li><a href="../index.html" accesskey="U">Module code</a> &raquo;</li>
  
    <li><a href="#">traits.has_traits</a></li>
  

      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for traits.has_traits</h1><div class="highlight"><pre>
<span class="c">#------------------------------------------------------------------------------</span>
<span class="c">#</span>
<span class="c">#  Copyright (c) 2005, Enthought, Inc.</span>
<span class="c">#  All rights reserved.</span>
<span class="c">#</span>
<span class="c">#  This software is provided without warranty under the terms of the BSD</span>
<span class="c">#  license included in enthought/LICENSE.txt and may be redistributed only</span>
<span class="c">#  under the conditions described in the aforementioned license.  The license</span>
<span class="c">#  is also available online at http://www.enthought.com/licenses/BSD.txt</span>
<span class="c">#</span>
<span class="c">#  Thanks for using Enthought open source!</span>
<span class="c">#</span>
<span class="c">#  Author:        David C. Morrill</span>
<span class="c">#  Original Date: 06/21/2002</span>
<span class="c">#</span>
<span class="c">#  Rewritten as a C-based type extension: 06/21/2004</span>
<span class="c">#</span>
<span class="c">#------------------------------------------------------------------------------</span>

<span class="sd">&quot;&quot;&quot; Defines the HasTraits class, along with several useful subclasses and</span>
<span class="sd">    associated metaclasses.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Imports:</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">absolute_import</span>

<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">copy</span> <span class="kn">as</span> <span class="nn">copy_module</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">import</span> <span class="nn">re</span>

<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">FunctionType</span><span class="p">,</span> <span class="n">MethodType</span>

<span class="kn">from</span> <span class="nn">.</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">TraitsVersion</span>

<span class="kn">from</span> <span class="nn">.ctraits</span> <span class="kn">import</span> <span class="n">CHasTraits</span><span class="p">,</span> <span class="n">CTraitMethod</span><span class="p">,</span> <span class="n">_HasTraits_monitors</span>

<span class="kn">from</span> <span class="nn">.traits</span> <span class="kn">import</span> <span class="p">(</span><span class="n">CTrait</span><span class="p">,</span> <span class="n">ForwardProperty</span><span class="p">,</span> <span class="n">Property</span><span class="p">,</span> <span class="n">SpecialNames</span><span class="p">,</span> <span class="n">Trait</span><span class="p">,</span>
    <span class="n">TraitFactory</span><span class="p">,</span> <span class="n">__newobj__</span><span class="p">,</span> <span class="n">generic_trait</span><span class="p">,</span> <span class="n">trait_factory</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">.trait_types</span> <span class="kn">import</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Bool</span><span class="p">,</span> <span class="n">Disallow</span><span class="p">,</span> <span class="n">Enum</span><span class="p">,</span> <span class="n">Event</span><span class="p">,</span> <span class="n">Python</span><span class="p">,</span> <span class="n">This</span>

<span class="kn">from</span> <span class="nn">.trait_notifiers</span> <span class="kn">import</span> <span class="p">(</span><span class="n">ExtendedTraitChangeNotifyWrapper</span><span class="p">,</span>
    <span class="n">FastUITraitChangeNotifyWrapper</span><span class="p">,</span> <span class="n">NewTraitChangeNotifyWrapper</span><span class="p">,</span>
    <span class="n">StaticAnyTraitChangeNotifyWrapper</span><span class="p">,</span> <span class="n">StaticTraitChangeNotifyWrapper</span><span class="p">,</span>
    <span class="n">TraitChangeNotifyWrapper</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">.trait_handlers</span> <span class="kn">import</span> <span class="n">TraitType</span>

<span class="kn">from</span> <span class="nn">.trait_base</span> <span class="kn">import</span> <span class="p">(</span><span class="n">Missing</span><span class="p">,</span> <span class="n">SequenceTypes</span><span class="p">,</span> <span class="n">TraitsCache</span><span class="p">,</span> <span class="n">Undefined</span><span class="p">,</span>
    <span class="n">add_article</span><span class="p">,</span> <span class="nb">enumerate</span><span class="p">,</span> <span class="n">is_none</span><span class="p">,</span> <span class="n">not_event</span><span class="p">,</span> <span class="n">not_false</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">.trait_errors</span> <span class="kn">import</span> <span class="n">TraitError</span>

<span class="kn">from</span> <span class="nn">.protocols.api</span> <span class="kn">import</span> <span class="p">(</span><span class="n">InterfaceClass</span><span class="p">,</span> <span class="n">Protocol</span><span class="p">,</span> <span class="n">addClassAdvisor</span><span class="p">,</span>
    <span class="n">declareImplementation</span><span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Set CHECK_INTERFACES to one of the following values:</span>
<span class="c">#</span>
<span class="c">#  - 0: Does not check to see if classes implement their declared interfaces.</span>
<span class="c">#  - 1: Ensures that classes implement the interfaces they say they do, and</span>
<span class="c">#       logs a warning if they don&#39;t.</span>
<span class="c">#  - 2: Ensures that classes implement the interfaces they say they do, and</span>
<span class="c">#       raises an InterfaceError if they don&#39;t.</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<span class="n">CHECK_INTERFACES</span> <span class="o">=</span> <span class="mi">0</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Deferred definitions:</span>
<span class="c">#</span>
<span class="c">#  The following classes have a &#39;chicken and the egg&#39; definition problem. They</span>
<span class="c">#  require Traits to work, because they subclass Traits, but the Traits</span>
<span class="c">#  meta-class programming support uses them, so Traits can&#39;t be subclassed</span>
<span class="c">#  until they are defined.</span>
<span class="c">#</span>
<span class="c">#  Note: We need to look at whether the Category support could be used to</span>
<span class="c">#        allow us to implement this better.</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="ViewElement"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.ViewElement">[docs]</a><span class="k">class</span> <span class="nc">ViewElement</span> <span class="p">(</span> <span class="nb">object</span> <span class="p">):</span>
    <span class="k">pass</span>
</div>
<span class="k">def</span> <span class="nf">ViewElements</span> <span class="p">(</span> <span class="p">):</span>
    <span class="k">return</span> <span class="bp">None</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Constants:</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<span class="n">WrapperTypes</span>   <span class="o">=</span> <span class="p">(</span> <span class="n">StaticAnyTraitChangeNotifyWrapper</span><span class="p">,</span>
                   <span class="n">StaticTraitChangeNotifyWrapper</span> <span class="p">)</span>

<span class="n">MethodTypes</span>    <span class="o">=</span> <span class="p">(</span> <span class="n">MethodType</span><span class="p">,</span>   <span class="n">CTraitMethod</span> <span class="p">)</span>
<span class="n">FunctionTypes</span>  <span class="o">=</span> <span class="p">(</span> <span class="n">FunctionType</span><span class="p">,</span> <span class="n">CTraitMethod</span> <span class="p">)</span>

<span class="c"># Class dictionary entries used to save trait, listener and view information and</span>
<span class="c"># definitions:</span>

<span class="n">BaseTraits</span>      <span class="o">=</span> <span class="s">&#39;__base_traits__&#39;</span>
<span class="n">ClassTraits</span>     <span class="o">=</span> <span class="s">&#39;__class_traits__&#39;</span>
<span class="n">PrefixTraits</span>    <span class="o">=</span> <span class="s">&#39;__prefix_traits__&#39;</span>
<span class="n">ListenerTraits</span>  <span class="o">=</span> <span class="s">&#39;__listener_traits__&#39;</span>
<span class="n">ViewTraits</span>      <span class="o">=</span> <span class="s">&#39;__view_traits__&#39;</span>
<span class="n">SubclassTraits</span>  <span class="o">=</span> <span class="s">&#39;__subclass_traits__&#39;</span>
<span class="n">InstanceTraits</span>  <span class="o">=</span> <span class="s">&#39;__instance_traits__&#39;</span>
<span class="n">ImplementsClass</span> <span class="o">=</span> <span class="s">&#39;__implements__&#39;</span>

<span class="c"># The default Traits View name</span>
<span class="n">DefaultTraitsView</span> <span class="o">=</span> <span class="s">&#39;traits_view&#39;</span>

<span class="c"># Trait types which cannot have default values</span>
<span class="n">CantHaveDefaultValue</span> <span class="o">=</span> <span class="p">(</span> <span class="s">&#39;event&#39;</span><span class="p">,</span> <span class="s">&#39;delegate&#39;</span><span class="p">,</span> <span class="s">&#39;constant&#39;</span> <span class="p">)</span>

<span class="c"># An empty list</span>
<span class="n">EmptyList</span> <span class="o">=</span> <span class="p">[]</span>

<span class="c"># The trait types that should be copied last when doing a &#39;copy_traits&#39;:</span>
<span class="n">DeferredCopy</span> <span class="o">=</span> <span class="p">(</span> <span class="s">&#39;delegate&#39;</span><span class="p">,</span> <span class="s">&#39;property&#39;</span> <span class="p">)</span>

<span class="c"># Quick test for normal vs extended trait name</span>
<span class="n">extended_trait_pat</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span> <span class="s">r&#39;.*[ :\+\-,\.\*\?\[\]]&#39;</span> <span class="p">)</span>

<span class="c"># Generic &#39;Any&#39; trait:</span>
<span class="n">any_trait</span> <span class="o">=</span> <span class="n">Any</span><span class="p">()</span><span class="o">.</span><span class="n">as_ctrait</span><span class="p">()</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Creates a clone of a specified trait:</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="_clone_trait"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._clone_trait">[docs]</a><span class="k">def</span> <span class="nf">_clone_trait</span> <span class="p">(</span> <span class="n">clone</span><span class="p">,</span> <span class="n">metadata</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates a clone of a specified trait.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trait</span> <span class="o">=</span> <span class="n">CTrait</span><span class="p">(</span> <span class="mi">0</span> <span class="p">)</span>
    <span class="n">trait</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span> <span class="n">clone</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">clone</span><span class="o">.</span><span class="n">__dict__</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">trait</span><span class="o">.</span><span class="n">__dict__</span> <span class="o">=</span> <span class="n">clone</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">metadata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">trait</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">metadata</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">trait</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Gets the definition of a specified method (if any):</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="_get_method"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._get_method">[docs]</a><span class="k">def</span> <span class="nf">_get_method</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">method</span> <span class="p">):</span>
    <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">result</span><span class="p">,</span> <span class="n">MethodTypes</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">result</span>
    <span class="k">return</span> <span class="bp">None</span>
</div>
<div class="viewcode-block" id="_get_def"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._get_def">[docs]</a><span class="k">def</span> <span class="nf">_get_def</span> <span class="p">(</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">class_dict</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">method</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Gets the definition of a specified method (if any).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">method</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;__&#39;</span><span class="p">:</span>
        <span class="n">method</span> <span class="o">=</span> <span class="s">&#39;_</span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">method</span> <span class="p">)</span>

    <span class="n">result</span> <span class="o">=</span> <span class="n">class_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">method</span> <span class="p">)</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span>
        <span class="nb">isinstance</span><span class="p">(</span> <span class="n">result</span><span class="p">,</span> <span class="n">FunctionTypes</span> <span class="p">)</span> <span class="ow">and</span>
        <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span> <span class="n">result</span><span class="p">,</span> <span class="s">&#39;on_trait_change&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)):</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">base</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">result</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span>
            <span class="nb">isinstance</span><span class="p">(</span> <span class="n">result</span><span class="p">,</span> <span class="n">MethodTypes</span> <span class="p">)</span> <span class="ow">and</span>
            <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span> <span class="n">result</span><span class="o">.</span><span class="n">im_func</span><span class="p">,</span> <span class="s">&#39;on_trait_change&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="bp">None</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Returns whether or not a specified value is serializable:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="_is_serializable"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._is_serializable">[docs]</a><span class="k">def</span> <span class="nf">_is_serializable</span> <span class="p">(</span> <span class="n">value</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns whether or not a specified value is serializable.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="p">(</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">tuple</span> <span class="p">)</span> <span class="p">):</span>
        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_serializable</span><span class="p">(</span> <span class="n">item</span> <span class="p">):</span>
                <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="nb">dict</span> <span class="p">):</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">value</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="p">((</span><span class="ow">not</span> <span class="n">_is_serializable</span><span class="p">(</span> <span class="n">name</span> <span class="p">))</span> <span class="ow">or</span>
                <span class="p">(</span><span class="ow">not</span> <span class="n">_is_serializable</span><span class="p">(</span> <span class="n">item</span> <span class="p">))):</span>
                <span class="k">return</span> <span class="bp">False</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="k">return</span> <span class="p">((</span><span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="n">HasTraits</span> <span class="p">))</span> <span class="ow">or</span>
            <span class="n">value</span><span class="o">.</span><span class="n">has_traits_interface</span><span class="p">(</span> <span class="n">ISerializable</span> <span class="p">))</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Returns a dictionary of potential &#39;Instance&#39; or &#39;List(Instance)&#39; handlers:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="_get_instance_handlers"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._get_instance_handlers">[docs]</a><span class="k">def</span> <span class="nf">_get_instance_handlers</span> <span class="p">(</span> <span class="n">class_dict</span><span class="p">,</span> <span class="n">bases</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns a dictionary of potential &#39;Instance&#39; or &#39;List(Instance)&#39;</span>
<span class="sd">        handlers.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Create the results dictionary:</span>
    <span class="n">instance_traits</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="c"># Merge all of the base class information into the result:</span>
    <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">base_arg_lists</span> <span class="ow">in</span> <span class="n">base</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">InstanceTraits</span> <span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">arg_lists</span> <span class="o">=</span> <span class="n">instance_traits</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">arg_lists</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">instance_traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">base_arg_lists</span><span class="p">[:]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">arg_list</span> <span class="ow">in</span> <span class="n">base_arg_lists</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">arg_list</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arg_lists</span><span class="p">:</span>
                        <span class="n">arg_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">arg_list</span> <span class="p">)</span>

    <span class="c"># Merge in the information from the class dictionary:</span>
    <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">class_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="n">FunctionTypes</span> <span class="p">):</span>
            <span class="n">n</span>   <span class="o">=</span> <span class="mi">13</span>
            <span class="n">col</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="s">&#39;_changed_for_&#39;</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
                 <span class="n">n</span>   <span class="o">=</span> <span class="mi">11</span>
                 <span class="n">col</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="s">&#39;_fired_for_&#39;</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">col</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span> <span class="n">col</span> <span class="o">+</span> <span class="n">n</span><span class="p">:</span> <span class="p">]</span>
                <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                    <span class="n">arg_list</span>  <span class="o">=</span> <span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">name</span><span class="p">[</span> <span class="mi">1</span><span class="p">:</span> <span class="n">col</span> <span class="p">]</span> <span class="p">)</span>
                    <span class="n">arg_lists</span> <span class="o">=</span> <span class="n">instance_traits</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="n">key</span><span class="p">,</span> <span class="p">[]</span> <span class="p">)</span>
                    <span class="k">if</span> <span class="n">arg_list</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">arg_lists</span><span class="p">:</span>
                        <span class="n">arg_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">arg_list</span> <span class="p">)</span>

    <span class="c"># Return the dictionary of possible arg_lists:</span>
    <span class="k">return</span> <span class="n">instance_traits</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Returns the correct &#39;delegate&#39; listener pattern for a specified name and</span>
<span class="c">#  delegate trait:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="get_delegate_pattern"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.get_delegate_pattern">[docs]</a><span class="k">def</span> <span class="nf">get_delegate_pattern</span> <span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the correct &#39;delegate&#39; listener pattern for a specified name and</span>
<span class="sd">        delegate trait.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prefix</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">_prefix</span>
    <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">name</span>
    <span class="k">elif</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">prefix</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">prefix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;*&#39;</span><span class="p">):</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">name</span>

    <span class="k">return</span> <span class="s">&#39; </span><span class="si">%s</span><span class="s">:</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">trait</span><span class="o">.</span><span class="n">_delegate</span><span class="p">,</span> <span class="n">prefix</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;_SimpleTest&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="_SimpleTest"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._SimpleTest">[docs]</a><span class="k">class</span> <span class="nc">_SimpleTest</span><span class="p">:</span>
    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
    <span class="k">def</span> <span class="nf">__call__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">test</span>  <span class="p">):</span> <span class="k">return</span> <span class="n">test</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Checks if a function can be converted to a &#39;trait method&#39; (and converts it if</span>
<span class="c">#  possible):</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="_check_method"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._check_method">[docs]</a><span class="k">def</span> <span class="nf">_check_method</span> <span class="p">(</span> <span class="n">class_dict</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">func</span> <span class="p">):</span>
    <span class="n">method_name</span>  <span class="o">=</span> <span class="n">name</span>
    <span class="n">return_trait</span> <span class="o">=</span> <span class="n">Any</span>

    <span class="n">col</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="s">&#39;__&#39;</span> <span class="p">)</span>
    <span class="k">if</span> <span class="n">col</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">type_name</span>    <span class="o">=</span> <span class="n">name</span><span class="p">[</span> <span class="p">:</span> <span class="n">col</span> <span class="p">]</span>
        <span class="n">method_name</span>  <span class="o">=</span> <span class="n">name</span><span class="p">[</span> <span class="n">col</span> <span class="o">+</span> <span class="mi">2</span><span class="p">:</span> <span class="p">]</span>

        <span class="n">return_trait</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">type_name</span> <span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">return_trait</span><span class="p">,</span> <span class="n">CTrait</span> <span class="p">):</span>
            <span class="n">return_trait</span> <span class="o">=</span> <span class="n">SpecialNames</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">type_name</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">return_trait</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">return_trait</span> <span class="o">=</span> <span class="n">Any</span>
                <span class="n">method_name</span>  <span class="o">=</span> <span class="n">name</span>

    <span class="n">has_traits</span> <span class="o">=</span> <span class="p">(</span><span class="n">method_name</span> <span class="o">!=</span> <span class="n">name</span><span class="p">)</span>
    <span class="n">arg_traits</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="n">defaults</span> <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">func_defaults</span>
    <span class="k">if</span> <span class="n">defaults</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">defaults</span><span class="p">:</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="n">_check_trait</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">trait</span><span class="p">,</span> <span class="n">CTrait</span> <span class="p">):</span>
                <span class="n">has_traits</span> <span class="o">=</span> <span class="bp">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">trait</span> <span class="o">=</span> <span class="n">Any</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span><span class="o">.</span><span class="n">as_ctrait</span><span class="p">()</span>
            <span class="n">arg_traits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span>

    <span class="k">if</span> <span class="n">has_traits</span><span class="p">:</span>
        <span class="n">code</span>       <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">func_code</span>
        <span class="n">var_names</span>  <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">co_varnames</span>
        <span class="n">arg_traits</span> <span class="o">=</span> <span class="p">(([</span> <span class="n">Missing</span> <span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">code</span><span class="o">.</span><span class="n">co_argcount</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span> <span class="n">arg_traits</span> <span class="p">)))</span> <span class="o">+</span>
                      <span class="n">arg_traits</span><span class="p">)</span>
        <span class="n">traits</span>     <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">arg_traits</span> <span class="p">):</span>
            <span class="n">traits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">var_names</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="p">)</span>
            <span class="n">traits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span>
        <span class="k">del</span> <span class="n">class_dict</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
        <span class="n">class_dict</span><span class="p">[</span> <span class="n">method_name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">CTraitMethod</span><span class="p">(</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span>
                                          <span class="nb">tuple</span><span class="p">(</span> <span class="p">[</span> <span class="n">return_trait</span> <span class="p">]</span> <span class="o">+</span> <span class="n">traits</span> <span class="p">)</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Returns either the original value or a valid CTrait if the value can be</span>
<span class="c">#  converted to a CTrait:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="_check_trait"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._check_trait">[docs]</a><span class="k">def</span> <span class="nf">_check_trait</span> <span class="p">(</span> <span class="n">trait</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns either the original value or a valid CTrait if the value can be</span>
<span class="sd">        converted to a CTrait.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">trait</span><span class="p">,</span> <span class="n">CTrait</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">trait</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">trait</span><span class="p">,</span> <span class="n">TraitFactory</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">trait_factory</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">trait</span><span class="p">,</span> <span class="nb">type</span> <span class="p">)</span> <span class="ow">and</span> <span class="nb">issubclass</span><span class="p">(</span> <span class="n">trait</span><span class="p">,</span> <span class="n">TraitType</span> <span class="p">):</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="n">trait</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">trait</span><span class="p">,</span> <span class="n">TraitType</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">trait</span><span class="o">.</span><span class="n">as_ctrait</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">trait</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Returns the trait corresponding to a specified value:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="_trait_for"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._trait_for">[docs]</a><span class="k">def</span> <span class="nf">_trait_for</span> <span class="p">(</span> <span class="n">trait</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the trait corresponding to a specified value.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">trait</span> <span class="o">=</span> <span class="n">_check_trait</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">trait</span><span class="p">,</span> <span class="n">CTrait</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">trait</span>

    <span class="k">return</span> <span class="n">Trait</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Returns the &#39;mapped trait&#39; definition for a mapped trait:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="_mapped_trait_for"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._mapped_trait_for">[docs]</a><span class="k">def</span> <span class="nf">_mapped_trait_for</span> <span class="p">(</span> <span class="n">trait</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the &#39;mapped trait&#39; definition for a mapped trait.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">default_value</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">default_value</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">default_value</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">handler</span><span class="o">.</span><span class="n">mapped_value</span><span class="p">(</span> <span class="n">default_value</span> <span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">pass</span>

    <span class="k">return</span> <span class="n">Any</span><span class="p">(</span> <span class="n">default_value</span><span class="p">,</span> <span class="n">is_base</span>  <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">transient</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                               <span class="n">editable</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">)</span><span class="o">.</span><span class="n">as_ctrait</span><span class="p">()</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Adds a list of handlers to a specified notifiers list:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="_add_notifiers"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._add_notifiers">[docs]</a><span class="k">def</span> <span class="nf">_add_notifiers</span> <span class="p">(</span> <span class="n">notifiers</span><span class="p">,</span> <span class="n">handlers</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adds a list of handlers to a specified notifiers list.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">handler</span> <span class="ow">in</span> <span class="n">handlers</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">handler</span><span class="p">,</span> <span class="n">WrapperTypes</span> <span class="p">):</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="n">StaticTraitChangeNotifyWrapper</span><span class="p">(</span> <span class="n">handler</span> <span class="p">)</span>
        <span class="n">notifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">handler</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Adds any specified event handlers defined for a trait by a class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="_add_event_handlers"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._add_event_handlers">[docs]</a><span class="k">def</span> <span class="nf">_add_event_handlers</span> <span class="p">(</span> <span class="n">trait</span><span class="p">,</span> <span class="n">cls</span><span class="p">,</span> <span class="n">handlers</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Adds any specified event handlers defined for a trait by a class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">events</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">event</span>
    <span class="k">if</span> <span class="n">events</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
            <span class="n">events</span> <span class="o">=</span> <span class="p">[</span> <span class="n">events</span> <span class="p">]</span>

        <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
            <span class="n">handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">_get_method</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="s">&#39;_</span><span class="si">%s</span><span class="s">_changed&#39;</span> <span class="o">%</span> <span class="n">event</span> <span class="p">)</span> <span class="p">)</span>
            <span class="n">handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">_get_method</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="s">&#39;_</span><span class="si">%s</span><span class="s">_fired&#39;</span>   <span class="o">%</span> <span class="n">event</span> <span class="p">)</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Returns the method associated with a particular class property getter/setter:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="_property_method"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._property_method">[docs]</a><span class="k">def</span> <span class="nf">_property_method</span> <span class="p">(</span> <span class="n">class_dict</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Returns the method associated with a particular class property</span>
<span class="sd">    getter/setter.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">class_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Defines a factory function for creating type checked methods:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="trait_method"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.trait_method">[docs]</a><span class="k">def</span> <span class="nf">trait_method</span> <span class="p">(</span> <span class="n">func</span><span class="p">,</span> <span class="n">return_type</span><span class="p">,</span> <span class="o">**</span><span class="n">arg_types</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Factory function for creating type-checked methods.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    func : function</span>
<span class="sd">        The method to be type-checked.</span>
<span class="sd">    return_type :</span>
<span class="sd">        The return type of the method, a trait or value that can be converted</span>
<span class="sd">        to a trait using Trait().</span>
<span class="sd">    **arg_types :</span>
<span class="sd">        Zero or more &#39;*keyword* = *trait*&#39; pairs, the argument names and types</span>
<span class="sd">        of parameters of the type-checked method. The *trait* portion of each</span>
<span class="sd">        pair must be a trait or a value that can be converted to a trait using</span>
<span class="sd">        Trait().</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Make the sure the first argument is a function:</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span> <span class="n">func</span> <span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">FunctionType</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span> <span class="n">return_type</span> <span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">FunctionType</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="s">&quot;First or second argument must be a function.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">func</span><span class="p">,</span> <span class="n">return_type</span> <span class="o">=</span> <span class="n">return_type</span><span class="p">,</span> <span class="n">func</span>

    <span class="c"># Make sure the return type is a trait (if not, coerce it to one):</span>
    <span class="n">return_type</span> <span class="o">=</span> <span class="n">_trait_for</span><span class="p">(</span> <span class="n">return_type</span> <span class="p">)</span>

    <span class="c"># Make up the list of arguments defined by the function we are wrapping:</span>
    <span class="n">code</span>       <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">func_code</span>
    <span class="n">arg_count</span>  <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">co_argcount</span>
    <span class="n">var_names</span>  <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">co_varnames</span><span class="p">[</span> <span class="p">:</span> <span class="n">arg_count</span> <span class="p">]</span>
    <span class="n">defaults</span>   <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">func_defaults</span> <span class="ow">or</span> <span class="p">()</span>
    <span class="n">defaults</span>   <span class="o">=</span> <span class="p">(</span> <span class="n">Missing</span><span class="p">,</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">arg_count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span> <span class="n">defaults</span> <span class="p">))</span> <span class="o">+</span> <span class="n">defaults</span>
    <span class="n">arg_traits</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">var_names</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="n">arg_types</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
            <span class="k">del</span> <span class="n">arg_types</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="c"># fixme: Should this be a hard error (i.e. missing parameter type?)</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="n">Any</span>

        <span class="n">arg_traits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
        <span class="n">arg_traits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Trait</span><span class="p">(</span> <span class="n">defaults</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_trait_for</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

    <span class="c"># Make sure there are no unaccounted for type parameters left over:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">arg_types</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">arg_types</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">names</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;The &#39;</span><span class="si">%s</span><span class="s">&#39; keyword defines a type for an &quot;</span>
                               <span class="s">&quot;argument which &#39;</span><span class="si">%s</span><span class="s">&#39; does not have.&quot;</span> <span class="o">%</span> <span class="p">(</span>
                               <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">func</span><span class="o">.</span><span class="n">func_name</span> <span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">names</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;The </span><span class="si">%s</span><span class="s"> keywords define types for arguments &quot;</span>
                               <span class="s">&quot;which &#39;</span><span class="si">%s</span><span class="s">&#39; does not have.&quot;</span> <span class="o">%</span> <span class="p">(</span>
                               <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span> <span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span> <span class="p">]</span> <span class="p">),</span>
                               <span class="n">func</span><span class="o">.</span><span class="n">func_name</span> <span class="p">))</span>

    <span class="c"># Otherwise, return a method wrapper for the function:</span>
    <span class="k">return</span> <span class="n">CTraitMethod</span><span class="p">(</span> <span class="n">func</span><span class="o">.</span><span class="n">func_name</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span>
                                         <span class="nb">tuple</span><span class="p">(</span> <span class="p">[</span> <span class="n">return_type</span> <span class="p">]</span> <span class="o">+</span> <span class="n">arg_traits</span> <span class="p">)</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Defines a method &#39;decorator&#39; for adding type checking to methods:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="_add_assignment_advisor"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._add_assignment_advisor">[docs]</a><span class="k">def</span> <span class="nf">_add_assignment_advisor</span> <span class="p">(</span> <span class="n">callback</span><span class="p">,</span> <span class="n">depth</span> <span class="o">=</span> <span class="mi">2</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Defines a method &#39;decorator&#39; for adding type checking to methods.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">frame</span>      <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">_getframe</span><span class="p">(</span> <span class="n">depth</span> <span class="p">)</span>
    <span class="n">old_trace</span>  <span class="o">=</span> <span class="p">[</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_trace</span> <span class="p">]</span>
    <span class="n">old_locals</span> <span class="o">=</span> <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">tracer</span> <span class="p">(</span> <span class="n">frm</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span> <span class="p">):</span>

        <span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s">&#39;call&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">old_trace</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">old_trace</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span> <span class="n">frm</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="bp">None</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">frm</span> <span class="ow">is</span> <span class="n">frame</span> <span class="ow">and</span> <span class="n">event</span> <span class="o">!=</span> <span class="s">&#39;exception&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">frm</span><span class="o">.</span><span class="n">f_locals</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">old_locals</span><span class="p">:</span>
                        <span class="k">del</span> <span class="n">frm</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="k">break</span>
                    <span class="k">elif</span> <span class="n">old_locals</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">v</span><span class="p">:</span>
                        <span class="n">frm</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_locals</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                        <span class="k">break</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">tracer</span>

                <span class="n">callback</span><span class="p">(</span> <span class="n">frm</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="p">)</span>

        <span class="k">finally</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">old_trace</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">old_trace</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">old_trace</span><span class="p">[</span><span class="mi">0</span><span class="p">](</span> <span class="n">frm</span><span class="p">,</span> <span class="n">event</span><span class="p">,</span> <span class="n">arg</span> <span class="p">)</span>

        <span class="n">frm</span><span class="o">.</span><span class="n">f_trace</span> <span class="o">=</span> <span class="n">old_trace</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span> <span class="n">old_trace</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">old_trace</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="n">frame</span><span class="o">.</span><span class="n">f_trace</span> <span class="o">=</span> <span class="n">tracer</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">settrace</span><span class="p">(</span> <span class="n">tracer</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="method"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.method">[docs]</a><span class="k">def</span> <span class="nf">method</span> <span class="p">(</span> <span class="n">return_type</span> <span class="o">=</span> <span class="n">Any</span><span class="p">,</span> <span class="o">*</span><span class="n">arg_types</span><span class="p">,</span> <span class="o">**</span><span class="n">kwarg_types</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Declares that the method defined immediately following a call to this</span>
<span class="sd">    function is type-checked.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    return_type : type</span>
<span class="sd">        The type returned by the type-checked method. Must be either a trait</span>
<span class="sd">        or a value that can be converted to a trait using the Trait()</span>
<span class="sd">        function. The default of Any means that the return value is not</span>
<span class="sd">        type-checked.</span>
<span class="sd">    *arg_types :</span>
<span class="sd">        Zero or more types of positional parameters of the type-checked method.</span>
<span class="sd">        Each value must either a trait or a value that can be converted to a</span>
<span class="sd">        trait using the Trait() function.</span>
<span class="sd">    **kwarg_types :</span>
<span class="sd">        Zero or more *keyword* = *type* pairs, the type names and types of</span>
<span class="sd">        keyword parameters of the type-checked method. The *type* portion of</span>
<span class="sd">        the parameter must be either a trait or a value that can be converted</span>
<span class="sd">        to a trait using the Trait() function.</span>

<span class="sd">    Description</span>
<span class="sd">    -----------</span>
<span class="sd">    Whenever the type-checked method is called, the method() function ensures</span>
<span class="sd">    that each parameter passed to the method of the type specified by</span>
<span class="sd">    *arg_types* and *kwarg_types*, and that the return value is of the type</span>
<span class="sd">    specified by *return_type*. It is an error to specify both positional and</span>
<span class="sd">    keyword definitions for the same method parameter. If a parameter defined by</span>
<span class="sd">    the type-checked method is not referenced in the method() call, the</span>
<span class="sd">    parameter is not type-checked (i.e., its type is implicitly set to Any).</span>
<span class="sd">    If the call to method() signature contains an *arg_types* or *kwarg_types*</span>
<span class="sd">    parameter that does not correspond to a parameter in the type-checked method</span>
<span class="sd">    definition, a TraitError exception is raised.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># The following is a &#39;hack&#39; to get around what seems to be a Python bug</span>
    <span class="c"># that does not pass &#39;return_type&#39; and &#39;arg_types&#39; through to the scope of</span>
    <span class="c"># &#39;callback&#39; below:</span>
    <span class="n">kwarg_types</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="n">return_type</span><span class="p">,</span> <span class="n">arg_types</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">callback</span> <span class="p">(</span> <span class="n">frame</span><span class="p">,</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">func</span> <span class="p">):</span>

        <span class="c"># This undoes the work of the &#39;hack&#39; described above:</span>
        <span class="n">return_type</span><span class="p">,</span> <span class="n">arg_types</span> <span class="o">=</span> <span class="n">kwarg_types</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span>
        <span class="k">del</span> <span class="n">kwarg_types</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span>

        <span class="c"># Add a &#39;fake&#39; positional argument as a place holder for &#39;self&#39;:</span>
        <span class="n">arg_types</span> <span class="o">=</span> <span class="p">(</span> <span class="n">Any</span><span class="p">,</span> <span class="p">)</span> <span class="o">+</span> <span class="n">arg_types</span>

        <span class="c"># Make the sure the first argument is a function:</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span> <span class="n">func</span> <span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">FunctionType</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;&#39;method&#39; must immediately precede a method &quot;</span>
                              <span class="s">&quot;definition.&quot;</span><span class="p">)</span>

        <span class="c"># Make sure the return type is a trait (if not, coerce it to one):</span>
        <span class="n">return_type</span> <span class="o">=</span> <span class="n">_trait_for</span><span class="p">(</span> <span class="n">return_type</span> <span class="p">)</span>

        <span class="c"># Make up the list of arguments defined by the function we are wrapping:</span>
        <span class="n">code</span>       <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">func_code</span>
        <span class="n">func_name</span>  <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">func_name</span>
        <span class="n">arg_count</span>  <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">co_argcount</span>
        <span class="n">var_names</span>  <span class="o">=</span> <span class="n">code</span><span class="o">.</span><span class="n">co_varnames</span><span class="p">[</span> <span class="p">:</span> <span class="n">arg_count</span> <span class="p">]</span>
        <span class="n">defaults</span>   <span class="o">=</span> <span class="n">func</span><span class="o">.</span><span class="n">func_defaults</span> <span class="ow">or</span> <span class="p">()</span>
        <span class="n">defaults</span>   <span class="o">=</span> <span class="p">(</span> <span class="n">Missing</span><span class="p">,</span> <span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">arg_count</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span> <span class="n">defaults</span> <span class="p">))</span> <span class="o">+</span> <span class="n">defaults</span>
        <span class="n">arg_traits</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">n</span>          <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">arg_types</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span> <span class="n">var_names</span> <span class="p">):</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;Too many positional argument types specified &quot;</span>
                               <span class="s">&quot;in the method signature for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">func_name</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">var_names</span> <span class="p">):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">kwarg_types</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;The &#39;</span><span class="si">%s</span><span class="s">&#39; argument is defined by both &quot;</span>
                                       <span class="s">&quot;a positional and keyword argument in &quot;</span>
                                       <span class="s">&quot;the method signature for </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                                       <span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">func_name</span> <span class="p">)</span> <span class="p">)</span>
                <span class="n">trait</span> <span class="o">=</span> <span class="n">arg_types</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">trait</span> <span class="o">=</span> <span class="n">kwarg_types</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
                    <span class="k">del</span> <span class="n">kwarg_types</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="c"># fixme: Should this be an error (missing parameter type?)</span>
                    <span class="n">trait</span> <span class="o">=</span> <span class="n">Any</span>
            <span class="n">arg_traits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
            <span class="n">arg_traits</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">Trait</span><span class="p">(</span> <span class="n">defaults</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">_trait_for</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c"># Make sure there are no unaccounted for type parameters left over:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">kwarg_types</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">kwarg_types</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">names</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;The &#39;</span><span class="si">%s</span><span class="s">&#39; method signature keyword defines &quot;</span>
                                   <span class="s">&quot;a type for an argument which &#39;</span><span class="si">%s</span><span class="s">&#39; does not &quot;</span>
                                   <span class="s">&quot;have.&quot;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">func_name</span> <span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">names</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
                <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;The </span><span class="si">%s</span><span class="s"> method signature keywords define &quot;</span>
                          <span class="s">&quot;types for arguments which &#39;</span><span class="si">%s</span><span class="s">&#39; does not have.&quot;</span> <span class="o">%</span> <span class="p">(</span>
                          <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span> <span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">name</span> <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span> <span class="p">]</span> <span class="p">),</span>
                          <span class="n">func_name</span> <span class="p">))</span>

        <span class="c"># Otherwise, return a method wrapper for the function:</span>
        <span class="n">frame</span><span class="o">.</span><span class="n">f_locals</span><span class="p">[</span> <span class="n">method_name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">CTraitMethod</span><span class="p">(</span> <span class="n">func_name</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span>
                                         <span class="nb">tuple</span><span class="p">(</span> <span class="p">[</span> <span class="n">return_type</span> <span class="p">]</span> <span class="o">+</span> <span class="n">arg_traits</span> <span class="p">)</span> <span class="p">)</span>

    <span class="n">_add_assignment_advisor</span><span class="p">(</span> <span class="n">callback</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;__NoInterface__&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="__NoInterface__"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.__NoInterface__">[docs]</a><span class="k">class</span> <span class="nc">__NoInterface__</span> <span class="p">(</span> <span class="nb">object</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; An uninstantiated class used to tag trait subclasses which do not</span>
<span class="sd">        implement any interfaces.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;MetaHasTraits&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<span class="c"># This really should be &#39;HasTraits&#39;, but it&#39;s not defined yet:</span></div>
<span class="n">_HasTraits</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="MetaHasTraits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.MetaHasTraits">[docs]</a><span class="k">class</span> <span class="nc">MetaHasTraits</span> <span class="p">(</span> <span class="nb">type</span> <span class="p">):</span>
    <span class="c">### JMS: Need a docstring here.</span>
    <span class="c"># All registered class creation listeners.</span>
    <span class="c">#</span>
    <span class="c"># { Str class_name : Callable listener }</span>
    <span class="n">_listeners</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">__new__</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">class_dict</span> <span class="p">):</span>
        <span class="n">mhto</span> <span class="o">=</span> <span class="n">MetaHasTraitsObject</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">class_dict</span><span class="p">,</span> <span class="bp">False</span> <span class="p">)</span>

        <span class="c"># Finish building the class using the updated class dictionary:</span>
        <span class="n">klass</span> <span class="o">=</span> <span class="nb">type</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">class_dict</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">_HasTraits</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span><span class="p">:</span>
                <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span> <span class="n">base</span><span class="p">,</span> <span class="n">_HasTraits</span> <span class="p">):</span>
                    <span class="nb">getattr</span><span class="p">(</span> <span class="n">base</span><span class="p">,</span> <span class="n">SubclassTraits</span> <span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">klass</span> <span class="p">)</span>
        <span class="nb">setattr</span><span class="p">(</span> <span class="n">klass</span><span class="p">,</span> <span class="n">SubclassTraits</span><span class="p">,</span> <span class="p">[]</span> <span class="p">)</span>

        <span class="c"># Fix up all self referential traits to refer to this class:</span>
        <span class="k">for</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">mhto</span><span class="o">.</span><span class="n">self_referential</span><span class="p">:</span>
            <span class="n">trait</span><span class="o">.</span><span class="n">set_validate</span><span class="p">(</span> <span class="p">(</span> <span class="mi">11</span><span class="p">,</span> <span class="n">klass</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c"># Call all listeners that registered for this specific class:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">.</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">klass</span><span class="o">.</span><span class="n">__module__</span><span class="p">,</span> <span class="n">klass</span><span class="o">.</span><span class="n">__name__</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">listener</span> <span class="ow">in</span> <span class="n">MetaHasTraits</span><span class="o">.</span><span class="n">_listeners</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="p">[]</span> <span class="p">):</span>
            <span class="n">listener</span><span class="p">(</span> <span class="n">klass</span> <span class="p">)</span>

        <span class="c"># Call all listeners that registered for ANY class:</span>
        <span class="k">for</span> <span class="n">listener</span> <span class="ow">in</span> <span class="n">MetaHasTraits</span><span class="o">.</span><span class="n">_listeners</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="p">[]</span> <span class="p">):</span>
            <span class="n">listener</span><span class="p">(</span> <span class="n">klass</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">klass</span>

<div class="viewcode-block" id="MetaHasTraits.add_listener"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.MetaHasTraits.add_listener">[docs]</a>    <span class="k">def</span> <span class="nf">add_listener</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">listener</span><span class="p">,</span> <span class="n">class_name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds a class creation listener.</span>

<span class="sd">        If the class name is the empty string then the listener will be called</span>
<span class="sd">        when *any* class is created.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">MetaHasTraits</span><span class="o">.</span><span class="n">_listeners</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="n">class_name</span><span class="p">,</span> <span class="p">[]</span> <span class="p">)</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">listener</span> <span class="p">)</span>
</div>
    <span class="n">add_listener</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">add_listener</span> <span class="p">)</span>

<div class="viewcode-block" id="MetaHasTraits.remove_listener"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.MetaHasTraits.remove_listener">[docs]</a>    <span class="k">def</span> <span class="nf">remove_listener</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">listener</span><span class="p">,</span> <span class="n">class_name</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Removes a class creation listener.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">MetaHasTraits</span><span class="o">.</span><span class="n">_listeners</span><span class="p">[</span> <span class="n">class_name</span> <span class="p">]</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span> <span class="n">listener</span> <span class="p">)</span>
</div>
    <span class="n">remove_listener</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">remove_listener</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;MetaInterface&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="MetaInterface"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.MetaInterface">[docs]</a><span class="k">class</span> <span class="nc">MetaInterface</span> <span class="p">(</span> <span class="n">MetaHasTraits</span><span class="p">,</span> <span class="n">InterfaceClass</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Meta class for interfaces.</span>

<span class="sd">        This combines trait and PyProtocols functionality.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MetaInterface.__init__"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.MetaInterface.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">__bases__</span><span class="p">,</span> <span class="n">__dict__</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method is copied over from PyProtocols &#39;AbstractBaseMets&#39;.</span>

<span class="sd">            It is needed here to make sure that we don&#39;t add any implied</span>
<span class="sd">            protocols for *our* &#39;Interface&#39; class (since PyProtocols doesn&#39;t</span>
<span class="sd">            know about it.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="nb">type</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">__name__</span><span class="p">,</span> <span class="n">__bases__</span><span class="p">,</span> <span class="n">__dict__</span> <span class="p">)</span>
        <span class="n">Protocol</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">__bases__</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">base</span><span class="p">,</span> <span class="n">InterfaceClass</span> <span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">base</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Interface</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">addImpliedProtocol</span><span class="p">(</span> <span class="n">base</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="MetaInterface.__call__"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.MetaInterface.__call__">[docs]</a>    <span class="k">def</span> <span class="nf">__call__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This method is copied over from the PyProtocols &#39;InterfaceClass&#39;</span>
<span class="sd">            (and cleaned up a little). It is needed here because:</span>

<span class="sd">            a) the &#39;InterfaceClass&#39; is no longer the first class in the</span>
<span class="sd">               hierarchy.</span>
<span class="sd">            b) the reference to &#39;Interface&#39; now needs to reference *our*</span>
<span class="sd">               Interface.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">__init__</span> <span class="ow">is</span> <span class="n">Interface</span><span class="o">.</span><span class="n">__init__</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">Protocol</span><span class="o">.</span><span class="n">__call__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span> <span class="p">)</span>

        <span class="k">return</span> <span class="nb">type</span><span class="o">.</span><span class="n">__call__</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="MetaInterface.getBases"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.MetaInterface.getBases">[docs]</a>    <span class="k">def</span> <span class="nf">getBases</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Overridden to make sure we don&#39;t return our &#39;Interface&#39; class. &quot;&quot;&quot;</span>

        <span class="k">return</span> <span class="p">[</span> <span class="n">base</span> <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__bases__</span>
                 <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">base</span><span class="p">,</span> <span class="n">InterfaceClass</span> <span class="p">)</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="n">base</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Interface</span><span class="p">)</span> <span class="p">]</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;MetaHasTraitsObject&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div></div>
<div class="viewcode-block" id="MetaHasTraitsObject"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.MetaHasTraitsObject">[docs]</a><span class="k">class</span> <span class="nc">MetaHasTraitsObject</span> <span class="p">(</span> <span class="nb">object</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Performs all of the meta-class processing needed to convert any</span>
<span class="sd">        subclass of HasTraits into a well-formed traits class.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<div class="viewcode-block" id="MetaHasTraitsObject.__init__"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.MetaHasTraitsObject.__init__">[docs]</a>    <span class="k">def</span> <span class="nf">__init__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">cls</span><span class="p">,</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">class_dict</span><span class="p">,</span> <span class="n">is_category</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Processes all of the traits related data in the class dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Create the various class dictionaries, lists and objects needed to</span>
        <span class="c"># hold trait and view information and definitions:</span>
        <span class="n">base_traits</span>      <span class="o">=</span> <span class="p">{}</span>
        <span class="n">class_traits</span>     <span class="o">=</span> <span class="p">{}</span>
        <span class="n">prefix_traits</span>    <span class="o">=</span> <span class="p">{}</span>
        <span class="n">listeners</span>        <span class="o">=</span> <span class="p">{}</span>
        <span class="n">prefix_list</span>      <span class="o">=</span> <span class="p">[]</span>
        <span class="n">override_bases</span>   <span class="o">=</span> <span class="n">bases</span>
        <span class="n">view_elements</span>    <span class="o">=</span> <span class="n">ViewElements</span><span class="p">()</span>
        <span class="n">self_referential</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c"># Create a list of just those base classes that derive from HasTraits:</span>
        <span class="n">hastraits_bases</span> <span class="o">=</span> <span class="p">[</span> <span class="n">base</span> <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">bases</span>
                            <span class="k">if</span> <span class="n">base</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">ClassTraits</span> <span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="p">]</span>

        <span class="c"># Create a list of all inherited trait dictionaries:</span>
        <span class="n">inherited_class_traits</span> <span class="o">=</span> <span class="p">[</span> <span class="n">base</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">ClassTraits</span> <span class="p">)</span>
                                   <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">hastraits_bases</span> <span class="p">]</span>

        <span class="c"># Move all trait definitions from the class dictionary to the</span>
        <span class="c"># appropriate trait class dictionaries:</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">class_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">value</span> <span class="o">=</span> <span class="n">_check_trait</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
            <span class="n">rc</span>    <span class="o">=</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="n">CTrait</span> <span class="p">)</span>

            <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">rc</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="n">ForwardProperty</span> <span class="p">):</span>
                <span class="n">rc</span>     <span class="o">=</span> <span class="bp">True</span>
                <span class="n">getter</span> <span class="o">=</span> <span class="n">_property_method</span><span class="p">(</span> <span class="n">class_dict</span><span class="p">,</span> <span class="s">&#39;_get_&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="p">)</span>
                <span class="n">setter</span> <span class="o">=</span> <span class="n">_property_method</span><span class="p">(</span> <span class="n">class_dict</span><span class="p">,</span> <span class="s">&#39;_set_&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">setter</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">getter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                    <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">getter</span><span class="p">,</span> <span class="s">&#39;settable&#39;</span><span class="p">,</span> <span class="bp">False</span> <span class="p">):</span>
                        <span class="n">setter</span> <span class="o">=</span> <span class="n">HasTraits</span><span class="o">.</span><span class="n">_set_traits_cache</span>
                    <span class="k">elif</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">getter</span><span class="p">,</span> <span class="s">&#39;flushable&#39;</span><span class="p">,</span> <span class="bp">False</span> <span class="p">):</span>
                        <span class="n">setter</span> <span class="o">=</span> <span class="n">HasTraits</span><span class="o">.</span><span class="n">_flush_traits_cache</span>
                <span class="n">validate</span> <span class="o">=</span> <span class="n">_property_method</span><span class="p">(</span> <span class="n">class_dict</span><span class="p">,</span> <span class="s">&#39;_validate_&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">validate</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">validate</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">validate</span>

                <span class="n">value</span> <span class="o">=</span> <span class="n">Property</span><span class="p">(</span> <span class="n">getter</span><span class="p">,</span> <span class="n">setter</span><span class="p">,</span> <span class="n">validate</span><span class="p">,</span> <span class="bp">True</span><span class="p">,</span>
                                  <span class="n">value</span><span class="o">.</span><span class="n">handler</span><span class="p">,</span> <span class="o">**</span><span class="n">value</span><span class="o">.</span><span class="n">metadata</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">rc</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">class_dict</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
                <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">!=</span> <span class="s">&#39;_&#39;</span><span class="p">:</span>
                    <span class="n">base_traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">class_traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="n">value_type</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">type</span>
                    <span class="k">if</span> <span class="n">value_type</span> <span class="o">==</span> <span class="s">&#39;trait&#39;</span><span class="p">:</span>
                       <span class="n">handler</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">handler</span>
                       <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                           <span class="k">if</span> <span class="n">handler</span><span class="o">.</span><span class="n">has_items</span><span class="p">:</span>
                               <span class="n">items_trait</span> <span class="o">=</span> <span class="n">_clone_trait</span><span class="p">(</span>
                                   <span class="n">handler</span><span class="o">.</span><span class="n">items_event</span><span class="p">(),</span> <span class="n">value</span><span class="o">.</span><span class="n">__dict__</span> <span class="p">)</span>

                               <span class="k">if</span> <span class="n">items_trait</span><span class="o">.</span><span class="n">instance_handler</span> <span class="o">==</span> \
                                   <span class="s">&#39;_list_changed_handler&#39;</span><span class="p">:</span>
                                   <span class="n">items_trait</span><span class="o">.</span><span class="n">instance_handler</span> <span class="o">=</span> \
                                       <span class="s">&#39;_list_items_changed_handler&#39;</span>

                               <span class="n">class_traits</span><span class="p">[</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_items&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">items_trait</span>

                           <span class="k">if</span> <span class="n">handler</span><span class="o">.</span><span class="n">is_mapped</span><span class="p">:</span>
                               <span class="n">class_traits</span><span class="p">[</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">_mapped_trait_for</span><span class="p">(</span>
                                                                         <span class="n">value</span> <span class="p">)</span>

                           <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">handler</span><span class="p">,</span> <span class="n">This</span> <span class="p">):</span>
                               <span class="n">handler</span><span class="o">.</span><span class="n">info_text</span> <span class="o">=</span> \
                                   <span class="n">add_article</span><span class="p">(</span> <span class="n">class_name</span> <span class="p">)</span> <span class="o">+</span> <span class="s">&#39; instance&#39;</span>
                               <span class="n">self_referential</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>

                    <span class="k">elif</span> <span class="n">value_type</span> <span class="o">==</span> <span class="s">&#39;delegate&#39;</span><span class="p">:</span>
                        <span class="c"># Only add a listener if the trait.listenable metadata</span>
                        <span class="c"># is not False:</span>
                        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">_listenable</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span><span class="p">:</span>
                            <span class="n">listeners</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="s">&#39;delegate&#39;</span><span class="p">,</span>
                                           <span class="n">get_delegate_pattern</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">value_type</span> <span class="o">==</span> <span class="s">&#39;event&#39;</span><span class="p">:</span>
                        <span class="n">on_trait_change</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">on_trait_change</span>
                        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">on_trait_change</span><span class="p">,</span> <span class="nb">basestring</span> <span class="p">):</span>
                            <span class="n">listeners</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="s">&#39;event&#39;</span><span class="p">,</span> <span class="n">on_trait_change</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                    <span class="n">prefix_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
                    <span class="n">prefix_traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="n">FunctionType</span> <span class="p">):</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="s">&#39;on_trait_change&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">pattern</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">listeners</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="s">&#39;method&#39;</span><span class="p">,</span> <span class="n">pattern</span> <span class="p">)</span>

                <span class="n">_check_method</span><span class="p">(</span> <span class="n">class_dict</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="nb">property</span> <span class="p">):</span>
                <span class="n">class_traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">generic_trait</span>

            <span class="c"># Handle any view elements found in the class:</span>
            <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="n">ViewElement</span> <span class="p">):</span>

                <span class="c"># Add the view element to the class&#39;s &#39;ViewElements&#39; if it is</span>
                <span class="c"># not already defined (duplicate definitions are errors):</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">view_elements</span><span class="o">.</span><span class="n">content</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span>
                        <span class="s">&quot;Duplicate definition for view element &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="n">name</span> <span class="p">)</span>

                <span class="n">view_elements</span><span class="o">.</span><span class="n">content</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                <span class="c"># Replace all substitutable view sub elements with &#39;Include&#39;</span>
                <span class="c"># objects, and add the substituted items to the</span>
                <span class="c"># &#39;ViewElements&#39;:</span>
                <span class="n">value</span><span class="o">.</span><span class="n">replace_include</span><span class="p">(</span> <span class="n">view_elements</span> <span class="p">)</span>

                <span class="c"># Remove the view element from the class definition:</span>
                <span class="k">del</span> <span class="n">class_dict</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">ct</span> <span class="ow">in</span> <span class="n">inherited_class_traits</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">ct</span><span class="p">:</span>
                        <span class="c"># The subclass is providing a default value for the</span>
                        <span class="c"># trait defined in a superclass.</span>
                        <span class="n">ictrait</span> <span class="o">=</span> <span class="n">ct</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
                        <span class="k">if</span> <span class="n">ictrait</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">CantHaveDefaultValue</span><span class="p">:</span>
                            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span> <span class="s">&quot;Cannot specify a default value &quot;</span>
                                <span class="s">&quot;for the </span><span class="si">%s</span><span class="s"> trait &#39;</span><span class="si">%s</span><span class="s">&#39;. You must override the &quot;</span>
                                <span class="s">&quot;the trait definition instead.&quot;</span> <span class="o">%</span>
                                <span class="p">(</span> <span class="n">ictrait</span><span class="o">.</span><span class="n">type</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span> <span class="p">)</span>

                        <span class="n">default_value</span> <span class="o">=</span> <span class="n">value</span>
                        <span class="n">class_traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">=</span> <span class="n">ictrait</span><span class="p">(</span> <span class="n">default_value</span> <span class="p">)</span>
                        <span class="c"># Make sure that the trait now has the default value</span>
                        <span class="c"># has the correct initializer.</span>
                        <span class="n">value</span><span class="o">.</span><span class="n">default_value</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">default</span><span class="p">)</span>
                        <span class="k">del</span> <span class="n">class_dict</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
                        <span class="n">override_bases</span> <span class="o">=</span> <span class="p">[]</span>
                        <span class="n">handler</span>        <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">handler</span>
                        <span class="k">if</span> <span class="p">(</span><span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="n">handler</span><span class="o">.</span><span class="n">is_mapped</span><span class="p">:</span>
                            <span class="n">class_traits</span><span class="p">[</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">_mapped_trait_for</span><span class="p">(</span>
                                                                         <span class="n">value</span> <span class="p">)</span>
                        <span class="k">break</span>

        <span class="c"># Process all HasTraits base classes:</span>
        <span class="n">migrated_properties</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">implements</span>          <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">base</span> <span class="ow">in</span> <span class="n">hastraits_bases</span><span class="p">:</span>
            <span class="n">base_dict</span> <span class="o">=</span> <span class="n">base</span><span class="o">.</span><span class="n">__dict__</span>

            <span class="c"># List the subclasses that implement interfaces:</span>
            <span class="k">if</span> <span class="p">((</span><span class="ow">not</span> <span class="n">is_category</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">base_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">ImplementsClass</span> <span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">__NoInterface__</span><span class="p">)):</span>
                <span class="n">implements</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">base</span> <span class="p">)</span>

            <span class="c"># Merge listener information:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">base_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">ListenerTraits</span> <span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">class_traits</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">class_dict</span><span class="p">):</span>
                    <span class="n">listeners</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

            <span class="c"># Merge base traits:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">base_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">BaseTraits</span> <span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">base_traits</span><span class="p">:</span>
                    <span class="n">property_info</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">property</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">property_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">key</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
                        <span class="n">migrated_properties</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span> <span class="o">=</span> \
                            <span class="bp">self</span><span class="o">.</span><span class="n">migrate_property</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">property_info</span><span class="p">,</span>
                                                   <span class="n">class_dict</span> <span class="p">)</span>
                    <span class="n">base_traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                <span class="k">elif</span> <span class="n">is_category</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;Cannot override &#39;</span><span class="si">%s</span><span class="s">&#39; trait &quot;</span>
                                       <span class="s">&quot;definition in a category&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

            <span class="c"># Merge class traits:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">base_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">ClassTraits</span> <span class="p">)</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">class_traits</span><span class="p">:</span>
                    <span class="n">property_info</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">property</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">property_info</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">new_value</span> <span class="o">=</span> <span class="n">migrated_properties</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="nb">id</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span> <span class="p">)</span>
                        <span class="k">if</span> <span class="n">new_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="n">new_value</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="n">value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">migrate_property</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span>
                                                     <span class="n">property_info</span><span class="p">,</span> <span class="n">class_dict</span> <span class="p">)</span>
                    <span class="n">class_traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

                <span class="k">elif</span> <span class="n">is_category</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;Cannot override &#39;</span><span class="si">%s</span><span class="s">&#39; trait &quot;</span>
                                       <span class="s">&quot;definition in a category&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

            <span class="c"># Merge prefix traits:</span>
            <span class="n">base_prefix_traits</span> <span class="o">=</span> <span class="n">base_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">PrefixTraits</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">base_prefix_traits</span><span class="p">[</span><span class="s">&#39;*&#39;</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">prefix_list</span><span class="p">:</span>
                    <span class="n">prefix_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
                    <span class="n">prefix_traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">base_prefix_traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
                <span class="k">elif</span> <span class="n">is_category</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;Cannot override &#39;</span><span class="si">%s</span><span class="s">_&#39; trait &quot;</span>
                                       <span class="s">&quot;definition in a category&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>

            <span class="c"># If the base class has a &#39;ViewElements&#39; object defined, add it to</span>
            <span class="c"># the &#39;parents&#39; list of this class&#39;s &#39;ViewElements&#39;:</span>
            <span class="n">parent_view_elements</span> <span class="o">=</span> <span class="n">base_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">ViewTraits</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">parent_view_elements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">view_elements</span><span class="o">.</span><span class="n">parents</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">parent_view_elements</span> <span class="p">)</span>

        <span class="c"># Make sure there is a definition for &#39;undefined&#39; traits:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">prefix_traits</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s">&#39;&#39;</span> <span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">is_category</span><span class="p">):</span>
            <span class="n">prefix_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;&#39;</span> <span class="p">)</span>
            <span class="n">prefix_traits</span><span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">Python</span><span class="p">()</span><span class="o">.</span><span class="n">as_ctrait</span><span class="p">()</span>

        <span class="c"># Save a link to the prefix_list:</span>
        <span class="n">prefix_traits</span><span class="p">[</span><span class="s">&#39;*&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">prefix_list</span>

        <span class="c"># Make sure the trait prefixes are sorted longest to shortest</span>
        <span class="c"># so that we can easily bind dynamic traits to the longest matching</span>
        <span class="c"># prefix:</span>
        <span class="n">prefix_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span> <span class="n">y</span> <span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c"># Get the list of all possible &#39;Instance&#39;/&#39;List(Instance)&#39; handlers:</span>
        <span class="n">instance_traits</span> <span class="o">=</span> <span class="n">_get_instance_handlers</span><span class="p">(</span> <span class="n">class_dict</span><span class="p">,</span> <span class="n">hastraits_bases</span> <span class="p">)</span>

        <span class="c"># If there is an &#39;anytrait_changed&#39; event handler, wrap it so that</span>
        <span class="c"># it can be attached to all traits in the class:</span>
        <span class="n">anytrait</span> <span class="o">=</span> <span class="n">_get_def</span><span class="p">(</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">class_dict</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span>
                             <span class="s">&#39;_anytrait_changed&#39;</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">anytrait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">anytrait</span> <span class="o">=</span> <span class="n">StaticAnyTraitChangeNotifyWrapper</span><span class="p">(</span> <span class="n">anytrait</span> <span class="p">)</span>

            <span class="c"># Save it in the prefix traits dictionary so that any dynamically</span>
            <span class="c"># created traits (e.g. &#39;prefix traits&#39;) can re-use it:</span>
            <span class="n">prefix_traits</span><span class="p">[</span><span class="s">&#39;@&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">anytrait</span>

        <span class="c"># Make one final pass over the class traits dictionary, making sure</span>
        <span class="c"># all static trait notification handlers are attached to a &#39;cloned&#39;</span>
        <span class="c"># copy of the original trait:</span>
        <span class="n">cloned</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">class_traits</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">trait</span>    <span class="o">=</span> <span class="n">class_traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
            <span class="n">handlers</span> <span class="o">=</span> <span class="p">[</span> <span class="n">anytrait</span><span class="p">,</span>
                         <span class="n">_get_def</span><span class="p">(</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">class_dict</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span>
                                   <span class="s">&#39;_</span><span class="si">%s</span><span class="s">_changed&#39;</span> <span class="o">%</span> <span class="n">name</span> <span class="p">),</span>
                         <span class="n">_get_def</span><span class="p">(</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">class_dict</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span>
                                   <span class="s">&#39;_</span><span class="si">%s</span><span class="s">_fired&#39;</span> <span class="o">%</span> <span class="n">name</span> <span class="p">)</span> <span class="p">]</span>

            <span class="c"># Check for an &#39;Instance&#39; or &#39;List(Instance)&#39; trait with defined</span>
            <span class="c"># handlers:</span>
            <span class="n">instance_handler</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">instance_handler</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">instance_handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="n">instance_traits</span><span class="p">)</span> <span class="ow">or</span>
                <span class="p">((</span><span class="n">instance_handler</span> <span class="o">==</span> <span class="s">&#39;_list_items_changed_handler&#39;</span><span class="p">)</span> <span class="ow">and</span>
                 <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;_items&#39;</span><span class="p">)</span> <span class="ow">and</span>
                 <span class="p">(</span><span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="ow">in</span> <span class="n">instance_traits</span><span class="p">))):</span>
                <span class="n">handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">HasTraits</span><span class="p">,</span> <span class="n">instance_handler</span> <span class="p">)</span> <span class="p">)</span>

            <span class="n">events</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">event</span>
            <span class="k">if</span> <span class="n">events</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>

                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">events</span><span class="p">,</span> <span class="nb">basestring</span><span class="p">):</span>
                    <span class="n">events</span> <span class="o">=</span> <span class="p">[</span> <span class="n">events</span> <span class="p">]</span>

                <span class="k">for</span> <span class="n">event</span> <span class="ow">in</span> <span class="n">events</span><span class="p">:</span>
                    <span class="n">handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">_get_def</span><span class="p">(</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">class_dict</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span>
                                               <span class="s">&#39;_</span><span class="si">%s</span><span class="s">_changed&#39;</span> <span class="o">%</span> <span class="n">event</span> <span class="p">)</span> <span class="p">)</span>
                    <span class="n">handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">_get_def</span><span class="p">(</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">class_dict</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span>
                                               <span class="s">&#39;_</span><span class="si">%s</span><span class="s">_fired&#39;</span> <span class="o">%</span> <span class="n">event</span> <span class="p">)</span> <span class="p">)</span>

            <span class="n">handlers</span> <span class="o">=</span> <span class="p">[</span> <span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">handlers</span> <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="p">]</span>
            <span class="n">default</span>  <span class="o">=</span> <span class="n">_get_def</span><span class="p">(</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">class_dict</span><span class="p">,</span> <span class="p">[],</span>
                                 <span class="s">&#39;_</span><span class="si">%s</span><span class="s">_default&#39;</span> <span class="o">%</span> <span class="n">name</span> <span class="p">)</span>
            <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">handlers</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cloned</span><span class="p">:</span>
                    <span class="n">cloned</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
                    <span class="n">class_traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">trait</span> <span class="o">=</span> <span class="n">_clone_trait</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">handlers</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">_add_notifiers</span><span class="p">(</span> <span class="n">trait</span><span class="o">.</span><span class="n">_notifiers</span><span class="p">(</span> <span class="mi">1</span> <span class="p">),</span> <span class="n">handlers</span> <span class="p">)</span>

                <span class="k">if</span> <span class="n">default</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">trait</span><span class="o">.</span><span class="n">default_value</span><span class="p">(</span> <span class="mi">8</span><span class="p">,</span> <span class="n">default</span> <span class="p">)</span>

            <span class="c"># Handle the case of properties whose value depends upon the value</span>
            <span class="c"># of other traits:</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">trait</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#39;property&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">trait</span><span class="o">.</span><span class="n">depends_on</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>

                <span class="n">cached</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">cached</span>
                <span class="k">if</span> <span class="n">cached</span> <span class="ow">is</span> <span class="bp">True</span><span class="p">:</span>
                    <span class="n">cached</span> <span class="o">=</span> <span class="n">TraitsCache</span> <span class="o">+</span> <span class="n">name</span>

                <span class="n">depends_on</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">depends_on</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">depends_on</span><span class="p">,</span> <span class="n">SequenceTypes</span> <span class="p">):</span>
                    <span class="n">depends_on</span> <span class="o">=</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">depends_on</span> <span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="c"># Note: We add the leading blank to force it to be treated</span>
                    <span class="c"># as using the extended trait notation so that it will</span>
                    <span class="c"># automatically add &#39;_items&#39; listeners to lists/dicts:</span>
                    <span class="n">depends_on</span> <span class="o">=</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="n">depends_on</span>

                <span class="n">listeners</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="s">&#39;property&#39;</span><span class="p">,</span> <span class="n">cached</span><span class="p">,</span> <span class="n">depends_on</span> <span class="p">)</span>

        <span class="c"># Define a class that is a subclass of all of the interfaces that the</span>
        <span class="c"># HasTraits base classes implement (we won&#39;t know which interfaces this</span>
        <span class="c"># class explicitly implements until the &#39;implements&#39; function callback</span>
        <span class="c"># runs, which is after we exit)...</span>
        <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">implements</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">implements_class</span> <span class="o">=</span> <span class="n">__NoInterface__</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">implements_class</span> <span class="o">=</span> <span class="n">implements</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">__implements__</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">implements_class</span> <span class="o">=</span> <span class="n">_create_implements_class</span><span class="p">(</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">EmptyList</span><span class="p">,</span>
                                                         <span class="n">implements</span> <span class="p">)</span>

        <span class="c"># Save the list of self referential traits:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">self_referential</span> <span class="o">=</span> <span class="n">self_referential</span>

        <span class="c"># Add the traits meta-data to the class:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">add_traits_meta_data</span><span class="p">(</span>
            <span class="n">bases</span><span class="p">,</span> <span class="n">class_dict</span><span class="p">,</span> <span class="n">base_traits</span><span class="p">,</span> <span class="n">class_traits</span><span class="p">,</span> <span class="n">instance_traits</span><span class="p">,</span>
            <span class="n">prefix_traits</span><span class="p">,</span> <span class="n">listeners</span><span class="p">,</span> <span class="n">view_elements</span><span class="p">,</span> <span class="n">implements_class</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Adds the traits meta-data to the class:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="MetaHasTraitsObject.add_traits_meta_data"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.MetaHasTraitsObject.add_traits_meta_data">[docs]</a>    <span class="k">def</span> <span class="nf">add_traits_meta_data</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">bases</span><span class="p">,</span> <span class="n">class_dict</span><span class="p">,</span> <span class="n">base_traits</span><span class="p">,</span>
                               <span class="n">class_traits</span><span class="p">,</span>  <span class="n">instance_traits</span><span class="p">,</span> <span class="n">prefix_traits</span><span class="p">,</span>
                               <span class="n">listeners</span><span class="p">,</span> <span class="n">view_elements</span><span class="p">,</span> <span class="n">implements_class</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds the Traits metadata to the class dictionary.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">class_dict</span><span class="p">[</span> <span class="n">BaseTraits</span>      <span class="p">]</span> <span class="o">=</span> <span class="n">base_traits</span>
        <span class="n">class_dict</span><span class="p">[</span> <span class="n">ClassTraits</span>     <span class="p">]</span> <span class="o">=</span> <span class="n">class_traits</span>
        <span class="n">class_dict</span><span class="p">[</span> <span class="n">InstanceTraits</span>  <span class="p">]</span> <span class="o">=</span> <span class="n">instance_traits</span>
        <span class="n">class_dict</span><span class="p">[</span> <span class="n">PrefixTraits</span>    <span class="p">]</span> <span class="o">=</span> <span class="n">prefix_traits</span>
        <span class="n">class_dict</span><span class="p">[</span> <span class="n">ListenerTraits</span>  <span class="p">]</span> <span class="o">=</span> <span class="n">listeners</span>
        <span class="n">class_dict</span><span class="p">[</span> <span class="n">ViewTraits</span>      <span class="p">]</span> <span class="o">=</span> <span class="n">view_elements</span>
        <span class="n">class_dict</span><span class="p">[</span> <span class="n">ImplementsClass</span> <span class="p">]</span> <span class="o">=</span> <span class="n">implements_class</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Migrates an existing property to the class being defined (allowing for</span>
    <span class="c">#  method overrides):</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="MetaHasTraitsObject.migrate_property"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.MetaHasTraitsObject.migrate_property">[docs]</a>    <span class="k">def</span> <span class="nf">migrate_property</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="nb">property</span><span class="p">,</span> <span class="n">property_info</span><span class="p">,</span> <span class="n">class_dict</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Migrates an existing property to the class being defined</span>
<span class="sd">        (allowing for method overrides).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">get</span> <span class="o">=</span> <span class="n">_property_method</span><span class="p">(</span> <span class="n">class_dict</span><span class="p">,</span> <span class="s">&#39;_get_&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="p">)</span>
        <span class="nb">set</span> <span class="o">=</span> <span class="n">_property_method</span><span class="p">(</span> <span class="n">class_dict</span><span class="p">,</span> <span class="s">&#39;_set_&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="p">)</span>
        <span class="n">val</span> <span class="o">=</span> <span class="n">_property_method</span><span class="p">(</span> <span class="n">class_dict</span><span class="p">,</span>
                                <span class="s">&#39;_validate_&#39;</span> <span class="o">+</span> <span class="n">name</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">((</span><span class="n">get</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">set</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)):</span>
            <span class="n">old_get</span><span class="p">,</span> <span class="n">old_set</span><span class="p">,</span> <span class="n">old_val</span> <span class="o">=</span> <span class="n">property_info</span>
            <span class="k">return</span> <span class="n">Property</span><span class="p">(</span> <span class="n">get</span> <span class="ow">or</span> <span class="n">old_get</span><span class="p">,</span> <span class="nb">set</span> <span class="ow">or</span> <span class="n">old_set</span><span class="p">,</span> <span class="n">val</span> <span class="ow">or</span> <span class="n">old_val</span><span class="p">,</span>
                             <span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="nb">property</span><span class="o">.</span><span class="n">__dict__</span> <span class="p">)</span>

        <span class="k">return</span> <span class="nb">property</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Manages the list of trait instance monitors:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div></div>
<div class="viewcode-block" id="_trait_monitor_index"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._trait_monitor_index">[docs]</a><span class="k">def</span> <span class="nf">_trait_monitor_index</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">handler</span> <span class="p">):</span>
    <span class="k">global</span> <span class="n">_HasTraits_monitors</span>

    <span class="n">type_handler</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span> <span class="n">handler</span> <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_cls</span><span class="p">,</span> <span class="n">_handler</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">_HasTraits_monitors</span> <span class="p">):</span>
        <span class="k">if</span> <span class="n">type_handler</span> <span class="ow">is</span> <span class="nb">type</span><span class="p">(</span> <span class="n">_handler</span> <span class="p">):</span>
            <span class="k">if</span> <span class="p">((</span><span class="n">type_handler</span> <span class="ow">is</span> <span class="n">MethodType</span><span class="p">)</span> <span class="ow">and</span>
                <span class="p">(</span><span class="n">handler</span><span class="o">.</span><span class="n">im_self</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">((</span><span class="n">handler</span><span class="o">.</span><span class="n">__name__</span> <span class="o">==</span> <span class="n">_handler</span><span class="o">.</span><span class="n">__name__</span><span class="p">)</span> <span class="ow">and</span>
                    <span class="p">(</span><span class="n">handler</span><span class="o">.</span><span class="n">im_self</span> <span class="ow">is</span> <span class="n">_handler</span><span class="o">.</span><span class="n">im_self</span><span class="p">)):</span>
                   <span class="k">return</span> <span class="n">i</span>

            <span class="k">elif</span> <span class="n">handler</span> <span class="o">==</span> <span class="n">_handler</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">i</span>

    <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Creates a class the implements a set of interfaces:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="_create_implements_class"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._create_implements_class">[docs]</a><span class="k">def</span> <span class="nf">_create_implements_class</span> <span class="p">(</span> <span class="n">class_name</span><span class="p">,</span> <span class="n">interfaces</span><span class="p">,</span> <span class="n">base_classes</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Creates a class the implements a set of interfaces.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">locals</span>  <span class="o">=</span> <span class="p">{}</span>
    <span class="n">classes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">interface</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="p">:</span>
        <span class="nb">locals</span><span class="p">[</span> <span class="n">interface</span><span class="o">.</span><span class="n">__name__</span> <span class="p">]</span> <span class="o">=</span> <span class="n">interface</span>
        <span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">interface</span><span class="o">.</span><span class="n">__name__</span> <span class="p">)</span>

    <span class="k">for</span> <span class="n">base_class</span> <span class="ow">in</span> <span class="n">base_classes</span><span class="p">:</span>
        <span class="n">ic</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">base_class</span><span class="p">,</span> <span class="n">ImplementsClass</span><span class="p">,</span> <span class="n">__NoInterface__</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">ic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">__NoInterface__</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">ifc</span> <span class="ow">in</span> <span class="n">_extract_interfaces</span><span class="p">(</span> <span class="n">ic</span> <span class="p">):</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">ifc</span><span class="o">.</span><span class="n">__name__</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">:</span>
                    <span class="nb">locals</span><span class="p">[</span> <span class="n">ifc</span><span class="o">.</span><span class="n">__name__</span> <span class="p">]</span> <span class="o">=</span> <span class="n">ifc</span>
                    <span class="n">classes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">ifc</span><span class="o">.</span><span class="n">__name__</span> <span class="p">)</span>

    <span class="n">name</span> <span class="o">=</span> <span class="n">class_name</span> <span class="o">+</span> <span class="s">&#39;Implements&#39;</span>
    <span class="k">exec</span> <span class="s">&#39;class </span><span class="si">%s</span><span class="s">(</span><span class="si">%s</span><span class="s">):__ignore_interface__=None&#39;</span> <span class="o">%</span> <span class="p">(</span>
         <span class="n">name</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">classes</span> <span class="p">)</span> <span class="p">)</span> <span class="ow">in</span> <span class="nb">locals</span>

    <span class="k">return</span> <span class="nb">locals</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
</div>
<div class="viewcode-block" id="_extract_interfaces"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits._extract_interfaces">[docs]</a><span class="k">def</span> <span class="nf">_extract_interfaces</span> <span class="p">(</span> <span class="n">implements_class</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Extracts the list of interfaces implemented by a specified class.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">ifc</span> <span class="ow">in</span> <span class="n">implements_class</span><span class="o">.</span><span class="n">__mro__</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">ifc</span> <span class="ow">is</span> <span class="n">Interface</span><span class="p">:</span>
            <span class="k">break</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span> <span class="n">ifc</span><span class="p">,</span> <span class="s">&#39;__ignore_interface__&#39;</span> <span class="p">):</span>
            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">ifc</span> <span class="p">)</span>

    <span class="k">return</span> <span class="n">result</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Defines the &#39;implements&#39; function for declaring which interfaces a class</span>
<span class="c">#  implements:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="implements"><a class="viewcode-back" href="../../traits_user_manual/advanced.html#traits.has_traits.implements">[docs]</a><span class="k">def</span> <span class="nf">implements</span> <span class="p">(</span> <span class="o">*</span><span class="n">interfaces</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Declares the interfaces that a class implements.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    *interfaces :</span>
<span class="sd">        A list of interface classes that the containing class implements.</span>

<span class="sd">    Description</span>
<span class="sd">    -----------</span>
<span class="sd">    Registers each specified interface with the interface manager as an</span>
<span class="sd">    interface that the containing class implements. Each specified interface</span>
<span class="sd">    must be a subclass of **Interface**. This function should only be</span>
<span class="sd">    called from directly within a class body.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Exit immediately if there is nothing to do:</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">interfaces</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span>

    <span class="c"># Verify that each argument is a valid interface:</span>
    <span class="k">for</span> <span class="n">interface</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">issubclass</span><span class="p">(</span> <span class="n">interface</span><span class="p">,</span> <span class="n">Interface</span> <span class="p">):</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span> <span class="s">&quot;All arguments to &#39;implements&#39; must be &quot;</span>
                              <span class="s">&quot;subclasses of Interface.&quot;</span> <span class="p">)</span>

    <span class="c"># Define a function that is called when the containing class is constructed:</span>
    <span class="k">def</span> <span class="nf">callback</span> <span class="p">(</span> <span class="n">klass</span> <span class="p">):</span>
        <span class="kn">from</span> <span class="nn">.category</span> <span class="kn">import</span> <span class="n">Category</span>

        <span class="n">target</span> <span class="o">=</span> <span class="n">klass</span>
        <span class="n">bases</span>  <span class="o">=</span> <span class="n">klass</span><span class="o">.</span><span class="n">__bases__</span>
        <span class="k">if</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">bases</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">bases</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="n">Category</span><span class="p">):</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">bases</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="c"># Update the class and each of the existing subclasses:</span>
            <span class="k">for</span> <span class="n">subclass</span> <span class="ow">in</span> <span class="n">target</span><span class="o">.</span><span class="n">trait_subclasses</span><span class="p">(</span> <span class="bp">True</span> <span class="p">):</span>
                <span class="c"># Merge in the interfaces implemented by the category:</span>
                <span class="n">subclass</span><span class="o">.</span><span class="n">__implements__</span> <span class="o">=</span> <span class="n">_create_implements_class</span><span class="p">(</span>
                        <span class="n">subclass</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">interfaces</span><span class="p">,</span> <span class="p">[</span> <span class="n">subclass</span> <span class="p">]</span> <span class="p">)</span>

        <span class="n">target</span><span class="o">.</span><span class="n">__implements__</span> <span class="o">=</span> <span class="n">_create_implements_class</span><span class="p">(</span>
            <span class="n">target</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">interfaces</span><span class="p">,</span> <span class="n">bases</span> <span class="p">)</span>

        <span class="c"># Compute the closure of all the interfaces (i.e. include all interface</span>
        <span class="c"># superclasses which are also interfaces):</span>
        <span class="n">closure</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(</span> <span class="n">interfaces</span> <span class="p">)</span>
        <span class="k">for</span> <span class="n">interface</span> <span class="ow">in</span> <span class="n">interfaces</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">subclass</span> <span class="ow">in</span> <span class="n">interface</span><span class="o">.</span><span class="n">__mro__</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">subclass</span> <span class="ow">is</span> <span class="n">Interface</span><span class="p">:</span>
                    <span class="k">break</span>

                <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span> <span class="n">subclass</span><span class="p">,</span> <span class="n">Interface</span> <span class="p">):</span>
                    <span class="n">closure</span><span class="o">.</span><span class="n">add</span><span class="p">(</span> <span class="n">subclass</span> <span class="p">)</span>

        <span class="c"># Tell PyProtocols that the class implements its interfaces:</span>
        <span class="n">declareImplementation</span><span class="p">(</span> <span class="n">target</span><span class="p">,</span> <span class="n">instancesProvide</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span> <span class="n">closure</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c"># Make sure the class actually does implement the interfaces it claims</span>
        <span class="c"># to:</span>
        <span class="k">if</span> <span class="n">CHECK_INTERFACES</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">.interface_checker</span> <span class="kn">import</span> <span class="n">check_implements</span>

            <span class="n">check_implements</span><span class="p">(</span> <span class="n">klass</span><span class="p">,</span> <span class="n">interfaces</span><span class="p">,</span> <span class="n">CHECK_INTERFACES</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">klass</span>

    <span class="c"># Request that we be called back at class construction time:</span>
    <span class="n">addClassAdvisor</span><span class="p">(</span> <span class="n">callback</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;HasTraits&#39; decorators:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="on_trait_change"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.on_trait_change">[docs]</a><span class="k">def</span> <span class="nf">on_trait_change</span> <span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">post_init</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">*</span><span class="n">names</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Marks the following method definition as being a handler for the</span>
<span class="sd">        extended trait change specified by *name(s)*.</span>

<span class="sd">        Refer to the documentation for the on_trait_change() method of</span>
<span class="sd">        the **HasTraits** class for information on the correct syntax for</span>
<span class="sd">        the *name(s)* argument.</span>

<span class="sd">        A handler defined using this decorator is normally effective</span>
<span class="sd">        immediately. However, if *post_init* is **True**, then the handler only</span>
<span class="sd">        become effective after all object constructor arguments have been</span>
<span class="sd">        processed. That is, trait values assigned as part of object construction</span>
<span class="sd">        will not cause the handler to be invoked.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">decorator</span> <span class="p">(</span> <span class="n">function</span> <span class="p">):</span>
        <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;&lt;&#39;</span>
        <span class="k">if</span> <span class="n">post_init</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;&gt;&#39;</span>

        <span class="n">function</span><span class="o">.</span><span class="n">on_trait_change</span> <span class="o">=</span> <span class="n">prefix</span> <span class="o">+</span> \
                                   <span class="p">(</span><span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span> <span class="n">names</span> <span class="p">)</span> <span class="p">))</span>

        <span class="k">return</span> <span class="n">function</span>

    <span class="k">return</span> <span class="n">decorator</span>
</div>
<div class="viewcode-block" id="cached_property"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.cached_property">[docs]</a><span class="k">def</span> <span class="nf">cached_property</span> <span class="p">(</span> <span class="n">function</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Marks the following method definition as being a &quot;cached property&quot;.</span>
<span class="sd">        That is, it is a property getter which, for performance reasons, caches</span>
<span class="sd">        its most recently computed result in an attribute whose name is of the</span>
<span class="sd">        form: *_traits_cache_name*, where *name* is the name of the property. A</span>
<span class="sd">        method marked as being a cached property needs only to compute and</span>
<span class="sd">        return its result. The @cached_property decorator automatically wraps</span>
<span class="sd">        the decorated method in cache management code, eliminating the need to</span>
<span class="sd">        write boilerplate cache management code explicitly. For example::</span>

<span class="sd">            file_name = File</span>
<span class="sd">            file_contents = Property( depends_on = &#39;file_name&#39; )</span>

<span class="sd">            @cached_property</span>
<span class="sd">            def _get_file_contents(self):</span>
<span class="sd">                fh = open(self.file_name, &#39;rb&#39;)</span>
<span class="sd">                result = fh.read()</span>
<span class="sd">                fh.close()</span>
<span class="sd">                return result</span>

<span class="sd">        In this example, accessing the *file_contents* trait calls the</span>
<span class="sd">        _get_file_contents() method only once each time after the **file_name**</span>
<span class="sd">        trait is modified. In all other cases, the cached value</span>
<span class="sd">        **_file_contents**, which maintained by the @cached_property wrapper</span>
<span class="sd">        code, is returned.</span>

<span class="sd">        Note the use, in the example, of the **depends_on** metadata attribute</span>
<span class="sd">        to specify that the value of **file_contents** depends on **file_name**,</span>
<span class="sd">        so that _get_file_contents() is called only when **file_name** changes.</span>
<span class="sd">        For details, see the traits.traits.Property() function.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">TraitsCache</span> <span class="o">+</span> <span class="n">function</span><span class="o">.</span><span class="n">__name__</span><span class="p">[</span> <span class="mi">5</span><span class="p">:</span> <span class="p">]</span>

    <span class="k">def</span> <span class="nf">decorator</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">Undefined</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">result</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="n">decorator</span><span class="o">.</span><span class="n">cached_property</span> <span class="o">=</span> <span class="bp">True</span>

    <span class="k">return</span> <span class="n">decorator</span>
</div>
<div class="viewcode-block" id="property_depends_on"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.property_depends_on">[docs]</a><span class="k">def</span> <span class="nf">property_depends_on</span> <span class="p">(</span> <span class="n">dependency</span><span class="p">,</span> <span class="n">settable</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">flushable</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Marks the following method definition as being a &quot;cached property&quot;</span>
<span class="sd">        that depends on the specified extended trait names. That is, it is a</span>
<span class="sd">        property getter which, for performance reasons, caches its most recently</span>
<span class="sd">        computed result in an attribute whose name is of the form:</span>
<span class="sd">        *_traits_cache_name*, where *name* is the name of the property. A method</span>
<span class="sd">        marked as being a cached property needs only to compute and return its</span>
<span class="sd">        result. The @property_depends_on decorator automatically wraps the</span>
<span class="sd">        decorated method in cache management code that will cache the most</span>
<span class="sd">        recently computed value and flush the cache when any of the specified</span>
<span class="sd">        dependencies are modified, thus eliminating the need to write</span>
<span class="sd">        boilerplate cache management code explicitly. For example::</span>

<span class="sd">            file_name = File</span>
<span class="sd">            file_contents = Property</span>

<span class="sd">            @property_depends_on( &#39;file_name&#39; )</span>
<span class="sd">            def _get_file_contents(self):</span>
<span class="sd">                fh = open(self.file_name, &#39;rb&#39;)</span>
<span class="sd">                result = fh.read()</span>
<span class="sd">                fh.close()</span>
<span class="sd">                return result</span>

<span class="sd">        In this example, accessing the *file_contents* trait calls the</span>
<span class="sd">        _get_file_contents() method only once each time after the **file_name**</span>
<span class="sd">        trait is modified. In all other cases, the cached value</span>
<span class="sd">        **_file_contents**, which is maintained by the @cached_property wrapper</span>
<span class="sd">        code, is returned.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">decorator</span> <span class="p">(</span> <span class="n">function</span> <span class="p">):</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">TraitsCache</span> <span class="o">+</span> <span class="n">function</span><span class="o">.</span><span class="n">__name__</span><span class="p">[</span> <span class="mi">5</span><span class="p">:</span> <span class="p">]</span>

        <span class="k">def</span> <span class="nf">wrapper</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">Undefined</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">result</span> <span class="o">=</span> <span class="n">function</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

            <span class="k">return</span> <span class="n">result</span>

        <span class="n">wrapper</span><span class="o">.</span><span class="n">cached_property</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">depends_on</span>      <span class="o">=</span> <span class="n">dependency</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">settable</span>        <span class="o">=</span> <span class="n">settable</span>
        <span class="n">wrapper</span><span class="o">.</span><span class="n">flushable</span>       <span class="o">=</span> <span class="n">flushable</span>

        <span class="k">return</span> <span class="n">wrapper</span>

    <span class="k">return</span> <span class="n">decorator</span>
</div>
<div class="viewcode-block" id="weak_arg"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.weak_arg">[docs]</a><span class="k">def</span> <span class="nf">weak_arg</span><span class="p">(</span><span class="n">arg</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Create a weak reference to arg and wrap the function so that the</span>
<span class="sd">    dereferenced weakref is passed as the first argument. If arg has been</span>
<span class="sd">    deleted then the function is not called.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Create the weak reference</span>
    <span class="n">weak_arg</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">decorator</span><span class="p">(</span><span class="n">function</span><span class="p">):</span>
        <span class="c"># We need multiple wrappers to traits can find the number of arguments.</span>
        <span class="c"># The all just dereference the weak reference and the call the</span>
        <span class="c"># function if it is not None.</span>
        <span class="k">def</span> <span class="nf">wrapper0</span><span class="p">():</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">weak_arg</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="n">arg</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper1</span><span class="p">(</span><span class="n">arg1</span><span class="p">):</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">weak_arg</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">arg1</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper2</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">):</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">weak_arg</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper3</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">):</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">weak_arg</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrapper4</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">,</span> <span class="n">arg4</span><span class="p">):</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">weak_arg</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">function</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">,</span> <span class="n">arg4</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">wrappern</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">):</span>
            <span class="n">arg</span> <span class="o">=</span> <span class="n">weak_arg</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">arg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">function</span><span class="p">(</span><span class="n">arg</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
        <span class="c"># Return the correct wrapper depending on the arg count</span>
        <span class="n">args</span> <span class="o">=</span> <span class="n">function</span><span class="o">.</span><span class="n">func_code</span><span class="o">.</span><span class="n">co_argcount</span><span class="o">-</span><span class="mi">1</span>
        <span class="k">if</span> <span class="n">args</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wrapper0</span>
        <span class="k">elif</span> <span class="n">args</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wrapper1</span>
        <span class="k">elif</span> <span class="n">args</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wrapper2</span>
        <span class="k">elif</span> <span class="n">args</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wrapper3</span>
        <span class="k">elif</span> <span class="n">args</span> <span class="o">==</span> <span class="mi">4</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wrapper4</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wrappern</span>

    <span class="k">return</span> <span class="n">decorator</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;HasTraits&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits">[docs]</a><span class="k">class</span> <span class="nc">HasTraits</span> <span class="p">(</span> <span class="n">CHasTraits</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Enables any Python class derived from it to have trait attributes.</span>

<span class="sd">    Most of the methods of HasTraits operated by default only on the trait</span>
<span class="sd">    attributes explicitly defined in the class definition. They do not operate</span>
<span class="sd">    on trait attributes defined by way of wildcards or by calling</span>
<span class="sd">    **add_trait()**.</span>
<span class="sd">    For example::</span>

<span class="sd">        &gt;&gt;&gt;class Person(HasTraits):</span>
<span class="sd">        ...    name = Str</span>
<span class="sd">        ...    age  = Int</span>
<span class="sd">        ...    temp_ = Any</span>
<span class="sd">        &gt;&gt;&gt;bob = Person()</span>
<span class="sd">        &gt;&gt;&gt;bob.temp_lunch = &#39;sandwich&#39;</span>
<span class="sd">        &gt;&gt;&gt;bob.add_trait(&#39;favorite_sport&#39;, Str(&#39;football&#39;))</span>
<span class="sd">        &gt;&gt;&gt;print bob.trait_names()</span>
<span class="sd">        [&#39;trait_added&#39;, &#39;age&#39;, &#39;name&#39;]</span>

<span class="sd">    In this example, the trait_names() method returns only the *age* and</span>
<span class="sd">    *name* attributes defined on the Person class. (The **trait_added**</span>
<span class="sd">    attribute is an explicit trait event defined on the HasTraits class.)</span>
<span class="sd">    The wildcard attribute *temp_lunch* and the dynamically-added trait</span>
<span class="sd">    attribute *favorite_sport* are not listed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">MetaHasTraits</span>

    <span class="c">#-- Trait Prefix Rules -----------------------------------------------------</span>

    <span class="c">#: Make traits &#39;property cache&#39; values private with no type checking:</span>
    <span class="n">_traits_cache__</span> <span class="o">=</span> <span class="n">Any</span><span class="p">(</span> <span class="n">private</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">transient</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>

    <span class="c">#-- Class Variables --------------------------------------------------------</span>

    <span class="c">#: Mapping from dispatch type to notification wrapper class type</span>
    <span class="n">wrappers</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s">&#39;same&#39;</span><span class="p">:</span>     <span class="n">TraitChangeNotifyWrapper</span><span class="p">,</span>
        <span class="s">&#39;extended&#39;</span><span class="p">:</span> <span class="n">ExtendedTraitChangeNotifyWrapper</span><span class="p">,</span>
        <span class="s">&#39;new&#39;</span><span class="p">:</span>      <span class="n">NewTraitChangeNotifyWrapper</span><span class="p">,</span>
        <span class="s">&#39;fast_ui&#39;</span><span class="p">:</span>  <span class="n">FastUITraitChangeNotifyWrapper</span><span class="p">,</span>
        <span class="s">&#39;ui&#39;</span><span class="p">:</span>       <span class="n">FastUITraitChangeNotifyWrapper</span>
        <span class="c"># fixme: Disabling the new ui dispatch mechanism until the problems can</span>
        <span class="c"># be worked out (i.e. breaks Undo/Redo and doesn&#39;t handle list item</span>
        <span class="c"># event objects correctly because of the &#39;new&#39; value replacement not</span>
        <span class="c"># always being the correct action to take).</span>
        <span class="c">#&#39;ui&#39;:     UITraitChangeNotifyWrapper</span>
    <span class="p">}</span>

    <span class="c">#-- Trait Definitions ------------------------------------------------------</span>

    <span class="c">#: An event fired when a new trait is dynamically added to the object</span>
    <span class="n">trait_added</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span> <span class="nb">basestring</span> <span class="p">)</span>

    <span class="c">#: An event that can be fired to indicate that the state of the object has</span>
    <span class="c">#: been modified</span>
    <span class="n">trait_modified</span> <span class="o">=</span> <span class="n">Event</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Handles a &#39;trait_added&#39; event being fired:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_trait_added_changed</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Handles a &#39;trait_added&#39; event being fired.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># fixme: This test should be made more comprehensive by also verifying</span>
        <span class="c"># that if the trait name does end in &#39;_items&#39;, its base trait is also</span>
        <span class="c"># a list or dictionary (in order to eliminate a false positive on an</span>
        <span class="c"># unfortunately named trait:</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">trait</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#39;delegate&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">6</span><span class="p">:]</span> <span class="o">!=</span> <span class="s">&#39;_items&#39;</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_trait_delegate_listener</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="s">&#39;delegate&#39;</span><span class="p">,</span>
                                           <span class="n">get_delegate_pattern</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="p">)</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Adds/Removes a trait instance creation monitor:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.trait_monitor"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.trait_monitor">[docs]</a>    <span class="k">def</span> <span class="nf">trait_monitor</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">remove</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds or removes the specified *handler* from the list of active</span>
<span class="sd">        monitors.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        handler : function</span>
<span class="sd">            The function to add or remove as a monitor.</span>
<span class="sd">        remove : bool</span>
<span class="sd">            Flag indicating whether to remove (True) or add the specified</span>
<span class="sd">            handler as a monitor for this class.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        If *remove* is omitted or False, the specified handler is added to</span>
<span class="sd">        the list of active monitors; if *remove* is True, the handler is</span>
<span class="sd">        removed from the active monitor list.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">global</span> <span class="n">_HasTraits_monitors</span>

        <span class="n">index</span> <span class="o">=</span> <span class="n">_trait_monitor_index</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">handler</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">index</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">_HasTraits_monitors</span><span class="p">[</span> <span class="n">index</span> <span class="p">]</span>
            <span class="k">return</span>

        <span class="k">if</span> <span class="n">index</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">_HasTraits_monitors</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">handler</span> <span class="p">)</span> <span class="p">)</span>
</div>
    <span class="n">trait_monitor</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">trait_monitor</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Add a new class trait (i.e. applies to all instances and subclasses):</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.add_class_trait"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.add_class_trait">[docs]</a>    <span class="k">def</span> <span class="nf">add_class_trait</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">trait</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds a named trait attribute to this class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the attribute to add.</span>
<span class="sd">        *trait :</span>
<span class="sd">            A trait or a value that can be converted to a trait using Trait()</span>
<span class="sd">            Trait definition of the attribute. It can be a single value or</span>
<span class="sd">            a list equivalent to an argument list for the Trait() function.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Make sure a trait argument was specified:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="s">&#39;No trait definition was specified.&#39;</span>

        <span class="c"># Make sure only valid traits get added:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="n">Trait</span><span class="p">(</span> <span class="o">*</span><span class="n">trait</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="n">_trait_for</span><span class="p">(</span> <span class="n">trait</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>

        <span class="c"># Add the trait to the class:</span>
        <span class="n">cls</span><span class="o">.</span><span class="n">_add_class_trait</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span> <span class="bp">False</span> <span class="p">)</span>

        <span class="c"># Also add the trait to all subclasses of this class:</span>
        <span class="k">for</span> <span class="n">subclass</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">trait_subclasses</span><span class="p">(</span> <span class="bp">True</span> <span class="p">):</span>
            <span class="n">subclass</span><span class="o">.</span><span class="n">_add_class_trait</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span> <span class="bp">True</span> <span class="p">)</span>
</div>
    <span class="n">add_class_trait</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">add_class_trait</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_add_class_trait</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span><span class="p">,</span> <span class="n">is_subclass</span> <span class="p">):</span>
        <span class="c"># Get a reference to the class&#39;s dictionary and &#39;prefix&#39; traits:</span>
        <span class="n">class_dict</span>    <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__dict__</span>
        <span class="n">prefix_traits</span> <span class="o">=</span> <span class="n">class_dict</span><span class="p">[</span> <span class="n">PrefixTraits</span> <span class="p">]</span>

        <span class="c"># See if the trait is a &#39;prefix&#39; trait:</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;_&#39;</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">prefix_traits</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">is_subclass</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span> <span class="s">&quot;The &#39;</span><span class="si">%s</span><span class="s">_&#39; trait is already defined.&quot;</span> <span class="o">%</span> <span class="n">name</span> <span class="p">)</span>
            <span class="n">prefix_traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">trait</span>

            <span class="c"># Otherwise, add it to the list of known prefixes:</span>
            <span class="n">prefix_list</span> <span class="o">=</span> <span class="n">prefix_traits</span><span class="p">[</span><span class="s">&#39;*&#39;</span><span class="p">]</span>
            <span class="n">prefix_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>

            <span class="c"># Resort the list from longest to shortest:</span>
            <span class="n">prefix_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span> <span class="n">y</span> <span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span> <span class="p">)</span>

            <span class="k">return</span>

        <span class="c"># Check to see if the trait is already defined:</span>
        <span class="n">class_traits</span> <span class="o">=</span> <span class="n">class_dict</span><span class="p">[</span> <span class="n">ClassTraits</span> <span class="p">]</span>
        <span class="k">if</span> <span class="n">class_traits</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">is_subclass</span><span class="p">:</span>
                <span class="k">return</span>
            <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span> <span class="s">&quot;The &#39;</span><span class="si">%s</span><span class="s">&#39; trait is already defined.&quot;</span> <span class="o">%</span> <span class="n">name</span> <span class="p">)</span>

        <span class="c"># Check to see if the trait has additional sub-traits that need to be</span>
        <span class="c"># defined also:</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">handler</span>
        <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">handler</span><span class="o">.</span><span class="n">has_items</span><span class="p">:</span>
                <span class="n">cls</span><span class="o">.</span><span class="n">add_class_trait</span><span class="p">(</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_items&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="o">.</span><span class="n">items_event</span><span class="p">()</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">handler</span><span class="o">.</span><span class="n">is_mapped</span><span class="p">:</span>
                <span class="n">cls</span><span class="o">.</span><span class="n">add_class_trait</span><span class="p">(</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="n">_mapped_trait_for</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c"># Make the new trait inheritable (if allowed):</span>
        <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">is_base</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">class_dict</span><span class="p">[</span> <span class="n">BaseTraits</span> <span class="p">][</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">trait</span>

        <span class="c"># See if there are any static notifiers defined:</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="p">[</span> <span class="n">_get_method</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="s">&#39;_</span><span class="si">%s</span><span class="s">_changed&#39;</span> <span class="o">%</span> <span class="n">name</span> <span class="p">),</span>
                     <span class="n">_get_method</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="s">&#39;_</span><span class="si">%s</span><span class="s">_fired&#39;</span>   <span class="o">%</span> <span class="n">name</span> <span class="p">)</span> <span class="p">]</span>

        <span class="c"># Add any special trait defined event handlers:</span>
        <span class="n">_add_event_handlers</span><span class="p">(</span> <span class="n">trait</span><span class="p">,</span> <span class="n">cls</span><span class="p">,</span> <span class="n">handlers</span> <span class="p">)</span>

        <span class="c"># Add the &#39;anytrait&#39; handler (if any):</span>
        <span class="n">handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">prefix_traits</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s">&#39;@&#39;</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c"># Filter out any &#39;None&#39; values:</span>
        <span class="n">handlers</span> <span class="o">=</span> <span class="p">[</span> <span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">handlers</span> <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="p">]</span>

        <span class="c"># If there are and handlers, add them to the trait&#39;s notifier&#39;s list:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">handlers</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="n">_clone_trait</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span>
            <span class="n">_add_notifiers</span><span class="p">(</span> <span class="n">trait</span><span class="o">.</span><span class="n">_notifiers</span><span class="p">(</span> <span class="mi">1</span> <span class="p">),</span> <span class="n">handlers</span> <span class="p">)</span>

        <span class="c"># Finally, add the new trait to the class trait dictionary:</span>
        <span class="n">class_traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">trait</span>

    <span class="n">_add_class_trait</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">_add_class_trait</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Adds a &#39;category&#39; to the class:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.add_trait_category"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.add_trait_category">[docs]</a>    <span class="k">def</span> <span class="nf">add_trait_category</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">category</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Adds a trait category to a class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span> <span class="n">category</span><span class="p">,</span> <span class="n">HasTraits</span> <span class="p">):</span>
            <span class="n">cls</span><span class="o">.</span><span class="n">_add_trait_category</span><span class="p">(</span>
                <span class="nb">getattr</span><span class="p">(</span> <span class="n">category</span><span class="p">,</span> <span class="n">BaseTraits</span> <span class="p">),</span>
                <span class="nb">getattr</span><span class="p">(</span> <span class="n">category</span><span class="p">,</span> <span class="n">ClassTraits</span> <span class="p">),</span>
                <span class="nb">getattr</span><span class="p">(</span> <span class="n">category</span><span class="p">,</span> <span class="n">InstanceTraits</span> <span class="p">),</span>
                <span class="nb">getattr</span><span class="p">(</span> <span class="n">category</span><span class="p">,</span> <span class="n">PrefixTraits</span> <span class="p">),</span>
                <span class="nb">getattr</span><span class="p">(</span> <span class="n">category</span><span class="p">,</span> <span class="n">ListenerTraits</span> <span class="p">),</span>
                <span class="nb">getattr</span><span class="p">(</span> <span class="n">category</span><span class="p">,</span> <span class="n">ViewTraits</span><span class="p">,</span> <span class="bp">None</span> <span class="p">),</span>
                <span class="nb">getattr</span><span class="p">(</span> <span class="n">category</span><span class="p">,</span> <span class="n">ImplementsClass</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c"># Copy all methods that are not already in the class from the category:</span>
        <span class="k">for</span> <span class="n">subcls</span> <span class="ow">in</span> <span class="n">category</span><span class="o">.</span><span class="n">__mro__</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">subcls</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
                    <span class="nb">setattr</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
</div>
    <span class="n">add_trait_category</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">add_trait_category</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Adds a &#39;category&#39; to the class:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_add_trait_category</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">base_traits</span><span class="p">,</span> <span class="n">class_traits</span><span class="p">,</span> <span class="n">instance_traits</span><span class="p">,</span>
                                   <span class="n">prefix_traits</span><span class="p">,</span> <span class="n">listeners</span><span class="p">,</span> <span class="n">view_elements</span><span class="p">,</span>
                                   <span class="n">implements_class</span> <span class="p">):</span>
        <span class="c"># Update the class and each of the existing subclasses:</span>
        <span class="k">for</span> <span class="n">subclass</span> <span class="ow">in</span> <span class="p">[</span> <span class="n">cls</span> <span class="p">]</span> <span class="o">+</span> <span class="n">cls</span><span class="o">.</span><span class="n">trait_subclasses</span><span class="p">(</span> <span class="bp">True</span> <span class="p">):</span>

            <span class="c"># Merge the &#39;base_traits&#39;:</span>
            <span class="n">subclass_traits</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">subclass</span><span class="p">,</span> <span class="n">BaseTraits</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">base_traits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">subclass_traits</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

            <span class="c"># Merge the &#39;class_traits&#39;:</span>
            <span class="n">subclass_traits</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">subclass</span><span class="p">,</span> <span class="n">ClassTraits</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">class_traits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">subclass_traits</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

            <span class="c"># Merge the &#39;instance_traits&#39;:</span>
            <span class="n">subclass_traits</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">subclass</span><span class="p">,</span> <span class="n">InstanceTraits</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">arg_lists</span> <span class="ow">in</span> <span class="n">instance_traits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">subclass_arg_lists</span> <span class="o">=</span> <span class="n">subclass_traits</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">subclass_arg_lists</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">subclass_traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">arg_lists</span><span class="p">[:]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">arg_list</span> <span class="ow">in</span> <span class="n">arg_lists</span><span class="p">:</span>
                        <span class="k">if</span> <span class="n">arg_list</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subclass_arg_lists</span><span class="p">:</span>
                            <span class="n">subclass_arg_lists</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">arg_list</span> <span class="p">)</span>

            <span class="c"># Merge the &#39;prefix_traits&#39;:</span>
            <span class="n">subclass_traits</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">subclass</span><span class="p">,</span> <span class="n">PrefixTraits</span> <span class="p">)</span>
            <span class="n">subclass_list</span>   <span class="o">=</span> <span class="n">subclass_traits</span><span class="p">[</span><span class="s">&#39;*&#39;</span><span class="p">]</span>
            <span class="n">changed</span>         <span class="o">=</span> <span class="bp">False</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">prefix_traits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subclass_traits</span><span class="p">:</span>
                    <span class="n">subclass_traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
                    <span class="n">subclass_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
                    <span class="n">changed</span> <span class="o">=</span> <span class="bp">True</span>

            <span class="c"># Resort the list from longest to shortest (if necessary):</span>
            <span class="k">if</span> <span class="n">changed</span><span class="p">:</span>
                <span class="n">subclass_list</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span> <span class="n">y</span> <span class="p">)</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span> <span class="p">)</span>

            <span class="c"># Merge the &#39;listeners&#39;:</span>
            <span class="n">subclass_traits</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">subclass</span><span class="p">,</span> <span class="n">ListenerTraits</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">listeners</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="n">subclass_traits</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

        <span class="c"># Copy all our new view elements into the base class&#39;s ViewElements:</span>
        <span class="k">if</span> <span class="n">view_elements</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">content</span> <span class="o">=</span> <span class="n">view_elements</span><span class="o">.</span><span class="n">content</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">content</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">base_ve</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">ViewTraits</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">base_ve</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">base_ve</span> <span class="o">=</span> <span class="n">ViewElements</span><span class="p">()</span>
                    <span class="nb">setattr</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">ViewTraits</span><span class="p">,</span> <span class="n">base_ve</span> <span class="p">)</span>
                <span class="n">base_ve_content</span> <span class="o">=</span> <span class="n">base_ve</span><span class="o">.</span><span class="n">content</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">content</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">base_ve_content</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="n">_add_trait_category</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">_add_trait_category</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Sets a trait notification dispatch handler:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.set_trait_dispatch_handler"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.set_trait_dispatch_handler">[docs]</a>    <span class="k">def</span> <span class="nf">set_trait_dispatch_handler</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">klass</span><span class="p">,</span> <span class="n">override</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets a trait notification dispatch handler.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">issubclass</span><span class="p">(</span> <span class="n">klass</span><span class="p">,</span> <span class="n">TraitChangeNotifyWrapper</span> <span class="p">):</span>
                <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">override</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">wrappers</span><span class="p">):</span>
                    <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;A dispatch handler called &#39;</span><span class="si">%s</span><span class="s">&#39; has &quot;</span>
                                       <span class="s">&quot;already been defined.&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
                <span class="n">cls</span><span class="o">.</span><span class="n">wrappers</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">klass</span>
                <span class="k">return</span>
        <span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">raise</span> <span class="n">TraitError</span><span class="p">,</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> is not a subclass of TraitChangeNotifyWrapper.&#39;</span> <span class="o">%</span>
                           <span class="n">klass</span><span class="p">)</span>
</div>
    <span class="n">set_trait_dispatch_handler</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">set_trait_dispatch_handler</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Returns the immediate (or all) subclasses of this class:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.trait_subclasses"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.trait_subclasses">[docs]</a>    <span class="k">def</span> <span class="nf">trait_subclasses</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="nb">all</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a list of the immediate (or all) subclasses of this class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        all : bool</span>
<span class="sd">            Indicates whether to return all subclasses of this class. If</span>
<span class="sd">            False, only immediate subclasses are returned.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">SubclassTraits</span> <span class="p">)[:]</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_trait_subclasses</span><span class="p">(</span> <span class="p">[]</span> <span class="p">)</span>
</div>
    <span class="n">trait_subclasses</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">trait_subclasses</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_trait_subclasses</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">subclasses</span> <span class="p">):</span>
        <span class="k">for</span> <span class="n">subclass</span> <span class="ow">in</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">SubclassTraits</span> <span class="p">):</span>
            <span class="k">if</span> <span class="n">subclass</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">subclasses</span><span class="p">:</span>
                <span class="n">subclasses</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">subclass</span> <span class="p">)</span>
                <span class="n">subclass</span><span class="o">.</span><span class="n">_trait_subclasses</span><span class="p">(</span> <span class="n">subclasses</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">subclasses</span>

    <span class="n">_trait_subclasses</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">_trait_subclasses</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Returns whether the object implements a specified traits interface:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.has_traits_interface"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.has_traits_interface">[docs]</a>    <span class="k">def</span> <span class="nf">has_traits_interface</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">interfaces</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns whether the object implements a specified traits interface.</span>

<span class="sd">           Parameters</span>
<span class="sd">           ----------</span>
<span class="sd">           *interfaces :</span>
<span class="sd">                One or more traits Interface (sub)classes.</span>

<span class="sd">           Description</span>
<span class="sd">           -----------</span>
<span class="sd">           Tests whether the object implements one or more of the interfaces</span>
<span class="sd">           specified by *interfaces*. Return **True** if it does, and **False**</span>
<span class="sd">           otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">issubclass</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__implements__</span><span class="p">,</span> <span class="n">interfaces</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Prepares an object to be pickled:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
    <span class="k">def</span> <span class="nf">__getstate__</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a dictionary of traits to pickle.</span>

<span class="sd">        In general, avoid overriding __getstate__ in subclasses. Instead, mark</span>
<span class="sd">        traits that should not be pickled with &#39;transient = True&#39; metadata.</span>

<span class="sd">        In cases where this strategy is not sufficient, override __getstate__</span>
<span class="sd">        in subclasses using the following pattern to remove items that should</span>
<span class="sd">        not be persisted::</span>

<span class="sd">            def __getstate__(self):</span>
<span class="sd">                state = super(X,self).__getstate__()</span>
<span class="sd">                for key in [&#39;foo&#39;, &#39;bar&#39;]:</span>
<span class="sd">                    if state.has_key(key):</span>
<span class="sd">                        del state[key]</span>
<span class="sd">                return state</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Save all traits which do not have any &#39;transient&#39; metadata:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_get</span><span class="p">(</span> <span class="n">transient</span> <span class="o">=</span> <span class="n">is_none</span> <span class="p">)</span>

        <span class="c"># Add all delegate traits that explicitly have &#39;transient = False&#39;</span>
        <span class="c"># metadata:</span>
        <span class="n">dic</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span>
        <span class="n">result</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="nb">dict</span><span class="p">(</span> <span class="p">[</span> <span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">dic</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="p">)</span>
                             <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_names</span><span class="p">(</span> <span class="nb">type</span> <span class="o">=</span> <span class="s">&#39;delegate&#39;</span><span class="p">,</span>
                                                           <span class="n">transient</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">)</span>
                             <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">dic</span> <span class="p">]</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c"># If this object implements ISerializable, make sure that all</span>
        <span class="c"># contained HasTraits objects in its persisted state also implement</span>
        <span class="c"># ISerializable:</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_traits_interface</span><span class="p">(</span> <span class="n">ISerializable</span> <span class="p">):</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">_is_serializable</span><span class="p">(</span> <span class="n">value</span> <span class="p">):</span>
                    <span class="k">raise</span> <span class="n">TraitError</span><span class="p">(</span> <span class="s">&quot;The &#39;</span><span class="si">%s</span><span class="s">&#39; trait of a &#39;</span><span class="si">%s</span><span class="s">&#39; instance &quot;</span>
                                      <span class="s">&quot;contains the unserializable value: </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span>
                                      <span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c"># Store the traits version in the state dictionary (if possible):</span>
        <span class="n">result</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="s">&#39;__traits_version__&#39;</span><span class="p">,</span> <span class="n">TraitsVersion</span> <span class="p">)</span>

        <span class="c"># Return the final state dictionary:</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">def</span> <span class="nf">__reduce_ex__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">protocol</span> <span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span> <span class="n">__newobj__</span><span class="p">,</span> <span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="p">,</span> <span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">__getstate__</span><span class="p">()</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Restores the previously pickled state of an object:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">__setstate__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">trait_change_notify</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Restores the previously pickled state of an object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">pop</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">pop</span>
        <span class="k">if</span> <span class="n">pop</span><span class="p">(</span> <span class="s">&#39;__traits_version__&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># If the state was saved by a version of Traits prior to 3.0, then</span>
            <span class="c"># use Traits 2.0 compatible code to restore it:</span>
            <span class="n">values</span> <span class="o">=</span> <span class="p">[</span> <span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">pop</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span> <span class="p">)</span>
                       <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">pop</span><span class="p">(</span> <span class="s">&#39;__HasTraits_restore__&#39;</span><span class="p">,</span> <span class="p">[]</span> <span class="p">)</span> <span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span> <span class="n">state</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trait_set</span><span class="p">(</span> <span class="n">trait_change_notify</span><span class="o">=</span><span class="n">trait_change_notify</span><span class="p">,</span>
                            <span class="o">**</span><span class="nb">dict</span><span class="p">(</span> <span class="n">values</span> <span class="p">)</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Otherwise, apply the Traits 3.0 restore logic:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_trait_listeners</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trait_set</span><span class="p">(</span> <span class="n">trait_change_notify</span> <span class="o">=</span> <span class="n">trait_change_notify</span><span class="p">,</span> <span class="o">**</span><span class="n">state</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_post_init_trait_listeners</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">traits_init</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">traits_inited</span><span class="p">(</span> <span class="bp">True</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Shortcut for retrieving the value of a list of traits:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.trait_get"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.trait_get">[docs]</a>    <span class="k">def</span> <span class="nf">trait_get</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">names</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Shortcut for getting object trait attributes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        names : list of strings</span>
<span class="sd">            A list of trait attribute names whose values are requested.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        result : dict</span>
<span class="sd">            A dictionary whose keys are the names passed as arguments and whose</span>
<span class="sd">            values are the corresponding trait values.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        Looks up the value of each trait whose name is passed as an argument</span>
<span class="sd">        and returns a dictionary containing the resulting name/value pairs.</span>
<span class="sd">        If any name does not correspond to a defined trait, it is not included</span>
<span class="sd">        in the result.</span>

<span class="sd">        If no names are specified, the result is a dictionary containing</span>
<span class="sd">        name/value pairs for *all* traits defined on the object.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">n</span>      <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">names</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span> <span class="ow">in</span> <span class="n">SequenceTypes</span><span class="p">):</span>
            <span class="n">names</span> <span class="o">=</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_names</span><span class="p">(</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="n">value</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">Missing</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Missing</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="c"># Defines the deprecated alias for &#39;trait_get&#39;</span></div>
    <span class="n">get</span> <span class="o">=</span> <span class="n">trait_get</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Shortcut for setting object traits:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.trait_set"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.trait_set">[docs]</a>    <span class="k">def</span> <span class="nf">trait_set</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait_change_notify</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="o">**</span><span class="n">traits</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Shortcut for setting object trait attributes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        trait_change_notify : bool</span>
<span class="sd">            If **True** (the default), then each value assigned may generate a</span>
<span class="sd">            trait change notification. If **False**, then no trait change</span>
<span class="sd">            notifications will be generated. (see also: trait_setq)</span>
<span class="sd">        **traits :</span>
<span class="sd">            Key/value pairs, the trait attributes and their values to be</span>
<span class="sd">            set</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self :</span>
<span class="sd">            The method returns this object, after setting attributes.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        Treats each keyword argument to the method as the name of a trait</span>
<span class="sd">        attribute and sets the corresponding trait attribute to the value</span>
<span class="sd">        specified. This is a useful shorthand when a number of trait attributes</span>
<span class="sd">        need to be set on an object, or a trait attribute value needs to be set</span>
<span class="sd">        in a lambda function. For example, you can write::</span>

<span class="sd">            person.trait_set(name=&#39;Bill&#39;, age=27)</span>

<span class="sd">        instead of::</span>

<span class="sd">            person.name = &#39;Bill&#39;</span>
<span class="sd">            person.age = 27</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">trait_change_notify</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_trait_change_notify</span><span class="p">(</span> <span class="bp">False</span> <span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">traits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="nb">setattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
            <span class="k">finally</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_trait_change_notify</span><span class="p">(</span> <span class="bp">True</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">traits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="nb">setattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

        <span class="k">return</span> <span class="bp">self</span>

    <span class="c"># Defines the deprecated alias for &#39;trait_set&#39;</span></div>
    <span class="nb">set</span> <span class="o">=</span> <span class="n">trait_set</span>

<div class="viewcode-block" id="HasTraits.trait_setq"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.trait_setq">[docs]</a>    <span class="k">def</span> <span class="nf">trait_setq</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">traits</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Shortcut for setting object trait attributes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **traits :</span>
<span class="sd">            Key/value pairs, the trait attributes and their values to be set.</span>
<span class="sd">            No trait change notifications will be generated for any values</span>
<span class="sd">            assigned (see also: trait_set).</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        self :</span>
<span class="sd">            The method returns this object, after setting attributes.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        Treats each keyword argument to the method as the name of a trait</span>
<span class="sd">        attribute and sets the corresponding trait attribute to the value</span>
<span class="sd">        specified. This is a useful shorthand when a number of trait attributes</span>
<span class="sd">        need to be set on an object, or a trait attribute value needs to be set</span>
<span class="sd">        in a lambda function. For example, you can write::</span>

<span class="sd">            person.trait_setq(name=&#39;Bill&#39;, age=27)</span>

<span class="sd">        instead of::</span>

<span class="sd">            person.name = &#39;Bill&#39;</span>
<span class="sd">            person.age = 27</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_set</span><span class="p">(</span> <span class="n">trait_change_notify</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">traits</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Resets some or all of an object&#39;s traits to their default values:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits.reset_traits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.reset_traits">[docs]</a>    <span class="k">def</span> <span class="nf">reset_traits</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">traits</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Resets some or all of an object&#39;s trait attributes to their default</span>
<span class="sd">        values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        traits : list of strings</span>
<span class="sd">            Names of trait attributes to reset.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        unresetable : list of strings</span>
<span class="sd">            A list of attributes that the method was unable to reset, which is</span>
<span class="sd">            empty if all the attributes were successfully reset.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        Resets each of the traits whose names are specified in the *traits*</span>
<span class="sd">        list to their default values. If *traits* is None or omitted, the</span>
<span class="sd">        method resets all explicitly-defined object trait attributes to their</span>
<span class="sd">        default values. Note that this does not affect wildcard trait</span>
<span class="sd">        attributes or trait attributes added via add_trait(), unless they are</span>
<span class="sd">        explicitly named in *traits*.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">unresetable</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="k">if</span> <span class="n">traits</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">traits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_names</span><span class="p">(</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">traits</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="nb">delattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span>
            <span class="k">except</span> <span class="p">(</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="n">TraitError</span> <span class="p">):</span>
                <span class="n">unresetable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">unresetable</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Returns the list of trait names to copy/clone by default:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits.copyable_trait_names"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.copyable_trait_names">[docs]</a>    <span class="k">def</span> <span class="nf">copyable_trait_names</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the list of trait names to copy or clone by default.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">metadata</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="s">&#39;transient&#39;</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">t</span><span class="p">:</span> <span class="n">t</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_names</span><span class="p">(</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Returns the list of all trait names, including implicitly defined</span>
    <span class="c">#  traits:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits.all_trait_names"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.all_trait_names">[docs]</a>    <span class="k">def</span> <span class="nf">all_trait_names</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the list of all trait names, including implicitly defined</span>
<span class="sd">            traits.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class_traits__</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Copies another object&#39;s traits into this one:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits.copy_traits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.copy_traits">[docs]</a>    <span class="k">def</span> <span class="nf">copy_traits</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">traits</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">memo</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">metadata</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Copies another object&#39;s trait attributes into this one.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        other : object</span>
<span class="sd">            The object whose trait attribute values should be copied.</span>
<span class="sd">        traits : list of strings</span>
<span class="sd">            A list of names of trait attributes to copy. If None or</span>
<span class="sd">            unspecified, the set of names returned by trait_names() is used.</span>
<span class="sd">            If &#39;all&#39; or an empty list, the set of names returned by</span>
<span class="sd">            all_trait_names() is used.</span>
<span class="sd">        memo : dict</span>
<span class="sd">            A dictionary of objects that have already been copied.</span>
<span class="sd">        copy : None | &#39;deep&#39; | &#39;shallow&#39;</span>
<span class="sd">            The type of copy to perform on any trait that does not have</span>
<span class="sd">            explicit &#39;copy&#39; metadata. A value of None means &#39;copy reference&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        unassignable : list of strings</span>
<span class="sd">            A list of attributes that the method was unable to copy, which is</span>
<span class="sd">            empty if all the attributes were successfully copied.</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">traits</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">traits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copyable_trait_names</span><span class="p">(</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">traits</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">traits</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">traits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_trait_names</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">memo</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">memo</span><span class="p">[</span> <span class="s">&#39;traits_to_copy&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="s">&#39;all&#39;</span>

        <span class="n">unassignable</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">deferred</span>     <span class="o">=</span> <span class="p">[]</span>
        <span class="n">deep_copy</span>    <span class="o">=</span> <span class="p">(</span><span class="n">copy</span> <span class="o">==</span> <span class="s">&#39;deep&#39;</span><span class="p">)</span>
        <span class="n">shallow_copy</span> <span class="o">=</span> <span class="p">(</span><span class="n">copy</span> <span class="o">==</span> <span class="s">&#39;shallow&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">traits</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">trait</span><span class="o">.</span><span class="n">type</span> <span class="ow">in</span> <span class="n">DeferredCopy</span><span class="p">:</span>
                    <span class="n">deferred</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
                    <span class="k">continue</span>

                <span class="n">base_trait</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">base_trait</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">base_trait</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#39;event&#39;</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">value</span>     <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">other</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span>
                <span class="n">copy_type</span> <span class="o">=</span> <span class="n">base_trait</span><span class="o">.</span><span class="n">copy</span>
                <span class="k">if</span> <span class="n">copy_type</span> <span class="o">==</span> <span class="s">&#39;shallow&#39;</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">copy_module</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
                <span class="k">elif</span> <span class="n">copy_type</span> <span class="o">==</span> <span class="s">&#39;ref&#39;</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">copy_type</span> <span class="o">==</span> <span class="s">&#39;deep&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">deep_copy</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">memo</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">copy_module</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">copy_module</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="n">memo</span> <span class="p">)</span>
                <span class="k">elif</span> <span class="n">shallow_copy</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">copy_module</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>

                <span class="nb">setattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">unassignable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">deferred</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span>     <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">other</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span>
                <span class="n">copy_type</span> <span class="o">=</span> <span class="n">other</span><span class="o">.</span><span class="n">base_trait</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span><span class="o">.</span><span class="n">copy</span>
                <span class="k">if</span> <span class="n">copy_type</span> <span class="o">==</span> <span class="s">&#39;shallow&#39;</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">copy_module</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
                <span class="k">elif</span> <span class="n">copy_type</span> <span class="o">==</span> <span class="s">&#39;ref&#39;</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="k">elif</span> <span class="p">(</span><span class="n">copy_type</span> <span class="o">==</span> <span class="s">&#39;deep&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">deep_copy</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">memo</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">copy_module</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">value</span> <span class="o">=</span> <span class="n">copy_module</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span> <span class="n">value</span><span class="p">,</span> <span class="n">memo</span> <span class="p">)</span>
                <span class="k">elif</span> <span class="n">shallow_copy</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="n">copy_module</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span>

                <span class="nb">setattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">unassignable</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">unassignable</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Clones a new object from this one, optionally copying only a specified</span>
    <span class="c">#  set of traits:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits.clone_traits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.clone_traits">[docs]</a>    <span class="k">def</span> <span class="nf">clone_traits</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">traits</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">memo</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">metadata</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Clones a new object from this one, optionally copying only a</span>
<span class="sd">        specified set of traits.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        traits : list of strings</span>
<span class="sd">            The list of names of the trait attributes to copy.</span>
<span class="sd">        memo : dict</span>
<span class="sd">            A dictionary of objects that have already been copied.</span>
<span class="sd">        copy : str</span>
<span class="sd">            The type of copy ``deep`` or ``shallow`` to perform on any trait</span>
<span class="sd">            that does not have explicit &#39;copy&#39; metadata. A value of None means</span>
<span class="sd">            &#39;copy reference&#39;.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        new :</span>
<span class="sd">            The newly cloned object.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        Creates a new object that is a clone of the current object. If *traits*</span>
<span class="sd">        is None (the default), then all explicit trait attributes defined</span>
<span class="sd">        for this object are cloned. If *traits* is &#39;all&#39; or an empty list, the</span>
<span class="sd">        list of traits returned by all_trait_names() is used; otherwise,</span>
<span class="sd">        *traits* must be a list of the names of the trait attributes to be</span>
<span class="sd">        cloned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">memo</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">memo</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">if</span> <span class="n">traits</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">traits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">copyable_trait_names</span><span class="p">(</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">)</span>
        <span class="k">elif</span> <span class="p">(</span><span class="n">traits</span> <span class="o">==</span> <span class="s">&#39;all&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span> <span class="n">traits</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">traits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">all_trait_names</span><span class="p">()</span>
            <span class="n">memo</span><span class="p">[</span> <span class="s">&#39;traits_to_copy&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="s">&#39;all&#39;</span>

        <span class="n">memo</span><span class="p">[</span> <span class="s">&#39;traits_copy_mode&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">copy</span>
        <span class="n">new</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span> <span class="p">)</span>
        <span class="n">memo</span><span class="p">[</span> <span class="nb">id</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span> <span class="p">]</span> <span class="o">=</span> <span class="n">new</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_init_trait_listeners</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">copy_traits</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">traits</span><span class="p">,</span> <span class="n">memo</span><span class="p">,</span> <span class="n">copy</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">)</span>
        <span class="n">new</span><span class="o">.</span><span class="n">_post_init_trait_listeners</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">traits_init</span><span class="p">()</span>
        <span class="n">new</span><span class="o">.</span><span class="n">traits_inited</span><span class="p">(</span> <span class="bp">True</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">new</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Creates a deep copy of the object:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
    <span class="k">def</span> <span class="nf">__deepcopy__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">memo</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Creates a deep copy of the object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">id_self</span> <span class="o">=</span> <span class="nb">id</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">id_self</span> <span class="ow">in</span> <span class="n">memo</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">memo</span><span class="p">[</span> <span class="n">id_self</span> <span class="p">]</span>

        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">clone_traits</span><span class="p">(</span> <span class="n">memo</span>   <span class="o">=</span> <span class="n">memo</span><span class="p">,</span>
                                    <span class="n">traits</span> <span class="o">=</span> <span class="n">memo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s">&#39;traits_to_copy&#39;</span> <span class="p">),</span>
                                    <span class="n">copy</span>   <span class="o">=</span> <span class="n">memo</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s">&#39;traits_copy_mode&#39;</span> <span class="p">)</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Edits the object&#39;s traits:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.edit_traits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.edit_traits">[docs]</a>    <span class="k">def</span> <span class="nf">edit_traits</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">view</span>       <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">parent</span>  <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                            <span class="n">kind</span>       <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">context</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                            <span class="n">handler</span>    <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="nb">id</span>      <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
                            <span class="n">scrollable</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Displays a user interface window for editing trait attribute values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        view : View or string</span>
<span class="sd">            A View object (or its name) that defines a user interface for</span>
<span class="sd">            editing trait attribute values of the current object. If the view is</span>
<span class="sd">            defined as an attribute on this class, use the name of the attribute.</span>
<span class="sd">            Otherwise, use a reference to the view object. If this attribute is</span>
<span class="sd">            not specified, the View object returned by trait_view() is used.</span>
<span class="sd">        parent : toolkit control</span>
<span class="sd">            The reference to a user interface component to use as the parent</span>
<span class="sd">            window for the object&#39;s UI window.</span>
<span class="sd">        kind : str</span>
<span class="sd">            The type of user interface window to create. See the</span>
<span class="sd">            **traitsui.view.kind_trait** trait for values and</span>
<span class="sd">            their meanings. If *kind* is unspecified or None, the **kind**</span>
<span class="sd">            attribute of the View object is used.</span>
<span class="sd">        context : object or dictionary</span>
<span class="sd">            A single object or a dictionary of string/object pairs, whose trait</span>
<span class="sd">            attributes are to be edited. If not specified, the current object is</span>
<span class="sd">            used.</span>
<span class="sd">        handler : Handler</span>
<span class="sd">            A handler object used for event handling in the dialog box. If</span>
<span class="sd">            None, the default handler for Traits UI is used.</span>
<span class="sd">        id : str</span>
<span class="sd">            A unique ID for persisting preferences about this user interface,</span>
<span class="sd">            such as size and position. If not specified, no user preferences</span>
<span class="sd">            are saved.</span>
<span class="sd">        scrollable : bool</span>
<span class="sd">            Indicates whether the dialog box should be scrollable. When set to</span>
<span class="sd">            True, scroll bars appear on the dialog box if it is not large enough</span>
<span class="sd">            to display all of the items in the view at one time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span>

        <span class="n">view</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_view</span><span class="p">(</span> <span class="n">view</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">view</span><span class="o">.</span><span class="n">ui</span><span class="p">(</span> <span class="n">context</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_view_elements</span><span class="p">(),</span>
                        <span class="n">handler</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">scrollable</span><span class="p">,</span> <span class="n">args</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Returns the default context to use for editing/configuring traits:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits.trait_context"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.trait_context">[docs]</a>    <span class="k">def</span> <span class="nf">trait_context</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the default context to use for editing or configuring</span>
<span class="sd">            traits.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">{</span> <span class="s">&#39;object&#39;</span><span class="p">:</span> <span class="bp">self</span> <span class="p">}</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Gets or sets a ViewElement associated with an object&#39;s class:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits.trait_view"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.trait_view">[docs]</a>    <span class="k">def</span> <span class="nf">trait_view</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">view_element</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets or sets a ViewElement associated with an object&#39;s class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of a view element</span>
<span class="sd">        view_element : ViewElement</span>
<span class="sd">            View element to associate</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A view element.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        If both *name* and *view_element* are specified, the view element is</span>
<span class="sd">        associated with *name* for the current object&#39;s class. (That is,</span>
<span class="sd">        *view_element* is added to the ViewElements object associated with</span>
<span class="sd">        the current object&#39;s class, indexed by *name*.)</span>

<span class="sd">        If only *name* is specified, the function returns the view element</span>
<span class="sd">        object associated with *name*, or None if *name* has no associated</span>
<span class="sd">        view element. View elements retrieved by this function are those that</span>
<span class="sd">        are bound to a class attribute in the class definition, or that are</span>
<span class="sd">        associated with a name by a previous call to this method.</span>

<span class="sd">        If neither *name* nor *view_element* is specified, the method returns a</span>
<span class="sd">        View object, based on the following order of preference:</span>

<span class="sd">        1. If there is a View object named ``traits_view`` associated with the</span>
<span class="sd">           current object, it is returned.</span>
<span class="sd">        2. If there is exactly one View object associated the current</span>
<span class="sd">           object, it is returned.</span>
<span class="sd">        3. Otherwise, it returns a View object containing items for all the</span>
<span class="sd">           non-event trait attributes on the current object.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">_trait_view</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">view_element</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">default_traits_view</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_view_elements</span><span class="p">,</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">editable_traits</span><span class="p">,</span> <span class="bp">self</span> <span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">class_trait_view</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">view_element</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_trait_view</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">view_element</span><span class="p">,</span>
                  <span class="n">cls</span><span class="o">.</span><span class="n">class_default_traits_view</span><span class="p">,</span> <span class="n">cls</span><span class="o">.</span><span class="n">class_trait_view_elements</span><span class="p">,</span>
                  <span class="n">cls</span><span class="o">.</span><span class="n">class_editable_traits</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>

    <span class="n">class_trait_view</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">class_trait_view</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Gets or sets a ViewElement associated with an object&#39;s class:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_trait_view</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">view_element</span><span class="p">,</span> <span class="n">default_name</span><span class="p">,</span> <span class="n">view_elements</span><span class="p">,</span>
                           <span class="n">editable_traits</span><span class="p">,</span> <span class="n">handler</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Gets or sets a ViewElement associated with an object&#39;s class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># If a view element was passed instead of a name or None, return it:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">ViewElement</span> <span class="p">):</span>
            <span class="k">return</span> <span class="n">name</span>

        <span class="c"># Get the ViewElements object associated with the class:</span>
        <span class="n">view_elements</span> <span class="o">=</span> <span class="n">view_elements</span><span class="p">()</span>

        <span class="c"># The following test should only succeed for objects created before</span>
        <span class="c"># traits has been fully initialized (such as the default Handler):</span>
        <span class="k">if</span> <span class="n">view_elements</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">None</span>

        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">view_element</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c"># If only a name was specified, return the ViewElement it</span>
                <span class="c"># matches, if any:</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">view_elements</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                    <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">handler</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
                    <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span> <span class="n">method</span> <span class="p">):</span>
                        <span class="n">result</span> <span class="o">=</span> <span class="n">method</span><span class="p">()</span>

                <span class="k">return</span> <span class="n">result</span>

            <span class="c"># Otherwise, save the specified ViewElement under the name</span>
            <span class="c"># specified:</span>
            <span class="n">view_elements</span><span class="o">.</span><span class="n">content</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">view_element</span>

            <span class="k">return</span> <span class="bp">None</span>

        <span class="c"># Get the default view/view name:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">default_name</span><span class="p">()</span>

        <span class="c"># If the default is a View, return it:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">ViewElement</span> <span class="p">):</span>
            <span class="k">return</span> <span class="n">name</span>

        <span class="c"># Otherwise, get all View objects associated with the object&#39;s class:</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">view_elements</span><span class="o">.</span><span class="n">filter_by</span><span class="p">()</span>

        <span class="c"># If the specified default name is in the list, return its View:</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">view_elements</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>

        <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">handler</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
            <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span> <span class="n">method</span> <span class="p">):</span>
                <span class="n">result</span> <span class="o">=</span> <span class="n">method</span><span class="p">()</span>
                <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">result</span><span class="p">,</span> <span class="n">ViewElement</span> <span class="p">):</span>
                    <span class="k">return</span> <span class="n">result</span>

        <span class="c"># If there is only one View, return it:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">names</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">view_elements</span><span class="o">.</span><span class="n">find</span><span class="p">(</span> <span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>

        <span class="c"># Otherwise, create and return a View based on the set of editable</span>
        <span class="c"># traits defined for the object:</span>
        <span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">View</span>

        <span class="k">return</span> <span class="n">View</span><span class="p">(</span> <span class="n">editable_traits</span><span class="p">(),</span> <span class="n">buttons</span> <span class="o">=</span> <span class="p">[</span> <span class="s">&#39;OK&#39;</span><span class="p">,</span> <span class="s">&#39;Cancel&#39;</span> <span class="p">]</span> <span class="p">)</span>

    <span class="n">_trait_view</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">_trait_view</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Return the default traits view/name:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.default_traits_view"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.default_traits_view">[docs]</a>    <span class="k">def</span> <span class="nf">default_traits_view</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the name of the default traits view for the object&#39;s class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">class_default_traits_view</span><span class="p">()</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Return the default traits view/name:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits.class_default_traits_view"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.class_default_traits_view">[docs]</a>    <span class="k">def</span> <span class="nf">class_default_traits_view</span> <span class="p">(</span> <span class="n">cls</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the name of the default traits view for the class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">DefaultTraitsView</span>
</div>
    <span class="n">class_default_traits_view</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">class_default_traits_view</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Gets the list of names of ViewElements associated with the object&#39;s</span>
    <span class="c">#  class that are of a specified ViewElement type:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.trait_views"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.trait_views">[docs]</a>    <span class="k">def</span> <span class="nf">trait_views</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">klass</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a list of the names of all view elements associated with the</span>
<span class="sd">        current object&#39;s class.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        klass : class</span>
<span class="sd">            A class, such that all returned names must correspond to instances</span>
<span class="sd">            of this class. Possible values include:</span>

<span class="sd">            * Group</span>
<span class="sd">            * Item</span>
<span class="sd">            * View</span>
<span class="sd">            * ViewElement</span>
<span class="sd">            * ViewSubElement</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        If *klass* is specified, the list of names is filtered such that only</span>
<span class="sd">        objects that are instances of the specified class are returned.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span> <span class="n">ViewTraits</span> <span class="p">]</span><span class="o">.</span><span class="n">filter_by</span><span class="p">(</span> <span class="n">klass</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Returns the ViewElements object associated with the object&#39;s class:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits.trait_view_elements"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.trait_view_elements">[docs]</a>    <span class="k">def</span> <span class="nf">trait_view_elements</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the ViewElements object associated with the object&#39;s</span>
<span class="sd">        class.</span>

<span class="sd">        The returned object can be used to access all the view elements</span>
<span class="sd">        associated with the class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">class_trait_view_elements</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="HasTraits.class_trait_view_elements"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.class_trait_view_elements">[docs]</a>    <span class="k">def</span> <span class="nf">class_trait_view_elements</span> <span class="p">(</span> <span class="n">cls</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the ViewElements object associated with the class.</span>

<span class="sd">        The returned object can be used to access all the view elements</span>
<span class="sd">        associated with the class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span> <span class="n">ViewTraits</span> <span class="p">]</span>
</div>
    <span class="n">class_trait_view_elements</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">class_trait_view_elements</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Configure the object&#39;s traits:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.configure_traits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.configure_traits">[docs]</a>    <span class="k">def</span> <span class="nf">configure_traits</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">view</span>       <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                                 <span class="n">kind</span>     <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">edit</span>       <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                                 <span class="n">context</span>  <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">handler</span>    <span class="o">=</span> <span class="bp">None</span><span class="p">,</span>
                                 <span class="nb">id</span>       <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span>   <span class="n">scrollable</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">args</span> <span class="p">):</span>
        <span class="c">### JMS: Is it correct to assume that non-modal options for &#39;kind&#39;</span>
        <span class="c">###      behave modally when called from this method?</span>
        <span class="sd">&quot;&quot;&quot;Creates and displays a dialog box for editing values of trait</span>
<span class="sd">        attributes, as if it were a complete, self-contained GUI application.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : str</span>
<span class="sd">            The name (including path) of a file that contains a pickled</span>
<span class="sd">            representation of the current object. When this parameter is</span>
<span class="sd">            specified, the method reads the corresponding file (if it exists)</span>
<span class="sd">            to restore the saved values of the object&#39;s traits before displaying</span>
<span class="sd">            them. If the user confirms the dialog box (by clicking **OK**),</span>
<span class="sd">            the new values are written to the file. If this parameter is not</span>
<span class="sd">            specified, the values are loaded from the in-memory object, and are</span>
<span class="sd">            not persisted when the dialog box is closed.</span>
<span class="sd">        view : View or str</span>
<span class="sd">            A View object (or its name) that defines a user interface for</span>
<span class="sd">            editing trait attribute values of the current object. If the view is</span>
<span class="sd">            defined as an attribute on this class, use the name of the attribute.</span>
<span class="sd">            Otherwise, use a reference to the view object. If this attribute is</span>
<span class="sd">            not specified, the View object returned by trait_view() is used.</span>
<span class="sd">        kind : str</span>
<span class="sd">            The type of user interface window to create. See the</span>
<span class="sd">            **traitsui.view.kind_trait** trait for values and</span>
<span class="sd">            their meanings. If *kind* is unspecified or None, the **kind**</span>
<span class="sd">            attribute of the View object is used.</span>
<span class="sd">        edit : bool</span>
<span class="sd">            Indicates whether to display a user interface. If *filename*</span>
<span class="sd">            specifies an existing file, setting *edit* to False loads the</span>
<span class="sd">            saved values from that file into the object without requiring</span>
<span class="sd">            user interaction.</span>
<span class="sd">        context : object or dictionary</span>
<span class="sd">            A single object or a dictionary of string/object pairs, whose trait</span>
<span class="sd">            attributes are to be edited. If not specified, the current object is</span>
<span class="sd">            used</span>
<span class="sd">        handler : Handler</span>
<span class="sd">            A handler object used for event handling in the dialog box. If</span>
<span class="sd">            None, the default handler for Traits UI is used.</span>
<span class="sd">        id : str</span>
<span class="sd">            A unique ID for persisting preferences about this user interface,</span>
<span class="sd">            such as size and position. If not specified, no user preferences</span>
<span class="sd">            are saved.</span>
<span class="sd">        scrollable : bool</span>
<span class="sd">            Indicates whether the dialog box should be scrollable. When set to</span>
<span class="sd">            True, scroll bars appear on the dialog box if it is not large enough</span>
<span class="sd">            to display all of the items in the view at one time.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        This method is intended for use in applications that do not normally</span>
<span class="sd">        have a GUI. Control does not resume in the calling application until</span>
<span class="sd">        the user closes the dialog box.</span>

<span class="sd">        The method attempts to open and unpickle the contents of *filename*</span>
<span class="sd">        before displaying the dialog box. When editing is complete, the method</span>
<span class="sd">        attempts to pickle the updated contents of the object back to *filename*.</span>
<span class="sd">        If the file referenced by *filename* does not exist, the object is not</span>
<span class="sd">        modified before displaying the dialog box. If *filename* is unspecified</span>
<span class="sd">        or None, no pickling or unpickling occurs.</span>

<span class="sd">        If *edit* is True (the default), a dialog box for editing the</span>
<span class="sd">        current object is displayed. If *edit* is False or None, no</span>
<span class="sd">        dialog box is displayed. You can use ``edit=False`` if you want the</span>
<span class="sd">        object to be restored from the contents of *filename*, without being</span>
<span class="sd">        modified by the user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fd</span> <span class="o">=</span> <span class="bp">None</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="kn">import</span> <span class="nn">cPickle</span>
                <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span> <span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">copy_traits</span><span class="p">(</span> <span class="n">cPickle</span><span class="o">.</span><span class="n">Unpickler</span><span class="p">(</span> <span class="n">fd</span> <span class="p">)</span><span class="o">.</span><span class="n">load</span><span class="p">()</span> <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">fd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">edit</span><span class="p">:</span>
            <span class="kn">from</span> <span class="nn">traitsui.api</span> <span class="kn">import</span> <span class="n">toolkit</span>
            <span class="k">if</span> <span class="n">context</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">context</span> <span class="o">=</span> <span class="bp">self</span>
            <span class="n">rc</span> <span class="o">=</span> <span class="n">toolkit</span><span class="p">()</span><span class="o">.</span><span class="n">view_application</span><span class="p">(</span> <span class="n">context</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_view</span><span class="p">(</span> <span class="n">view</span> <span class="p">),</span>
                                           <span class="n">kind</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="nb">id</span><span class="p">,</span> <span class="n">scrollable</span><span class="p">,</span> <span class="n">args</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">rc</span> <span class="ow">and</span> <span class="p">(</span><span class="n">filename</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">):</span>
                <span class="n">fd</span> <span class="o">=</span> <span class="bp">None</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="kn">import</span> <span class="nn">cPickle</span>
                    <span class="n">fd</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span> <span class="n">filename</span><span class="p">,</span> <span class="s">&#39;wb&#39;</span> <span class="p">)</span>
                    <span class="n">cPickle</span><span class="o">.</span><span class="n">Pickler</span><span class="p">(</span> <span class="n">fd</span><span class="p">,</span> <span class="bp">True</span> <span class="p">)</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
                <span class="k">finally</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">fd</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                        <span class="n">fd</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">return</span> <span class="n">rc</span>

        <span class="k">return</span> <span class="bp">True</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Return the list of editable traits:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits.editable_traits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.editable_traits">[docs]</a>    <span class="k">def</span> <span class="nf">editable_traits</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an alphabetically sorted list of the names of non-event</span>
<span class="sd">        trait attributes associated with the current object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_names</span><span class="p">(</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">not_event</span><span class="p">,</span> <span class="n">editable</span> <span class="o">=</span> <span class="n">not_false</span> <span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">names</span>
</div>
<div class="viewcode-block" id="HasTraits.class_editable_traits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.class_editable_traits">[docs]</a>    <span class="k">def</span> <span class="nf">class_editable_traits</span> <span class="p">(</span> <span class="n">cls</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns an alphabetically sorted list of the names of non-event</span>
<span class="sd">        trait attributes associated with the current class.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">class_trait_names</span><span class="p">(</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">not_event</span><span class="p">,</span> <span class="n">editable</span> <span class="o">=</span> <span class="n">not_false</span> <span class="p">)</span>
        <span class="n">names</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">names</span>
</div>
    <span class="n">class_editable_traits</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">class_editable_traits</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Pretty print the traits of an object:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.print_traits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.print_traits">[docs]</a>    <span class="k">def</span> <span class="nf">print_traits</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">show_help</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Prints the values of all explicitly-defined, non-event trait</span>
<span class="sd">        attributes on the current object, in an easily readable format.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        show_help : bool</span>
<span class="sd">            Indicates whether to display additional descriptive information.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">metadata</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_names</span><span class="p">(</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait_names</span><span class="p">(</span> <span class="nb">type</span> <span class="o">=</span> <span class="n">not_event</span> <span class="p">)</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">names</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">print</span> <span class="s">&#39;&#39;</span>
            <span class="k">return</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">pad</span>    <span class="o">=</span> <span class="nb">max</span><span class="p">(</span> <span class="p">[</span> <span class="nb">len</span><span class="p">(</span> <span class="n">x</span> <span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">names</span> <span class="p">]</span> <span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">maxval</span> <span class="o">=</span> <span class="mi">78</span> <span class="o">-</span> <span class="n">pad</span>
        <span class="n">names</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>

        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">names</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="nb">repr</span><span class="p">(</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span> <span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\\</span><span class="s">n&#39;</span> <span class="p">)</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">value</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="n">maxval</span><span class="p">:</span>
                    <span class="n">value</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">...</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">value</span><span class="p">[:</span> <span class="p">(</span><span class="n">maxval</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="p">],</span>
                                          <span class="n">value</span><span class="p">[</span> <span class="o">-</span><span class="p">((</span><span class="n">maxval</span> <span class="o">-</span> <span class="mi">3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">):</span> <span class="p">]</span> <span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">value</span> <span class="o">=</span> <span class="s">&#39;&lt;undefined&gt;&#39;</span>
            <span class="n">lname</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span> <span class="o">+</span> <span class="s">&#39;:&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span> <span class="n">pad</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">show_help</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="se">\n</span><span class="s">   The value must be </span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="p">(</span>
                       <span class="n">lname</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_trait</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span><span class="o">.</span><span class="n">setter</span><span class="o">.</span><span class="n">info</span><span class="p">()</span> <span class="p">)</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s"> </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">lname</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span> <span class="p">)</span>

        <span class="k">print</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span> <span class="n">result</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Add/Remove a handler for a specified trait being changed:</span>
    <span class="c">#</span>
    <span class="c">#  If no name is specified, the handler will be invoked for any trait</span>
    <span class="c">#  change.</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
    <span class="k">def</span> <span class="nf">_on_trait_change</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">remove</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                                 <span class="n">dispatch</span> <span class="o">=</span> <span class="s">&#39;same&#39;</span><span class="p">,</span> <span class="n">priority</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                                 <span class="n">target</span> <span class="o">=</span> <span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Causes the object to invoke a handler whenever a trait attribute</span>
<span class="sd">        is modified, or removes the association.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        handler : function</span>
<span class="sd">            A trait notification function for the attribute specified by *name*.</span>
<span class="sd">        name : str</span>
<span class="sd">            Specifies the trait attribute whose value changes trigger the</span>
<span class="sd">            notification.</span>
<span class="sd">        remove : bool</span>
<span class="sd">            If True, removes the previously-set association between</span>
<span class="sd">            *handler* and *name*; if False (the default), creates the</span>
<span class="sd">            association.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        Multiple handlers can be defined for the same object, or even for the</span>
<span class="sd">        same trait attribute on the same object. If *name* is not specified or</span>
<span class="sd">        is None, *handler* is invoked when any trait attribute on the</span>
<span class="sd">        object is changed.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span> <span class="ow">is</span> <span class="nb">list</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name_i</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_on_trait_change</span><span class="p">(</span> <span class="n">handler</span><span class="p">,</span> <span class="n">name_i</span><span class="p">,</span> <span class="n">remove</span><span class="p">,</span> <span class="n">dispatch</span><span class="p">,</span>
                                       <span class="n">priority</span><span class="p">,</span> <span class="n">target</span> <span class="p">)</span>

            <span class="k">return</span>

        <span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="ow">or</span> <span class="s">&#39;anytrait&#39;</span>

        <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;anytrait&#39;</span><span class="p">:</span>
                <span class="n">notifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notifiers</span><span class="p">(</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="mi">1</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">return</span>
                <span class="n">notifiers</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">_notifiers</span><span class="p">(</span> <span class="mi">0</span> <span class="p">)</span>

            <span class="k">if</span> <span class="n">notifiers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">notifier</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">notifiers</span> <span class="p">):</span>
                    <span class="k">if</span> <span class="n">notifier</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span> <span class="n">handler</span> <span class="p">):</span>
                        <span class="k">del</span> <span class="n">notifiers</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                        <span class="n">notifier</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>
                        <span class="k">break</span>

            <span class="k">return</span>

        <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;anytrait&#39;</span><span class="p">:</span>
            <span class="n">notifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notifiers</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">notifiers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="mi">2</span> <span class="p">)</span><span class="o">.</span><span class="n">_notifiers</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">notifier</span> <span class="ow">in</span> <span class="n">notifiers</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">notifier</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span> <span class="n">handler</span> <span class="p">):</span>
                <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">wrapper</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">wrappers</span><span class="p">[</span> <span class="n">dispatch</span> <span class="p">](</span> <span class="n">handler</span><span class="p">,</span> <span class="n">notifiers</span><span class="p">,</span> <span class="n">target</span> <span class="p">)</span>

            <span class="k">if</span> <span class="n">priority</span><span class="p">:</span>
                <span class="n">notifiers</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span> <span class="mi">0</span><span class="p">,</span> <span class="n">wrapper</span> <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">notifiers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">wrapper</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Add/Remove handlers for an extended set of one or more traits being</span>
    <span class="c">#  changed:</span>
    <span class="c">#</span>
    <span class="c">#  If no name is specified, the handler will be invoked for any trait</span>
    <span class="c">#  change.</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.on_trait_change"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.on_trait_change">[docs]</a>    <span class="k">def</span> <span class="nf">on_trait_change</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">handler</span><span class="p">,</span> <span class="n">name</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">remove</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                                <span class="n">dispatch</span> <span class="o">=</span> <span class="s">&#39;same&#39;</span><span class="p">,</span> <span class="n">priority</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span>
                                <span class="n">deferred</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="bp">None</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Causes the object to invoke a handler whenever a trait attribute</span>
<span class="sd">        matching a specified pattern is modified, or removes the association.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        handler : function</span>
<span class="sd">            A trait notification function for the *name* trait attribute, with</span>
<span class="sd">            one of the signatures described below.</span>
<span class="sd">        name : str</span>
<span class="sd">            The name of the trait attribute whose value changes trigger the</span>
<span class="sd">            notification. The *name* can specify complex patterns of trait</span>
<span class="sd">            changes using an extended *name* syntax, which is described below.</span>
<span class="sd">        remove : bool</span>
<span class="sd">            If True, removes the previously-set association between</span>
<span class="sd">            *handler* and *name*; if False (the default), creates the</span>
<span class="sd">            association.</span>
<span class="sd">        dispatch : str</span>
<span class="sd">            A string indicating the thread on which notifications must be run.</span>
<span class="sd">            Possible values are:</span>

<span class="sd">            =========== =======================================================</span>
<span class="sd">            value       dispatch</span>
<span class="sd">            =========== =======================================================</span>
<span class="sd">            ``same``    Run notifications on the same thread as this one.</span>
<span class="sd">            ``ui``      Run notifications on the UI thread, and allow them to</span>
<span class="sd">                        be queued and deferred.</span>
<span class="sd">            ``fast_ui`` Run notifications on the UI thread, and process</span>
<span class="sd">                        them immediately.</span>
<span class="sd">            ``new``     Run notifications in a new thread.</span>
<span class="sd">            =========== =======================================================</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        Multiple handlers can be defined for the same object, or even for the</span>
<span class="sd">        same trait attribute on the same object. If *name* is not specified or</span>
<span class="sd">        is None, *handler* is invoked when any trait attribute on the</span>
<span class="sd">        object is changed.</span>

<span class="sd">        The *name* parameter is a single *xname* or a list of *xname* names,</span>
<span class="sd">        where an *xname* is an extended name of the form::</span>

<span class="sd">            xname2[(&#39;.&#39;|&#39;:&#39;) xname2]*</span>

<span class="sd">        An *xname2* is of the form::</span>

<span class="sd">            ( xname3 | &#39;[&#39;xname3[&#39;,&#39;xname3]*&#39;]&#39; ) [&#39;*&#39;]</span>

<span class="sd">        An *xname3* is of the form::</span>

<span class="sd">             xname | [&#39;+&#39;|&#39;-&#39;][name] | name[&#39;?&#39; | (&#39;+&#39;|&#39;-&#39;)[name]]</span>

<span class="sd">        A *name* is any valid Python attribute name. The semantic meaning of</span>
<span class="sd">        this notation is as follows:</span>

<span class="sd">        ================================ ======================================</span>
<span class="sd">        expression                       meaning</span>
<span class="sd">        ================================ ======================================</span>
<span class="sd">        ``item1.item2``                  means *item1* is a trait containing an</span>
<span class="sd">                                         object (or objects if *item1* is a</span>
<span class="sd">                                         list or dict) with a trait called</span>
<span class="sd">                                         *item2*. Changes to either *item1* or</span>
<span class="sd">                                         *item2* cause a notification to be</span>
<span class="sd">                                         generated.</span>
<span class="sd">        ``item1:item2``                  means *item1* is a trait containing an</span>
<span class="sd">                                         object (or objects if *item1* is a</span>
<span class="sd">                                         list or dict) with a trait called</span>
<span class="sd">                                         *item2*. Changes to *item2* cause a</span>
<span class="sd">                                         notification to be generated, while</span>
<span class="sd">                                         changes to *item1* do not (i.e., the</span>
<span class="sd">                                         &#39;:&#39; indicates that changes to the</span>
<span class="sd">                                         *link* object should not be reported).</span>
<span class="sd">        ``[ item1, item2, ..., itemN ]`` A list which matches any of the</span>
<span class="sd">                                         specified items. Note that at the</span>
<span class="sd">                                         topmost level, the surrounding square</span>
<span class="sd">                                         brackets are optional.</span>
<span class="sd">        ``name?``                        If the current object does not have an</span>
<span class="sd">                                         attribute called *name*, the reference</span>
<span class="sd">                                         can be ignored. If the &#39;?&#39; character</span>
<span class="sd">                                         is omitted, the current object must</span>
<span class="sd">                                         have a trait called *name*, otherwise</span>
<span class="sd">                                         an exception will be raised.</span>
<span class="sd">        ``prefix+``                      Matches any trait on the object whose</span>
<span class="sd">                                         name begins with *prefix*.</span>
<span class="sd">        ``+metadata_name``               Matches any trait on the object having</span>
<span class="sd">                                         *metadata_name* metadata.</span>
<span class="sd">        ``-metadata_name``               Matches any trait on the object which</span>
<span class="sd">                                         does not have *metadata_name*</span>
<span class="sd">                                         metadata.</span>
<span class="sd">        ``prefix+metadata_name``         Matches any trait on the object whose</span>
<span class="sd">                                         name begins with *prefix* and which</span>
<span class="sd">                                         has *metadata_name* metadata.</span>
<span class="sd">        ``prefix-metadata_name``         Matches any trait on the object</span>
<span class="sd">                                         whose name begins with *prefix* and</span>
<span class="sd">                                         which does not have *metadata_name*</span>
<span class="sd">                                         metadata.</span>
<span class="sd">        ``+``                            Matches all traits on the object.</span>
<span class="sd">        ``pattern*``                     Matches object graphs where *pattern*</span>
<span class="sd">                                         occurs one or more times (useful for</span>
<span class="sd">                                         setting up listeners on recursive data</span>
<span class="sd">                                         structures like trees or linked</span>
<span class="sd">                                         lists).</span>
<span class="sd">        ================================ ======================================</span>

<span class="sd">        Some examples of valid names and their meaning are as follows:</span>

<span class="sd">        ======================= ===============================================</span>
<span class="sd">        example                 meaning</span>
<span class="sd">        ======================= ===============================================</span>
<span class="sd">        ``foo,bar,baz``         Listen for trait changes to *object.foo*,</span>
<span class="sd">                                *object.bar*, and *object.baz*.</span>
<span class="sd">        ``[&#39;foo&#39;,&#39;bar&#39;,&#39;baz&#39;]`` Equivalent to &#39;foo,bar,baz&#39;, but may be more</span>
<span class="sd">                                useful in cases where the individual items are</span>
<span class="sd">                                computed.</span>
<span class="sd">        ``foo.bar.baz``         Listen for trait changes to</span>
<span class="sd">                                *object.foo.bar.baz* and report changes to</span>
<span class="sd">                                *object.foo*, *object.foo.bar* or</span>
<span class="sd">                                *object.foo.bar.baz*.</span>
<span class="sd">        ``foo:bar:baz``         Listen for changes to *object.foo.bar.baz*, and</span>
<span class="sd">                                only report changes to *object.foo.bar.baz*.</span>
<span class="sd">        ``foo.[bar,baz]``       Listen for trait changes to *object.foo.bar*</span>
<span class="sd">                                and *object.foo.baz*.</span>
<span class="sd">        ``[left,right]*.name``  Listen for trait changes to the *name* trait of</span>
<span class="sd">                                each node of a tree having *left* and *right*</span>
<span class="sd">                                links to other tree nodes, and where *object*</span>
<span class="sd">                                the method is applied to the root node of the</span>
<span class="sd">                                tree.</span>
<span class="sd">        ``+dirty``              Listen for trait changes on any trait in the</span>
<span class="sd">                                *object* which has the &#39;dirty&#39; metadata set.</span>
<span class="sd">        ``foo.+dirty``          Listen for trait changes on any trait in</span>
<span class="sd">                                *object.foo* which has the &#39;dirty&#39; metadata</span>
<span class="sd">                                set.</span>
<span class="sd">        ``foo.[bar,-dirty]``    Listen for trait changes on *object.foo.bar* or</span>
<span class="sd">                                any trait on *object.foo* which does not have</span>
<span class="sd">                                &#39;dirty&#39; metadata set.</span>
<span class="sd">        ======================= ===============================================</span>


<span class="sd">        Note that any of the intermediate (i.e., non-final) links in a</span>
<span class="sd">        pattern can be traits of type Instance, List or Dict. In the case</span>
<span class="sd">        of List and Dict traits, the subsequent portion of the pattern is</span>
<span class="sd">        applied to each item in the list, or value in the dictionary.</span>

<span class="sd">        For example, if the self.children is a list, &#39;children.name&#39;</span>
<span class="sd">        listens for trait changes to the *name* trait for each item in the</span>
<span class="sd">        self.children list.</span>

<span class="sd">        Note that items added to or removed from a list or dictionary in</span>
<span class="sd">        the pattern will cause the *handler* routine to be invoked as well,</span>
<span class="sd">        since this is treated as an *implied* change to the item&#39;s trait</span>
<span class="sd">        being monitored.</span>

<span class="sd">        The signature of the *handler* supplied also has an effect on</span>
<span class="sd">        how changes to intermediate traits are processed. The five valid</span>
<span class="sd">        handler signatures are:</span>

<span class="sd">        1. handler()</span>
<span class="sd">        2. handler(new)</span>
<span class="sd">        3. handler(name,new)</span>
<span class="sd">        4. handler(object,name,new)</span>
<span class="sd">        5. handler(object,name,old,new)</span>

<span class="sd">        For signatures 1, 4 and 5, any change to any element of a path</span>
<span class="sd">        being listened to invokes the handler with information about the</span>
<span class="sd">        particular element that was modified (e.g., if the item being</span>
<span class="sd">        monitored is &#39;foo.bar.baz&#39;, a change to &#39;bar&#39; will call *handler*</span>
<span class="sd">        with the following information:</span>

<span class="sd">        - object: object.foo</span>
<span class="sd">        - name:   bar</span>
<span class="sd">        - old:    old value for object.foo.bar</span>
<span class="sd">        - new:    new value for object.foo.bar</span>

<span class="sd">        If one of the intermediate links is a List or Dict, the call to</span>
<span class="sd">        *handler* may report an *_items* changed event. If in the previous</span>
<span class="sd">        example, *bar* is a List, and a new item is added to *bar*, then</span>
<span class="sd">        the information passed to *handler* would be:</span>

<span class="sd">        - object: object.foo</span>
<span class="sd">        - name:   bar_items</span>
<span class="sd">        - old:    Undefined</span>
<span class="sd">        - new:    TraitListEvent whose *added* trait contains the new item</span>
<span class="sd">                  added to *bar*.</span>

<span class="sd">        For signatures 2 and 3, the *handler* does not receive enough</span>
<span class="sd">        information to discern between a change to the final trait being</span>
<span class="sd">        listened to and a change to an intermediate link. In this case,</span>
<span class="sd">        the event dispatcher will attempt to map a change to an</span>
<span class="sd">        intermediate link to its effective change on the final trait. This</span>
<span class="sd">        only works if all of the intermediate links are single values (such</span>
<span class="sd">        as an Instance or Any trait) and not Lists or Dicts. If the modified</span>
<span class="sd">        intermediate trait or any subsequent intermediate trait preceding</span>
<span class="sd">        the final trait is a List or Dict, then a TraitError is raised,</span>
<span class="sd">        since the effective value for the final trait cannot in general be</span>
<span class="sd">        resolved unambiguously. To prevent TraitErrors in this case, use the</span>
<span class="sd">        &#39;:&#39; separator to suppress notifications for changes to any of the</span>
<span class="sd">        intermediate links.</span>

<span class="sd">        Handler signature 1 also has the special characteristic that if a</span>
<span class="sd">        final trait is a List or Dict, it will automatically handle &#39;_items&#39;</span>
<span class="sd">        changed events for the final trait as well. This can be useful in</span>
<span class="sd">        cases where the *handler* only needs to know that some aspect of the</span>
<span class="sd">        final trait has been changed. For all other *handler* signatures,</span>
<span class="sd">        you must explicitly specify the &#39;xxx_items&#39; trait if you want to</span>
<span class="sd">        be notified of changes to any of the items of the &#39;xxx&#39; trait.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Check to see if we can do a quick exit to the basic trait change</span>
        <span class="c"># handler:</span>
        <span class="k">if</span> <span class="p">((</span><span class="nb">isinstance</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="nb">basestring</span> <span class="p">)</span> <span class="ow">and</span>
            <span class="p">(</span><span class="n">extended_trait_pat</span><span class="o">.</span><span class="n">match</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">))</span> <span class="ow">or</span> <span class="p">(</span><span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_on_trait_change</span><span class="p">(</span> <span class="n">handler</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">remove</span><span class="p">,</span> <span class="n">dispatch</span><span class="p">,</span> <span class="n">priority</span><span class="p">,</span> <span class="n">target</span> <span class="p">)</span>

            <span class="k">return</span>

        <span class="kn">from</span> <span class="nn">.traits_listener</span> \
            <span class="kn">import</span> <span class="n">TraitsListener</span><span class="p">,</span> <span class="n">ListenerParser</span><span class="p">,</span> <span class="n">ListenerHandler</span><span class="p">,</span> \
                   <span class="n">ListenerNotifyWrapper</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="nb">list</span> <span class="p">):</span>
            <span class="k">for</span> <span class="n">name_i</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span> <span class="n">handler</span><span class="p">,</span> <span class="n">name_i</span><span class="p">,</span> <span class="n">remove</span><span class="p">,</span> <span class="n">dispatch</span><span class="p">,</span>
                                      <span class="n">priority</span><span class="p">,</span> <span class="n">target</span> <span class="p">)</span>

            <span class="k">return</span>

        <span class="c"># Make sure we have a name string:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="p">(</span><span class="n">name</span> <span class="ow">or</span> <span class="s">&#39;anytrait&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
            <span class="nb">dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">TraitsListener</span> <span class="p">)</span>
            <span class="k">if</span> <span class="nb">dict</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">listeners</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">listeners</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">wrapper</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span> <span class="n">listeners</span> <span class="p">):</span>
                        <span class="k">if</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span> <span class="n">handler</span> <span class="p">):</span>
                            <span class="k">del</span> <span class="n">listeners</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
                            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">listeners</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                <span class="k">del</span> <span class="nb">dict</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
                                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="nb">dict</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span> <span class="n">TraitsListener</span> <span class="p">]</span>
                            <span class="n">wrapper</span><span class="o">.</span><span class="n">listener</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>
                            <span class="n">wrapper</span><span class="o">.</span><span class="n">dispose</span><span class="p">()</span>
                            <span class="k">break</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">dict</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="n">TraitsListener</span><span class="p">,</span> <span class="p">{}</span> <span class="p">)</span>
            <span class="n">listeners</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="p">[]</span> <span class="p">)</span>
            <span class="k">for</span> <span class="n">wrapper</span> <span class="ow">in</span> <span class="n">listeners</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">wrapper</span><span class="o">.</span><span class="n">equals</span><span class="p">(</span> <span class="n">handler</span> <span class="p">):</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">listener</span> <span class="o">=</span> <span class="n">ListenerParser</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span><span class="o">.</span><span class="n">listener</span>
                <span class="n">lnw</span> <span class="o">=</span> <span class="n">ListenerNotifyWrapper</span><span class="p">(</span> <span class="n">handler</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">listener</span><span class="p">,</span> <span class="n">target</span> <span class="p">)</span>
                <span class="n">listeners</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">lnw</span> <span class="p">)</span>
                <span class="n">listener</span><span class="o">.</span><span class="n">set</span><span class="p">(</span> <span class="n">handler</span>         <span class="o">=</span> <span class="n">ListenerHandler</span><span class="p">(</span> <span class="n">handler</span> <span class="p">),</span>
                              <span class="n">wrapped_handler_ref</span> <span class="o">=</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="n">lnw</span><span class="p">),</span>
                              <span class="nb">type</span>            <span class="o">=</span> <span class="n">lnw</span><span class="o">.</span><span class="n">type</span><span class="p">,</span>
                              <span class="n">dispatch</span>        <span class="o">=</span> <span class="n">dispatch</span><span class="p">,</span>
                              <span class="n">priority</span>        <span class="o">=</span> <span class="n">priority</span><span class="p">,</span>
                              <span class="n">deferred</span>        <span class="o">=</span> <span class="n">deferred</span> <span class="p">)</span>
                <span class="n">listener</span><span class="o">.</span><span class="n">register</span><span class="p">(</span> <span class="bp">self</span> <span class="p">)</span>

    <span class="c"># A synonym for &#39;on_trait_change&#39;</span></div>
    <span class="n">on_trait_event</span> <span class="o">=</span> <span class="n">on_trait_change</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Synchronize the value of two traits:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.sync_trait"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.sync_trait">[docs]</a>    <span class="k">def</span> <span class="nf">sync_trait</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait_name</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">alias</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="n">mutual</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span>
                           <span class="n">remove</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Synchronizes the value of a trait attribute on this object with a</span>
<span class="sd">        trait attribute on another object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the trait attribute on this object.</span>
<span class="sd">        object : object</span>
<span class="sd">            The object with which to synchronize.</span>
<span class="sd">        alias : str</span>
<span class="sd">            Name of the trait attribute on *other*; if None or omitted, same</span>
<span class="sd">            as *name*.</span>
<span class="sd">        mutual : bool or int</span>
<span class="sd">            Indicates whether synchronization is mutual (True or non-zero)</span>
<span class="sd">            or one-way (False or zero)</span>
<span class="sd">        remove : bool or int</span>
<span class="sd">            Indicates whether synchronization is being added (False or zero)</span>
<span class="sd">            or removed (True or non-zero)</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        In mutual synchronization, any change to the value of the specified</span>
<span class="sd">        trait attribute of either object results in the same value being</span>
<span class="sd">        assigned to the corresponding trait attribute of the other object.</span>
<span class="sd">        In one-way synchronization, any change to the value of the attribute</span>
<span class="sd">        on this object causes the corresponding trait attribute of *object* to</span>
<span class="sd">        be updated, but not vice versa.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">alias</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">alias</span> <span class="o">=</span> <span class="n">trait_name</span>

        <span class="n">is_list</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_is_list_trait</span><span class="p">(</span> <span class="n">trait_name</span> <span class="p">)</span> <span class="ow">and</span>
                   <span class="nb">object</span><span class="o">.</span><span class="n">_is_list_trait</span><span class="p">(</span> <span class="n">alias</span> <span class="p">))</span>

        <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
            <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sync_trait_info</span><span class="p">()</span>
            <span class="n">dic</span>  <span class="o">=</span> <span class="n">info</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">trait_name</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">dic</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="p">(</span> <span class="nb">id</span><span class="p">(</span> <span class="nb">object</span> <span class="p">),</span> <span class="n">alias</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>
                    <span class="k">del</span> <span class="n">dic</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span>

                    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">dic</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="k">del</span> <span class="n">info</span><span class="p">[</span> <span class="n">trait_name</span> <span class="p">]</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_on_trait_change</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sync_trait_modified</span><span class="p">,</span>
                            <span class="n">trait_name</span><span class="p">,</span> <span class="n">remove</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>

                        <span class="k">if</span> <span class="n">is_list</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">_on_trait_change</span><span class="p">(</span>
                                <span class="bp">self</span><span class="o">.</span><span class="n">_sync_trait_items_modified</span><span class="p">,</span>
                                <span class="n">trait_name</span> <span class="o">+</span> <span class="s">&#39;_items&#39;</span><span class="p">,</span> <span class="n">remove</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>

            <span class="k">if</span> <span class="n">mutual</span><span class="p">:</span>
                <span class="nb">object</span><span class="o">.</span><span class="n">sync_trait</span><span class="p">(</span> <span class="n">alias</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait_name</span><span class="p">,</span> <span class="bp">False</span><span class="p">,</span> <span class="bp">True</span> <span class="p">)</span>

            <span class="k">return</span>

        <span class="n">value</span> <span class="o">=</span> <span class="p">(</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sync_trait_listener_deleted</span> <span class="p">),</span>
                  <span class="n">alias</span> <span class="p">)</span>
        <span class="n">dic</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_sync_trait_info</span><span class="p">()</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="n">trait_name</span><span class="p">,</span> <span class="p">{}</span> <span class="p">)</span>
        <span class="n">key</span>   <span class="o">=</span> <span class="p">(</span> <span class="nb">id</span><span class="p">(</span> <span class="nb">object</span> <span class="p">),</span> <span class="n">alias</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">dic</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_on_trait_change</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sync_trait_modified</span><span class="p">,</span> <span class="n">trait_name</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">is_list</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_on_trait_change</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sync_trait_items_modified</span><span class="p">,</span>
                                           <span class="n">trait_name</span> <span class="o">+</span> <span class="s">&#39;_items&#39;</span> <span class="p">)</span>
            <span class="n">dic</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
            <span class="nb">setattr</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">alias</span><span class="p">,</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait_name</span> <span class="p">)</span> <span class="p">)</span>

        <span class="k">if</span> <span class="n">mutual</span><span class="p">:</span>
            <span class="nb">object</span><span class="o">.</span><span class="n">sync_trait</span><span class="p">(</span> <span class="n">alias</span><span class="p">,</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait_name</span><span class="p">,</span> <span class="bp">False</span> <span class="p">)</span>
</div>
    <span class="k">def</span> <span class="nf">_get_sync_trait_info</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;__sync_trait__&#39;</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">info</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span> <span class="s">&#39;__sync_trait__&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="n">info</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">info</span><span class="p">[</span> <span class="s">&#39;&#39;</span> <span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">return</span> <span class="n">info</span>

    <span class="k">def</span> <span class="nf">_sync_trait_modified</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="p">):</span>
        <span class="n">info</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sync_trait__</span>
        <span class="n">locked</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span> <span class="s">&#39;&#39;</span> <span class="p">]</span>
        <span class="n">locked</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="nb">object</span><span class="p">,</span> <span class="n">object_name</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="nb">object</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">object_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">object</span><span class="o">.</span><span class="n">_get_sync_trait_info</span><span class="p">()[</span> <span class="s">&#39;&#39;</span> <span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">setattr</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">object_name</span><span class="p">,</span> <span class="n">new</span> <span class="p">)</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">del</span> <span class="n">locked</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_sync_trait_items_modified</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">event</span> <span class="p">):</span>
        <span class="n">n0</span>     <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">index</span>
        <span class="n">n1</span>     <span class="o">=</span> <span class="n">n0</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span> <span class="n">event</span><span class="o">.</span><span class="n">removed</span> <span class="p">)</span>
        <span class="n">name</span>   <span class="o">=</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span>
        <span class="n">info</span>   <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sync_trait__</span>
        <span class="n">locked</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span> <span class="s">&#39;&#39;</span> <span class="p">]</span>
        <span class="n">locked</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="k">for</span> <span class="nb">object</span><span class="p">,</span> <span class="n">object_name</span> <span class="ow">in</span> <span class="n">info</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="nb">object</span> <span class="o">=</span> <span class="nb">object</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">object_name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">object</span><span class="o">.</span><span class="n">_get_sync_trait_info</span><span class="p">()[</span> <span class="s">&#39;&#39;</span> <span class="p">]:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="nb">getattr</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">object_name</span> <span class="p">)[</span> <span class="n">n0</span><span class="p">:</span> <span class="n">n1</span> <span class="p">]</span> <span class="o">=</span> <span class="n">event</span><span class="o">.</span><span class="n">added</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="k">pass</span>

        <span class="k">del</span> <span class="n">locked</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_sync_trait_listener_deleted</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">ref</span> <span class="p">):</span>
        <span class="n">info</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sync_trait__</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">dic</span> <span class="ow">in</span> <span class="n">info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">key</span> <span class="o">!=</span> <span class="s">&#39;&#39;</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">dic</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="k">if</span> <span class="n">ref</span> <span class="ow">is</span> <span class="n">value</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                        <span class="k">del</span> <span class="n">dic</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
                        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">dic</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                            <span class="k">del</span> <span class="n">info</span><span class="p">[</span> <span class="n">key</span> <span class="p">]</span>

    <span class="k">def</span> <span class="nf">_is_list_trait</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">trait_name</span> <span class="p">):</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_trait</span><span class="p">(</span> <span class="n">trait_name</span> <span class="p">)</span><span class="o">.</span><span class="n">handler</span>

        <span class="k">return</span> <span class="p">((</span><span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">handler</span><span class="o">.</span><span class="n">default_value_type</span> <span class="o">==</span> <span class="mi">5</span><span class="p">))</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Add a new trait:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.add_trait"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.add_trait">[docs]</a>    <span class="k">def</span> <span class="nf">add_trait</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">trait</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a trait attribute to this object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the attribute to add.</span>
<span class="sd">        *trait :</span>
<span class="sd">            Trait or a value that can be converted to a trait by Trait().</span>
<span class="sd">            Trait definition for *name*. If more than one value is specified,</span>
<span class="sd">            it is equivalent to passing the entire list of values to Trait().</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c"># Make sure a trait argument was specified:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">,</span> <span class="s">&#39;No trait definition was specified.&#39;</span>

        <span class="c"># Make sure only valid traits get added:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="n">Trait</span><span class="p">(</span> <span class="o">*</span><span class="n">trait</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">trait</span> <span class="o">=</span> <span class="n">_trait_for</span><span class="p">(</span> <span class="n">trait</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)</span>

        <span class="c"># Check to see if the trait has additional sub-traits that need to be</span>
        <span class="c"># defined also:</span>
        <span class="n">handler</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">handler</span>
        <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">handler</span><span class="o">.</span><span class="n">has_items</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_items&#39;</span><span class="p">,</span> <span class="n">handler</span><span class="o">.</span><span class="n">items_event</span><span class="p">()</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">handler</span><span class="o">.</span><span class="n">is_mapped</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">add_trait</span><span class="p">(</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span><span class="p">,</span> <span class="n">_mapped_trait_for</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span> <span class="p">)</span>

        <span class="c"># See if there already is a class or instance trait with the same name:</span>
        <span class="n">old_trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>

        <span class="c"># Get the object&#39;s instance trait dictionary and add a clone of the new</span>
        <span class="c"># trait to it:</span>
        <span class="n">itrait_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance_traits</span><span class="p">()</span>
        <span class="n">itrait_dict</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">trait</span> <span class="o">=</span> <span class="n">_clone_trait</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span>

        <span class="c"># If there already was a trait with the same name:</span>
        <span class="k">if</span> <span class="n">old_trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c"># Copy the old traits notifiers into the new trait:</span>
            <span class="n">old_notifiers</span> <span class="o">=</span> <span class="n">old_trait</span><span class="o">.</span><span class="n">_notifiers</span><span class="p">(</span> <span class="mi">0</span> <span class="p">)</span>
            <span class="k">if</span> <span class="n">old_notifiers</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">trait</span><span class="o">.</span><span class="n">_notifiers</span><span class="p">(</span> <span class="mi">1</span> <span class="p">)</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span> <span class="n">old_notifiers</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Otherwise, see if there are any static notifiers that should be</span>
            <span class="c"># applied to the trait:</span>
            <span class="n">cls</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span>
            <span class="n">handlers</span> <span class="o">=</span> <span class="p">[</span> <span class="n">_get_method</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="s">&#39;_</span><span class="si">%s</span><span class="s">_changed&#39;</span> <span class="o">%</span> <span class="n">name</span> <span class="p">),</span>
                         <span class="n">_get_method</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="s">&#39;_</span><span class="si">%s</span><span class="s">_fired&#39;</span>   <span class="o">%</span> <span class="n">name</span> <span class="p">)</span> <span class="p">]</span>

            <span class="c"># Add any special trait defined event handlers:</span>
            <span class="n">_add_event_handlers</span><span class="p">(</span> <span class="n">trait</span><span class="p">,</span> <span class="n">cls</span><span class="p">,</span> <span class="n">handlers</span> <span class="p">)</span>

            <span class="c"># Add the &#39;anytrait&#39; handler (if any):</span>
            <span class="n">handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prefix_traits__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s">&#39;@&#39;</span> <span class="p">)</span> <span class="p">)</span>

            <span class="c"># Filter out any &#39;None&#39; values:</span>
            <span class="n">handlers</span> <span class="o">=</span> <span class="p">[</span> <span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">handlers</span> <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="p">]</span>

            <span class="c"># If there are any static notifiers, attach them to the trait:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">handlers</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">_add_notifiers</span><span class="p">(</span> <span class="n">trait</span><span class="o">.</span><span class="n">_notifiers</span><span class="p">(</span> <span class="mi">1</span> <span class="p">),</span> <span class="n">handlers</span> <span class="p">)</span>

        <span class="c"># If this was a new trait, fire the &#39;trait_added&#39; event:</span>
        <span class="k">if</span> <span class="n">old_trait</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trait_added</span> <span class="o">=</span> <span class="n">name</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Remove an existing trait:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits.remove_trait"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.remove_trait">[docs]</a>    <span class="k">def</span> <span class="nf">remove_trait</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Removes a trait attribute from this object.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the attribute to remove.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Get the trait definition:</span>
        <span class="n">trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="mi">0</span> <span class="p">)</span>
        <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>

            <span class="c"># Check to see if the trait has additional sub-traits that need to</span>
            <span class="c"># be removed also:</span>
            <span class="n">handler</span> <span class="o">=</span> <span class="n">trait</span><span class="o">.</span><span class="n">handler</span>
            <span class="k">if</span> <span class="n">handler</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">handler</span><span class="o">.</span><span class="n">has_items</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_trait</span><span class="p">(</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_items&#39;</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">handler</span><span class="o">.</span><span class="n">is_mapped</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">remove_trait</span><span class="p">(</span> <span class="n">name</span> <span class="o">+</span> <span class="s">&#39;_&#39;</span> <span class="p">)</span>

            <span class="c"># Remove the trait value from the object dictionary as well:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
                <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>

            <span class="c"># Get the object&#39;s instance trait dictionary and remove the trait</span>
            <span class="c"># from it:</span>
            <span class="n">itrait_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_instance_traits</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="n">itrait_dict</span><span class="p">:</span>
                <span class="k">del</span> <span class="n">itrait_dict</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
                <span class="k">return</span> <span class="bp">True</span>

        <span class="k">return</span> <span class="bp">False</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Returns the trait definition of a specified trait:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits.trait"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.trait">[docs]</a>    <span class="k">def</span> <span class="nf">trait</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">force</span> <span class="o">=</span> <span class="bp">False</span><span class="p">,</span> <span class="n">copy</span> <span class="o">=</span> <span class="bp">False</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the trait definition for the *name* trait attribute.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the attribute whose trait definition is to be returned.</span>
<span class="sd">        force : bool</span>
<span class="sd">            Indicates whether to return a trait definition if *name* is</span>
<span class="sd">            not explicitly defined.</span>
<span class="sd">        copy : bool</span>
<span class="sd">            Indicates whether to return the original trait definition or a</span>
<span class="sd">            copy.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        If *force* is False (the default) and *name* is the name of an</span>
<span class="sd">        implicitly defined trait attribute that has never been referenced</span>
<span class="sd">        explicitly (i.e., has not yet been defined), the result is None. In</span>
<span class="sd">        all other cases, the result is the trait definition object associated</span>
<span class="sd">        with *name*.</span>

<span class="sd">        If *copy* is True, and a valid trait definition is found for *name*,</span>
<span class="sd">        a copy of the trait found is returned. In all other cases, the trait</span>
<span class="sd">        definition found is returned unmodified (the default).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mode</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">mode</span> <span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="ow">not</span> <span class="n">copy</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">return</span>  <span class="n">_clone_trait</span><span class="p">(</span> <span class="n">result</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Returns the base trait definition of a specified trait:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits.base_trait"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.base_trait">[docs]</a>    <span class="k">def</span> <span class="nf">base_trait</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns the base trait definition for a trait attribute.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        name : str</span>
<span class="sd">            Name of the attribute whose trait definition is returned.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        This method is similar to the trait() method, and returns a</span>
<span class="sd">        different result only in the case where the trait attribute defined by</span>
<span class="sd">        *name* is a delegate. In this case, the base_trait() method follows the</span>
<span class="sd">        delegation chain until a non-delegated trait attribute is reached, and</span>
<span class="sd">        returns the definition of that attribute&#39;s trait as the result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Validates whether or not a specified value is legal for a specified</span>
    <span class="c"># trait and returns the validated value if valid:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits.validate_trait"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.validate_trait">[docs]</a>    <span class="k">def</span> <span class="nf">validate_trait</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Validates whether a value is legal for a trait.</span>

<span class="sd">        Returns the validated value if it is valid.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">base_trait</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span><span class="o">.</span><span class="n">validate</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Return a dictionary of all traits which match a set of metadata:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits.traits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.traits">[docs]</a>    <span class="k">def</span> <span class="nf">traits</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary containing the definitions of all of the trait</span>
<span class="sd">        attributes of this object that match the set of *metadata* criteria.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **metadata :</span>
<span class="sd">            Criteria for selecting trait attributes.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        The keys of the returned dictionary are the trait attribute names, and</span>
<span class="sd">        the values are their corresponding trait definition objects.</span>

<span class="sd">        If no *metadata* information is specified, then all explicitly defined</span>
<span class="sd">        trait attributes defined for the object are returned.</span>

<span class="sd">        Otherwise, the *metadata* keyword dictionary is assumed to define a set</span>
<span class="sd">        of search criteria for selecting trait attributes of interest. The</span>
<span class="sd">        *metadata* dictionary keys correspond to the names of trait metadata</span>
<span class="sd">        attributes to examine, and the values correspond to the values the</span>
<span class="sd">        metadata attribute must have in order to be included in the search</span>
<span class="sd">        results.</span>

<span class="sd">        The *metadata* values either may be simple Python values like strings or</span>
<span class="sd">        integers, or may be lambda expressions or functions that return True</span>
<span class="sd">        if the trait attribute is to be included in the result. A lambda</span>
<span class="sd">        expression or function must receive a single argument, which is the</span>
<span class="sd">        value of the trait metadata attribute being tested. If more than one</span>
<span class="sd">        metadata keyword is specified, a trait attribute must match the metadata</span>
<span class="sd">        values of all keywords to be included in the result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">traits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__base_traits__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">traits</span><span class="p">:</span>
                <span class="n">trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trait</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                    <span class="n">traits</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">trait</span>

        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">metadata</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">traits</span>

        <span class="k">for</span> <span class="n">meta_name</span><span class="p">,</span> <span class="n">meta_eval</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span> <span class="n">meta_eval</span> <span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">FunctionType</span><span class="p">:</span>
                <span class="n">metadata</span><span class="p">[</span> <span class="n">meta_name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">_SimpleTest</span><span class="p">(</span> <span class="n">meta_eval</span> <span class="p">)</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">traits</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">meta_name</span><span class="p">,</span> <span class="n">meta_eval</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">meta_eval</span><span class="p">(</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">trait</span><span class="p">,</span> <span class="n">meta_name</span> <span class="p">)</span> <span class="p">):</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">trait</span>

        <span class="k">return</span> <span class="n">result</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Return a dictionary of all traits which match a set of metadata:</span>
    <span class="c">#---------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasTraits.class_traits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.class_traits">[docs]</a>    <span class="k">def</span> <span class="nf">class_traits</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a dictionary containing the definitions of all of the trait</span>
<span class="sd">        attributes of the class that match the set of *metadata* criteria.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **metadata :</span>
<span class="sd">            Criteria for selecting trait attributes.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        The keys of the returned dictionary are the trait attribute names, and</span>
<span class="sd">        the values are their corresponding trait definition objects.</span>

<span class="sd">        If no *metadata* information is specified, then all explicitly defined</span>
<span class="sd">        trait attributes defined for the class are returned.</span>

<span class="sd">        Otherwise, the *metadata* keyword dictionary is assumed to define a set</span>
<span class="sd">        of search criteria for selecting trait attributes of interest. The</span>
<span class="sd">        *metadata* dictionary keys correspond to the names of trait metadata</span>
<span class="sd">        attributes to examine, and the values correspond to the values the</span>
<span class="sd">        metadata attribute must have in order to be included in the search</span>
<span class="sd">        results.</span>

<span class="sd">        The *metadata* values either may be simple Python values like strings or</span>
<span class="sd">        integers, or may be lambda expressions or functions that return **True**</span>
<span class="sd">        if the trait attribute is to be included in the result. A lambda</span>
<span class="sd">        expression or function must receive a single argument, which is the</span>
<span class="sd">        value of the trait metadata attribute being tested. If more than one</span>
<span class="sd">        metadata keyword is specified, a trait attribute must match the metadata</span>
<span class="sd">        values of all keywords to be included in the result.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">metadata</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">__base_traits__</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="k">for</span> <span class="n">meta_name</span><span class="p">,</span> <span class="n">meta_eval</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span> <span class="n">meta_eval</span> <span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">FunctionType</span><span class="p">:</span>
                <span class="n">metadata</span><span class="p">[</span> <span class="n">meta_name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">_SimpleTest</span><span class="p">(</span> <span class="n">meta_eval</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">trait</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">__base_traits__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">for</span> <span class="n">meta_name</span><span class="p">,</span> <span class="n">meta_eval</span> <span class="ow">in</span> <span class="n">metadata</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">meta_eval</span><span class="p">(</span> <span class="nb">getattr</span><span class="p">(</span> <span class="n">trait</span><span class="p">,</span> <span class="n">meta_name</span> <span class="p">)</span> <span class="p">):</span>
                    <span class="k">break</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">result</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">trait</span>

        <span class="k">return</span> <span class="n">result</span>
</div>
    <span class="n">class_traits</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">class_traits</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Return a list of all trait names which match a set of metadata:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasTraits.trait_names"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.trait_names">[docs]</a>    <span class="k">def</span> <span class="nf">trait_names</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of the names of all trait attributes whose definitions</span>
<span class="sd">        match the set of *metadata* criteria specified.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **metadata :</span>
<span class="sd">            Criteria for selecting trait attributes.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        This method is similar to the traits() method, but returns only the</span>
<span class="sd">        names of the matching trait attributes, not the trait definitions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">traits</span><span class="p">(</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="HasTraits.class_trait_names"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasTraits.class_trait_names">[docs]</a>    <span class="k">def</span> <span class="nf">class_trait_names</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Returns a list of the names of all trait attributes whose definitions</span>
<span class="sd">        match the set of *metadata* criteria specified.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        **metadata :</span>
<span class="sd">            Criteria for selecting trait attributes.</span>

<span class="sd">        Description</span>
<span class="sd">        -----------</span>
<span class="sd">        This method is similar to the traits() method, but returns only the</span>
<span class="sd">        names of the matching trait attributes, not the trait definitions.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">class_traits</span><span class="p">(</span> <span class="o">**</span><span class="n">metadata</span> <span class="p">)</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</div>
    <span class="n">class_trait_names</span> <span class="o">=</span> <span class="nb">classmethod</span><span class="p">(</span> <span class="n">class_trait_names</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Explicitly sets the value of a cached property:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_set_traits_cache</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Explicitly sets the value of a cached property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cached</span>    <span class="o">=</span> <span class="n">TraitsCache</span> <span class="o">+</span> <span class="n">name</span>
        <span class="n">old_value</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">cached</span><span class="p">,</span> <span class="n">Undefined</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span> <span class="n">cached</span> <span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">old_value</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trait_property_changed</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">old_value</span><span class="p">,</span> <span class="n">value</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Explicitly flushes the value of a cached property:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_flush_traits_cache</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Explicitly flushes the value of a cached property.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">trait_property_changed</span><span class="p">(</span>
            <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span> <span class="n">TraitsCache</span> <span class="o">+</span> <span class="n">name</span><span class="p">,</span> <span class="n">Undefined</span> <span class="p">)</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Returns the trait definition for a specified name when there is no</span>
    <span class="c">#  explicit definition in the class:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">__prefix_trait__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">is_set</span> <span class="p">):</span>
        <span class="c"># Check to see if the name is of the form &#39;__xxx__&#39;:</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">name</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;__&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;__&#39;</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span> <span class="o">==</span> <span class="s">&#39;__class__&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">generic_trait</span>

            <span class="c"># If this is for purposes of performing a &#39;setattr&#39;, always map the</span>
            <span class="c"># name to an &#39;Any&#39; trait:</span>
            <span class="k">if</span> <span class="n">is_set</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">any_trait</span>

            <span class="c"># Otherwise, it is a &#39;getattr&#39; request, so indicate that no such</span>
            <span class="c"># attribute exists:</span>
            <span class="k">raise</span> <span class="ne">AttributeError</span><span class="p">,</span> <span class="s">&quot;&#39;</span><span class="si">%s</span><span class="s">&#39; object has no attribute &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span> <span class="o">%</span> <span class="p">(</span>
                                  <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span><span class="p">,</span> <span class="n">name</span> <span class="p">)</span>

        <span class="c"># Handle the special case of &#39;delegated&#39; traits:</span>
        <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;_&#39;</span><span class="p">:</span>
           <span class="n">trait</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait</span><span class="p">(</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span> <span class="p">)</span>
           <span class="k">if</span> <span class="p">(</span><span class="n">trait</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">trait</span><span class="o">.</span><span class="n">type</span> <span class="o">==</span> <span class="s">&#39;delegate&#39;</span><span class="p">):</span>
               <span class="k">return</span> <span class="n">_clone_trait</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span>

        <span class="n">prefix_traits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__prefix_traits__</span>
        <span class="k">for</span> <span class="n">prefix</span> <span class="ow">in</span> <span class="n">prefix_traits</span><span class="p">[</span><span class="s">&#39;*&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">prefix</span> <span class="o">==</span> <span class="n">name</span><span class="p">[</span> <span class="p">:</span><span class="nb">len</span><span class="p">(</span> <span class="n">prefix</span> <span class="p">)</span> <span class="p">]:</span>
                <span class="c"># If we found a match, use its trait as a template for a new</span>
                <span class="c"># trait:</span>
                <span class="n">trait</span> <span class="o">=</span> <span class="n">prefix_traits</span><span class="p">[</span> <span class="n">prefix</span> <span class="p">]</span>

                <span class="c"># Get any change notifiers that apply to the trait:</span>
                <span class="n">cls</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span>
                <span class="n">handlers</span> <span class="o">=</span> <span class="p">[</span> <span class="n">_get_method</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="s">&#39;_</span><span class="si">%s</span><span class="s">_changed&#39;</span> <span class="o">%</span> <span class="n">name</span> <span class="p">),</span>
                             <span class="n">_get_method</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="s">&#39;_</span><span class="si">%s</span><span class="s">_fired&#39;</span>   <span class="o">%</span> <span class="n">name</span> <span class="p">)</span> <span class="p">]</span>

                <span class="c"># Add any special trait defined event handlers:</span>
                <span class="n">_add_event_handlers</span><span class="p">(</span> <span class="n">trait</span><span class="p">,</span> <span class="n">cls</span><span class="p">,</span> <span class="n">handlers</span> <span class="p">)</span>

                <span class="c"># Add the &#39;anytrait&#39; handler (if any):</span>
                <span class="n">handlers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span> <span class="n">prefix_traits</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="s">&#39;@&#39;</span> <span class="p">)</span> <span class="p">)</span>

                <span class="c"># Filter out any &#39;None&#39; values:</span>
                <span class="n">handlers</span> <span class="o">=</span> <span class="p">[</span> <span class="n">h</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">handlers</span> <span class="k">if</span> <span class="n">h</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span> <span class="p">]</span>

                <span class="c"># If there are any handlers, add them to the trait&#39;s notifier&#39;s</span>
                <span class="c"># list:</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="n">handlers</span> <span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">trait</span> <span class="o">=</span> <span class="n">_clone_trait</span><span class="p">(</span> <span class="n">trait</span> <span class="p">)</span>
                    <span class="n">_add_notifiers</span><span class="p">(</span> <span class="n">trait</span><span class="o">.</span><span class="n">_notifiers</span><span class="p">(</span> <span class="mi">1</span> <span class="p">),</span> <span class="n">handlers</span> <span class="p">)</span>

                <span class="k">return</span> <span class="n">trait</span>

        <span class="c"># There should ALWAYS be a prefix match in the trait classes, since &#39;&#39;</span>
        <span class="c"># is at the end of the list, so we should never get here:</span>
        <span class="k">raise</span> <span class="ne">SystemError</span><span class="p">,</span> <span class="p">(</span><span class="s">&quot;Trait class look-up failed for attribute &#39;</span><span class="si">%s</span><span class="s">&#39; &quot;</span>
                            <span class="s">&quot;for an object of type &#39;</span><span class="si">%s</span><span class="s">&#39;&quot;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
                            <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__name__</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Adds/Removes (Java-style) event listeners to an object:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">add_trait_listener</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trait_listener</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="bp">False</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">remove_trait_listener</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#39;&#39;</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trait_listener</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="bp">True</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_trait_listener</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">prefix</span><span class="p">,</span> <span class="n">remove</span> <span class="p">):</span>
        <span class="k">if</span> <span class="n">prefix</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">:]</span> <span class="o">!=</span> <span class="s">&#39;_&#39;</span><span class="p">:</span>
            <span class="n">prefix</span> <span class="o">+=</span> <span class="s">&#39;_&#39;</span>
        <span class="n">n</span>      <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">prefix</span> <span class="p">)</span>
        <span class="n">traits</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__base_traits__</span>
        <span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_each_trait_method</span><span class="p">(</span> <span class="nb">object</span> <span class="p">):</span>
            <span class="k">if</span> <span class="n">name</span><span class="p">[:</span><span class="n">n</span><span class="p">]</span> <span class="o">==</span> <span class="n">prefix</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">name</span><span class="p">[</span><span class="o">-</span><span class="mi">8</span><span class="p">:]</span> <span class="o">==</span> <span class="s">&#39;_changed&#39;</span><span class="p">:</span>
                    <span class="n">short_name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="o">-</span><span class="mi">8</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">short_name</span> <span class="ow">in</span> <span class="n">traits</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_on_trait_change</span><span class="p">(</span> <span class="nb">getattr</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span> <span class="p">),</span>
                                               <span class="n">short_name</span><span class="p">,</span> <span class="n">remove</span> <span class="o">=</span> <span class="n">remove</span> <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">short_name</span> <span class="o">==</span> <span class="s">&#39;anytrait&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_on_trait_change</span><span class="p">(</span> <span class="nb">getattr</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span> <span class="p">),</span>
                                               <span class="n">remove</span> <span class="o">=</span> <span class="n">remove</span> <span class="p">)</span>
                <span class="k">elif</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;_fired&#39;</span><span class="p">:</span>
                    <span class="n">short_name</span> <span class="o">=</span> <span class="n">name</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span>
                    <span class="k">if</span> <span class="n">short_name</span> <span class="ow">in</span> <span class="n">traits</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_on_trait_change</span><span class="p">(</span> <span class="nb">getattr</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span> <span class="p">),</span>
                                               <span class="n">short_name</span><span class="p">,</span> <span class="n">remove</span> <span class="o">=</span> <span class="n">remove</span> <span class="p">)</span>
                    <span class="k">elif</span> <span class="n">short_name</span> <span class="o">==</span> <span class="s">&#39;anytrait&#39;</span><span class="p">:</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">_on_trait_change</span><span class="p">(</span> <span class="nb">getattr</span><span class="p">(</span> <span class="nb">object</span><span class="p">,</span> <span class="n">name</span> <span class="p">),</span>
                                               <span class="n">remove</span> <span class="o">=</span> <span class="n">remove</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Generates each (name, method) pair for a specified object:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_each_trait_method</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Generates each (name, method) pair for a specified object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">dic</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">klass</span> <span class="ow">in</span> <span class="nb">object</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__mro__</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">method</span> <span class="ow">in</span> <span class="n">klass</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span> <span class="n">method</span> <span class="p">)</span> <span class="ow">is</span> <span class="n">FunctionType</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dic</span><span class="p">):</span>
                    <span class="n">dic</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="bp">True</span>
                    <span class="k">yield</span> <span class="n">name</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Handles adding/removing listeners for a generic &#39;Instance&#39; trait:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_instance_changed_handler</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Handles adding/removing listeners for a generic &#39;Instance&#39; trait.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arg_lists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_instance_handlers</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>

        <span class="k">if</span> <span class="n">old</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">arg_lists</span><span class="p">:</span>
                <span class="n">old</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span> <span class="n">remove</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">)</span>

        <span class="k">if</span> <span class="n">new</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">arg_lists</span><span class="p">:</span>
                <span class="n">new</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span> <span class="o">*</span><span class="n">args</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Handles adding/removing listeners for a generic &#39;List( Instance )&#39; trait:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_list_changed_handler</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Handles adding/removing listeners for a generic &#39;List( Instance )&#39;</span>
<span class="sd">            trait.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arg_lists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_instance_handlers</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">old</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">arg_lists</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span> <span class="n">remove</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">new</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">arg_lists</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span> <span class="o">*</span><span class="n">args</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_list_items_changed_handler</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">not_used</span><span class="p">,</span> <span class="n">event</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Handles adding/removing listeners for a generic &#39;List( Instance )&#39;</span>
<span class="sd">            trait.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">arg_lists</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_instance_handlers</span><span class="p">(</span> <span class="n">name</span><span class="p">[:</span><span class="o">-</span><span class="mi">6</span><span class="p">]</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">removed</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">arg_lists</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span> <span class="n">remove</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span> <span class="p">)</span>

        <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">event</span><span class="o">.</span><span class="n">added</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">args</span> <span class="ow">in</span> <span class="n">arg_lists</span><span class="p">:</span>
                <span class="n">item</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span> <span class="o">*</span><span class="n">args</span> <span class="p">)</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Returns a list of ( name, method ) pairs for a specified &#39;Instance&#39; or</span>
    <span class="c">#  &#39;List( Instance )&#39; trait name:</span>
    <span class="c">#---------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_get_instance_handlers</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns a list of ( name, method ) pairs for a specified &#39;Instance&#39;</span>
<span class="sd">            or &#39;List( Instance )&#39; trait name:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">[</span> <span class="p">(</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span> <span class="p">),</span> <span class="n">item_name</span> <span class="p">)</span>
                 <span class="k">for</span> <span class="n">method_name</span><span class="p">,</span> <span class="n">item_name</span> <span class="ow">in</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__instance_traits__</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span> <span class="p">]</span>

    <span class="c">#---------------------------------------------------------------------------</span>
    <span class="c">#  Initializes the object&#39;s statically parsed, but dynamically registered,</span>
    <span class="c">#  traits listeners (called at object creation and unpickling times):</span>
    <span class="c">#---------------------------------------------------------------------------</span>

    <span class="k">def</span> <span class="nf">_post_init_trait_listeners</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initializes the object&#39;s statically parsed, but dynamically</span>
<span class="sd">            registered, traits listeners (called at object creation and</span>
<span class="sd">            unpickling times).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__listener_traits__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;method&#39;</span><span class="p">:</span>
                <span class="n">pattern</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">pattern</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&gt;&#39;</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">),</span> <span class="n">pattern</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                                          <span class="n">deferred</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_trait_listeners</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Initializes the object&#39;s statically parsed, but dynamically</span>
<span class="sd">            registered, traits listeners (called at object creation and</span>
<span class="sd">            unpickling times).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__listener_traits__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="s">&#39;_init_trait_</span><span class="si">%s</span><span class="s">_listener&#39;</span> <span class="o">%</span> <span class="n">data</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="p">)(</span> <span class="n">name</span><span class="p">,</span> <span class="o">*</span><span class="n">data</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_trait_method_listener</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">pattern</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets up the listener for a method with the @on_trait_change</span>
<span class="sd">            decorator.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pattern</span><span class="p">[:</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;&lt;&#39;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span> <span class="nb">getattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">),</span> <span class="n">pattern</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
                                  <span class="n">deferred</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_trait_event_listener</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">pattern</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets up the listener for an event with on_trait_change metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nd">@weak_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">notify</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
            <span class="nb">setattr</span><span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="bp">True</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span> <span class="n">notify</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="bp">self</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_trait_property_listener</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">cached</span><span class="p">,</span> <span class="n">pattern</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets up the listener for a property with &#39;depends_on&#39; metadata.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">cached</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="nd">@weak_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">notify</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">trait_property_changed</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cached_old</span> <span class="o">=</span> <span class="n">cached</span> <span class="o">+</span> <span class="s">&#39;:old&#39;</span>
            <span class="nd">@weak_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">pre_notify</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
                <span class="nb">dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span>
                <span class="n">old</span>  <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span> <span class="n">cached_old</span><span class="p">,</span> <span class="n">Undefined</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">old</span> <span class="ow">is</span> <span class="n">Undefined</span><span class="p">:</span>
                    <span class="nb">dict</span><span class="p">[</span> <span class="n">cached_old</span> <span class="p">]</span> <span class="o">=</span> <span class="nb">dict</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span> <span class="n">cached</span><span class="p">,</span> <span class="bp">None</span> <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span> <span class="n">pre_notify</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">priority</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="bp">self</span> <span class="p">)</span>

            <span class="nd">@weak_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">def</span> <span class="nf">notify</span> <span class="p">(</span> <span class="bp">self</span> <span class="p">):</span>
                <span class="n">old</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span> <span class="n">cached_old</span><span class="p">,</span> <span class="n">Undefined</span> <span class="p">)</span>
                <span class="k">if</span> <span class="n">old</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">Undefined</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">trait_property_changed</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">old</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span> <span class="n">notify</span><span class="p">,</span> <span class="n">pattern</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="bp">self</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_init_trait_delegate_listener</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">kind</span><span class="p">,</span> <span class="n">pattern</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Sets up the listener for a delegate trait.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name_pattern</span>    <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait_delegate_name</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">pattern</span> <span class="p">)</span>
        <span class="n">target_name_len</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span> <span class="n">name_pattern</span><span class="o">.</span><span class="n">split</span><span class="p">(</span> <span class="s">&#39;:&#39;</span> <span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>

        <span class="nd">@weak_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">def</span> <span class="nf">notify</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">notify_name</span><span class="p">,</span> <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">trait_property_changed</span><span class="p">(</span> <span class="n">name</span> <span class="o">+</span> <span class="n">notify_name</span><span class="p">[</span> <span class="n">target_name_len</span><span class="p">:</span> <span class="p">],</span>
                                         <span class="n">old</span><span class="p">,</span> <span class="n">new</span> <span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span> <span class="n">notify</span><span class="p">,</span> <span class="n">name_pattern</span><span class="p">,</span> <span class="n">target</span><span class="o">=</span><span class="bp">self</span> <span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="n">ListenerTraits</span><span class="p">,</span> <span class="p">{}</span> <span class="p">)[</span> <span class="n">name</span> <span class="p">]</span> <span class="o">=</span> <span class="n">notify</span>

    <span class="k">def</span> <span class="nf">_remove_trait_delegate_listener</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">remove</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Removes a delegate listener when the local delegate value is set.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span> <span class="n">ListenerTraits</span><span class="p">,</span> <span class="p">{}</span> <span class="p">)</span>

        <span class="k">if</span> <span class="n">remove</span><span class="p">:</span>
            <span class="c"># Although the name should be in the dict, it may not be if a value</span>
            <span class="c"># was assigned to a delegate in a constructor or setstate:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">:</span>
                <span class="c"># Remove the delegate listener:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">on_trait_change</span><span class="p">(</span> <span class="nb">dict</span><span class="p">[</span> <span class="n">name</span> <span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trait_delegate_name</span><span class="p">(</span>
                         <span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__listener_traits__</span><span class="p">[</span> <span class="n">name</span> <span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="p">),</span>
                         <span class="n">remove</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>
                <span class="k">del</span> <span class="nb">dict</span><span class="p">[</span> <span class="n">name</span> <span class="p">]</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span> <span class="nb">dict</span> <span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">del</span> <span class="bp">self</span><span class="o">.</span><span class="n">__dict__</span><span class="p">[</span> <span class="n">ListenerTraits</span> <span class="p">]</span>

            <span class="k">return</span>

        <span class="c"># Otherwise the local copy of the delegate value was deleted, restore</span>
        <span class="c"># the delegate listener (unless it&#39;s already there):</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">dict</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_init_trait_delegate_listener</span><span class="p">(</span>
                     <span class="n">name</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__listener_traits__</span><span class="p">[</span> <span class="n">name</span> <span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_trait_delegate_name</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">pattern</span> <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Returns the fully-formed &#39;on_trait_change&#39; name for a specified</span>
<span class="sd">            delegate.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">pattern</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;*&#39;</span><span class="p">:</span>
            <span class="n">pattern</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span> <span class="n">pattern</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">__class__</span><span class="o">.</span><span class="n">__prefix__</span><span class="p">,</span>
                                    <span class="n">name</span> <span class="p">)</span>

        <span class="k">return</span> <span class="n">pattern</span>

<span class="c"># Patch the definition of _HasTraits to be the real &#39;HasTraits&#39;:</span></div>
<span class="n">_HasTraits</span> <span class="o">=</span> <span class="n">HasTraits</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;HasStrictTraits&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="HasStrictTraits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasStrictTraits">[docs]</a><span class="k">class</span> <span class="nc">HasStrictTraits</span> <span class="p">(</span> <span class="n">HasTraits</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class guarantees that any object attribute that does not have an</span>
<span class="sd">    explicit or wildcard trait definition results in an exception.</span>

<span class="sd">    This feature can be useful in cases where a more rigorous software</span>
<span class="sd">    engineering approach is being used than is typical for Python programs. It</span>
<span class="sd">    also helps prevent typos and spelling mistakes in attribute names from</span>
<span class="sd">    going unnoticed; a misspelled attribute name typically causes an exception.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span> <span class="o">=</span> <span class="n">Disallow</span>   <span class="c"># Disallow access to any traits not explicitly defined</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;HasPrivateTraits&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="HasPrivateTraits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.HasPrivateTraits">[docs]</a><span class="k">class</span> <span class="nc">HasPrivateTraits</span> <span class="p">(</span> <span class="n">HasTraits</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; This class ensures that any public object attribute that does not have</span>
<span class="sd">    an explicit or wildcard trait definition results in an exception, but</span>
<span class="sd">    &quot;private&quot; attributes (whose names start with &#39;_&#39;) have an initial value of</span>
<span class="sd">    **None**, and are not type-checked.</span>

<span class="sd">    This feature is useful in cases where a class needs private attributes to</span>
<span class="sd">    keep track of its internal object state, which are not part of the class&#39;s</span>
<span class="sd">    public API. Such attributes do not need to be type-checked, because they are</span>
<span class="sd">    manipulated only by the (presumably correct) methods of the class itself.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Make &#39;private&#39; traits (leading &#39;_&#39;) have no type checking:</span>
    <span class="n">__</span> <span class="o">=</span> <span class="n">Any</span><span class="p">(</span> <span class="n">private</span> <span class="o">=</span> <span class="bp">True</span><span class="p">,</span> <span class="n">transient</span> <span class="o">=</span> <span class="bp">True</span> <span class="p">)</span>

    <span class="c"># Disallow access to all other traits not explicitly defined:</span>
    <span class="n">_</span>  <span class="o">=</span> <span class="n">Disallow</span>


<span class="c">#------------------------------------------------------------------------------</span>
<span class="c"># ABC classes with traits: (where available)</span>
<span class="c">#------------------------------------------------------------------------------</span></div>
<span class="k">try</span><span class="p">:</span>

    <span class="kn">import</span> <span class="nn">abc</span>


<div class="viewcode-block" id="ABCMetaHasTraits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.ABCMetaHasTraits">[docs]</a>    <span class="k">class</span> <span class="nc">ABCMetaHasTraits</span><span class="p">(</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">,</span> <span class="n">MetaHasTraits</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A MetaHasTraits subclass which also inherits from</span>
<span class="sd">        abc.ABCMeta.</span>

<span class="sd">        .. note:: The ABCMeta class is cooperative and behaves nicely</span>
<span class="sd">            with MetaHasTraits, provided it is inherited first.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>

</div>
<div class="viewcode-block" id="ABCHasTraits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.ABCHasTraits">[docs]</a>    <span class="k">class</span> <span class="nc">ABCHasTraits</span><span class="p">(</span><span class="n">HasTraits</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A HasTraits subclass which enables the features of Abstract</span>
<span class="sd">        Base Classes (ABC). See the &#39;abc&#39; module in the standard library</span>
<span class="sd">        for more information.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">ABCMetaHasTraits</span>

</div>
<div class="viewcode-block" id="ABCHasStrictTraits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.ABCHasStrictTraits">[docs]</a>    <span class="k">class</span> <span class="nc">ABCHasStrictTraits</span><span class="p">(</span><span class="n">ABCHasTraits</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; A HasTraits subclass which behaves like HasStrictTraits but</span>
<span class="sd">        also enables the features of Abstract Base Classes (ABC). See the</span>
<span class="sd">        &#39;abc&#39; module in the standard library for more information.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">Disallow</span>
</div>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="k">pass</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Singleton classes with traits:</span>
<span class="c">#</span>
<span class="c">#  This code is based on a recipe taken from:</span>
<span class="c">#      http://aspn.activestate.com/ASPN/Cookbook/Python/Recipe/66531</span>
<span class="c">#  Specifically, the implementation of Oren Tirosh is used.</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="SingletonHasTraits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.SingletonHasTraits">[docs]</a><span class="k">class</span> <span class="nc">SingletonHasTraits</span> <span class="p">(</span> <span class="n">HasTraits</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Singleton class that support trait attributes.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__new__</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">traits</span> <span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s">&#39;_the_instance&#39;</span> <span class="ow">in</span> <span class="n">cls</span><span class="o">.</span><span class="n">__dict__</span><span class="p">:</span>
            <span class="n">cls</span><span class="o">.</span><span class="n">_the_instance</span> <span class="o">=</span> <span class="n">HasTraits</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">traits</span> <span class="p">)</span>
        <span class="k">return</span> <span class="n">cls</span><span class="o">.</span><span class="n">_the_instance</span>
</div>
<div class="viewcode-block" id="SingletonHasStrictTraits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.SingletonHasStrictTraits">[docs]</a><span class="k">class</span> <span class="nc">SingletonHasStrictTraits</span> <span class="p">(</span> <span class="n">HasStrictTraits</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Singleton class that supports strict trait attributes.</span>

<span class="sd">        Non-trait attributes generate an exception.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__new__</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">traits</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">SingletonHasTraits</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">traits</span> <span class="p">)</span>
</div>
<div class="viewcode-block" id="SingletonHasPrivateTraits"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.SingletonHasPrivateTraits">[docs]</a><span class="k">class</span> <span class="nc">SingletonHasPrivateTraits</span> <span class="p">(</span> <span class="n">HasPrivateTraits</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Singleton class that supports trait attributes, with private attributes</span>
<span class="sd">        being unchecked.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__new__</span> <span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">traits</span> <span class="p">):</span>
        <span class="k">return</span> <span class="n">SingletonHasTraits</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span> <span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">traits</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  Defines a &#39;vetoable&#39; request object and an associated event:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="Vetoable"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.Vetoable">[docs]</a><span class="k">class</span> <span class="nc">Vetoable</span> <span class="p">(</span> <span class="n">HasStrictTraits</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; Defines a &#39;vetoable&#39; request object and an associated event.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c"># Should the request be vetoed? (Can only be set to &#39;True&#39;)</span>
    <span class="n">veto</span> <span class="o">=</span> <span class="n">Bool</span><span class="p">(</span> <span class="bp">False</span> <span class="p">)</span>

    <span class="k">def</span> <span class="nf">_veto_changed</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">state</span> <span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_trait_veto_notify</span><span class="p">(</span> <span class="n">state</span> <span class="p">)</span>
</div>
<span class="n">VetoableEvent</span> <span class="o">=</span> <span class="n">Event</span><span class="p">(</span> <span class="n">Vetoable</span> <span class="p">)</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;Interface&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>

<div class="viewcode-block" id="Interface"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.Interface">[docs]</a><span class="k">class</span> <span class="nc">Interface</span> <span class="p">(</span> <span class="n">HasTraits</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; The base class for all interfaces.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">MetaInterface</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;ISerializable&#39; interface:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="ISerializable"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.ISerializable">[docs]</a><span class="k">class</span> <span class="nc">ISerializable</span> <span class="p">(</span> <span class="n">Interface</span> <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot; A class that implemented ISerializable requires that all HasTraits</span>
<span class="sd">        objects saved as part of its state also implement ISerializable.</span>
<span class="sd">    &quot;&quot;&quot;</span>

<span class="c">#-------------------------------------------------------------------------------</span>
<span class="c">#  &#39;traits_super&#39; class:</span>
<span class="c">#-------------------------------------------------------------------------------</span>
</div>
<div class="viewcode-block" id="traits_super"><a class="viewcode-back" href="../../traits_api_reference/has_traits.html#traits.has_traits.traits_super">[docs]</a><span class="k">class</span> <span class="nc">traits_super</span> <span class="p">(</span> <span class="nb">super</span> <span class="p">):</span>

    <span class="k">def</span> <span class="nf">__getattribute__</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="n">name</span> <span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">super</span><span class="p">(</span> <span class="n">traits_super</span><span class="p">,</span> <span class="bp">self</span> <span class="p">)</span><span class="o">.</span><span class="n">__getattribute__</span><span class="p">(</span> <span class="n">name</span> <span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_noop</span>

    <span class="k">def</span> <span class="nf">_noop</span> <span class="p">(</span> <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span> <span class="p">):</span>
        <span class="k">pass</span>
</pre></div></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="../../index.html">
              <img class="logo" src="../../_static/e-logo-rev.png" alt="Logo"/>
            </a></p>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li><a href="../../index.html">Traits 4 User Manual</a> &raquo;</li>
          <li><a href="../index.html" >Module code</a> &raquo;</li>
  
    <li><a href="#">traits.has_traits</a></li>
  

      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2008-2011, Enthought.
      Last updated on Feb 22, 2013.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.2.
    </div>
  </body>
</html>